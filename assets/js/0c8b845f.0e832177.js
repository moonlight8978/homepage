(self.webpackChunkmoonlight_8978_github_io=self.webpackChunkmoonlight_8978_github_io||[]).push([[7927],{3905:function(e,t,n){"use strict";n.d(t,{Zo:function(){return s},kt:function(){return m}});var r=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var u=r.createContext({}),c=function(e){var t=r.useContext(u),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},s=function(e){var t=c(e.components);return r.createElement(u.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,i=e.mdxType,a=e.originalType,u=e.parentName,s=l(e,["components","mdxType","originalType","parentName"]),d=c(n),m=i,h=d["".concat(u,".").concat(m)]||d[m]||p[m]||a;return n?r.createElement(h,o(o({ref:t},s),{},{components:n})):r.createElement(h,o({ref:t},s))}));function m(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var a=n.length,o=new Array(a);o[0]=d;var l={};for(var u in t)hasOwnProperty.call(t,u)&&(l[u]=t[u]);l.originalType=e,l.mdxType="string"==typeof e?e:i,o[1]=l;for(var c=2;c<a;c++)o[c]=n[c];return r.createElement.apply(null,o)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},4311:function(e,t,n){"use strict";n.r(t),n.d(t,{frontMatter:function(){return l},metadata:function(){return u},toc:function(){return c},default:function(){return p}});var r=n(2122),i=n(9756),a=(n(7294),n(3905)),o=["components"],l={},u={unversionedId:"www/oauth2-in-action",id:"www/oauth2-in-action",isDocsHomePage:!1,title:"OAuth2 in Action",description:"What OAuth2 do?",source:"@site/books/www/oauth2-in-action.md",sourceDirName:"www",slug:"/www/oauth2-in-action",permalink:"/books/www/oauth2-in-action",editUrl:"https://github.com/moonlight8978/moonlight8978.github.io/edit/v2/books/books/www/oauth2-in-action.md",version:"current",lastUpdatedAt:1623035465,formattedLastUpdatedAt:"6/7/2021",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Optimize Subquery v\u1edbi Semijoin transformation",permalink:"/books/mysql-chap8/subquery"}},c=[{value:"What OAuth2 do?",id:"what-oauth2-do",children:[]},{value:"Flow",id:"flow",children:[]},{value:"Components",id:"components",children:[{value:"Access token",id:"access-token",children:[]},{value:"Scopes",id:"scopes",children:[]},{value:"Refresh token",id:"refresh-token",children:[]},{value:"Authorization grants",id:"authorization-grants",children:[]}]},{value:"Implement",id:"implement",children:[{value:"Register OAuth client",id:"register-oauth-client",children:[]},{value:"Send authorization request",id:"send-authorization-request",children:[]},{value:"Process callback",id:"process-callback",children:[]},{value:"Adding cross-site protection with <code>state</code> parameter",id:"adding-cross-site-protection-with-state-parameter",children:[]}]}],s={toc:c};function p(e){var t=e.components,l=(0,i.Z)(e,o);return(0,a.kt)("wrapper",(0,r.Z)({},s,l,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h2",{id:"what-oauth2-do"},"What OAuth2 do?"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Delegation protocol (Security protocol)",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Let someone who controls a resource allow a software to access that resource on their behalf"),(0,a.kt)("li",{parentName:"ul"},"The application requests owner of the resource, receives ",(0,a.kt)("em",{parentName:"li"},"tokens")," that can use to access the resource."),(0,a.kt)("li",{parentName:"ul"},"OAuth2 can limit the client's access on the resource"))),(0,a.kt)("li",{parentName:"ul"},"OAuth is defined under HTTP",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"OAuth2 with Bearer token provides no signatures, it is not meant to be used outside of HTTPS"))),(0,a.kt)("li",{parentName:"ul"},"OAuth is not an authentication protocol",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"The resource owner does not need to know who request to access the resource, only that ",(0,a.kt)("em",{parentName:"li"},"somebody")," said it was OK to access the resource."))),(0,a.kt)("li",{parentName:"ul"},"OAuth is not define authorization-process mechanism.")),(0,a.kt)("h2",{id:"flow"},"Flow"),(0,a.kt)("p",null,(0,a.kt)("img",{src:n(6129).Z})),(0,a.kt)("h2",{id:"components"},"Components"),(0,a.kt)("h3",{id:"access-token"},"Access token"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"aka ",(0,a.kt)("em",{parentName:"li"},"token")),(0,a.kt)("li",{parentName:"ul"},"Are opaque to the client. The client does not need to know about the token it self, client's job is to carry the token")),(0,a.kt)("h3",{id:"scopes"},"Scopes"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"A set of rights at a protected resource.")),(0,a.kt)("h3",{id:"refresh-token"},"Refresh token"),(0,a.kt)("h3",{id:"authorization-grants"},"Authorization grants"),(0,a.kt)("h2",{id:"implement"},"Implement"),(0,a.kt)("h3",{id:"register-oauth-client"},"Register OAuth client"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"client_id")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"client_secret"),":",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Shared secret in order to authenticate when talking with the authorization server"),(0,a.kt)("li",{parentName:"ul"},"Can be passed to authorization server in many ways, e.g. Basic Authorization"))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"redirect_uris"))),(0,a.kt)("h3",{id:"send-authorization-request"},"Send authorization request"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"/authorize"),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"response_type=code")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"client_id={client_id}")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"redirect_uri={redirect_uri}"))))),(0,a.kt)("p",null,"=> 302 Redirect to ",(0,a.kt)("inlineCode",{parentName:"p"},"{redirect_uri}?code={code}")),(0,a.kt)("h3",{id:"process-callback"},"Process callback"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"/token"),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"grant_type=authorization_code")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"code={code}")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"redirect_uri={redirect_uri}")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"client_secret={client_secret}"))))),(0,a.kt)("p",null,"=> ",(0,a.kt)("inlineCode",{parentName:"p"},'{ access_token: "token", "refresh_token": "token", "token_type": "Bearer" }')),(0,a.kt)("h3",{id:"adding-cross-site-protection-with-state-parameter"},"Adding cross-site protection with ",(0,a.kt)("inlineCode",{parentName:"h3"},"state")," parameter"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Any time someone comes to http://localhost:9000/ callback, the client will naively take in the input code value and attempt to post it to the authorization server"),(0,a.kt)("p",{parentName:"li"},"=> Waste both client and server resources and potentially causing our client to fetch a token it never requested")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Client add ",(0,a.kt)("inlineCode",{parentName:"p"},"state")," parameter to ",(0,a.kt)("inlineCode",{parentName:"p"},"/authorize")," request"),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Authorization returns ",(0,a.kt)("inlineCode",{parentName:"li"},"code")," with ",(0,a.kt)("inlineCode",{parentName:"li"},"state")),(0,a.kt)("li",{parentName:"ul"},"Client check if ",(0,a.kt)("inlineCode",{parentName:"li"},"state")," matches o\x10ld generated one, then send request to authorization server")))))}p.isMDXComponent=!0},6129:function(e,t,n){"use strict";t.Z=n.p+"assets/images/flow-8810b586fb1b6a6103a797f65df3b79c.png"}}]);