(self.webpackChunkmoonlight_8978_github_io=self.webpackChunkmoonlight_8978_github_io||[]).push([[8414],{3905:function(n,t,e){"use strict";e.d(t,{Zo:function(){return p},kt:function(){return g}});var a=e(7294);function r(n,t,e){return t in n?Object.defineProperty(n,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[t]=e,n}function i(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),e.push.apply(e,a)}return e}function o(n){for(var t=1;t<arguments.length;t++){var e=null!=arguments[t]?arguments[t]:{};t%2?i(Object(e),!0).forEach((function(t){r(n,t,e[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):i(Object(e)).forEach((function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(e,t))}))}return n}function l(n,t){if(null==n)return{};var e,a,r=function(n,t){if(null==n)return{};var e,a,r={},i=Object.keys(n);for(a=0;a<i.length;a++)e=i[a],t.indexOf(e)>=0||(r[e]=n[e]);return r}(n,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);for(a=0;a<i.length;a++)e=i[a],t.indexOf(e)>=0||Object.prototype.propertyIsEnumerable.call(n,e)&&(r[e]=n[e])}return r}var c=a.createContext({}),h=function(n){var t=a.useContext(c),e=t;return n&&(e="function"==typeof n?n(t):o(o({},t),n)),e},p=function(n){var t=h(n.components);return a.createElement(c.Provider,{value:t},n.children)},s={inlineCode:"code",wrapper:function(n){var t=n.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(n,t){var e=n.components,r=n.mdxType,i=n.originalType,c=n.parentName,p=l(n,["components","mdxType","originalType","parentName"]),u=h(e),g=r,d=u["".concat(c,".").concat(g)]||u[g]||s[g]||i;return e?a.createElement(d,o(o({ref:t},p),{},{components:e})):a.createElement(d,o({ref:t},p))}));function g(n,t){var e=arguments,r=t&&t.mdxType;if("string"==typeof n||r){var i=e.length,o=new Array(i);o[0]=u;var l={};for(var c in t)hasOwnProperty.call(t,c)&&(l[c]=t[c]);l.originalType=n,l.mdxType="string"==typeof n?n:r,o[1]=l;for(var h=2;h<i;h++)o[h]=e[h];return a.createElement.apply(null,o)}return a.createElement.apply(null,e)}u.displayName="MDXCreateElement"},6796:function(n,t,e){"use strict";e.r(t),e.d(t,{frontMatter:function(){return l},metadata:function(){return c},toc:function(){return h},default:function(){return s}});var a=e(2122),r=e(9756),i=(e(7294),e(3905)),o=["components"],l={slug:"gioi-thieu-ve-kubernetes",title:"Gi\u1edbi thi\u1ec7u v\u1ec1 Kubernetes",author:"L\xea S\u0129 B\xedch",author_title:"Ruby on Rails/React Developer",author_url:"https://github.com/moonlight8978",tags:["devops","kubernetes","introduction"]},c={permalink:"/blog/gioi-thieu-ve-kubernetes",editUrl:"https://github.com/facebook/docusaurus/edit/master/website/blog/blog/2019-11-21-introduce-to-kubernetes.md",source:"@site/blog/2019-11-21-introduce-to-kubernetes.md",title:"Gi\u1edbi thi\u1ec7u v\u1ec1 Kubernetes",description:"Ng\xe0y nay, container \u0111\xe3 l\xe0 1 th\u1ee9 g\xec \u0111\xf3 qu\xe1 ph\u1ed5 bi\u1ebfn, nh\u1eefng n\u1ec1n t\u1ea3ng cloud c\u1ee7a Amazon, Google, hay Microsoft, v.v... \u0111\u1ec1u \u0111\xe3 h\u1ed7 tr\u1ee3 deploy container. V\xe0 \u1edf local, hay nh\u1eefng server test, m\u1ecdi ng\u01b0\u1eddi c\u0169ng \u0111ang d\u1ea7n chu\u1ea9n sang container v\xec s\u1ef1 ti\u1ec7n l\u1ee3i c\u1ee7a ch\xfang.",date:"2019-11-21T00:00:00.000Z",formattedDate:"November 21, 2019",tags:[{label:"devops",permalink:"/blog/tags/devops"},{label:"kubernetes",permalink:"/blog/tags/kubernetes"},{label:"introduction",permalink:"/blog/tags/introduction"}],readingTime:10.52,truncated:!1,prevItem:{title:"C\u01b0\u1ee1i React Native xem Appium (Ph\u1ea7n 1 - C\xf9ng t\xecm hi\u1ec3u c\xe1ch ho\u1ea1t \u0111\u1ed9ng c\u1ee7a Appium)",permalink:"/blog/cuoi-react-native-xem-appium-phan-1-cung-tim-hieu-cach-hoat-dong-cua-appium"},nextItem:{title:"T\u1ed1i \u01b0u m\u1ec7nh \u0111\u1ec1 WHERE (MySQL)",permalink:"/blog/toi-uu-menh-de-where-mysql"}},h=[{value:"2.1 Master components",id:"21-master-components",children:[]},{value:"2.2 Node components",id:"22-node-components",children:[]},{value:"2.3 Ho\u1ea1t \u0111\u1ed9ng",id:"23-ho\u1ea1t-\u0111\u1ed9ng",children:[]},{value:"3.1 Pod",id:"31-pod",children:[]},{value:"3.2 Networking",id:"32-networking",children:[]},{value:"3.3 Storage - Volume",id:"33-storage---volume",children:[]}],p={toc:h};function s(n){var t=n.components,e=(0,r.Z)(n,o);return(0,i.kt)("wrapper",(0,a.Z)({},p,e,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"Ng\xe0y nay, container \u0111\xe3 l\xe0 1 th\u1ee9 g\xec \u0111\xf3 qu\xe1 ph\u1ed5 bi\u1ebfn, nh\u1eefng n\u1ec1n t\u1ea3ng cloud c\u1ee7a Amazon, Google, hay Microsoft, v.v... \u0111\u1ec1u \u0111\xe3 h\u1ed7 tr\u1ee3 deploy container. V\xe0 \u1edf local, hay nh\u1eefng server test, m\u1ecdi ng\u01b0\u1eddi c\u0169ng \u0111ang d\u1ea7n chu\u1ea9n sang container v\xec s\u1ef1 ti\u1ec7n l\u1ee3i c\u1ee7a ch\xfang."),(0,i.kt)("p",null,"Tuy nhi\xean khi s\u1ed1 l\u01b0\u1ee3ng container l\u1edbn d\u1ea7n, ch\xfang ng\xe0y c\xe0ng tr\u1edf n\xean r\u1eafc r\u1ed1i, vi\u1ec7c control resource, network, volume c\u1ee7a m\u1ed9t s\u1ed1 l\u01b0\u1ee3ng l\u1edbn container ng\xe0y c\xe0ng kh\xf3. Ch\xednh v\xec l\xfd do \u0111\xf3, m\u1ed9t s\u1ed1 n\u1ec1n t\u1ea3ng qu\u1ea3n l\xfd container \u0111\xe3 ra \u0111\u1eddi nh\u01b0 Docker Swarm, Kubernetes, ..."),(0,i.kt)("p",null,"V\u1edbi m\u1ed9t h\u1ec7 th\u1ed1ng nh\u1ecf, ta c\xf3 th\u1ec3 s\u1eed d\u1ee5ng Docker Swarm, s\u1eed d\u1ee5ng n\xf3 r\u1ea5t d\u1ec5 v\xe0 \u0111\u01a1n gi\u1ea3n. Kubernetes cho ph\xe9p ta customize nhi\u1ec1u th\u1ee9 trong h\u1ec7 th\u1ed1ng h\u01a1n, tuy nhi\xean c\xe1i gi\xe1 c\u1ee7a n\xf3 l\xe0 kh\xf3 s\u1eed d\u1ee5ng h\u01a1n nhi\u1ec1u Docker Swarm."),(0,i.kt)("p",null,"Note: Ta kh\xf4ng bao gi\u1edd so s\xe1nh Kubernetes v\u1edbi Docker, v\xec k8s th\u1ee9 l\xe0 management tool, c\xf2n docker l\xe0 container runtime."),(0,i.kt)("h1",{id:"2-ki\u1ebfn-tr\xfac-h\u1ea1-t\u1ea7ng-c\u1ee7a-kubernetes"},"2. Ki\u1ebfn tr\xfac h\u1ea1 t\u1ea7ng c\u1ee7a Kubernetes"),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://images.viblo.asia/8fd57971-e1c9-41dd-b205-0ce88a356e50.png",alt:null})),(0,i.kt)("h3",{id:"21-master-components"},"2.1 Master components"),(0,i.kt)("p",null,"Nh\u1eefng components tr\xean master node s\u1ebd \u0111\xf3ng vai tr\xf2 l\xe0 control plane c\u1ee7a cluster. VD nh\u01b0: scheduling c\xe1c pod, ..."),(0,i.kt)("h5",{id:"211-etcd"},"2.1.1 etcd"),(0,i.kt)("p",null,"\u0110\xe2y l\xe0 database ph\xe2n t\xe1n, s\u1eed d\u1ee5ng Raft l\xe0m c\u01a1 ch\u1ebf \u0111\u1ed3ng thu\u1eadn."),(0,i.kt)("p",null,"State c\u1ee7a cluster (config, node info, IP addresses, ...) \u0111\u1ec1u \u0111\u01b0\u1ee3c l\u01b0u tr\u1eef t\u1ea1i \u0111\xe2y."),(0,i.kt)("h5",{id:"212-kube-scheduler"},"2.1.2 kube-scheduler"),(0,i.kt)("p",null,"C\xf3 nhi\u1ec7m v\u1ee5 schedule pod t\u1edbi nh\u1eefng node c\xf3 \u0111\u1ee7 resource, v\xe0 \u0111\u1ea3m b\u1ea3o pod \u0111\u1ea1t \u0111\u01b0\u1ee3c expected status."),(0,i.kt)("p",null,"C\xf3 th\u1ec3 hi\u1ec3u \u0111\u01a1n gi\u1ea3n \u0111\xe2y l\xe0 m\u1ed9t v\xf2ng l\u1eb7p v\xf4 t\u1eadn, \u0111\u01b0a nh\u1eefng pod m\u1edbi \u0111\u01b0\u1ee3c t\u1ea1o v\xe0o 1 queue, t\u1eebng item trong \u0111\xf3 s\u1ebd \u0111\u01b0\u1ee3c schedule t\u1edbi node th\u1ecfa m\xe3n."),(0,i.kt)("h5",{id:"213-kube-apiserver"},"2.1.3 kube-apiserver"),(0,i.kt)("p",null,"API Server \u0111\u01a1n thu\u1ea7n l\xe0 1 REST API c\u1ee7a Kubernetes cluster."),(0,i.kt)("p",null,"Khi mu\u1ed1n t\u1ea1o, c\u1eadp nh\u1eadt, hay x\xf3a nh\u1eefng resource c\u1ee7a h\u1ec7 th\u1ed1ng nh\u01b0 pod, ingress, ... th\xec \u0111\u1ec1u c\u1ea7n th\xf4ng qua API Server, ch\u1ee9 kh\xf4ng call th\u1eb3ng t\u1edbi kube-scheduler, etcd, ..."),(0,i.kt)("h5",{id:"214-kube-controller-manager"},"2.1.4 kube-controller-manager"),(0,i.kt)("p",null,"Ch\u1ea1y nhi\u1ec1u controller process. M\u1ed7i controller c\xf3 nhi\u1ec7m v\u1ee5 kh\xe1c nhau nh\u01b0:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Node Controller"),(0,i.kt)("li",{parentName:"ul"},"Replication Controller"),(0,i.kt)("li",{parentName:"ul"},"...")),(0,i.kt)("h3",{id:"22-node-components"},"2.2 Node components"),(0,i.kt)("p",null,"L\xe0 nh\u1eefng component \u0111\u01b0\u1ee3c c\xe0i \u0111\u1eb7t tr\xean t\u1ea5t c\u1ea3 c\xe1c node, gi\xfap qu\u1ea3n l\xfd container tr\xean node, logging, qu\u1ea3n l\xfd network, ..."),(0,i.kt)("h5",{id:"221-kubelet"},"2.2.1 kubelet"),(0,i.kt)("p",null,"C\xf3 nhi\u1ec7m v\u1ee5 qu\u1ea3n l\xfd container, \u0111\u1ea3m b\u1ea3o container ch\u1ea1y ch\xednh x\xe1c, kubelet ch\u1ec9 qu\u1ea3n l\xfd container do k8s t\u1ea1o."),(0,i.kt)("h5",{id:"222-kube-proxy"},"2.2.2 kube-proxy"),(0,i.kt)("p",null,"L\xe0 m\u1ed9t network proxy, d\xf9ng \u0111\u1ec3 forward request t\u1edbi h\u1ea1 t\u1ea7ng c\u1ee7a k8s."),(0,i.kt)("h5",{id:"223-container-runtime"},"2.2.3 Container runtime"),(0,i.kt)("p",null,"Ch\u1eafn ch\u1eafn ta kh\xf4ng th\u1ec3 thi\u1ebfu runtime cho container, n\xf3 c\xf3 th\u1ec3 l\xe0 rkt, Docker, ... hay b\u1ea5t c\u1ee9 th\u1ee9 g\xec kh\xe1c."),(0,i.kt)("h3",{id:"23-ho\u1ea1t-\u0111\u1ed9ng"},"2.3 Ho\u1ea1t \u0111\u1ed9ng"),(0,i.kt)("p",null,"Ch\xfang ta s\u1ebd c\xf9ng xem nh\u1eefng component tr\xean s\u1ebd k\u1ebft h\u1ee3p v\u1edbi nhau ho\u1ea1t \u0111\u1ed9ng ra sao, th\xf4ng qua vi\u1ec7c t\u1ea1o 1 Pod qua ",(0,i.kt)("inlineCode",{parentName:"p"},"kubectl")," CLI."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Pod")," \u1edf \u0111\xe2y c\xf3 th\u1ec3 coi l\xe0 1 m\xe1y \u1ea3o, hay 1 container nh\u01b0 Docker cho d\u1ec5 h\xecnh dung."),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://images.viblo.asia/f19795c9-fbc9-48e1-9391-53fc439c1391.jpg",alt:null})),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Tr\u01b0\u1edbc ti\xean ta s\u1eed d\u1ee5ng ",(0,i.kt)("inlineCode",{parentName:"li"},"kubectl")," \u0111\u1ec3 y\xeau c\u1ea7u t\u1ea1o 1 Pod. B\u1ea3n ch\u1ea5t c\u1ee7a command n\xe0y l\xe0 s\u1ebd th\u1ef1c hi\u1ec7n 1 HTTP request t\u1edbi ",(0,i.kt)("strong",{parentName:"li"},"apiserver")," c\u1ee7a cluster."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"apiserver")," s\u1ebd th\u1ef1c hi\u1ec7n ghi l\u1ea1i current state, v\xe0 desired state c\u1ee7a cluster l\u1ea1i v\xe0o ",(0,i.kt)("strong",{parentName:"li"},"etcd")," (asynchronous)"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"etcd")," s\u1ebd notify l\u1ea1i ",(0,i.kt)("strong",{parentName:"li"},"apiserver")," khi entry \u0111\u01b0\u1ee3c t\u1ea1o th\xe0nh c\xf4ng"),(0,i.kt)("li",{parentName:"ul"},"Ti\u1ebfp theo ",(0,i.kt)("strong",{parentName:"li"},"kube-scheduler")," s\u1ebd th\u1ef1c hi\u1ec7n vi\u1ec7c schedule Pod. Khi t\xecm th\u1ea5y node th\xedch h\u1ee3p, n\xf3 s\u1ebd b\xe1o cho ",(0,i.kt)("strong",{parentName:"li"},"apiserver")," l\xe0 Pod \u0111\xf3 \u0111\xe3 \u0111\u01b0\u1ee3c bind v\xe0o node n\xe0o. ",(0,i.kt)("strong",{parentName:"li"},"apiserver")," s\u1ebd l\u1ea1i update v\xe0o ",(0,i.kt)("strong",{parentName:"li"},"etcd")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"kubelet")," t\u1ea1i node \u0111\xf3 s\u1ebd th\u1ef1c hi\u1ec7n vi\u1ec7c theo d\xf5i container t\u1ea1o b\u1edfi ",(0,i.kt)("strong",{parentName:"li"},"container runtime")," (Docker), xem ch\xfang c\xf3 ch\u1ea1y \u0111\xfang v\u1edbi PodSpec kh\xf4ng. ",(0,i.kt)("strong",{parentName:"li"},"kubelet")," s\u1ebd g\u1ecdi t\u1edbi ",(0,i.kt)("strong",{parentName:"li"},"apiserver")," \u0111\u1ec3 update state c\u1ee7a Pod \u0111\xf3 th\u01b0\u1eddng xuy\xean.")),(0,i.kt)("h1",{id:"3-ki\u1ebfn-tr\xfac-c\u1ee7a-\u1ee9ng-d\u1ee5ng-tr\xean-kubernetes"},"3. Ki\u1ebfn tr\xfac c\u1ee7a \u1ee9ng d\u1ee5ng tr\xean Kubernetes"),(0,i.kt)("p",null,"Ta s\u1ebd ch\u1ec9 t\u1eadp trung v\xe0o 3 y\u1ebfu t\u1ed1 ch\xednh \u0111\u1ec3 m\u1ed9t h\u1ec7 th\u1ed1ng c\xf3 th\u1ec3 ho\u1ea1t \u0111\u1ed9ng \u0111\u01b0\u1ee3c:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"\u1ee8ng d\u1ee5ng"),(0,i.kt)("li",{parentName:"ul"},"Network"),(0,i.kt)("li",{parentName:"ul"},"Storage")),(0,i.kt)("h3",{id:"31-pod"},"3.1 Pod"),(0,i.kt)("h5",{id:"pod-l\xe0-g\xec"},"Pod l\xe0 g\xec"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Pod")," l\xe0 \u0111\u01a1n v\u1ecb nh\u1ecf nh\u1ea5t trong cluster. M\u1ed7i Pod c\xf3 IP ri\xeang, v\xe0 c\xf3 th\u1ec3 ch\u1ee9a nhi\u1ec1u container, nh\u1eefng container trong c\xf9ng 1 Pod c\xf3 th\u1ec3 giao ti\u1ebfp v\u1edbi nhau qua localhost. V\xec v\u1eady, c\xf3 th\u1ec3 coi Pod l\xe0 m\u1ed9t m\xe1y \u1ea3o cho d\u1ec5 h\xecnh dung."),(0,i.kt)("p",null,"Tuy nhi\xean \u0111\u1ec3 \u0111\u01a1n gi\u1ea3n, ng\u01b0\u1eddi ta th\u01b0\u1eddng ch\u1ec9 ch\u1ea1y 1 container tr\xean m\u1ed7i Pod, khi \u0111\xf3 ta s\u1ebd l\xe0m vi\u1ec7c v\u1edbi Pod thay v\xec v\u1edbi t\u1eebng container ri\xeang l\u1ebb."),(0,i.kt)("h5",{id:"init-container"},"Init container"),(0,i.kt)("p",null,"Pod c\xf3 h\u1ed7 tr\u1ee3 init container (1 ho\u1eb7c nhi\u1ec1u \u0111\u1ec1u \u0111\u01b0\u1ee3c). Tr\u01b0\u1edbc khi app container (container ch\xednh - v\xed d\u1ee5 container v\u1edbi command ",(0,i.kt)("inlineCode",{parentName:"p"},"rails s"),") ch\u1ea1y, t\u1ea5t c\u1ea3 init container s\u1ebd \u0111\u01b0\u1ee3c ch\u1ea1y l\u1ea7n l\u01b0\u1ee3t, c\xe1i tr\u01b0\u1edbc th\xe0nh c\xf4ng r\u1ed3i \u0111\u1ebfn c\xe1i sau ch\u1ea1y."),(0,i.kt)("p",null,"V\xed d\u1ee5 nh\u01b0 1 \u1ee9ng d\u1ee5ng Rails, ta c\xf3 th\u1ec3 settings ",(0,i.kt)("inlineCode",{parentName:"p"},"rails s")," l\xe0m app container, c\xf2n ",(0,i.kt)("inlineCode",{parentName:"p"},"rails db:create db:migrate")," s\u1ebd l\xe0m init container."),(0,i.kt)("h5",{id:"controller"},"Controller"),(0,i.kt)("p",null,"Controller l\xe0 1 concept trong Kubernetes, n\xf3 d\xf9ng \u0111\u1ec3 theo d\xf5i 1 lo\u1ea1i Resource n\xe0o \u0111\xf3. ",(0,i.kt)("strong",{parentName:"p"},"kube-controller-manager")," c\xf3 nhi\u1ec7m v\u1ee5 qu\u1ea3n l\xfd nh\u1eefng controller n\xe0y."),(0,i.kt)("p",null,"V\u1ec1 m\u1eb7t k\u1ef9 thu\u1eadt th\xec \u0111\xe2y \u0111\u01a1n thu\u1ea7n l\xe0 1 v\xf2ng l\u1eb7p v\xf4 h\u1ea1n (",(0,i.kt)("em",{parentName:"p"},"control loop"),") \u0111\u1ec3 c\xf3 th\u1ec3 \u0111i\u1ec1u ch\u1ec9nh state c\u1ee7a cluster sao cho n\xf3 \u0111\u1ea1t t\u1edbi \u0111\u01b0\u1ee3c desired state."),(0,i.kt)("p",null,"Tuy nhi\xean \u0111ang trong m\u1ee5c Pod n\xean ta s\u1ebd ch\u1ec9 \u0111\u1ec1 c\u1eadp t\u1edbi controller theo d\xf5i Pod trong ph\u1ea7n n\xe0y."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"Deployment"),":"),(0,i.kt)("p",{parentName:"li"},"Ta s\u1ebd s\u1eed d\u1ee5ng ",(0,i.kt)("inlineCode",{parentName:"p"},"Deployment")," khi c\u1ea7n deploy 1 ho\u1eb7c nhi\u1ec1u replica (th\u01b0\u1eddng l\xe0 stateless)."),(0,i.kt)("p",{parentName:"li"},"Th\u1ee9 t\u1ef1 kh\u1edfi \u0111\u1ed9ng, identify c\u1ee7a nh\u1eefng replica (Pod) l\xe0 ho\xe0n to\xe0n ng\u1eabu nhi\xean.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"StatefulSet"),":"),(0,i.kt)("p",{parentName:"li"},"N\u1ebfu app c\u1ee7a ch\xfang ta l\xe0 stateful (v\xed d\u1ee5 nh\u01b0 1 set MySQL v\u1edbi 1 master v\xe0 2 slave), khi \u0111\xf3 vi\u1ec7c c\xf3 1 stable identity l\xe0 r\u1ea5t quan tr\u1ecdng. Ngo\xe0i ra v\u1edbi m\u1ed7i replica trong ",(0,i.kt)("inlineCode",{parentName:"p"},"StatefulSet"),", Kubernetes s\u1ebd cung c\u1ea5p cho n\xf3 m\u1ed9t storage ri\xeang."),(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"StatefulSet")," th\xeam prefix ",(0,i.kt)("inlineCode",{parentName:"p"},"0"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"1"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"2"),", ... l\xe0 th\u1ee9 t\u1ef1 kh\u1edfi \u0111\u1ed9ng c\u1ee7a pod v\xe0o t\xean pod."),(0,i.kt)("p",{parentName:"li"},"Khi \u0111\xf3 network identity, c\u0169ng nh\u01b0 storage c\u1ee7a Pod s\u1ebd tr\u1edf n\xean stable. N\u1ebfu mysql-0 c\u1ee7a ta l\xe0 master, n\xf3 s\u1ebd lu\xf4n l\xe0 master, v\xe0 n\xf3 c\u0169ng lu\xf4n request t\u1edbi storage c\u1ee7a master.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"DaemonSet"),":"),(0,i.kt)("p",{parentName:"li"},"Ta d\xf9ng ",(0,i.kt)("inlineCode",{parentName:"p"},"DaemonSet")," trong tr\u01b0\u1eddng h\u1ee3p mu\u1ed1n t\u1ea5t c\u1ea3 c\xe1c node \u0111\u1ec1u ph\u1ea3i ch\u1ea1y 1 Pod n\xe0o \u0111\xf3."),(0,i.kt)("p",{parentName:"li"},"V\xed d\u1ee5 nh\u01b0 storage cluster nh\u01b0 ",(0,i.kt)("strong",{parentName:"p"},"glusterd"),", hay log agent nh\u01b0 ",(0,i.kt)("strong",{parentName:"p"},"fluentd"),", ...")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"Job"),":"),(0,i.kt)("p",{parentName:"li"},"Khi ta c\u1ea7n ch\u1ea1y one-off Pod. V\xed d\u1ee5 nh\u01b0 vi\u1ec7c import master data.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"CronJob"),":"),(0,i.kt)("p",{parentName:"li"},"Nh\u01b0 t\xean g\u1ecdi c\u1ee7a n\xf3, c\u1ee9 \u0111\u1ecbnh k\xec n\xf3 s\u1ebd t\u1ea1o Pod \u0111\u1ec3 th\u1ef1c hi\u1ec7n job."))),(0,i.kt)("h3",{id:"32-networking"},"3.2 Networking"),(0,i.kt)("h4",{id:"321-service"},"3.2.1 Service"),(0,i.kt)("p",null,"Tr\xean m\xf4i tr\u01b0\u1eddng production, r\u1ea5t hi\u1ebfm khi ta th\u1ea5y 1 service ch\u1ec9 ch\u1ea1y tr\xean 1 server. Thay v\xec th\u1ebf, th\u01b0\u1eddng s\u1ebd c\xf3 2 ho\u1eb7c nhi\u1ec1u h\u01a1n server c\xf9ng ch\u1ea1y, khi server n\xe0y ch\u1ebft, ta c\xf3 th\u1ec3 forward request t\u1edbi nh\u1eefng server heo-th\xec (healthy) c\xf2n l\u1ea1i (trong tr\u01b0\u1eddng h\u1ee3p c\xf3 set load balancer v\xe0 healthcheck), kh\xf4ng l\xe0m cho service c\u1ee7a ta ng\u1ecfm lu\xf4n."),(0,i.kt)("p",null,"Tuy nhi\xean IP c\u1ee7a Pod trong cluster lu\xf4n thay \u0111\u1ed5i, v\u1eady th\xec ta bi\u1ebft ph\u1ea3i setup cho load balancer nh\u01b0 th\u1ebf n\xe0o? V\xe0 \u0111\xe2y ch\xednh l\xe0 \u0111\u1ea5t di\u1ec5n c\u1ee7a ",(0,i.kt)("inlineCode",{parentName:"p"},"Service"),"."),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"Service")," l\xe0 m\u1ed9t t\u1eadp h\u1ee3p c\xe1c Pod, th\u01b0\u1eddng s\u1ebd d\xf9ng ",(0,i.kt)("inlineCode",{parentName:"p"},"label")," \u0111\u1ec3 group c\xe1c Pod."),(0,i.kt)("p",null,"Th\xf4ng th\u01b0\u1eddng, m\u1ed7i ",(0,i.kt)("inlineCode",{parentName:"p"},"Service")," s\u1ebd \u0111\u01b0\u1ee3c g\xe1n cho 1 cluster IP, Kubernetes s\u1ebd cung c\u1ea5p DNS name, v\xe0 \u0111\u1ed3ng th\u1eddi c\u0169ng load-balance cho c\xe1c Pod c\u1ee7a ",(0,i.kt)("inlineCode",{parentName:"p"},"Service"),"."),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://images.viblo.asia/2a7f4968-7280-47eb-a225-60ab2f06ab6e.png",alt:null})),(0,i.kt)("p",null,"Ta c\u0169ng c\xf3 th\u1ec3 s\u1eed d\u1ee5ng ",(0,i.kt)("inlineCode",{parentName:"p"},"Service")," cho external endpoint."),(0,i.kt)("p",null,"V\xed d\u1ee5 khi h\u1ec7 th\u1ed1ng c\u1ea7n call \u0111\u1ebfn ",(0,i.kt)("em",{parentName:"p"},(0,i.kt)("a",{parentName:"em",href:"https://google.com.vn"},"https://google.com.vn")),". Tuy nhi\xean ta l\u1ea1i kh\xf4ng mu\u1ed1n call tr\u1ef1c ti\u1ebfp, hay hardcode trong code, m\xe0 mu\u1ed1n endpoint n\xe0y c\u0169ng tr\u1edf th\xe0nh 1 ph\u1ea7n c\u1ee7a cluster, \u0111\u1ec3 d\u1ec5 qu\u1ea3n l\xfd. Khi \u0111\xf3 ta c\xf3 th\u1ec3 thay \u0111\u1ed5i endpoint n\xe0y m\xe0 kh\xf4ng ph\u1ea3i \u0111\u1ee5ng \u0111\u1ebfn code, hay bi\u1ebfn ENV g\xec \u0111\xf3. Khi \u0111\xf3, ta s\u1ebd define 1 ",(0,i.kt)("inlineCode",{parentName:"p"},"Service"),", v\xe0 set ",(0,i.kt)("inlineCode",{parentName:"p"},"Endpoint")," th\u1ee7 c\xf4ng cho service n\xe0y, thay v\xec s\u1eed d\u1ee5ng ",(0,i.kt)("inlineCode",{parentName:"p"},"label"),"."),(0,i.kt)("p",null,"Ngo\xe0i ra c\xf2n c\xf3 ",(0,i.kt)("inlineCode",{parentName:"p"},"Headless Service"),", lo\u1ea1i service n\xe0y s\u1ebd kh\xf4ng \u0111\u01b0\u1ee3c g\xe1n cluster IP. Ta s\u1ebd s\u1eed d\u1ee5ng khi ta mu\u1ed1n s\u1eed d\u1ee5ng c\xe1ch load balance ri\xeang, kh\xf4ng ph\u1ee5 thu\u1ed9c Kubernetes."),(0,i.kt)("h4",{id:"322-load-balancer"},"3.2.2 Load balancer"),(0,i.kt)("p",null,"Khi t\u1ea1o Service, n\u1ebfu \u0111\xe2y l\xe0 service cho ph\xe9p traffic t\u1eeb b\xean ngo\xe0i Internet, ta ho\xe0n to\xe0n c\xf3 th\u1ec3 s\u1eed d\u1ee5ng Load Balancer c\u1ee7a c\xe1c nh\xe0 cung c\u1ea5p d\u1ecbch v\u1ee5 cloud (th\u01b0\u1eddng l\xe0 L3 Load Balancer)."),(0,i.kt)("p",null,"Khi call t\u1edbi Load Balancer n\xf3i tr\xean, n\xf3 s\u1ebd tr\u1ef1c ti\u1ebfp forward traffic t\u1edbi service trong cluster, thu\u1eadt to\xe1n load-balance s\u1ebd do Load Balancer n\xe0y quy\u1ebft \u0111\u1ecbnh."),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://images.viblo.asia/fdf97441-6cc1-4b42-ac48-342541d0421e.png",alt:null})),(0,i.kt)("h4",{id:"323-ingress"},"3.2.3 Ingress"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"Ingress")," ho\u1ea1t \u0111\u1ed9ng gi\u1ed1ng 1 Reverse Proxy hay Layer 7 Load Balancer. N\xf3 c\u0169ng c\xf3 n\xe9t t\u01b0\u01a1ng \u0111\u1ed3ng v\u1edbi API Gateway."),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"Ingress")," c\xf3 th\u1ec3 \u0111i\u1ec1u h\u01b0\u1edbng c\u1ea3 internal traffic l\u1eabn external traffic d\u1ef1a v\xe0o URL, \u0111\u1ed3ng th\u1eddi cung c\u1ea5p th\xeam c\u1ea3 load balancing gi\u1eefa nh\u1eefng pod c\u1ee7a service. M\u1ed9t \u0111i\u1ec3m \u0111\xe1ng l\u01b0u \xfd l\xe0 ",(0,i.kt)("inlineCode",{parentName:"p"},"Ingress")," s\u1ebd load balance tr\u1ef1c ti\u1ebfp c\xe1c backend Pod m\xe0 kh\xf4ng th\xf4ng qua service, do \u0111\xf3, ta c\xf3 th\u1ec3 t\xf9y ch\u1ec9nh \u0111\u01b0\u1ee3c thu\u1eadt to\xe1n, ... li\xean quan t\u1edbi LB cho to\xe0n b\u1ed9 ",(0,i.kt)("inlineCode",{parentName:"p"},"Ingress")," c\u1ee7a cluster."),(0,i.kt)("p",null,"Ngo\xe0i ra, ng\u01b0\u1eddi ta c\u0169ng d\xf9ng ",(0,i.kt)("inlineCode",{parentName:"p"},"Ingress")," \u0111\u1ec3 terminate TLS session."),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://images.viblo.asia/5809feda-e282-4d5f-9cfb-11077d952add.jpg",alt:null})),(0,i.kt)("p",null,"Kubernetes sau khi init m\u1eb7c \u0111\u1ecbnh s\u1ebd kh\xf4ng c\xf3 ingress controller. N\u1ebfu ta ch\u1ec9 t\u1ea1o ",(0,i.kt)("inlineCode",{parentName:"p"},"Ingress")," th\xec s\u1ebd kh\xf4ng c\xf3 \xfd ngh\u0129a g\xec. \u0110\u1ec3 s\u1eed d\u1ee5ng ",(0,i.kt)("inlineCode",{parentName:"p"},"Ingress")," ta s\u1ebd ph\u1ea3i setup th\u1ee7 c\xf4ng Ingress Controller. Tuy nhi\xean vi\u1ec7c n\xe0y kh\xe1 \u0111\u01a1n gi\u1ea3n, do nhi\u1ec1u h\xe3ng \u0111\xe3 build s\u1eb5n m\u1ecdi th\u1ee9, ta ch\u1ec9 c\u1ea7n l\u1ea5y file manifest c\u1ee7a h\u1ecd v\u1ec1 r\u1ed3i ch\u1ea1y l\xe0 \u0111\u01b0\u1ee3c."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"nginx: ",(0,i.kt)("a",{parentName:"li",href:"https://kubernetes.github.io/ingress-nginx/"},"NGINX Ingress Controller")),(0,i.kt)("li",{parentName:"ul"},"traefik: ",(0,i.kt)("a",{parentName:"li",href:"https://docs.traefik.io/providers/kubernetes-ingress/"},"Kubernetes Ingress")),(0,i.kt)("li",{parentName:"ul"},"...")),(0,i.kt)("h4",{id:"324-practice"},"3.2.4 Practice"),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://images.viblo.asia/5001a20e-979c-473f-b2da-92c8668f621e.png",alt:null})),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Traffic t\u1eeb ph\xeda client s\u1ebd \u0111\u01b0\u1ee3c t\u1eadp trung t\u1ea1i Layer 4 Load Balancer."),(0,i.kt)("li",{parentName:"ul"},"L4 LB s\u1ebd ph\xe2n b\u1ed1 traffic t\u1edbi c\xe1c Node trong cluster (th\u01b0\u1eddng qua ",(0,i.kt)("inlineCode",{parentName:"li"},"NodePort"),")."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"Ingress")," \u0111\u01b0\u1ee3c map v\u1edbi ",(0,i.kt)("inlineCode",{parentName:"li"},"NodePort")," \u0111\xf3 s\u1ebd terminate SSL, routing, v\xe0 load balance traffic t\u1edbi nh\u1eefng Pod th\xedch h\u1ee3p.",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"Traffic t\u1edbi ",(0,i.kt)("inlineCode",{parentName:"li"},"/web")," s\u1ebd \u0111\u01b0\u1ee3c \u0111i\u1ec1u h\u01b0\u1edbng t\u1edbi Frontend Pods"),(0,i.kt)("li",{parentName:"ul"},"Traffic t\u1edbi ",(0,i.kt)("inlineCode",{parentName:"li"},"/api")," s\u1ebd \u0111\u01b0\u1ee3c \u0111i\u1ec1u h\u01b0\u1edbng t\u1edbi Backend Pods")))),(0,i.kt)("h3",{id:"33-storage---volume"},"3.3 Storage - Volume"),(0,i.kt)("p",null,"M\u1ed9t h\u1ec7 th\u1ed1ng kh\xf3 c\xf3 th\u1ec3 ho\u1ea1t \u0111\u1ed9ng ch\u1ec9 v\u1edbi stateless service."),(0,i.kt)("p",null,"V\u1edbi m\u1ed9t s\u1ed1 service nh\u01b0 database, hay nh\u01b0 t\xednh n\u0103ng upload file, ... N\u1ebfu ch\xfang ta kh\xf4ng s\u1eed d\u1ee5ng external service, th\xec service c\u1ee7a ta s\u1ebd tr\u1edf th\xe0nh stateful service. N\xf3 \u0111\xf2i h\u1ecfi d\u1eef li\u1ec7u trong qu\xe1 tr\xecnh x\u1eed l\xfd ph\u1ea3i \u0111\u01b0\u1ee3c l\u01b0u l\u1ea1i ngay c\u1ea3 khi b\u1ecb crash. Ngo\xe0i ra c\xf3 nh\u1eefng l\xfac ta s\u1ebd c\u1ea7n share d\u1eef li\u1ec7u gi\u1eefa nh\u1eefng container trong c\xf9ng 1 Pod. Nh\u1eefng l\xfac nh\u01b0 v\u1eady, ta s\u1ebd c\u1ea7n \u0111\u1ebfn ",(0,i.kt)("strong",{parentName:"p"},"Volume"),"."),(0,i.kt)("p",null,"Khi define Pod, ta s\u1ebd ch\u1ec9 r\xf5 Pod n\xe0y c\u1ea7n nh\u1eefng volume n\xe0o, sau \u0111\xf3 map nh\u1eefng volume \u0111\xf3 cho container."),(0,i.kt)("h5",{id:"persistentvolume"},"PersistentVolume"),(0,i.kt)("p",null,"Kubernetes s\u1eed d\u1ee5ng ",(0,i.kt)("inlineCode",{parentName:"p"},"PersistentVolume")," \u0111\u1ec3 t\u1ea1o n\xean 1 l\u1edbp abstract v\u1edbi nh\u1eefng h\u1ec7 th\u1ed1ng storage th\u1eadt ph\xeda sau. ",(0,i.kt)("inlineCode",{parentName:"p"},"PV")," c\u0169ng c\xf3 life-cycle gi\u1ed1ng nh\u01b0 Pod."),(0,i.kt)("p",null,"Khi ta s\u1eed d\u1ee5ng volume, ta s\u1ebd kh\xf4ng c\u1ea7n quan t\xe2m h\u1ec7 th\u1ed1ng \u0111\u1eb1ng sau ngang d\u1ecdc ra sao, th\u1ee9 duy nh\u1ea5t ta c\u1ea7n quan t\xe2m l\xe0 API c\u1ee7a ",(0,i.kt)("inlineCode",{parentName:"p"},"PersistentVolume"),"."),(0,i.kt)("p",null,"Trong Kubernetes, ",(0,i.kt)("inlineCode",{parentName:"p"},"PV")," c\xf3 th\u1ec3 \u0111\u01b0\u1ee3c t\u1ea1o b\u1eb1ng 2 c\xe1ch:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Dynamic Provisioning"),(0,i.kt)("li",{parentName:"ul"},"Static Provisioning")),(0,i.kt)("h5",{id:"static-provisioning"},"Static Provisioning"),(0,i.kt)("p",null,"Admin cluster s\u1ebd t\u1ea1o ra 1 s\u1ed1 ",(0,i.kt)("inlineCode",{parentName:"p"},"PV")," tr\u01b0\u1edbc, sau \u0111\xf3 cung c\u1ea5p cho b\xean Dev/Ops. Nh\u1eefng ",(0,i.kt)("inlineCode",{parentName:"p"},"PV")," n\xe0y \u0111\xe3 \u0111\u01b0\u1ee3c tr\u1ecf t\u1edbi h\u1ec7 th\u1ed1ng storage th\u1eadt \u0111ang ho\u1ea1t \u0111\u1ed9ng \u0111\u1eb1ng sau."),(0,i.kt)("p",null,"C\xf3 th\u1ec3 xem danh s\xe1ch driver m\xe0 Kubernetes h\u1ed7 tr\u1ee3 t\u1ea1i ",(0,i.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/concepts/storage/volumes/#types-of-volumes"},"\u0111\xe2y"),"."),(0,i.kt)("p",null,"V\xed d\u1ee5: Ta c\xf3 1 cluster Glusterfs v\u1edbi 3 node, t\u1ed5ng dung l\u01b0\u1ee3ng l\xe0 3TB. Khi c\u1ea7n 10GB cho vi\u1ec7c l\u01b0u tr\u1eef share resource, ta s\u1ebd t\u1ea1o ",(0,i.kt)("inlineCode",{parentName:"p"},"PersistentVolume")," v\u1edbi dung l\u01b0\u1ee3ng 10GB, tr\u1ecf t\u1edbi cluster n\xf3i tr\xean. Sau \u0111\xf3 ta s\u1ebd s\u1eed d\u1ee5ng volume tr\xean t\u01b0\u01a1ng t\u1ef1 nh\u01b0 c\xe1c volume kh\xe1c trong h\u1ec7 th\u1ed1ng."),(0,i.kt)("h5",{id:"dynamic-provisioning"},"Dynamic Provisioning"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"PV")," s\u1ebd \u0111\u01b0\u1ee3c t\u1ea1o 1 c\xe1ch \u0111\u1ed9ng. T\u1ee9c l\xe0 khi n\xe0o Pod c\u1ee7a ta c\u1ea7n volume, th\xec ",(0,i.kt)("inlineCode",{parentName:"p"},"PV")," s\u1ebd \u0111\u01b0\u1ee3c t\u1ea1o 1 c\xe1ch t\u1ef1 \u0111\u1ed9ng, nh\u1edd v\xe0o ",(0,i.kt)("inlineCode",{parentName:"p"},"StorageClass")," (s\u1ebd \u0111\u1ec1 c\u1eadp sau)."),(0,i.kt)("p",null,"C\xe1ch l\xe0m n\xe0y \u0111\xf2i h\u1ecfi h\u1ec7 th\u1ed1ng storage c\u1ee7a ta c\u0169ng ph\u1ea3i support dynamic provisioning."),(0,i.kt)("h5",{id:"persistentvolumeclaim"},"PersistentVolumeClaim"),(0,i.kt)("p",null,"\u0110\u1ec3 c\xf3 th\u1ec3 s\u1eed d\u1ee5ng \u0111\u01b0\u1ee3c ",(0,i.kt)("inlineCode",{parentName:"p"},"PV"),", ta c\u1ea7n t\u1ea1o th\xeam ",(0,i.kt)("inlineCode",{parentName:"p"},"PersistentVolumeClaim")," (PVC)."),(0,i.kt)("p",null,"Ta c\xf3 th\u1ec3 s\u1eed d\u1ee5ng Claim tr\xean cho config, hay volume, ... c\u1ee7a Pod."),(0,i.kt)("h1",{id:"4-high-availability-setup"},"4. High Availability Setup"),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://images.viblo.asia/48635fac-b09b-4174-b279-4f8d0fa29fb6.png",alt:null})),(0,i.kt)("h1",{id:"5-reference"},"5. Reference"),(0,i.kt)("p",null,"kubernetes.io - ",(0,i.kt)("a",{parentName:"p",href:"https://documentationo/docs/home/"},"Kubernetes Official Documentation")),(0,i.kt)("p",null,"youtube.com - ",(0,i.kt)("a",{parentName:"p",href:"https://www.youtube.com/watch?v=GXq3FS8M_kw"},"June 2018 Online Meetup: Kubernetes Networking Master Class")),(0,i.kt)("p",null,"x-team.com - ",(0,i.kt)("a",{parentName:"p",href:"https://x-team.com/blog/introduction-kubernetes-architecture/"},"INTRODUCTION TO KUBERNETES ARCHITECTURE")),(0,i.kt)("p",null,"ovh.com - ",(0,i.kt)("a",{parentName:"p",href:"https://www.ovh.com/blog/getting-external-traffic-into-kubernetes-clusterip-nodeport-loadbalancer-and-ingress/"},"Getting external traffic into Kubernetes \u2013 ClusterIp, NodePort, LoadBalancer, and Ingress")),(0,i.kt)("p",null,"medium.com - ",(0,i.kt)("a",{parentName:"p",href:"https://medium.com/jorgeacetozi/kubernetes-master-components-etcd-api-server-controller-manager-and-scheduler-3a0179fc8186"},"Kubernetes Master Components: Etcd, API Server, Controller Manager, and Scheduler")),(0,i.kt)("p",null,"medium.com - ",(0,i.kt)("a",{parentName:"p",href:"https://medium.com/google-cloud/kubernetes-nodeport-vs-loadbalancer-vs-ingress-when-should-i-use-what-922f010849e0"},"Kubernetes NodePort vs LoadBalancer vs Ingress? When should I use what?")))}s.isMDXComponent=!0}}]);