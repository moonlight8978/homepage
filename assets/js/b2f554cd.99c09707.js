"use strict";(self.webpackChunkmoonlight_8978_github_io=self.webpackChunkmoonlight_8978_github_io||[]).push([[1477],{10:n=>{n.exports=JSON.parse('{"blogPosts":[{"id":"tim-hieu-ve-active-record-encryption","metadata":{"permalink":"/blog/tim-hieu-ve-active-record-encryption","editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/blog/2021-06-17-active-record-encryption.md","source":"@site/blog/2021-06-17-active-record-encryption.md","title":"T\xecm hi\u1ec3u v\u1ec1 Active Record Encryption","description":"Overview","date":"2021-06-17T00:00:00.000Z","formattedDate":"June 17, 2021","tags":[{"label":"websocket","permalink":"/blog/tags/websocket"},{"label":"javascript","permalink":"/blog/tags/javascript"},{"label":"web","permalink":"/blog/tags/web"}],"readingTime":7.275,"hasTruncateMarker":false,"authors":[{"name":"L\xea S\u0129 B\xedch","title":"Ruby on Rails/React Developer","url":"https://github.com/moonlight8978","imageURL":"https://avatars.githubusercontent.com/u/26299310?v=4"}],"frontMatter":{"slug":"tim-hieu-ve-active-record-encryption","title":"T\xecm hi\u1ec3u v\u1ec1 Active Record Encryption","author":"L\xea S\u0129 B\xedch","author_title":"Ruby on Rails/React Developer","author_url":"https://github.com/moonlight8978","author_image_url":"https://avatars.githubusercontent.com/u/26299310?v=4","tags":["websocket","javascript","web"]},"unlisted":false,"nextItem":{"title":"WebSocket ho\u1ea1t \u0111\u1ed9ng nh\u01b0 th\u1ebf n\xe0o?","permalink":"/blog/websocket-hoat-dong-nhu-the-nao"}},"content":"## Overview\\n\\nV\xe0o ng\xe0y 28/5/2021, tr\xean blog c\u1ee7a Rails c\xf3 th\xf4ng b\xe1o v\u1ec1 1 t\xednh n\u0103ng m\u1edbi \u0111\xf3 l\xe0 [ActiveRecord Encryption](https://weblog.rubyonrails.org/2021/5/28/this-week-in-rails-active-record-encrytion-several-performance-optimizations-and-much-more/).\\n\\nActiveRecord Encryption gi\xfap encrypt attribute n\xe0o \u0111\xf3 c\u1ee7a model, v\xe0 l\u01b0u v\xe0o DB d\u01b0\u1edbi d\u1ea1ng m\xe3 ho\xe1. T\xednh n\u0103ng n\xe0y \u0111\u01b0\u1ee3c extract ra t\u1eeb d\u1ef1 \xe1n [HEY](https://www.hey.com) c\u1ee7a Basecamp.\\n\\nH\xe3y th\u1eed t\xecm hi\u1ec3u xem t\xednh n\u0103ng n\xe0y c\xf3 g\xec th\xfa v\u1ecb.\\n\\n## Usage\\n\\nTheo [guide](https://edgeguides.rubyonrails.org/active_record_encryption.html#basic-usage), \u0111\u1ea7u ti\xean ch\xfang ta s\u1ebd c\u1ea7n ph\u1ea3i ch\u1ea1y c\xe2u l\u1ec7nh sau\\n\\n```bash\\nrails db:encryption:init\\n```\\n\\nRails s\u1ebd cho ta 1 g\u1ee3i \xfd l\xe0 copy \u0111\u1ed1ng sau v\xe0o credentials. \u1eea `EDITOR=vim rails credentials:edit` r\u1ed3i copy paste th\xf4i.\\n\\n```yml\\nactive_record_encryption:\\n  primary_key: EGY8WhulUOXixybod7ZWwMIL68R9o5kC\\n  deterministic_key: aPA5XyALhf75NNnMzaspW7akTfZp0lPY\\n  key_derivation_salt: xEY0dt6TZcAMg52K7O84wYzkjvbA62Hz\\n```\\n\\nTrong model, ta define attribute c\u1ea7n m\xe3 ho\xe1 nh\u01b0 sau:\\n\\n```ruby title=app/models/article.rb\\nclass Article < ApplicationRecord\\n  encrypts :title\\nend\\n```\\n\\nR\u1ed3i create/update model nh\u01b0 b\xecnh th\u01b0\u1eddng\\n\\n```ruby\\narticle = Article.create(title: \\"Encrypt it all!\\")\\n```\\n\\nV\xe0 b\xf9m, magic...\\n\\n```sql\\nINSERT INTO `articles` (`title`) VALUES (\'{\\\\\\"p\\\\\\":\\\\\\"n7J0/ol+a7DRMeaE\\\\\\",\\\\\\"h\\\\\\":{\\\\\\"iv\\\\\\":\\\\\\"DXZMDWUKfp3bg/Yu\\\\\\",\\\\\\"at\\\\\\":\\\\\\"X1/YjMHbHD4talgF9dt61A==\\\\\\"}}\')\\n```\\n\\nV\xf4 h\u1ea1n b\u1ed1i r\u1ed1i...\\n\\n## AES\\n\\nTr\u01b0\u1edbc ti\xean ta h\xe3y t\xecm hi\u1ec3u v\u1ec1 \u0111\u1ed1ng key m\xe0 Rails \u0111\xe3 gen cho ta l\xfac \u0111\u1ea7u\\n\\n```yml\\nactive_record_encryption:\\n  primary_key: EGY8WhulUOXixybod7ZWwMIL68R9o5kC\\n  deterministic_key: aPA5XyALhf75NNnMzaspW7akTfZp0lPY\\n  key_derivation_salt: xEY0dt6TZcAMg52K7O84wYzkjvbA62Hz\\n```\\n\\nRails gen ra \u0111\u1ed1ng tr\xean nh\u01b0 n\xe0o v\u1eady?\\n\\n```ruby title=https://github.com/rails/rails/blob/e2585a21e389967322a98b46a7b3643d82bd9c28/activerecord/lib/active_record/railties/databases.rake#L554-L566\\nputs <<~MSG\\n  Add this entry to the credentials of the target environment:#{\' \'}\\n\\n  active_record_encryption:\\n    primary_key: #{SecureRandom.alphanumeric(32)}\\n    deterministic_key: #{SecureRandom.alphanumeric(32)}\\n    key_derivation_salt: #{SecureRandom.alphanumeric(32)}\\nMSG\\n```\\n\\nN\u1ebfu ai ch\u01b0a bi\u1ebft th\xec \u0111\xe2y l\xe0 [standard lib c\u1ee7a Ruby](https://ruby-doc.org/stdlib-3.0.1/libdoc/securerandom/rdoc/SecureRandom.html), \u0111\u01a1n thu\u1ea7n l\xe0... random m\xe0 th\xf4i =))\\n\\nTh\u1ebf \u0111\u1ed1ng key n\xe0y \u0111\u1ec3 l\xe0m g\xec? \u1ede m\u1ee5c [Setup](https://edgeguides.rubyonrails.org/active_record_encryption.html#setup) c\u1ee7a guide, Rails c\u0169ng \u0111\xe3 g\u1ee3i \xfd cho ta, \u0111\u1ed1ng n\xe0y d\xf9ng cho AES.\\n\\n> this will be used to derive the AES 32 bytes key\\n\\nV\u1eady AES l\xe0 c\xe1i kh\u1ec9 m\u1ed1c g\xec? Theo [wiki](https://en.wikipedia.org/wiki/Advanced_Encryption_Standard), AES l\xe0 vi\u1ebft t\u1eaft c\u1ee7a **A**dvanced **E**ncryption **S**tandard. Hay c\xf2n \u0111\u01b0\u1ee3c bi\u1ebft \u0111\u1ebfn v\u1edbi c\xe1i t\xean Rijndael. AES l\xe0 1 chu\u1ea9n m\xe3 ho\xe1, s\u1eed d\u1ee5ng symmetric encryption. AES r\u1ea5t ph\u1ed5 bi\u1ebfn ng\xe0y nay.\\n\\nTh\u1ebf b\u1ea5t n\xe0o m\xe0 l\u1ea1i \u0111\u1ebb ra th\xeam nhi\u1ec1u thu\u1eadt ng\u1eef h\u1ea1i n\xe3o h\u01a1n v\u1eady =)) C\u1ee9 t\u1eeb t\u1eeb r\u1ed3i khoai s\u1ebd nh\u1eeb, ch\xfang ta s\u1ebd t\xecm hi\u1ec3u ti\u1ebfp.\\n\\nTr\u01b0\u1edbc h\u1ebft th\xec, th\u1ebf n\xe0o l\xe0 m\xe3 ho\xe1? V\xed d\u1ee5 nh\u01b0 \u1edf 1 di\u1ec5n \u0111\xe0n n\xe0o \u0111\xf3 ng\u01b0\u1eddi ta share nhau ho\xe0ng thu\u1ef3 link b\u1eb1ng \u0111\u1ed1ng k\xed t\u1ef1 n\xe0y\\n\\n> 68747470733A2F2F7777772E676F6F676C652E636F6D2E766E2F\\n\\nthay v\xec hu\u1ef5ch to\u1eb9t ra l\xe0 m\u1ed9t \u0111\u01b0\u1eddng link ~~\u0111\u1ed3i tru\u1ef5~~ n\xe0o \u0111\xf3. Nh\u01b0ng do vi\u1ec7c gi\u1ea3i m\xe3 qu\xe1 \u0111\u01a1n gi\u1ea3n, c\u1ee5 th\u1ec3 l\xe0 d\xf9ng m\xe3 HEX, n\xean \u0111\xe2y ch\u1ec9 l\xe0 encode/decode sang 1 d\u1ea1ng d\u1eef li\u1ec7u kh\xe1c m\xe0 th\xf4i, v\xe0 vi\u1ec7c chuy\u1ec3n \u0111\u1ed5i th\u01b0\u1eddng kh\xe1 nhanh. C\xe1c b\u1ea1n c\xf3 th\u1ec3 v\xe0o \u0111\xe2y [\u0111\xe2y](https://www.convertstring.com/vi/EncodeDecode/HexDecode) \u0111\u1ec3 decode chu\u1ed7i huy\u1ec1n b\xed tr\xean.\\n\\nC\xf2n encrypt v\xe0 decrypt d\xf9ng trong cryptography n\xf3 \u1edf 1 t\u1ea7m cao kh\xe1c. Th\xf4ng th\u01b0\u1eddng s\u1ebd c\xf3 th\xeam 1 key (ho\u1eb7c 1 c\u1eb7p key public/private). Khi \u0111\xf3 input s\u1ebd l\xe0 key + data. V\xe0 output s\u1ebd l\xe0 1 chu\u1ed7i n\xe0o \u0111\xf3, chu\u1ed7i n\xe0y c\u1ef1c k\xec kh\xf3 \u0111\u1ec3 gi\u1ea3i m\xe3 n\u1ebfu kh\xf4ng n\u1eafm trong tay key. Th\xf4ng th\u01b0\u1eddng th\xec ph\u1ea3i cho ch\u1ea1y thu\u1eadt to\xe1n v\xe9t c\u1ea1n - t\u1ee9c l\xe0 th\u1eed t\u1eebng key m\u1ed9t, v\xe0 vi\u1ec7c n\xe0y c\u1ea7n \u0111\u1ebfn h\xe0ng tri\u1ec7u n\u0103m \u0111\u1ed1i v\u1edbi c\u1ea3 si\xeau m\xe1y t\xednh.\\n\\n- V\u1edbi thu\u1eadt to\xe1n d\xf9ng 1 key cho c\u1ea3 vi\u1ec7c encrypt l\u1eabn decrypt th\xec s\u1ebd \u0111\u01b0\u1ee3c g\u1ecdi l\xe0 **symmetric encryption**\\n\\n![symmetric](/img/blog/symmetric-encryption.png)\\n\\n- Thu\u1eadt to\xe1n d\xf9ng 1 c\u1eb7p key, trong \u0111\xf3 public key \u0111\u1ec3 m\xe3 ho\xe1, c\xf2n private key \u0111\u1ec3 gi\u1ea3i m\xe3, \u0111\u01b0\u1ee3c g\u1ecdi l\xe0 **asymmetric encryption**\\n\\n![asymmetric](/img/blog/asymmetric-encryption.png)\\n\\n[Image source](https://hackernoon.com/symmetric-and-asymmetric-encryption-5122f9ec65b1)\\n\\nQuay l\u1ea1i v\u1edbi AES, n\xf3 d\xf9ng symmetric, n\xean s\u1ebd d\xf9ng 1 key cho c\u1ea3 vi\u1ec7c m\xe3 ho\xe1 l\u1eabn gi\u1ea3i m\xe3. AES key c\xf3 \u0111\u1ed9 d\xe0i l\xe0 128, 192, ho\u1eb7c 256 bit. Tu\u1ef3 v\xe0o \u0111\u1ed9 d\xe0i key n\xf3 s\u1ebd c\xf3 t\xean kh\xe1c nhau AES-128, AES-192, AES-256. Key c\xe0ng d\xe0i th\xec vi\u1ec7c x\u1eed l\xfd c\xe0ng l\xe2u, nh\u01b0ng \u0111\u1ed5i l\u1ea1i c\xe0ng b\u1ea3o m\u1eadt h\u01a1n. M\u1eb7c \u0111\u1ecbnh Rails s\u1eed d\u1ee5ng key c\xf3 \u0111\u1ed9 d\xe0i 256 bit (32 bytes)\\n\\n```ruby title=https://github.com/rails/rails/blob/e2585a21e389967322a98b46a7b3643d82bd9c28/activerecord/lib/active_record/encryption/cipher/aes256_gcm.rb#L16\\nCIPHER_TYPE = \\"aes-256-gcm\\"\\n```\\n\\nV\u1ec1 vi\u1ec7c l\xe0m th\u1ebf n\xe0o \u0111\u1ec3 AES m\xe3 ho\xe1/gi\u1ea3i m\xe3 th\xec m\xecnh s\u1ebd kh\xf4ng \u0111\u1ec1 c\u1eadp t\u1ea1i \u0111\xe2y ~~v\xec m\xecnh c\u0169ng kh\xf4ng c\xf3 hi\u1ec3u m\u1ea5y =))~~, n\u1ebfu ai mu\u1ed1n t\xecm hi\u1ec3u th\xeam c\xf3 th\u1ec3 xem link [n\xe0y](https://www.youtube.com/watch?v=lnKPoWZnNNM), ho\u1eb7c g\xfac g\u1ed3 ~~. \u1ede d\u01b0\u1edbi l\xe0 b\u1ea3n preview, tr\xf4ng c\xe1i thu\u1eadt to\xe1n n\xf3 n\xf4m na nh\u01b0 sau\\n\\nAES s\u1ebd chia nh\u1ecf input th\xe0nh t\u1eebng block \u0111\u1ec3 x\u1eed l\xfd\\n\\n![block-cipher](/img/blog/aes-block-cipher.png)\\n\\n![flow](/img/blog/aes-flow.jpeg)\\n\\n![round](/img/blog/aes-round.jpeg)\\n\\n[Image Source](https://www.tutorialspoint.com/cryptography/advanced_encryption_standard.htm)\\n\\nC\u01a1 m\xe0 ch\u1ec9 quan t\xe2m l\xe0 m\u1ed9t chu\u1ed7i \u0111\u1ea7u v\xe0o + 1 key, \u0111i qua \u0111\u1ed1ng black magic r\u1ed3i tr\u1edf th\xe0nh 1 chu\u1ed7i b\u1ea3o m\u1eadt si\xeau h\u1ea1ng l\xe0 qu\xe1 \u0111\u1ee7 cho m\u1ed9t cu\u1ed9c t\xecnh r\u1ed3i.\\n\\n\xc0 m\xe0 nh\xecn c\xe1i constant Rails define \u1edf tr\xean kia, l\u1ea1i c\xf3 th\xeam c\xe1i g\xec \u1edf cu\u1ed1i chu\u1ed7i th\u1ebf nh\u1ec9. `gcm`???? B\u1ed1i r\u1ed1i again.\\n\\n## GCM\\n\\nGCM l\xe0 vi\u1ebft t\u1eaft c\u1ee7a **G**alois/**C**ounter **M**ode... Nghe xong hi\u1ec3u ch\u1ebft li\u1ec1n .\\\\_\\\\_. M\xf2 th\u1eed xem n\xe0o!\\n\\nNh\u01b0 t\xean g\u1ecdi c\u1ee7a n\xf3, GCM l\xe0 m\u1ed9t _mode_ trong symmetric encryption, k\u1ebft h\u1ee3p c\u1ee7a **Counter Mode** v\xe0 **Galois Mode**, d\xf9ng cho m\xe3 ho\xe1 d\u1ea1ng kh\u1ed1i (block). V\u1eady th\xec AES \u0111i v\u1edbi GCM l\xe0 chu\u1ea9n b\xe0i r\u1ed3i nh\u1ec9.\\n\\nNgo\xe0i GCM ra c\xf2n c\xe1c mode kh\xe1c nh\u01b0 CCM, SIV, ...v\xe2n v\xe2n m\xe2y m\xe2y. C\xe1c b\u1ea1n c\xf3 th\u1ec3 xem th\xeam t\u1ea1i [\u0111\xe2y](https://en.wikipedia.org/wiki/Block_cipher_mode_of_operation)\\n\\nTr\u01b0\u1edbc ti\xean ta h\xe3y b\u1eaft \u0111\u1ea7u t\u1eeb **mode**, t\u1eeb n\xe0y n\u1eb1m trong **Mode of Operation**. C\xe1c mode s\u1ebd \u0111\u01b0\u1ee3c apply tr\xean t\u1eebng block data (nh\u01b0 \u0111\xe3 n\xf3i \u1edf tr\xean th\xec AES chia data th\xe0nh c\xe1c block nh\u1ecf v\xe0 m\xe3 ho\xe1), gi\xfap cho output c\u1ee7a vi\u1ec7c m\xe3 ho\xe1 block b\u1ea3o m\u1eadt h\u01a1n.\\n\\nCounter mode s\u1eed d\u1ee5ng 1 s\u1ed1 integer l\xe0m counter, qua t\u1eebng block counter s\u1ebd t\u0103ng l\xean 1. \u1ede m\u1ed7i block, s\u1ed1 n\xe0y s\u1ebd \u0111\u01b0\u1ee3c m\xe3 ho\xe1 c\xf9ng v\u1edbi data \u0111\u1ec3 c\xf3 \u0111\u01b0\u1ee3c output b\u1ea3o m\u1eadt h\u01a1n.\\n\\n![counter-mode](/img/blog/ctr-mode.png)\\n\\nGalois Mode l\xe0 m\u1ed9t authentication mode. Galois Mode gi\xfap \u0111\u1ea3m b\u1ea3o r\u1eb1ng cipher output c\u1ee7a ta kh\xf4ng b\u1ecb ch\u1ec9nh s\u1eeda b\u1edfi m\u1ed9t b\xean th\u1ee9 3. Ho\u1ea1t \u0111\u1ed9ng nh\u01b0 n\xe0o th\xec m\xecnh ch\u1ecbu \xe0 =))\\n\\nK\u1ebft h\u1ee3p 2 mode tr\xean v\xe0 ta c\xf3 GCM, gi\xfap thu\u1eadt to\xe1n m\xe3 ho\xe1 c\u1ee7a ta b\u1ea3o m\u1eadt h\u01a1n, \u0111\u1ed3ng th\u1eddi \u0111\u1ea3m b\u1ea3o \u0111\u01b0\u1ee3c t\xednh to\xe0n v\u1eb9n c\u1ee7a d\u1eef li\u1ec7u.\\n\\n![gcm-mode](/img/blog/gcm-mode.png)\\n\\nB\xean tr\xean l\xe0 gi\u1ea3i th\xedch s\u01a1 qua v\u1ec1 thu\u1eadt to\xe1n m\xe3 ho\xe1 m\xe0 Rails s\u1eed d\u1ee5ng, n\u1ebfu c\xf3 sai s\xf3t th\xec c\u0169ng \u0111\u1eebng g\u1ea1ch \u0111\xe1 t\u1ed9i m\xecnh =))\\n\\n## AES-256-GCM meets Rails\\n\\n### Encryption Key\\n\\n```yml\\nactive_record_encryption:\\n  primary_key: EGY8WhulUOXixybod7ZWwMIL68R9o5kC\\n  deterministic_key: aPA5XyALhf75NNnMzaspW7akTfZp0lPY\\n  key_derivation_salt: xEY0dt6TZcAMg52K7O84wYzkjvbA62Hz\\n```\\n\\nQuay tr\u1edf l\u1ea1i v\u1edbi \u0111\u1ed1ng key, h\xe3y c\xf9ng m\xf2 code \u0111\xe1y b\u1ec3 xem ch\xfang d\u1eabn ta t\u1edbi \u0111\xe2u :v\\n\\n```ruby\\n# https://github.com/rails/rails/blob/9c091b4fd378df515c4c31b85bb6a968463a1d82/activerecord/lib/active_record/railtie.rb#L313-L317\\nActiveRecord::Encryption.configure \\\\\\n  primary_key: app.credentials.dig(:active_record_encryption, :primary_key),\\n  deterministic_key: app.credentials.dig(:active_record_encryption, :deterministic_key),\\n  key_derivation_salt: app.credentials.dig(:active_record_encryption, :key_derivation_salt),\\n  **config.active_record.encryption\\n\\n# https://github.com/rails/rails/blob/9c091b4fd378df515c4c31b85bb6a968463a1d82/activerecord/lib/active_record/encryption/configurable.rb#L20-L33\\ndef configure(primary_key:, deterministic_key:, key_derivation_salt:, **properties)\\n  config.primary_key = primary_key\\n  config.deterministic_key = deterministic_key\\n  config.key_derivation_salt = key_derivation_salt\\n\\n  context.key_provider = ActiveRecord::Encryption::DerivedSecretKeyProvider.new(primary_key)\\nend\\n\\n# https://github.com/rails/rails/blob/9c091b4fd378df515c4c31b85bb6a968463a1d82/activerecord/lib/active_record/encryption/derived_secret_key_provider.rb#L7-L9\\ndef initialize(passwords)\\n  super(Array(passwords).collect { |password| Key.derive_from(password) })\\nend\\n```\\n\\nXem ti\u1ebfp class `Key` c\xf3 g\xec n\xe0o.\\n\\n```ruby\\n# https://github.com/rails/rails/blob/9c091b4fd378df515c4c31b85bb6a968463a1d82/activerecord/lib/active_record/encryption/key.rb#L10-L26\\nclass Key\\n  def initialize(secret)\\n    @secret = secret\\n    @public_tags = Properties.new\\n  end\\n\\n  def self.derive_from(password)\\n    secret = ActiveRecord::Encryption.key_generator.derive_key_from(password)\\n    ActiveRecord::Encryption::Key.new(secret)\\n  end\\nend\\n\\n# https://github.com/rails/rails/blob/9c091b4fd378df515c4c31b85bb6a968463a1d82/activerecord/lib/active_record/encryption/key_generator.rb#L32-L34\\ndef derive_key_from(password, length: key_length)\\n  ActiveSupport::KeyGenerator.new(password).generate_key(ActiveRecord::Encryption.config.key_derivation_salt, length)\\nend\\n```\\n\\nNh\u01b0 v\u1eady, 2 trong s\u1ed1 3 thanh ni\xean c\u1ee7a ta \u0111\xe3 b\u1ecb l\u1ed9 m\u1eb7t:\\n\\n- `primary_key` \u0111\xf3ng vai tr\xf2 l\xe0 `password` param c\u1ee7a `ActiveSupport::KeyGenerator.new`\\n- `key_derivation_salt` \u0111\xf3ng vai tr\xf2 l\xe0 tham s\u1ed1 th\u1ee9 nh\u1ea5t c\u1ee7a `ActiveSupport::KeyGenerator#generate_key`\\n\\nH\xe3y check ti\u1ebfp `ActiveSupport::KeyGenerator`\\n\\n```ruby\\n# https://github.com/rails/rails/blob/9c091b4fd378df515c4c31b85bb6a968463a1d82/activesupport/lib/active_support/key_generator.rb#L26-L41\\ndef initialize(secret, options = {})\\n  @secret = secret\\n  @iterations = options[:iterations] || 2**16\\n  @hash_digest_class = options[:hash_digest_class] || self.class.hash_digest_class\\nend\\n\\ndef generate_key(salt, key_size = 64)\\n  OpenSSL::PKCS5.pbkdf2_hmac(@secret, salt, @iterations, key_size, @hash_digest_class.new)\\nend\\n```\\n\\nQua h\u1ebft wrapper c\u1ee7a Rails r\u1ed3i, gi\u1edd ta ph\u1ea3i m\xf2 v\xe0o docs c\u1ee7a Ruby th\xf4i.\\nTheo [docs](https://ruby-doc.org/stdlib-3.0.1/libdoc/openssl/rdoc/OpenSSL.html#module-OpenSSL-label-Encryption), docs l\u1ea1i b\u1ea3o h\xe0m n\xe0y gi\u1edd \u0111\u1ed5i t\xean th\xe0nh [`OpenSSL::KDF.pbkdf2_hmac`](https://ruby-doc.org/stdlib-3.0.1/libdoc/openssl/rdoc/OpenSSL/KDF.html#method-c-pbkdf2_hmac) m\u1ea5t r\u1ed3i... \u1edc th\xec l\u1ea1i m\xf2 v\xe0o xem. N\xf4m na h\xe0m n\xe0y s\u1ebd t\u1ea1o ra 1 cipher key d\xf9ng cho vi\u1ec7c m\xe3 ho\xe1.\\n\\nT\u1ea1i \u0111\xe2y, ta c\xf3 th\u1ec3 k\u1ebft lu\u1eadn key m\xe3 ho\xe1 m\xe0 Rails d\xf9ng c\xf3:\\n\\n- `passphrase`: `primary_key`\\n- `salt`: `key_derivation_salt`\\n- `iterations`: 2^16\\n- `key_len`: \u0111\u1ed9 d\xe0i key 32 bytes\\n- `digest`: hash algorithm SHA-1\\n\\nH\xe3y c\xf9ng test qua c\xe1i key n\xe0y xem\\n\\n```ruby title=irb\\nrequire \'openssl\'\\n\\ncipher = OpenSSL::Cipher.new(\'aes-256-gcm\')\\ncipher.encrypt\\niv = cipher.random_iv\\n\\npwd = \'EGY8WhulUOXixybod7ZWwMIL68R9o5kC\'\\nsalt = \'xEY0dt6TZcAMg52K7O84wYzkjvbA62Hz\'\\niter = 2**16\\nkey_len = OpenSSL::Cipher.new(\\"aes-256-gcm\\").key_len\\ndigest = OpenSSL::Digest.new(\'SHA1\')\\n\\nkey = OpenSSL::PKCS5.pbkdf2_hmac(pwd, salt, iter, key_len, digest)\\ncipher.key = key\\n\\nencrypted = cipher.update \\"hello\\"\\nencrypted << cipher.final # => \\"\\\\xB2#\\\\x10\\\\xE7n\\"\\n\\ncipher.decrypt\\ncipher.iv = iv\\ndecrypted = cipher.update(encrypted) # => \\"hello\\"\\n```\\n\\nSau bao nhi\xeau v\u1ea5t v\u1ea3 th\xec c\u0169ng t\xecm \u0111\u01b0\u1ee3c c\xe1i key =)) V\u1eady qu\xe1 tr\xecnh m\xe3 ho\xe1 nh\u01b0 th\u1ebf n\xe0o? L\u1ea1i m\xf2 ti\u1ebfp .\\\\_\\\\_.\\n\\n### Encryption Process\\n\\nH\xe3y c\xf9ng b\u1eaft \u0111\u1ea7u t\u1eeb vi\u1ec7c khai b\xe1o trong model\\n\\n```ruby title=app/models/article.rb\\nclass Article < ApplicationRecord\\n  encrypts :title\\nend\\n```\\n\\nR\u1ed3i c\xf9ng t\xecm xem `ApplicationRecord.encrypts` n\xf3 l\xe0m tr\xf2 g\xec n\xe0o\\n\\n## Tham kh\u1ea3o\\n\\n- https://edgeguides.rubyonrails.org/active_record_encryption.html\\n- https://www.precisely.com/blog/data-security/aes-vs-rsa-encryption-differences\\n- https://www.youtube.com/watch?v=lnKPoWZnNNM\\n- https://www.youtube.com/watch?v=g_eY7JXOc8U\\n- https://www.includehelp.com/cryptography/mode-of-operation.aspx"},{"id":"websocket-hoat-dong-nhu-the-nao","metadata":{"permalink":"/blog/websocket-hoat-dong-nhu-the-nao","editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/blog/2021-06-16-how-websocket-works.md","source":"@site/blog/2021-06-16-how-websocket-works.md","title":"WebSocket ho\u1ea1t \u0111\u1ed9ng nh\u01b0 th\u1ebf n\xe0o?","description":"WebSocket l\xe0 g\xec","date":"2021-06-16T00:00:00.000Z","formattedDate":"June 16, 2021","tags":[{"label":"websocket","permalink":"/blog/tags/websocket"},{"label":"javascript","permalink":"/blog/tags/javascript"},{"label":"web","permalink":"/blog/tags/web"}],"readingTime":2.825,"hasTruncateMarker":false,"authors":[{"name":"L\xea S\u0129 B\xedch","title":"Ruby on Rails/React Developer","url":"https://github.com/moonlight8978","imageURL":"https://avatars.githubusercontent.com/u/26299310?v=4"}],"frontMatter":{"slug":"websocket-hoat-dong-nhu-the-nao","title":"WebSocket ho\u1ea1t \u0111\u1ed9ng nh\u01b0 th\u1ebf n\xe0o?","author":"L\xea S\u0129 B\xedch","author_title":"Ruby on Rails/React Developer","author_url":"https://github.com/moonlight8978","author_image_url":"https://avatars.githubusercontent.com/u/26299310?v=4","tags":["websocket","javascript","web"]},"unlisted":false,"prevItem":{"title":"T\xecm hi\u1ec3u v\u1ec1 Active Record Encryption","permalink":"/blog/tim-hieu-ve-active-record-encryption"},"nextItem":{"title":"C\xf9ng t\xecm hi\u1ec3u v\u1ec1 Puma (Ruby on Rails)","permalink":"/blog/cung-tim-hieu-ve-puma-ruby-on-rails"}},"content":"## WebSocket l\xe0 g\xec\\n\\nC\u0169ng gi\u1ed1ng nh\u01b0 HTTP, WebSocket l\xe0 1 protocol, ho\u1ea1t \u0111\u1ed9ng tr\xean m\xf4 h\xecnh client/server, v\xe0 s\u1eed d\u1ee5ng TCP connection.\\nL\xe0 m\u1ed9t protocol, c\xf3 ngh\u0129a l\xe0 b\u1ea5t k\u1ec3 vi\u1ec7c implement ra sao, nh\u01b0ng server c\u1ee9 l\u1eafng nghe 1 TCP port, v\xe0 giao ti\u1ebfp gi\u1eefa client/server tu\xe2n theo \u0111\xfang spec m\xe0 WebSocket \u0111\u1ec1 ra l\xe0 \u0111\u01b0\u1ee3c.\\n\\nWebSocket cho ph\xe9p trao \u0111\u1ed5i d\u1eef li\u1ec7u 2 chi\u1ec1u gi\u1eefa client v\xe0 server. Tuy nhi\xean ch\u1eafc s\u1ebd c\xf3 nhi\u1ec1u ng\u01b0\u1eddi th\u1eafc m\u1eafc\\n\\n> Sao kh\xf4ng d\xf9ng HTTP r\u1ed3i set interval request l\xean, hay l\xe0 server push cho \u0111\u01a1n gi\u1ea3n. \u0110\u1ebb ra l\u1eafm protocol l\xe0m g\xec \u0111au \u0111\u1ea7u?\\n\\nN\u1ebfu s\u1eed d\u1ee5ng HTTP, m\u1ed7i l\u1ea7n c\u1eadp nh\u1eadt data m\u1edbi th\xec client l\u1ea1i ph\u1ea3i t\u1ea1o request HTTP, v\xe0 s\u1ebd c\xf3 r\u1ea5t nhi\u1ec1u header d\u01b0 th\u1eeba, g\xe2y l\xe3ng ph\xed b\u0103ng th\xf4ng, v\xe0 vi\u1ec7c kh\u1edfi t\u1ea1o request c\u0169ng m\u1ea5t th\xeam 1 ch\xfat th\u1eddi gian. Trong khi \u0111\xf3 WebSocket, sau khi client v\xe0 server _say hello_ v\u1edbi nhau, TCP connection s\u1ebd v\u1eabn alive, v\xe0 ch\xfang s\u1ebd giao l\u01b0u k\u1ebft h\u1ee3p v\u1edbi nhau qua connection \u0111\xf3 m\xe0 kh\xf4ng c\u1ea7n th\xeam nh\u1eefng th\xf4ng tin d\u01b0 th\u1eeba nh\u01b0 header. V\xe0 c\xf3 l\u1ebd c\xf2n nhi\u1ec1u l\u1ee3i \xedch n\u1eefa, nh\u01b0ng m\xecnh kh\xf4ng bi\u1ebft =))\\n\\nKhen th\u1ebf \u0111\u1ee7 r\u1ed3i, h\xe3y th\u1eed t\xecm hi\u1ec3u xem WebSocket ngang d\u1ecdc ra sao.\\n\\n## C\xe1ch ho\u1ea1t \u0111\u1ed9ng c\u1ee7a WebSocket\\n\\n### Ti\u1ec1n \u0111\u1ec1\\n\\nV\xed d\u1ee5 v\u1edbi \u1ee9ng d\u1ee5ng m\u1ea1ng x\xe3 h\u1ed9i, ta c\xf3 1 t\xednh n\u0103ng chat. M\u1ed7i khi b\u1eadt chat v\u1edbi 1 ng\u01b0\u1eddi, 1 WebSocket t\u1edbi webserver c\u1ee7a ta s\u1ebd \u0111\u01b0\u1ee3c kh\u1edfi t\u1ea1o. Nh\u01b0 v\u1eady, ta \u0111ang c\xf3 1 webserver, v\xe0 \u0111ang c\u1ea7n 1 websocket connection t\u1edbi webserver \u0111\xf3. M\u1eb7t kh\xe1c vi\u1ec7c s\u1eed d\u1ee5ng raw TCP tr\xean client c\u0169ng r\u1ea5t h\u1ea1n ch\u1ebf. Ch\xednh v\xec v\u1eady, WebSocket \u0111\xe3 t\u1eadn d\u1ee5ng lu\xf4n port 80/443 c\u1ee7a HTTP(S) \u0111\u1ec3 kh\u1edfi t\u1ea1o connection.\\n\\n### Handshaking\\n\\nKhi kh\u1edfi t\u1ea1o connection, client s\u1ebd t\u1ea1o 1 HTTP request \u0111\u1ec3 th\u1ef1c hi\u1ec7n _handshake_ v\u1edbi server\\n\\n![handshake](/img/blog/websocket-handshake.jpeg)\\n\\n- Tr\u01b0\u1edbc ti\xean client s\u1ebd g\u1eedi request t\u1edbi endpoint m\xe0 websocket server \u0111ang l\u1eafng nghe. v\xed d\u1ee5 nh\u01b0 `/chat`.\\n  Request s\u1ebd k\xe8m theo 1 v\xe0i header m\xe0 WebSocket protocol quy \u0111\u1ecbnh: `Sec-WebSocket-Key`, `Sec-WebSocket-Version`, `Upgrade`, `Connection`, ... v\xe0 nh\u1eefng header c\u01a1 b\u1ea3n c\u1ee7a 1 HTTP request kh\xe1c n\u1eefa.\\n\\n- WebSocket server s\u1ebd ti\u1ebfp nh\u1eadn request, authen (n\u1ebfu c\xf3), n\u1ebfu kh\xf4ng h\u1ee3p l\u1ec7 s\u1ebd tr\u1ea3 v\u1ec1 `400 Bad Request` v\xe0 terminate connection \u0111\xf3.\\n  Ng\u01b0\u1ee3c l\u1ea1i n\u1ebfu OK, server s\u1ebd tr\u1ea3 v\u1ec1 `101 Switching Protocols` c\xf9ng v\u1edbi header `Sec-WebSocket-Accept`. Connection \u0111\xf3 s\u1ebd \u0111\u01b0\u1ee3c gi\u1eef, v\xe0 sau \u0111\xf3 client v\xe0 server b\u1eaft \u0111\u1ea7u trao \u0111\u1ed5i th\xf4ng tin qua l\u1ea1i v\u1edbi nhau.\\n\\nGi\xe1 tr\u1ecb c\u1ee7a `Sec-WebSocket-Accept` \u0111\u01b0\u1ee3c quy \u0111\u1ecbnh nh\u01b0 sau:\\n\\n```txt\\nSec-WebSocket-Accept = Base64( SHA1 ( Sec-WebSocket-Key + 258EAFA5-E914-47DA-95CA-C5AB0DC85B11 ) )\\n```\\n\\n`258EAFA5-E914-47DA-95CA-C5AB0DC85B11` c\xf2n \u0111\u01b0\u1ee3c g\u1ecdi l\xe0 _magic string_\\n\\n### Trao \u0111\u1ed5i d\u1eef li\u1ec7u\\n\\nVi\u1ec7c trao \u0111\u1ed5i d\u1eef li\u1ec7u gi\u1eefa client v\xe0 server kh\xe1 l\xe0 h\u1ea1i n\xe3o, c\u1ee5 th\u1ec3 vi\u1ec7c decode message, hay format message c\xf3 th\u1ec3 xem th\xeam t\u1ea1i [\u0111\xe2y](https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API/Writing_WebSocket_servers#exchanging_data_frames). Gi\u1eef ch\u1ed7 \u0111\u1ec3 sau n\xe0y n\u1ebfu kh\xf4ng ~~l\u01b0\u1eddi~~ b\u1eadn quay l\u1ea1i t\xecm hi\u1ec3u sau =))\\n\\nTrong qu\xe1 tr\xecnh connection \u0111\u01b0\u1ee3c keep alive, s\u1ebd c\xf3 r\u1ea5t nhi\u1ec1u request ping gi\u1eefa client/server \u0111\u1ec3 ki\u1ec3m tra xem ph\xeda b\xean kia c\xf2n active hay kh\xf4ng. B\xean g\u1eedi ping, b\xean nh\u1eadn pong, v\u1eabn c\xf2n s\u1ed1ng th\xec ta l\u1ea1i giao l\u01b0u k\u1ebft h\u1ee3p ti\u1ebfp. C\xf2n kh\xf4ng th\xec server/client s\u1ebd bi\u1ebft \u0111\u1ec3 terminate inactive connection \u0111\xf3 \u0111i.\\n\\n## Tham kh\u1ea3o\\n\\n- https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API/Writing_WebSocket_servers\\n\\n- https://stackoverflow.com/questions/50197453/how-long-can-a-websocket-connection-last\\n\\n- https://datatracker.ietf.org/doc/html/rfc6455"},{"id":"cung-tim-hieu-ve-puma-ruby-on-rails","metadata":{"permalink":"/blog/cung-tim-hieu-ve-puma-ruby-on-rails","editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/blog/2021-05-31-rails-puma.md","source":"@site/blog/2021-05-31-rails-puma.md","title":"C\xf9ng t\xecm hi\u1ec3u v\u1ec1 Puma (Ruby on Rails)","description":"1. M\u1edf \u0111\u1ea7u","date":"2021-05-31T00:00:00.000Z","formattedDate":"May 31, 2021","tags":[{"label":"puma","permalink":"/blog/tags/puma"},{"label":"ruby-on-rails","permalink":"/blog/tags/ruby-on-rails"},{"label":"multi-threading","permalink":"/blog/tags/multi-threading"},{"label":"multi-processing","permalink":"/blog/tags/multi-processing"}],"readingTime":10.165,"hasTruncateMarker":false,"authors":[{"name":"L\xea S\u0129 B\xedch","title":"Ruby on Rails/React Developer","url":"https://github.com/moonlight8978","imageURL":"https://avatars.githubusercontent.com/u/26299310?v=4"}],"frontMatter":{"slug":"cung-tim-hieu-ve-puma-ruby-on-rails","title":"C\xf9ng t\xecm hi\u1ec3u v\u1ec1 Puma (Ruby on Rails)","author":"L\xea S\u0129 B\xedch","author_title":"Ruby on Rails/React Developer","author_url":"https://github.com/moonlight8978","author_image_url":"https://avatars.githubusercontent.com/u/26299310?v=4","tags":["puma","ruby-on-rails","multi-threading","multi-processing"]},"unlisted":false,"prevItem":{"title":"WebSocket ho\u1ea1t \u0111\u1ed9ng nh\u01b0 th\u1ebf n\xe0o?","permalink":"/blog/websocket-hoat-dong-nhu-the-nao"},"nextItem":{"title":"C\u01b0\u1ee1i React Native xem Appium (Ph\u1ea7n 1 - C\xf9ng t\xecm hi\u1ec3u c\xe1ch ho\u1ea1t \u0111\u1ed9ng c\u1ee7a Appium)","permalink":"/blog/cuoi-react-native-xem-appium-phan-1-cung-tim-hieu-cach-hoat-dong-cua-appium"}},"content":"## 1. M\u1edf \u0111\u1ea7u\\n\\nCh\u1eafc h\u1eb3n Puma kh\xf4ng ph\u1ea3i m\u1ed9t c\xe1i t\xean xa l\u1ea1 \u0111\u1ed1i v\u1edbi m\u1ed7i Rails developer, m\u1ed9t ph\u1ea7n c\u0169ng v\xec \u0111\xe2y l\xe0 appserver m\u1eb7c \u0111\u1ecbnh khi t\u1ea1o m\u1edbi m\u1ed9t project Rails.\\n\\nH\xe3y c\xf9ng nh\xecn qua nh\u1eefng config c\u01a1 b\u1ea3n khi ch\u1ea1y 1 \u1ee9ng d\u1ee5ng Rails v\u1edbi Puma server. [link](https://github.com/rails/rails/blob/0f5700ac3589081126fbfde1e4037dc1d4166cce/railties/lib/rails/generators/rails/app/templates/config/puma.rb.tt)\\n\\n```ruby title=config/puma.rb\\nmax_threads_count = ENV.fetch(\\"RAILS_MAX_THREADS\\") { 5 }\\nmin_threads_count = ENV.fetch(\\"RAILS_MIN_THREADS\\") { max_threads_count }\\nthreads min_threads_count, max_threads_count\\n\\nworker_timeout 3600 if ENV.fetch(\\"RAILS_ENV\\", \\"development\\") == \\"development\\"\\n\\nport ENV.fetch(\\"PORT\\") { 3000 }\\n\\nenvironment ENV.fetch(\\"RAILS_ENV\\") { \\"development\\" }\\n\\npidfile ENV.fetch(\\"PIDFILE\\") { \\"tmp/pids/server.pid\\" }\\n\\nworkers ENV.fetch(\\"WEB_CONCURRENCY\\") { 2 }\\n\\npreload_app!\\n\\nplugin :tmp_restart\\n```\\n\\n\u0110\u1ed1i v\u1edbi nh\u1eefng ng\u01b0\u1eddi m\u1edbi b\u1eaft \u0111\u1ea7u, khi deploy puma, c\xf3 l\u1ebd s\u1ebd t\u1eeb ch\u1ed1i hi\u1ec3u \u0111\u1ed1ng config tr\xean v\xe0 set m\u1ed9t s\u1ed1 bi\u1ebfn m\xf4i tr\u01b0\u1eddng nh\u01b0 sau:\\n\\n- `WEB_CONCURRENCY`: b\u1eb1ng v\u1edbi s\u1ed1 l\u01b0\u1ee3ng vcore/process c\u1ee7a m\xe1y\\n- `RAILS_MAX_THREADS`: \u1edd th\xec nhi\u1ec1u RAM th\xec set 16, 32 cho o\xe1ch, kh\xf4ng th\xec th\xf4i d\xf9ng m\u1eb7c \u0111\u1ecbnh 5 v\xe0 m\u1eb7c do d\xf2ng \u0111\u1eddi x\xf4 \u0111\u1ea9y :v\\n\\nH\xe3y c\xf9ng t\xecm hi\u1ec3u th\xeam v\u1ec1 Puma \u0111\u1ec3 g\xf3p ph\u1ea7n l\xe0m ch\u1ee7 t\u1eebng d\xf2ng code trong app c\u1ee7a ch\xfang ta.\\n\\n## 2. Multi-processing v\xe0 Multi-threading\\n\\n### 2.1. Puma d\xf9ng lo\u1ea1i n\xe0o?\\n\\n- Khi ch\u1ea1y 1 Rails app m\u1edbi t\u1ea1o, h\xe3y \u0111\u1ec3 \xfd l\xfac boot server, b\u1ea1n s\u1ebd th\u1ea5y:\\n\\n```log\\nPuma starting in single mode...\\n* Puma version: 5.3.1 (ruby 3.0.1-p64) (\\"Sweetnighter\\")\\n*  Min threads: 5\\n*  Max threads: 5\\n*  Environment: development\\n*          PID: 1\\n* Listening on http://0.0.0.0:3000\\nUse Ctrl-C to stop\\n```\\n\\n\u0110\xe2y l\xe0 d\u1ea5u hi\u1ec7u cho ta th\u1ea5y, Rails \u0111ang ch\u1ea1y \u1edf ch\u1ebf \u0111\u1ed9 single process (1 process), v\xe0 multi-thread (c\u1ee5 th\u1ec3 l\xe0 5 thread)\\n\\n- C\xf2n khi config deploy, c\xf3 th\u1ec3 b\u1ea1n s\u1ebd \u0111\u01b0\u1ee3c 1 ng\u01b0\u1eddi c\xf3 kinh nghi\u1ec7m h\u01a1n b\u1ea3o r\u1eb1ng _\\"B\u1ecf comment c\xe1i d\xf2ng `workers ENV.fetch(\\"WEB_CONCURRENCY\\") { 2 }` \u0111i em \xeai\\"_\\n\\nV\xe0 \u0111\xe2y l\xe0 k\u1ebft qu\u1ea3 khi ta l\xe0m nh\u01b0 v\u1eady\\n\\n```log\\n[1] Puma starting in cluster mode...\\n[1] * Puma version: 5.3.1 (ruby 3.0.1-p64) (\\"Sweetnighter\\")\\n[1] *  Min threads: 5\\n[1] *  Max threads: 5\\n[1] *  Environment: development\\n[1] *   Master PID: 1\\n[1] *      Workers: 2\\n[1] *     Restarts: (\ufffd\ufffd\ufffd) hot (\ufffd\ufffd\ufffd) phased\\n[1] * Preloading application\\n[1] * Listening on htp://0.0.0.0:3000\\n[1] Use Ctrl-C to stop\\n[1] - Worker 0 (PID: 16) booted in 0.02s, phase: 0\\n[1] - Worker 1 (PID: 17) booted in 0.05s, phase: 0\\n```\\n\\nPuma \u0111ang ch\u1ea1y \u0111\u1ed3ng th\u1eddi multi-process (2 process) v\xe0 multi-thread (5 thread)\\n\\n> Multi-process, multi-thread l\xe0 c\xe1i c\u1ee7a n\u1ee3 g\xec v\u1eady?\\n\\nCh\xfang ta s\u1ebd t\xecm hi\u1ec3u v\u1ec1 n\xf3 ngay sau \u0111\xe2y. Tuy nhi\xean ch\xfang ta s\u1ebd focus v\xe0o cluster mode c\u1ee7a Puma nh\xe9.\\n\\n### 2.2. Multi-threading\\n\\nTr\u01b0\u1edbc ti\xean ta h\xe3y nh\u1edb l\u1ea1i \u0111\u1ecbnh ngh\u0129a v\u1ec1 `process` - ti\u1ebfn tr\xecnh, m\u1ed7i khi ta ch\u1ea1y 1 command n\xe0o \u0111\xf3 (v\xed d\u1ee5 nh\u01b0 `ruby xxx.rb` hay b\u1eadt chrome ch\u1eb3ng h\u1ea1n), OS s\u1ebd t\u1ea1o 1 process \u0111\u1ec3 x\u1eed l\xfd command c\u1ee7a ta.\\n\\nM\u1ed7i _process_ c\xf3 th\u1ec3 t\u1ea1o ra nhi\u1ec1u _thread_ \u0111\u1ec3 x\u1eed l\xfd task (v\xed d\u1ee5 m\u1ed7i tab chrome \u0111\u01b0\u1ee3c handle b\u1edfi 1 thread). C\xe1c thread \u0111\u01b0\u1ee3c t\u1ea1o b\u1edfi 1 process s\u1ebd share nhau 1 v\xf9ng nh\u1edb (memory), trong shared memory n\xe0y, m\u1ed7i thread s\u1ebd c\xf3 stack, register (google \u0111\u1ec3 bi\u1ebft th\xeam \u0111\u1ed1ng n\xe0y l\xe0 g\xec =)) ) ri\xeang c\u1ee7a m\xecnh. Tuy nhi\xean, vi\u1ec7c chung \u0111\u1ee5ng memory nh\u01b0 tr\xean s\u1ebd d\u1eabn \u0111\u1ebfn 1 v\u1ea5n \u0111\u1ec1 l\xe0 nhi\u1ec1u thread c\xf9ng ch\u1ecdc t\u1edbi 1 resource n\xe0o \u0111\xf3, d\u1eabn t\u1edbi conflict v\u1ec1 data, hay c\xf2n \u0111\u01b0\u1ee3c bi\u1ebft \u0111\u1ebfn v\u1edbi c\xe1i t\xean nguy hi\u1ec3m h\u01a1n l\xe0 **race condition**. Code c\u1ee7a ta s\u1ebd c\u1ea7n _thread-safe_ (c\xe1c b\u1ea1n c\xf3 th\u1ec3 google th\xeam :v)\\n\\n\u0110\u1ed1i v\u1edbi \u1ee9ng d\u1ee5ng Ruby th\xec khi ch\u1ea1y \u1edf m\xf4i tr\u01b0\u1eddng MRI... \xc0 \u0111\u1ea5y l\u1ea1i nh\u1eafc t\u1edbi MRI, ch\u1eafc nhi\u1ec1u ng\u01b0\u1eddi s\u1ebd th\u1eafc m\u1eafc li\u1ec7u \u0111\xf3 l\xe0 g\xec. \u0110\xe2y l\xe0 t\xean c\u1ee7a 1 Ruby Runtime. Ruby 1 chu\u1ea9n spec, implement ki\u1ec3u g\xec c\u0169ng \u0111\u01b0\u1ee3c, mi\u1ec5n l\xe0 \u0111\xe1p \u1ee9ng \u0111\u01b0\u1ee3c spec \u0111\xf3 th\xec \u0111\u1ec1u l\xe0 Ruby. C\xf3 th\u1ec3 k\u1ec3 \u0111\u1ebfn c\xe1c Runtime ph\u1ed5 bi\u1ebfn sau\\n\\n- MRI - aka CRuby: Matz\u2019s Ruby Interpreter (Matz - hay Matsumoto Yukihiro) l\xe0 ng\u01b0\u1eddi t\u1ea1o ra runtime n\xe0y, \u0111\u01b0\u1ee3c vi\u1ebft b\u1eb1ng C, n\xean c\xf2n g\u1ecdi l\xe0 CRuby\\n\\n  \u0110a s\u1ed1 l\xe0 d\xf9ng MRI\\n\\n- JRuby: Ruby implement b\u1eb1ng Java\\n\\n- Rubinius\\n\\n- mruby\\n\\n- ...\\n\\nMRI c\xf3 1 c\u01a1 ch\u1ebf l\xe0 **Global Interpreter Lock** (GIL), khi ch\u1ea1y multi-thread, n\xf3 ch\u1ec9 cho ph\xe9p 1 thread ch\u1ea1y source code Ruby t\u1ea1i 1 th\u1eddi \u0111i\u1ec3m, n\xean l\xe0 ta c\xf3 nhi\u1ec1u thread \u0111i ch\u0103ng n\u1eefa th\xec c\u0169ng ch\u1ec9 c\xf3 1 thread \u0111\u01b0\u1ee3c ch\u1ea1y m\xe0 th\xf4i.\\n\\nTuy nhi\xean v\u1edbi c\xe1c thao t\xe1c IO nh\u01b0 \u0111\u1ecdc DB, request external resource, \u0111\u1ecdc ghi file, ... th\xec GIL kh\xf4ng block. Puma \u0111\xe3 t\u1eadn d\u1ee5ng \u0111i\u1ec1u n\xe0y, khi 1 thread \u0111ang x\u1eed l\xfd IO, n\xf3 s\u1ebd quay tr\u1edf l\u1ea1i x\u1eed l\xfd \u1edf process, nh\u1eadn th\xeam c\xe1c request kh\xe1c \u0111\u1ec3 x\u1eed l\xfd.\\n\\nCh\xednh v\xec v\u1eady, ngay c\u1ea3 khi ch\u1ec9 ch\u1ea1y \u1edf single mode, Puma v\u1eabn c\xf3 th\u1ec3 handle \u0111\u01b0\u1ee3c concurrent request. Tuy nhi\xean v\u1edbi c\xe1c request c\u1ea7n th\u1eddi gian d\xe0i \u0111\u1ec3 x\u1eed l\xfd, do ch\u1ec9 c\xf3 1 thread \u0111\u01b0\u1ee3c ch\u1ea1y, n\xean request sau s\u1ebd ph\u1ea3i ch\u1edd request tr\u01b0\u1edbc x\u1eed l\xfd xong, d\u1eabn \u0111\u1ebfn Puma b\u1ecb th\u1ecdt trong tr\u01b0\u1eddng h\u1ee3p n\xe0y.\\n\\nTa c\xf3 th\u1ec3 ki\u1ec3m tra v\u1ec1 tr\u1ea1ng th\xe1i c\xe1c thread c\u1ee7a Puma b\u1eb1ng \u0111o\u1ea1n code sau:\\n\\n```ruby title=app/controllers/homes_controller.rb\\nclass HomesController < ApplicationController\\n  def show\\n    Thread.list.select { |t| t.name&.match?(/puma threadpool \\\\d+/) }.each do |t|\\n      Rails.logger.info(\\"Thread #{t.name}: #{t.status}, alive: #{t.alive?}, current: #{t == Thread.current}\\")\\n    end\\n    head :ok\\n  end\\nend\\n```\\n\\nV\xec sao l\u1ea1i l\xe0 `/puma threadpool \\\\d+/`? C\xe1c b\u1ea1n c\xf3 th\u1ec3 xem t\u1ea1i [\u0111\xe2y](https://github.com/puma/puma/blob/3e80f7c704e5585da4faa32edf0fa7a0abed3689/lib/puma/thread_pool.rb#L104).\\n\\n```ruby title=config/routes.rb\\nRails.application.routes.draw do\\n  resource :home\\nend\\n```\\n\\n```ruby title=config/puma.rb\\nmax_threads_count = ENV.fetch(\'RAILS_MAX_THREADS\', 5)\\nmin_threads_count = ENV.fetch(\'RAILS_MIN_THREADS\') { max_threads_count }\\nthreads min_threads_count, max_threads_count\\nworker_timeout 3600 if ENV.fetch(\'RAILS_ENV\', \'development\') == \'development\'\\nport ENV.fetch(\'PORT\', 3000)\\nenvironment ENV.fetch(\'RAILS_ENV\', \'development\')\\npidfile ENV.fetch(\'PIDFILE\', \'tmp/pids/server.pid\')\\nplugin :tmp_restart\\n```\\n\\n```curl\\ncurl http://localhost:3000/home\\ntail -n 50 log/development.log\\n```\\n\\nV\xe0 \u0111\xe2y l\xe0 output:\\n\\n```log\\nThread puma threadpool 001: sleep, alive: true, current: false\\nThread puma threadpool 002: sleep, alive: true, current: false\\nThread puma threadpool 003: sleep, alive: true, current: false\\nThread puma threadpool 004: sleep, alive: true, current: false\\nThread puma threadpool 005: run, alive: true, current: true\\n```\\n\\n\u0110\xf3 ch\xednh l\xe0 5 thread c\u1ee7a ch\xfang ta, nh\u01b0 v\xed d\u1ee5 l\xe0 thread 5 \u0111ang ti\u1ebfn h\xe0nh x\u1eed l\xfd request, c\xf2n nh\u1eefng thread kh\xe1c n\u1ebfu r\u1ea3nh n\xf3 s\u1ebd \u1edf tr\u1ea1ng th\xe1i `sleep`. \u1ede \u0111\xe2y c\xf3 1 \u0111i\u1ec3m \u0111\xe1ng ch\xfa \xfd l\xe0 sau khi k\u1ebft th\xfac request, thread kh\xf4ng b\u1ecb kill m\xe0 ch\u1ec9 v\u1ec1 tr\u1ea1ng th\xe1i `sleep`, do v\u1eady n\u1ebfu ta tu\u1ef3 ti\u1ec7n modify bi\u1ebfn global, n\xf3 s\u1ebd \u1ea3nh h\u01b0\u1edfng t\u1edbi request ti\u1ebfp theo m\xe0 thread \u0111\xf3 handle.\\n\\nV\xed d\u1ee5:\\n\\n```ruby\\nbefore_action :set_locale\\n\\ndef set_locale\\n  I18n.locale = params[:locale] || I18n.default_locale\\nend\\n```\\n\\nKh\xf4ng c\u1ea7n bi\u1ebft code c\xe1i g\xec, nh\u01b0ng modify 1 bi\u1ebfn global t\u1ea1i runtime nh\u01b0 tr\xean l\xe0 \u0111\xe3 th\u1ea5y nguy hi\u1ec3m r\u1ed3i. V\xe0 ta h\xe3y ti\u1ebfn h\xe0nh test xem\\n\\n```ruby title=app/controllers/homes_controller.rb\\nclass HomesController < ApplicationController\\n  def show\\n    Thread.current.tap { |t| Rails.logger.info(\\"Current thread #{t.name}: #{t.status}, alive: #{t.alive?}\\") }\\n    Rails.logger.info(\\"Before: #{I18n.locale}\\")\\n    I18n.locale = params[:locale]\\n    Rails.logger.info(\\"After: #{I18n.locale}\\")\\n    head :ok\\n  end\\nend\\n```\\n\\nr\u1ed3i sau \u0111\xf3 spam kho\u1ea3ng ch\u1ee5c c\xe1i request\\n\\n```bash\\ncurl http://localhost:3000/home?locale=vi\\n```\\n\\nv\xe0 ta s\u1ebd th\u1ea5y k\u1ebft qu\u1ea3 nh\u01b0 sau\\n\\n```log title=log/development.log\\nCurrent thread puma threadpool 003: run, alive: true\\nBefore: en\\nAfter: vi\\n\\nCurrent thread puma threadpool 003: run, alive: true\\nBefore: vi\\nAfter: vi\\n```\\n\\nC\xf3 th\u1ec3 d\u1ec5 d\xe0ng nh\u1eadn ra r\u1eb1ng vi\u1ec7c set `I18n.locale = \\"vi\\"` \u1edf request tr\u01b0\u1edbc \u0111\xe3 b\u1ecb leak sang request sau. N\u1ebfu \u1edf t\u1ea5t c\u1ea3 c\xe1c request, tr\u01b0\u1edbc khi x\u1eed l\xfd ta \u0111\u1ec1u set `I18n.locale` th\xec vi\u1ec7c leak tr\xean s\u1ebd \xedt \u1ea3nh h\u01b0\u1edfng h\u01a1n.\\n\\nTuy nhi\xean h\xe3y th\u1eed t\u01b0\u1edfng t\u01b0\u1ee3ng khi app c\u1ee7a b\u1ea1n c\xf3 ch\u1ee9a c\u1ea3 code admin v\xe0 api, b\xean admin c\xf3 th\u1ec3 \u0111\u1ed5i ng\xf4n ng\u1eef, c\xf2n api th\xec kh\xf4ng, th\xec k\u1ebft qu\u1ea3 s\u1ebd ra sao. Khi admin \u0111\u1ed5i ng\xf4n ng\u1eef, t\xecnh c\u1edd, 1 user v\xf4 ph\xfac n\xe0o \u0111\xf3 request t\u1edbi tr\xfang c\xe1i thread v\u1eeba handle vi\u1ec7c admin \u0111\u1ed5i ng\xf4n ng\u1eef, v\xe0 API s\u1ebd tr\u1ea3 v\u1ec1 locale c\u1ee7a \xf4ng admin kia :v\\n\\nCh\xednh v\xec v\u1eady, \u1edf docs c\u1ee7a Rails c\u0169ng c\xf3 recommend ch\xfang ta x\u1eed l\xfd chuy\u1ec3n locale b\u1eb1ng `I18n.with_locale`, c\xe1c b\u1ea1n c\xf3 th\u1ec3 xem t\u1ea1i [\u0111\xe2y](https://guides.rubyonrails.org/i18n.html#managing-the-locale-across-requests)\\n\\n```ruby\\naround_action :switch_locale\\n\\ndef switch_locale(&action)\\n  locale = params[:locale] || I18n.default_locale\\n  I18n.with_locale(locale, &action)\\nend\\n```\\n\\nT\xfam v\xe1y l\u1ea1i l\xe0 multi-threading h\u1ed7 tr\u1ee3 concurrent r\u1ea5t t\u1ed1t, tuy nhi\xean c\u0169ng \u1ea9n ch\u1ee9a 1 v\xe0i v\u1ea5n \u0111\u1ec1. N\xean s\u1ebd c\u1ea7n ch\xfa \xfd h\u01a1n khi code.\\n\\n### 2.3. Multi-processing\\n\\nM\xe1y t\xednh hi\u1ec7n nay \u0111a s\u1ed1 \u0111\u1ec1u c\xf3 kh\xe1 nhi\u1ec1u core, v\xe0 \u0111\u1ec1u h\u1ed7 tr\u1ee3 \u0111a nhi\u1ec7m \u0111\u1ec3 t\u1ed1i \u01b0u ho\xe1 vi\u1ec7c x\u1eed l\xfd song song. V\u1eady v\u1edbi webserver th\xec sao? C\xf3 c\u1ea7n ch\u1ee9, multi-processing gi\xfap ta c\xf3 th\u1ec3 x\u1eed l\xfd th\xeam nhi\u1ec1u request \u0111\u1ed3ng th\u1eddi h\u01a1n n\u1eefa. Tr\u1eeb khi server c\u1ee7a ta qu\xe1 y\u1ebfu, ch\u1ee9 kh\xf4ng th\xec t\u1ed9i g\xec, nh\xe0 ch\u1ea3 c\xf3 g\xec ngo\xe0i core m\xe0 l\u1ea1i ch\u1ea1y \u0111\u01a1n nh\xe2n th\xec ph\xed c\u1ee7a gi\u1eddi qu\xe1 :v\\n\\nM\u1eb7c \u0111\u1ecbnh Puma s\u1ebd ch\u1ea1y \u1edf single mode, khi \u0111\xf3 ch\u1ec9 c\xf3 1 process, process n\xe0y s\u1ebd \u0111\u1ea3m nh\u1eadn h\u1ebft t\u1eeb vi\u1ec7c l\u01b0u code c\u1ee7a app, ti\u1ebfp nh\u1eadn request, ... sau \u0111\xf3 s\u1ebd \u0111\u1ea9y request sang cho c\xe1c thread x\u1eed l\xfd nh\u01b0 \u0111\xe3 m\xf4 t\u1ea3 \u1edf tr\xean.\\n\\nC\xf2n \u0111\u1ed1i v\u1edbi cluster mode, tr\u01b0\u1edbc h\u1ebft Puma s\u1ebd t\u1ea1o ra m\u1ed9t master process. T\u1eeb process n\xe0y, d\u1ef1a v\xe0o gi\xe1 tr\u1ecb c\u1ee7a config d\u01b0\u1edbi, Puma s\u1ebd _fork_ \u0111\u1ec3 t\u1ea1o ra s\u1ed1 process t\u01b0\u01a1ng \u1ee9ng, hay c\xf2n g\u1ecdi l\xe0 _worker_.\\n\\n```ruby title=config/puma.rb\\nworkers ENV.fetch(\\"WEB_CONCURRENCY\\") { 2 }\\n```\\n\\nL\u1ea1i n\xf3i v\u1ec1 fork, \u0111\xe2y l\xe0 qu\xe1 tr\xecnh m\xe0 1 process t\u1ea1o ra 1 process m\u1edbi, g\u1ecdi l\xe0 _child process_. M\u1ed7i child process \u0111\u1ec1u c\xf3 process id (PID) ri\xeang bi\u1ec7t, v\xe0 m\u1ed9t m\xf4i tr\u01b0\u1eddng ri\xeang t\xe1ch bi\u1ec7t ho\xe0n to\xe0n v\u1edbi parent process (source code, memory, stack, ...). Kh\xf4ng nh\u01b0 thread v\u1eabn share code v\u1edbi process, nh\u01b0ng c\xf3 stack, register ri\xeang. Do v\u1eady, c\xf3 th\u1ec3 n\xf3i forking an to\xe0n v\xe0 b\u1ea3o m\u1eadt h\u01a1n so v\u1edbi multi-thread.\\n\\nQuay tr\u1edf l\u1ea1i v\u1edbi Puma, \u1edf cluster mode, master process ch\u1ec9 \u0111\u1ea3m nh\u1eadn vi\u1ec7c ti\u1ebfp nh\u1eadn request, sau \u0111\xf3 s\u1ebd b\u1eafn sang c\xe1c worker \u0111\u1ec3 ch\xfang t\u1ef1 x\u1eed v\u1edbi c\xe1c thread m\xe0 ch\xfang spawn. C\xe1c worker c\u1ee7a Puma \u0111\u1ec1u c\xf3 1 b\u1ea3n copy source code app ri\xeang, n\xean khi ch\u1ea1y nhi\u1ec1u worker, h\xe3y ch\u1eafc ch\u1eafn l\xe0 server c\u1ee7a b\u1ea1n c\xf3 \u0111\u1ee7 RAM :v\\n\\n\u1ede Ruby, c\xf3 th\u1ec3 ki\u1ec3m tra xem app c\u1ee7a ta \u0111ang ch\u1ea1y \u1edf process n\xe0o b\u1eb1ng c\xe1ch s\u1eed d\u1ee5ng\\n\\n```ruby\\nProcess.pid  # Current child process\\nProcess.ppid # Parent process\\n```\\n\\nH\xe3y th\u1eed \u1edf app Rails c\u1ee7a ta xem\\n\\n```ruby title=app/controllers/homes_controller.rb\\nclass HomesController < ApplicationController\\n  def show\\n    Rails.logger.info(\\"Current: #{Process.pid}. Parent: #{Process.ppid}\\")\\n    head :ok\\n  end\\nend\\n```\\n\\n```ruby title=config/puma.rb\\n# ...\\nworkers 2\\n```\\n\\n```log title=log/development.log\\nProcessing by HomesController#show as */*\\nCurrent: 128. Parent: 1\\n\\nProcessing by HomesController#show as */*\\nCurrent: 129. Parent: 1\\n```\\n\\n```bash\\nps aux\\n# USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND\\n# root         1  0.5  7.1 236000 145864 pts/0   Ssl+ 03:28   0:04 puma 5.3.1 (tcp://0.0.0.0:3000) [app]\\n# root         7  0.0  0.1   3544  3192 pts/1    Ss   03:29   0:00 zsh\\n# root       128  0.0  6.9 288680 142008 pts/0   Sl+  03:29   0:00 puma: cluster worker 0: 1 [app]\\n# root       129  0.0  6.9 288720 142116 pts/0   Sl+  03:29   0:00 puma: cluster worker 1: 1 [app]\\n# root       219  0.0  0.0   1640   856 pts/1    R+   03:40   0:00 ps aux\\n```\\n\\n## 3. K\u1ebft lu\u1eadn\\n\\nC\u1ea3 multi-threading v\xe0 multi-processing \u0111\u1ec1u quan tr\u1ecdng, ch\xfang g\xf3p ph\u1ea7n gi\xfap app ta x\u1eed l\xfd \u0111c concurrent request. Hy v\u1ecdng b\xe0i vi\u1ebft c\xf3 th\u1ec3 gi\xfap \xedch cho c\xe1c b\u1ea1n \xedt nhi\u1ec1u.\\n\\nNgo\xe0i ra, v\u1ec1 v\u1ea5n \u0111\u1ec1 set s\u1ed1 worker v\xe0 thread \u1edf ph\u1ea7n \u0111\u1ea7u \u0111\xe3 n\xf3i, t\u1ed1t nh\u1ea5t ch\u1eafc v\u1eabn l\xe0:\\n\\n- `WEB_CONCURRENCY` = vcore, ngo\xe0i ra c\xf2n ph\u1ee5 thu\u1ed9c v\xe0o RAM n\u1eefa\\n- `RAILS_MAX_THREADS` kh\xf4ng c\xf3 con s\u1ed1 c\u1ee5 th\u1ec3, ph\u1ee5 thu\u1ed9c v\xe0o RAM v\xe0 CPU, nhi\u1ec1u RAM, CPU kho\u1ebb th\xec set \u0111\u01b0\u1ee3c c\xe0ng nhi\u1ec1u, nh\u01b0ng c\u0169ng kh\xe1 l\xe0 h\xean xui, ph\u1ea3i ti\u1ebfn h\xe0nh test r\u1ed3i m\u1edbi c\u0103n ch\u1ec9nh con s\u1ed1 ph\xf9 h\u1ee3p \u0111\u01b0\u1ee3c =))\\n\\nN\u1ebfu c\xf3 sai s\xf3t g\xec c\xe1c b\u1ea1n c\u1ee9 g\u1ea1ch \u0111\xe1 tho\u1ea3i m\xe1i \xe0 :v chi ti\u1ebft c\xf3 th\u1ec3 tham kh\u1ea3o \u1edf [\u0111\xe2y](https://devcenter.heroku.com/articles/deploying-rails-applications-with-the-puma-web-server#workers)\\n\\n## 4. Tham kh\u1ea3o\\n\\n- https://www.speedshop.co/2015/07/29/scaling-ruby-apps-to-1000-rpm.html\\n- https://devcenter.heroku.com/articles/concurrency-and-database-connections\\n- https://devcenter.heroku.com/articles/deploying-rails-applications-with-the-puma-web-server\\n- http://www.geekride.com/fork-forking-vs-threading-thread-linux-kernel/\\n- https://www.studytonight.com/operating-system/multithreading\\n- https://www.tutorialspoint.com/how-to-create-a-process-in-linux#:~:text=A%20new%20process%20can%20be,newly%20is%20called%20child%20process."},{"id":"cuoi-react-native-xem-appium-phan-1-cung-tim-hieu-cach-hoat-dong-cua-appium","metadata":{"permalink":"/blog/cuoi-react-native-xem-appium-phan-1-cung-tim-hieu-cach-hoat-dong-cua-appium","editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/blog/2021-01-04-appium-react-native.md","source":"@site/blog/2021-01-04-appium-react-native.md","title":"C\u01b0\u1ee1i React Native xem Appium (Ph\u1ea7n 1 - C\xf9ng t\xecm hi\u1ec3u c\xe1ch ho\u1ea1t \u0111\u1ed9ng c\u1ee7a Appium)","description":"Do d\xf2ng \u0111\u1eddi \u0111\u01b0a \u0111\u1ea9y v\xe0 kh\xe1ch th\xec ti\u1ec1n \xedt nh\u01b0ng l\u1ea1i th\xedch h\xedt h\xe0ng th\u01a1m (to\xe0n \u0111\xf2i 80~100 coverage -\\\\_-) n\xean m\xecnh c\u0169ng \u0111\xe3 kinh qua react-native-testing-library m\u1ed9t th\u1eddi gian kha kh\xe1, v\xe0 c\u0169ng ngh\u1ecbch th\u1eed Detox, nh\u01b0ng ch\u01b0a th\u1eb1ng n\xe0o l\xe0m m\xecnh h\xe0i l\xf2ng:","date":"2021-01-04T00:00:00.000Z","formattedDate":"January 4, 2021","tags":[{"label":"react-native","permalink":"/blog/tags/react-native"},{"label":"e2e-testing","permalink":"/blog/tags/e-2-e-testing"},{"label":"appium","permalink":"/blog/tags/appium"}],"readingTime":13.14,"hasTruncateMarker":false,"authors":[{"name":"L\xea S\u0129 B\xedch","title":"Ruby on Rails/React Developer","url":"https://github.com/moonlight8978","imageURL":"https://avatars.githubusercontent.com/u/26299310?v=4"}],"frontMatter":{"slug":"cuoi-react-native-xem-appium-phan-1-cung-tim-hieu-cach-hoat-dong-cua-appium","title":"C\u01b0\u1ee1i React Native xem Appium (Ph\u1ea7n 1 - C\xf9ng t\xecm hi\u1ec3u c\xe1ch ho\u1ea1t \u0111\u1ed9ng c\u1ee7a Appium)","author":"L\xea S\u0129 B\xedch","author_title":"Ruby on Rails/React Developer","author_url":"https://github.com/moonlight8978","author_image_url":"https://avatars.githubusercontent.com/u/26299310?v=4","tags":["react-native","e2e-testing","appium"]},"unlisted":false,"prevItem":{"title":"C\xf9ng t\xecm hi\u1ec3u v\u1ec1 Puma (Ruby on Rails)","permalink":"/blog/cung-tim-hieu-ve-puma-ruby-on-rails"},"nextItem":{"title":"Gi\u1edbi thi\u1ec7u v\u1ec1 Kubernetes","permalink":"/blog/gioi-thieu-ve-kubernetes"}},"content":"Do d\xf2ng \u0111\u1eddi \u0111\u01b0a \u0111\u1ea9y v\xe0 kh\xe1ch th\xec ti\u1ec1n \xedt nh\u01b0ng l\u1ea1i th\xedch h\xedt h\xe0ng th\u01a1m (to\xe0n \u0111\xf2i 80~100 coverage -\\\\_-) n\xean m\xecnh c\u0169ng \u0111\xe3 kinh qua [react-native-testing-library](https://github.com/callstack/react-native-testing-library) m\u1ed9t th\u1eddi gian kha kh\xe1, v\xe0 c\u0169ng ngh\u1ecbch th\u1eed [Detox](https://github.com/wix/Detox), nh\u01b0ng ch\u01b0a th\u1eb1ng n\xe0o l\xe0m m\xecnh h\xe0i l\xf2ng:\\n\\n- Testing-library: Khi test e2e th\xec ph\u1ea3i mock qu\xe1 nhi\u1ec1u, kh\xe1 kh\xf3 \u0111\u1ec3 mock component sao cho ho\u1ea1t \u0111\u1ed9ng gi\u1ed1ng nh\u01b0 component th\u1eadt. C\xf3 nh\u1eefng l\xfac m\xecnh ch\u1ec9 vi\u1ebft \u0111\u1ec3 cho % coverage l\xean ch\u1ee9 c\xe1c fn c\u1ee7a test \u0111\xf3 b\u1ecb mock h\u1ebft, th\xe0nh ra ch\u1ea3 c\xf3 \xfd ngh\u0129a g\xec nhi\u1ec1u. C\xe1c th\xe0nh ph\u1ea7n UI b\u1ecb mock h\u1ebft, n\xean test pass m\xe0 v\u1eabn ch\u1ebft l\xe0 \u0111i\u1ec1u b\xecnh th\u01b0\u1eddng nh\u01b0 c\xe2n \u0111\u01b0\u1eddng h\u1ed9p s\u1eefa.\\n- Detox: ch\u01a1i v\u1edbi m\u1ed7i simulator, device th\u1eadt ko r\xf5 t\u1edbi gi\u1edd \u0111\xe3 \u0111\u01b0\u1ee3c \u0111\xe1nh \u0111i\u1ec7n t\u1eed ch\u01b0a.\\n\\nV\xe0 g\u1ea7n \u0111\xe2y th\xec m\xecnh \u0111\u1ecdc l\u1ea1i [docs c\u1ee7a React Native](https://reactnative.dev/docs/testing-overview#end-to-end-tests) c\xf3 recommend th\xeam 1 th\u1eb1ng - Appium. Appium s\u1eed d\u1ee5ng driver nh\u01b0 XCUITest, UIAutomator, Espresso, ... \u0110\u01b0\u1ee3c c\xe1c teito (tay to :v) native \u1edf c\xf4ng ty b\u1ea3o m\u1ea5y th\u1eb1ng driver tr\xean to\xe0n l\xe0 h\xe0ng h\u1ecbn b\xean native d\xf9ng \u0111\u1ec3 ch\u1ea1y test, n\xean th\u1eed ngh\u1ecbch lu\xf4n. Sau m\u1ed9t th\u1eddi gian m\xe0y m\xf2 th\xec kh\xe1 h\xe0i l\xf2ng.\\n\\n#### T\u1ea1i sao l\u1ea1i d\xf9ng Appium m\xe0 ko ch\u1ea1y c\u01a1m cho kh\u1ecfe?\\n\\nN\xf3i th\u1ebf ch\u1ee9 th\u1ef1c ra th\xec ch\u1ea1y c\u01a1m kh\xf4ng h\u1ec1 kh\u1ecfe t\xed n\xe0o \u0111\xe2u c\xe1c b\u1ea1n.\\n\\nKhi ta ph\xe1t tri\u1ec3n 1 feature m\u1edbi cho app, ta ph\u1ea3i test cho c\u1ea3 nh\u1eefng t\xednh n\u0103ng \u0111\xe3 c\xf3, \u1ea3nh h\u01b0\u1edfng t\u1edbi ch\xfang l\xe0 \u0111i\u1ec1u kh\xf3 tr\xe1nh kh\u1ecfi.\\n\\nTh\xf4ng th\u01b0\u1eddng dev ch\xfang ta s\u1ebd ngh\u0129 l\xe0 \\"C\xf3 tester r\u1ed3i xo\u1eafn g\xec\\" \u0111\xfang kh\xf4ng n\xe0o? Tuy nhi\xean ph\u1eadn dev qu\xe8n th\xec c\u0169ng v\u1eabn ph\u1ea3i check qua nh\u1eefng case c\u01a1 b\u1ea3n, (test th\xeam case d\u1ecb c\xe0ng t\u1ed1t) tr\u01b0\u1edbc khi chuy\u1ec3n qua cho tester. Nh\u01b0ng kh\xf4ng l\u1ebd c\u1ee9 vi\u1ebft m\u1ed9t feature l\xe0 ng\u1ed3i b\u1eadt app l\xean b\u1ea5m t\u1eebng n\xfat, ch\u01b0a k\u1ec3 ~~xe \u0111\u1ea1p m\u1edbi ( m\xecnh c\xf3 m\u1ed9t ng\u01b0\u1eddi b\u1ea1n r\u1ea5t hay nh\u1ea7m newbie v\xe0 newbike =)) )~~ newbie kh\xf4ng n\u1eafm r\xf5 h\u1ec7 th\u1ed1ng, lack case l\xe0 \u0111i\u1ec1u t\u1ea5t nhi\xean, h\u01a1n n\u1eefa con ng\u01b0\u1eddi ch\xfang ta kh\xf4ng gi\u1ecfi trong nh\u1eefng vi\u1ec7c nh\xe0m ch\xe1n c\xf3 t\xednh l\u1eb7p l\u1ea1i cao nh\u01b0 test app, v\xec v\u1eady d\xf9 c\xf3 l\xe0 b\xf4 l\xe3o th\xec c\u0169ng s\u1ebd c\xf3 l\xfac nh\u1ea7m l\u1eabn.\\n\\nNgo\xe0i ra, \u1edf cu\u1ed1n \\"The Effective Engineer\\" c\u1ee7a Edmond Lau (n\u1ebfu ko c\xf3 g\xec sai s\xf3t th\xec l\xe0 trang 159) c\xf3 vi\u1ebft:\\n\\n> If you have to do something manually more than twice, then write a tool for the third time\\n\\nV\u1eady th\xec sao ch\xfang ta kh\xf4ng \u0111\u1ec3 m\xe1y l\xe0m nh\u1eefng c\xf4ng vi\u1ec7c nh\xe0m ch\xe1n nh\u01b0 test, v\xe0 focus v\xe0o nh\u1eefng vi\u1ec7c khi\u1ebfn ta h\u1ee9ng th\xfa h\u01a1n. H\xe3y c\xf9ng h\u1ecdc vi\u1ebft test t\u1ef1 \u0111\u1ed9ng cho \u1ee9ng d\u1ee5ng React Native c\u1ee7a ch\xfang ta th\xf4i n\xe0o!\\n\\n### M\u1ed9t v\xe0i ki\u1ebfn th\u1ee9c c\u1ea7n c\xf3\\n\\n- React Native, Babel (kh\xf4ng c\u1ea7n qu\xe1 m\xe1t t\u01a1)\\n- N\u1eafm \u0111\u01b0\u1ee3c c\u01a1 b\u1ea3n v\u1ec1 vi\u1ebft unit test (v\u1edbi jest, hay g\xec \u0111\xf3 t\u01b0\u01a1ng t\u1ef1)\\n- Typescript (optional): do \u1edf b\xe0i vi\u1ebft s\u1ebd d\xf9ng Typescript\\n\\n### Hardware\\n\\n- M\xe1y Mac/Hackintosh \u0111\u1ec3 build iOS ho\u1eb7c m\xe1y Win (ch\u1ec9 ch\u1ea1y \u0111\u01b0\u1ee3c Android th\xf4i)\\n- 1 con \u0111i\u1ec7n tho\u1ea1i iOS ho\u1eb7c Android - n\xf3i kh\xf4ng v\u1edbi integration test tr\xean simulator :v\\n\\n# 2. Ch\u1ea1y th\u1eed v\xed d\u1ee5 nh\u1ecf\\n\\nT\u1ef1 d\u01b0ng nh\u1ed3i m\u1ed9t \u0111\u1ed1ng l\xfd thuy\u1ebft su\xf4ng, trong khi kh\xf4ng bi\u1ebft m\xecnh s\u1ebd l\xe0m g\xec c\xf3 ph\u1ea3i r\u1ea5t ch\xe1n kh\xf4ng n\xe0o? V\xec v\u1eady tr\u01b0\u1edbc ti\xean ta h\xe3y ch\u1ea1y th\u1eed m\u1ed9t v\xed d\u1ee5 nh\u1ecf sau tr\u01b0\u1edbc \u0111\xe3: \u0110\u0103ng k\xed account\\n\\nV\xed d\u1ee5 sau d\xf9ng Typescript + WebdriverIO, v\xe0 c\xf3 c\u1ea5u tr\xfac t\u01b0\u01a1ng \u0111\u01b0\u01a1ng v\u1edbi v\xed d\u1ee5 tr\xean trang ch\u1ee7 c\u1ee7a Appium [link](https://github.com/appium/appium/tree/master/sample-code/javascript-webdriverio) (C\xe1c b\u1ea1n c\u0169ng c\xf3 th\u1ec3 v\xe0o link tr\xean b\u1eb1ng truy c\u1eadp [trang ch\u1ee7 Appium](http://appium.io/) r\u1ed3i b\u1ea5m v\xe0o n\xfat Examples), t\u1ea5t nhi\xean \u0111\u1ec3 go pro th\xec ta s\u1ebd ko code nh\u01b0 v\u1eady, m\xecnh s\u1ebd th\u1ef1c hi\u1ec7n refactor v\xe0 chuy\u1ec3n \u0111\u1ed5i m\xf4i tr\u01b0\u1eddng ch\u1ea1y test \u1edf c\xe1c b\xe0i sau ( n\u1ebfu c\xf3 =)) ).\\n\\nSau khi setup Babel c\xf9ng v\u1edbi Jest (do Jest lu\xf4n \u0111i k\xe8m v\u1edbi React Native n\xean m\xecnh d\xf9ng lu\xf4n \u0111\u1ec3 demo cho th\xe2n thi\u1ec7n), h\xe3y vi\u1ebft 1 \u0111o\u1ea1n test \u0111\u01a1n gi\u1ea3n cho qu\xe1 tr\xecnh sign up c\u1ee7a ta.\\nHi\u1ec7n t\u1ea1i m\xecnh ch\u1ec9 fill nh\u1eefng field text input, v\xec field select, date picker vi\u1ebft kh\xe1 d\xe0i, n\xean m\xecnh s\u1ebd \u0111\u1ec1 c\u1eadp sau.\\n\\n> N\xf3i nhi\u1ec1u qu\xe1, code \u0111\xe2u?\\n\\nV\xe2ng, code \u0111\xe2y (\u1edf d\u01b0\u1edbi c\xf3 gi\u1ea3i th\xedch code)\\n\\n```js\\nimport { BrowserObject, remote, RemoteOptions } from \\"webdriverio\\";\\n\\nconst iOS: RemoteOptions = {\\n  path: \\"/wd/hub\\",\\n  host: \\"localhost\\",\\n  port: 4723,\\n  capabilities: {\\n    platformName: \\"iOS\\",\\n    automationName: \\"XCUITest\\",\\n    deviceName: \\"iPhone (2)\\",\\n    platformVersion: \\"14.1\\",\\n    app: \\"org.reactjs.native.example.LearnRnE2eTest\\",\\n    udid: process.env.IOS_DEVICE_UUID,\\n    xcodeOrgId: \\"xxx\\",\\n    xcodeSigningId: \\"Apple Development\\",\\n  },\\n};\\n\\nconst android: RemoteOptions = {\\n  path: \\"/wd/hub\\",\\n  host: \\"localhost\\",\\n  port: 4723,\\n  capabilities: {\\n    automationName: \\"UiAutomator2\\",\\n    platformName: \\"android\\",\\n    platformVersion: \\"8.0.0\\",\\n    deviceName: \\"BH9057609A\\",\\n    appPackage: \\"com.learnrne2etest\\",\\n    appActivity: \\".MainActivity\\",\\n  },\\n};\\n\\nlet client: BrowserObject;\\n\\nbeforeEach(async () => {\\n  client = await remote(iOS);\\n  console.error(client);\\n});\\n\\nafterEach(async () => {\\n  if (client) {\\n    await client.deleteSession();\\n  }\\n});\\n\\nconst scrollTo = async (a11yId: string) => {\\n  if (client.options.capabilities.platformName === \\"android\\") {\\n    await client.execute(\\"mobile: scroll\\", {\\n      strategy: \\"accessibility id\\",\\n      selector: a11yId,\\n    });\\n  }\\n};\\n\\nit(\\"sign up the user\\", async () => {\\n  const toRegistrationScreenButton = await client.$(\\n    \\"~login/toRegistrationScreenButton\\"\\n  );\\n  await toRegistrationScreenButton.click();\\n\\n  const registerButton = await client.$(\\"~registration/registerButton\\");\\n  await scrollTo(\\"registration/toLoginScreenButton\\");\\n  await registerButton.click();\\n\\n  await scrollTo(\\"registration/usernameInput-error\\");\\n  let usernameError = await client.$(\\"~registration/usernameInput-error\\");\\n  expect(await usernameError.getText()).toMatch(\\"Please enter username\\");\\n\\n  const passwordError = await client.$(\\"~registration/passwordInput-error\\");\\n  expect(await passwordError.getText()).toMatch(\\"Please enter password\\");\\n\\n  let passwordConfirmationError = await client.$(\\n    \\"~registration/passwordConfirmationInput-error\\"\\n  );\\n  expect(await passwordConfirmationError.getText()).toMatch(\\n    \\"Please confirm your password\\"\\n  );\\n\\n  const fullNameError = await client.$(\\"~registration/fullNameInput-error\\");\\n  expect(await fullNameError.getText()).toMatch(\\"Please enter your full name\\");\\n\\n  const usernameInput = await client.$(\\"~registration/usernameInput\\");\\n  await usernameInput.setValue(\\"user..01\\");\\n  usernameError = await client.$(\\"~registration/usernameInput-error\\");\\n  expect(await usernameError.getText()).toMatch(\\n    \\"Username must be alphabet and numbers\\"\\n  );\\n  await usernameInput.setValue(\\"user\\");\\n\\n  const passwordInput = await client.$(\\"~registration/passwordInput\\");\\n  await passwordInput.setValue(\\"password\\");\\n\\n  const passwordConfirmationInput = await client.$(\\n    \\"~registration/passwordConfirmationInput\\"\\n  );\\n  await passwordConfirmationInput.setValue(\\"password123\\");\\n  passwordConfirmationError = await client.$(\\n    \\"~registration/passwordConfirmationInput-error\\"\\n  );\\n  expect(await passwordConfirmationError.getText()).toMatch(\\n    \\"Password confirmation must match your password\\"\\n  );\\n  await passwordConfirmationInput.setValue(\\"password\\");\\n\\n  const fullNameInput = await client.$(\\"~registration/fullNameInput\\");\\n  await fullNameInput.setValue(\\"Test\\");\\n\\n  await client.hideKeyboard();\\n\\n  await scrollTo(\\"registration/toLoginScreenButton\\");\\n  await registerButton.click();\\n\\n  await client.waitUntil(\\n    () =>\\n      client\\n        .$(\\"~registrationCompleted/toLoginScreenButton\\")\\n        .then((element) => element.isDisplayed()),\\n    { timeout: 10000 }\\n  );\\n});\\n```\\n\\nChi ti\u1ebft source code c\xf3 th\u1ec3 xem t\u1ea1i [\u0111\xe2y](https://github.com/moonlight8978/learn-rn-e2e-test/tree/jest/e2e)\\n\\nSource code c\u1ee7a c\xe1c m\xe0n h\xecnh c\xf3 th\u1ec3 xem t\u1ea1i \u0111\xe2y:\\n\\n- Login screen [link](https://github.com/moonlight8978/learn-rn-e2e-test/blob/jest/rn-app/src/screens/login/login.tsx)\\n- Registration screen [link](https://github.com/moonlight8978/learn-rn-e2e-test/blob/jest/rn-app/src/screens/registration/registration.tsx)\\n\\nV\xe0 \u0111\xe2y l\xe0 th\xe0nh ph\u1ea9m:\\n\\n```js\\n$ yarn test\\n\\n PASS  __tests__/sign-up.spec.ts (18.817 s)\\n  \u2713 sign up the user (17179 ms)\\n\\nTest Suites: 1 passed, 1 total\\nTests:       1 passed, 1 total\\nSnapshots:   0 total\\nTime:        18.869 s, estimated 29 s\\nRan all test suites.\\n\u2728  Done in 21.80s.\\n```\\n\\n|                                   iOS                                   |                                 Android                                 |\\n| :---------------------------------------------------------------------: | :---------------------------------------------------------------------: |\\n| ![](https://images.viblo.asia/30a3e57a-44ab-4c56-b4cf-0047bb221353.gif) | ![](https://images.viblo.asia/907005db-f46a-40ea-9b3c-f269fe06646d.gif) |\\n\\n### V\xed d\u1ee5 tr\xean l\xe0m g\xec?\\n\\n1. T\u1eeb m\xe0n **Login**, b\u1ea5m v\xe0o button \u300cCreate an account\u300d `login/toRegistrationScreenButton` \u0111\u1ec3 v\xe0o m\xe0n **Registration**\\n\\n2. T\u1ea1i m\xe0n **Registration**\\n\\n   1.1.B\u1ea5m v\xe0o n\xfat \u300cRegister\u300d`registration/registerButton`, do m\xe1y Android c\u1ee7a m\xecnh m\xe0n h\u01a1i ng\u1eafn, n\xean tr\u01b0\u1edbc khi click ph\u1ea3i scroll t\u1edbi element \u0111\xf3 tr\u01b0\u1edbc.\\n\\n   1.2. Do ch\u01b0a fill g\xec n\xean expect error message hi\u1ec3n th\u1ecb t\u01b0\u01a1ng \u1ee9ng\\n\\n   1.3. Fill \u300cuser..01\u300dv\xe0o input username, do field n\xe0y ch\u1ec9 nh\u1eadn alphabet v\xe0 s\u1ed1, n\xean gi\xe1 tr\u1ecb \u0111\xf3 ko h\u1ee3p l\u1ec7, expect hi\u1ec3n th\u1ecb error message\\n\\n   1.4. Fill username 1 gi\xe1 tr\u1ecb h\u1ee3p l\u1ec7 \u300cuser\u300d\\n\\n   1.5. Fill password \u300cpassword\u300d\\n\\n   1.6. Fill password confirmation\u300cpassword123\u300d, do ko match password \u0111\xe3 nh\u1eadp n\xean s\u1ebd hi\u1ec3n th\u1ecb error\\n\\n   1.7. Fill password confirmation h\u1ee3p l\u1ec7 \u300cpassword\u300d\\n\\n   1.8. Fill full name\\n\\n   1.9. B\u1ea5m v\xe0o n\xfat \u300cRegister\u300d\\n\\n3. User \u0111\u01b0\u1ee3c chuy\u1ec3n qua m\xe0n RegistrationCompleted, n\xean ta expect button \u1edf m\xe0n n\xe0y \u0111\u01b0\u1ee3c hi\u1ec3n th\u1ecb.\\n\\n### Ph\xe2n t\xedch m\u1ed9t v\xe0i note v\u1ec1 c\xfa ph\xe1p\\n\\nC\xfa ph\xe1p c\u1ee7a WebdriverIO nh\xecn kh\xe1 trong s\xe1ng v\xe0 d\u1ec5 hi\u1ec3u, n\xean m\xecnh s\u1ebd kh\xf4ng gi\u1ea3i th\xedch nhi\u1ec1u, tuy nhi\xean c\xf3 m\u1ed9t v\xe0i ch\xfa \xfd d\u01b0\u1edbi \u0111\xe2y cho c\xe1c b\u1ea1n.\\n\\n- Khi t\xecm element, m\xecnh \u0111\xe3 d\xf9ng `~`, \u0111\xe2y l\xe0 shorthand \u0111\u1ec3 t\xecm element theo `accessibility id` c\u1ee7a WebdriverIO, tu\u1ef3 theo OS m\xe0 ta s\u1ebd ph\u1ea3i g\xe1n prop kh\xe1c nhau \u0111\u1ec3 c\xf3 th\u1ec3 d\xf9ng \u0111\u01b0\u1ee3c strategy t\xecm theo `accessibility id` n\xe0y [link](https://github.com/webdriverio/native-demo-app/blob/master/js/config/TestProperties.js), ch\u1ec9 v\xec c\xe1i n\xe0y m\xe0 m\xecnh m\u1ea5t v\xe0i ti\u1ebfng, ko hi\u1ec3u t\u1ea1i sao ko t\xecm th\u1ea5y element =))\\n\\n  - \u1ede b\xean iOS ta ph\u1ea3i d\xf9ng `testID`, v\xe0 tr\xe1nh g\xe1n `accessibilityLabel` v\xe0 `accessibilityHint` cho component.\\n  - \u1ede b\xean Android, h\xe3y d\xf9ng `accessibilityLabel`\\n\\n  * C\xe1c b\u1ea1n c\xf3 th\u1ec3 tham kh\u1ea3o c\xe1c strategy kh\xe1c \u1edf docs c\u1ee7a webdriverio [link](https://webdriver.io/docs/selectors.html)\\n\\n- T\u1ea1i sao l\u1ea1i d\xf9ng `accessibility id` m\xe0 kh\xf4ng d\xf9ng content c\u1ee7a n\xf3?\\n\\n  - \u0110\xfang ra l\xe0 khi b\u1ea5m button hay thao t\xe1c tr\xean m\xe0n h\xecnh, ch\xfang ta n\xean d\xf9ng text c\u1ee7a n\xf3, \u0111\u1ec3 khi text (requirement) thay \u0111\u1ed5i th\xec test c\u0169ng o\u1eb3ng. Nh\u01b0ng m\xe0 c\u01a1 b\u1ea3n l\xe0 do ~~h\u01a1i b\u1eadn~~ l\u01b0\u1eddi =)) v\xe0 tr\u01b0\u1eddng h\u1ee3p accessibility id \u0111\xfang nh\u01b0ng text sai th\xec ph\u1ea3i ch\u1ea5p nh\u1eadn th\xf4i \xe0 =))\\n\\n* Do API c\u1ee7a WebdriverIO to\xe0n tr\u1ea3 v\u1ec1 Promise, n\xean h\u1ea7u nh\u01b0 c\xe2u l\u1ec7nh n\xe0o c\u0169ng c\u1ea7n ph\u1ea3i d\xf9ng `async/await`, c\xe1c b\u1ea1n c\xf3 th\u1ec3 s\u1eed d\u1ee5ng k\xe8m package [`@wdio/sync`](https://www.npmjs.com/package/@wdio/sync) \u0111\u1ec3 API c\u1ee7a WebdriverIO tr\u1edf n\xean \u0111\u1ed3ng b\u1ed9.\\n\\n* C\xe1c b\u1ea1n c\xf3 \u0111\u1ec3 \xfd \u0111o\u1ea1n code \u1edf `beforeEach` v\xe0 `afterEach` kh\xf4ng? M\u1ed7i test, ch\xfang ta \u0111ang t\u1ea1o ra m\u1ed9t session m\u1edbi, v\xe0 xo\xe1 session \u0111\xf3 sau m\u1ed7i test. N\u1ebfu d\xf9ng CLI c\u1ee7a wdio th\xec s\u1ebd thu\u1eadn ti\u1ec7n h\u01a1n.\\n\\n* Options `xcodeOrgId` v\xe0 `xcodeSigningId` b\xean trong `capabilities` c\u1ee7a `RemoteOptions` iOS\\n\\n  - \u0110\u1ec3 ch\u1ea1y test tr\xean thi\u1ebft b\u1ecb iOS, Appium s\u1ebd c\xe0i m\u1ed9t ph\u1ea7n m\u1ec1m t\xean l\xe0 `WebDriverAgent` l\xean thi\u1ebft b\u1ecb, v\xe0 \u0111\u1ec3 c\xe0i \u0111\u1eb7t \u0111\u01b0\u1ee3c, ta ph\u1ea3i cung c\u1ea5p developer team v\xe0 signing certificate.\\n\\n    C\xe1c b\u1ea1n c\xf3 th\u1ec3 xem th\xeam t\u1ea1i \u0111\xe2y [link](http://appium.io/docs/en/drivers/ios-xcuitest-real-devices/)\\n\\n    ![](https://images.viblo.asia/8915c299-098f-4f94-a9a4-cbdf450e371b.jpg)\\n\\n* \u0110\u1ed1i v\u1edbi thi\u1ebft b\u1ecb th\u1eadt th\xec ta c\u1ea7n th\xeam UUID, c\xf3 th\u1ec3 xem c\xe1ch t\xecm UUID t\u1ea1i [\u0111\xe2y](https://www.idownloadblog.com/2018/11/20/how-to-find-udid-iphone-xs-max-xr/)\\n\\n* `capabilities` c\u1ee7a Android\\n\\n  - \u0110\u1ec3 l\u1ea5y `deviceName`, h\xe3y ch\u1ea1y `adb devices`\\n\\n  - `com.learnrne2etest` v\xe0 `.MainActivity` c\xf3 th\u1ec3 l\u1ea5y t\u1eeb `android/app/src/main/AndroidManifest.xml`\\n\\n    ```xml\\n    <manifest package=\\"com.learnrne2etest\\">\\n        \x3c!-- ... --\x3e\\n        <activity android:name=\\".MainActivity\\">\\n           \x3c!-- ... --\x3e\\n        </activity>\\n    </manifest>\\n    ```\\n\\n    Ho\u1eb7c tham kh\u1ea3o b\xe0i sau [link](http://www.automationtestinghub.com/apppackage-and-appactivity-name/)\\n\\nC\u01b0\u1ee1i ng\u1ef1a xem hoa nh\u01b0 v\u1eady \u0111\u1ee7 r\u1ed3i, ch\xfang ta h\xe3y c\xf9ng t\xecm hi\u1ec3u th\xeam v\u1ec1 c\xe1ch ho\u1ea1t \u0111\u1ed9ng c\u1ee7a Appium\\n\\n# 3. Ki\u1ebfn tr\xfac, flow c\u1ee7a Appium\\n\\n![](https://images.viblo.asia/d5fa4bea-70c4-4bfa-9d89-03aac8d9a92c.jpg)\\n\\nAppium d\u1ef1a tr\xean ki\u1ebfn tr\xfac client-server, b\u1ea3n th\xe2n Appium l\xe0 1 server, c\xf3 th\u1ec3 d\u1ec5 d\xe0ng nh\u1eadn th\u1ea5y \u0111i\u1ec1u n\xe0y \u1edf \u0111o\u1ea1n config.\\n\\n```ts\\nconst iOS: RemoteOptions = {\\n  path: \\"/wd/hub\\",\\n  host: \\"localhost\\",\\n  port: 4723,\\n  // ...\\n};\\n```\\n\\n#### 3.1. Test library + WebDriver client\\n\\nKhi vi\u1ebft test, ta s\u1ebd d\xe0nh ph\u1ea7n l\u1edbn th\u1eddi gian \u0111\u1ec3 l\xe0m vi\u1ec7c v\u1edbi ch\xfang, nh\u01b0 v\xed d\u1ee5 \u1edf ph\u1ea7n 2, ta \u0111\xe3 s\u1eed d\u1ee5ng Jest (v\u1edbi c\xe1c c\xe2u l\u1ec7nh `it`, `describe`, `afterEach`, `afterAll`) l\xe0 c\xf4ng c\u1ee5 \u0111\u1ec3 ch\u1ea1y test, v\xe0 WebdriverIO (v\u1edbi `$`, `click()`, `setValue(value)`) \u0111\u1ec3 giao ti\u1ebfp v\u1edbi Appium server.\\n\\nNgo\xe0i b\u1ed9 \u0111\xf4i n\xe0y, ch\xfang ta c\xf3 th\u1ec3 s\u1eed d\u1ee5ng b\u1ea5t c\u1ee9 ng\xf4n ng\u1eef n\xe0o m\xe0 ta th\xedch (mi\u1ec5n l\xe0 Appium n\xf3 support :v), t\u1eeb Ruby, Python cho \u0111\u1ebfn PHP, C#, c\xf3 th\u1ec3 xem list t\u1ea1i [\u0111\xe2y](http://appium.io/docs/en/about-appium/appium-clients/index.html)\\n\\nNh\u01b0ng m\xe0 m\xecnh recommend combo sau:\\n\\n- Ng\xf4n ng\u1eef: JS/TS th\xe2n thi\u1ec7n v\u1edbi React Native dev\\n\\n- WebDriver client: [WebdriverIO](https://webdriver.io/) v\xec trong \u0111\xe1m client, th\u1eb1ng n\xe0y nhi\u1ec1u star tr\xean github nh\u1ea5t =))\\n\\n* Test library: [jasmine](https://jasmine.github.io/index.html)\\n  - V\xec n\xf3 c\xf3 c\xfa ph\xe1p gi\u1ed1ng Jest, m\xe0 anh em code React Native th\xec qu\xe1 quen thu\u1ed9c v\u1edbi Jest r\u1ed3i\\n  - L\xe0 1 trong 3 test framework \u0111\u01b0\u1ee3c WebdriverIO support s\u1eb5n \u0111\u1ec3 go pro =)) (ngo\xe0i ra c\xf2n c\xf3 mocha v\xe0 cucumber), d\xf9ng Jest n\u1ebfu l\u1ed7i th\xec ph\u1ea3i t\u1ef1 m\xe0y m\xf2 th\xf4i :v\\n\\nNh\u01b0 \u0111\xe3 n\xf3i \u1edf tr\xean, Appium \xe1p d\u1ee5ng ki\u1ebfn tr\xfac client-server. Khi ta vi\u1ebft nh\u1eefng c\xe2u l\u1ec7nh sau\\n\\n```ts\\n// ./__tests__/sign-up.spec.ts\\nawait passwordConfirmationInput.setValue(\\"password123\\");\\n```\\n\\nn\u1ebfu \u0111\u1ec3 \xfd log ta c\xf3 th\u1ec3 th\u1ea5y nh\u1eefng d\xf2ng log d\u01b0\u1edbi \u0111\xe2y, webdriverio ch\u1ec9 \u0111\u01a1n thu\u1ea7n g\u1eedi 1 HTTP request t\u1edbi server, server l\xe0m g\xec th\xec ch\xfang ta s\u1ebd t\xecm hi\u1ec3u sau :v\\n\\n- iOS\\n\\n```js\\n[HTTP] --\x3e POST /wd/hub/session/b891507e-4d84-4e62-a5b2-e9110c529c9e/element/6F000000-0000-0000-E00E-000000000000/value\\n[HTTP] {\\"text\\":\\"password123\\"}\\n[debug] [W3C (b891507e)] Calling AppiumDriver.setValue() with args: [\\"password123\\",\\"6F000000-0000-0000-E00E-000000000000\\",\\"b891507e-4d84-4e62-a5b2-e9110c529c9e\\"]\\n[debug] [XCUITest] Executing command \'setValue\'\\n[debug] [WD Proxy] Matched \'/element/6F000000-0000-0000-E00E-000000000000/value\' to command name \'setValue\'\\n[debug] [Protocol Converter] Added \'text\' property \\"password123\\" to \'setValue\' request body\\n[debug] [WD Proxy] Proxying [POST /element/6F000000-0000-0000-E00E-000000000000/value] to [POST http://127.0.0.1:8100/session/01BFCDD1-27D7-4904-A95A-C75086994546/element/6F000000-0000-0000-E00E-000000000000/value] with body: {\\"value\\":[\\"p\\",\\"a\\",\\"s\\",\\"s\\",\\"w\\",\\"o\\",\\"r\\",\\"d\\",\\"1\\",\\"2\\",\\"3\\"],\\"text\\":\\"password123\\"}\\n[debug] [WD Proxy] Got response with status 200: {\\"value\\":null,\\"sessionId\\":\\"01BFCDD1-27D7-4904-A95A-C75086994546\\"}\\n[debug] [W3C (b891507e)] Responding to client with driver.setValue() result: null\\n[HTTP] <-- POST /wd/hub/session/b891507e-4d84-4e62-a5b2-e9110c529c9e/element/6F000000-0000-0000-E00E-000000000000/value 200 821 ms - 14\\n```\\n\\n- Android\\n\\n```js\\nconsole.info\\n  2020-12-31T02:12:23.288Z INFO webdriver: COMMAND findElement(\\"accessibility id\\", \\"login/toRegistrationScreenButton\\")\\n\\n    at node_modules/@wdio/logger/build/node.js:76:9\\n\\nconsole.info\\n  2020-12-31T02:12:23.289Z INFO webdriver: [POST] http://localhost:4723/wd/hub/session/7fc4b801-deae-49dc-947d-292d67ba5467/element\\n\\n    at node_modules/@wdio/logger/build/node.js:76:9\\n\\nconsole.info\\n  2020-12-31T02:12:23.289Z INFO webdriver: DATA {\\n    using: \'accessibility id\',\\n    value: \'login/toRegistrationScreenButton\'\\n  }\\n\\n    at node_modules/@wdio/logger/build/node.js:76:9\\n\\nconsole.info\\n  2020-12-31T02:12:23.414Z INFO webdriver: RESULT {\\n    \'element-6066-11e4-a52e-4f735466cecf\': \'bb82f194-16d1-4ba0-a520-33f47e117211\',\\n    ELEMENT: \'bb82f194-16d1-4ba0-a520-33f47e117211\'\\n  }\\n\\n    at node_modules/@wdio/logger/build/node.js:76:9\\n```\\n\\n#### 3.2. Appium server, Automation tool, Devices\\n\\n\u0110\xe2y l\xe0 ph\u1ea7n x\u01b0\u01a1ng s\u1ed1ng trong ki\u1ebfn tr\xfac c\u1ee7a Appium, n\xf3 \u0111\u1ea3m nh\u1eadn vi\u1ec7c handle request t\u1eeb client, giao ti\u1ebfp v\u1edbi native automation tool \u0111\u1ec3 th\u1ef1c thi nh\u1eefng command m\xe0 ta c\u1ea7n.\\n\\nAppium server expose ra API theo chu\u1ea9n JSON Wire Protocol (WebDriver Protocol). Tu\u1ef3 v\xe0o target l\xe0 iOS hay Android, n\xf3 s\u1ebd c\xf3 c\xe1ch ho\u1ea1t \u0111\u1ed9ng ri\xeang \u0111\u1ec3 ph\xf9 h\u1ee3p v\u1edbi n\u1ec1n t\u1ea3ng \u0111\xf3.\\n\\n##### 3.2.1. Appium meets iOS\\n\\nQuay tr\u1edf l\u1ea1i \u0111o\u1ea1n log \u1edf ph\u1ea7n 3.1, n\xf3 \u0111\xe3 \xedt nhi\u1ec1u g\u1ee3i \xfd cho ta c\xe1ch ho\u1ea1t \u0111\u1ed9ng c\u1ee7a Appium\\n\\n```js\\n[HTTP] --\x3e POST /wd/hub/session/b891507e-4d84-4e62-a5b2-e9110c529c9e/element/6F000000-0000-0000-E00E-000000000000/value\\n[debug] [WD Proxy] Proxying [POST /element/6F000000-0000-0000-E00E-000000000000/value] to [POST http://127.0.0.1:8100/session/01BFCDD1-27D7-4904-A95A-C75086994546/element/6F000000-0000-0000-E00E-000000000000/value]\\n```\\n\\nC\xf3 th\u1ec3 d\u1ec5 th\u1ea5y Appium server \u0111\u01a1n gi\u1ea3n ch\u1ec9 proxy request c\u1ee7a ta t\u1edbi 1 server kh\xe1c ch\u1ea1y \u1edf port 8100 `http://127.0.0.1:8100`.\\n\\n> O\xe1t d\u1edd ph\u01b0\u1edbc? Th\u1eb1ng n\xe0o \u0111ang ch\u1ea1y \u1edf port 8100 v\u1eady?\\n\\n\u0110\xf3 l\xe0 [WebDriverAgent server](https://github.com/facebookarchive/WebDriverAgent), ban \u0111\u1ea7u \u0111\u01b0\u1ee3c ph\xe1t tri\u1ec3n b\u1edfi \xf4ng l\u1edbn **Facebook**, appium \u0111\xe3 fork v\u1ec1 th\xeam m\u1eafm th\xeam mu\u1ed1i g\xec \u0111\xf3 v\xe0o.\\n\\nWDA gi\xfap giao ti\u1ebfp v\u1edbi XCUITest \u0111\u1ec3 c\xf3 th\u1ec3 \u0111i\u1ec1u khi\u1ec3n device/simulator iOS t\u1eeb xa. B\u1ea3n th\xe2n n\xf3 c\u0169ng \u0111\xe3 support s\u1eb5n Webdriver Protocol, v\u1eady n\xean ch\u1eafc h\u1eb3n dev Appium \u0111\xe3 ngh\u0129 nh\u01b0 sau\\n\\n> T\u1ed9i g\xec m\xe0 ph\u1ea3i code l\u1ea1i, c\xf3 s\u1eb5n h\xe0ng ngon r\u1ed3i th\xec d\xf9ng lu\xf4n th\xf4i =))\\n\\nWDA l\xe0m g\xec v\u1edbi device th\xec m\xecnh xin skip, v\xec c\u0169ng ko bi\u1ebft =)) C\xe1c b\u1ea1n c\xf3 th\u1ec3 t\u1ef1 m\xecnh t\xecm hi\u1ec3u s\xe2u h\u01a1n n\u1ebfu c\xf3 h\u1ee9ng th\xfa v\u1edbi n\xf3.\\n\\n##### 3.2.2. Appium meets Android\\n\\nV\u1edbi Android, ta c\xf3 \xedt g\u1ee3i \xfd h\u01a1n\\n\\n```js\\n2020-12-31T02:12:23.289Z INFO webdriver: [POST] http://localhost:4723/wd/hub/session/7fc4b801-deae-49dc-947d-292d67ba5467/element\\n2020-12-31T02:12:23.414Z INFO webdriver: RESULT {\\n  \'element-6066-11e4-a52e-4f735466cecf\': \'bb82f194-16d1-4ba0-a520-33f47e117211\',\\n  ELEMENT: \'bb82f194-16d1-4ba0-a520-33f47e117211\'\\n}\\n```\\n\\nKh\xf4ng th\u1ea5y proxy g\xec \u0111\xf3 ph\u1ea3i kh\xf4ng n\xe0o? \u0110\xfang v\u1eady, v\xec n\xf3 c\xf3 proxy \u0111\xe2u :v\\n\\n\u1ede version m\u1edbi nh\u1ea5t, Appium s\u1eed d\u1ee5ng [appium-android-driver](https://github.com/appium/appium-android-driver) \u0111\u1ec3 giao ti\u1ebfp v\u1edbi UIAutomator2. V\u1eady giao ti\u1ebfp th\u1ebf n\xe0o?\\n\\nM\u1ed7i khi b\u1eaft \u0111\u1ea7u ch\u1ea1y test, Appium s\u1ebd c\xe0i app **Appium Settings** tr\xean device c\u1ee7a ta, th\u1eb1ng n\xe0y s\u1ebd m\u1edf port [4724](https://github.com/appium/appium-android-driver/blob/19b949383e9e1300edd25982e33bb76689a001d2/lib/driver.js#L17) tr\xean device c\u1ee7a ta v\xe0 expose ra m\u1ed9t v\xe0i API h\u1ec7 th\u1ed1ng. Appium server _abc_ v\u1edbi app \u0111\xe3 c\xe0i tr\xean (qua HTTP), v\xe0 n\xf3 s\u1ebd _xyz_ v\u1edbi UIAutomator2 \u0111\u1ec3 th\u1ef1c hi\u1ec7n c\xe1c command.\\n\\n![](https://images.viblo.asia/0b1ef505-609d-4412-b9d6-65508df7358d.jpg)\\n\\n# 4. K\u1ebft lu\u1eadn\\n\\nL\xe0 m\u1ed9t dev, ch\xfang ta kh\xf4ng \u0111\u01b0\u1ee3c ch\u1ee7 quan, l\u1ec7 thu\u1ed9c v\xe0o b\xean tester, m\xe0 h\xe3y t\u1ef1 m\xecnh ki\u1ec3m th\u1eed tr\u01b0\u1edbc khi chuy\u1ec3n qua cho h\u1ecd. Test ch\u1ea1y c\u01a1m l\xe0 m\u1ed9t c\xf4ng vi\u1ec7c nh\xe0m ch\xe1n, v\u1eady th\xec t\u1ea1i sao ch\xfang ta kh\xf4ng l\xe0m cho n\xf3 th\xfa v\u1ecb h\u01a1n b\u1eb1ng c\xe1ch automate n\xf3. Tuy s\u1ebd c\xf3 l\xfac c\u1ea7n m\u1ed9t s\u1ed1 th\u1ee7 thu\u1eadt, hay l\xe0 ph\u1ea3i d\xf9ng nhi\u1ec1u command kh\xe1 l\u1eb1ng nh\u1eb1ng ( nh\u01b0 c\xe1i datepicker ch\u1eb3ng h\u1ea1n =)) ), nh\u01b0ng m\u1ed9t khi ch\u1ea1y \u0111\u01b0\u1ee3c nh\u1ea5t \u0111\u1ecbnh n\xf3 s\u1ebd \u0111em l\u1ea1i cho c\xe1c b\u1ea1n m\u1ed9t c\u1ea3m gi\xe1c ph\xea nh\u01b0 con t\xea t\xea =))\\n\\nCode e2e c\u1ee7a b\xe0i vi\u1ebft ch\u1ec9 l\xe0 nh\u1eefng \u0111o\u1ea1n code t\u1ea1m b\u1ee3, c\xe1c b\u1ea1n mu\u1ed1n go pro c\xf3 th\u1ec3 tham kh\u1ea3o [appium-boilerplate](https://github.com/webdriverio/appium-boilerplate) c\u1ee7a webdriverio v\u1ec1 c\xe1ch chia module, c\u0169ng nh\u01b0 setup project. N\u1ebfu c\xf3 th\u1eddi gian m\xecnh s\u1ebd vi\u1ebft th\xeam v\u1ec1 vi\u1ec7c refactor \u0111\u1ed1ng code t\u1ea1m b\u1ee3 tr\xean \u0111\u1ec3 go pro =)) Gi\u1edd th\xec xin t\u1ea1m bi\u1ec7t c\xe1c b\u1ea1n."},{"id":"gioi-thieu-ve-kubernetes","metadata":{"permalink":"/blog/gioi-thieu-ve-kubernetes","editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/blog/2019-11-21-introduce-to-kubernetes.md","source":"@site/blog/2019-11-21-introduce-to-kubernetes.md","title":"Gi\u1edbi thi\u1ec7u v\u1ec1 Kubernetes","description":"Ng\xe0y nay, container \u0111\xe3 l\xe0 1 th\u1ee9 g\xec \u0111\xf3 qu\xe1 ph\u1ed5 bi\u1ebfn, nh\u1eefng n\u1ec1n t\u1ea3ng cloud c\u1ee7a Amazon, Google, hay Microsoft, v.v... \u0111\u1ec1u \u0111\xe3 h\u1ed7 tr\u1ee3 deploy container. V\xe0 \u1edf local, hay nh\u1eefng server test, m\u1ecdi ng\u01b0\u1eddi c\u0169ng \u0111ang d\u1ea7n chu\u1ea9n sang container v\xec s\u1ef1 ti\u1ec7n l\u1ee3i c\u1ee7a ch\xfang.","date":"2019-11-21T00:00:00.000Z","formattedDate":"November 21, 2019","tags":[{"label":"devops","permalink":"/blog/tags/devops"},{"label":"kubernetes","permalink":"/blog/tags/kubernetes"},{"label":"introduction","permalink":"/blog/tags/introduction"}],"readingTime":10.52,"hasTruncateMarker":false,"authors":[{"name":"L\xea S\u0129 B\xedch","title":"Ruby on Rails/React Developer","url":"https://github.com/moonlight8978","imageURL":"https://avatars.githubusercontent.com/u/26299310?v=4"}],"frontMatter":{"slug":"gioi-thieu-ve-kubernetes","title":"Gi\u1edbi thi\u1ec7u v\u1ec1 Kubernetes","author":"L\xea S\u0129 B\xedch","author_title":"Ruby on Rails/React Developer","author_url":"https://github.com/moonlight8978","author_image_url":"https://avatars.githubusercontent.com/u/26299310?v=4","tags":["devops","kubernetes","introduction"]},"unlisted":false,"prevItem":{"title":"C\u01b0\u1ee1i React Native xem Appium (Ph\u1ea7n 1 - C\xf9ng t\xecm hi\u1ec3u c\xe1ch ho\u1ea1t \u0111\u1ed9ng c\u1ee7a Appium)","permalink":"/blog/cuoi-react-native-xem-appium-phan-1-cung-tim-hieu-cach-hoat-dong-cua-appium"},"nextItem":{"title":"T\u1ed1i \u01b0u m\u1ec7nh \u0111\u1ec1 WHERE (MySQL)","permalink":"/blog/toi-uu-menh-de-where-mysql"}},"content":"Ng\xe0y nay, container \u0111\xe3 l\xe0 1 th\u1ee9 g\xec \u0111\xf3 qu\xe1 ph\u1ed5 bi\u1ebfn, nh\u1eefng n\u1ec1n t\u1ea3ng cloud c\u1ee7a Amazon, Google, hay Microsoft, v.v... \u0111\u1ec1u \u0111\xe3 h\u1ed7 tr\u1ee3 deploy container. V\xe0 \u1edf local, hay nh\u1eefng server test, m\u1ecdi ng\u01b0\u1eddi c\u0169ng \u0111ang d\u1ea7n chu\u1ea9n sang container v\xec s\u1ef1 ti\u1ec7n l\u1ee3i c\u1ee7a ch\xfang.\\n\\nTuy nhi\xean khi s\u1ed1 l\u01b0\u1ee3ng container l\u1edbn d\u1ea7n, ch\xfang ng\xe0y c\xe0ng tr\u1edf n\xean r\u1eafc r\u1ed1i, vi\u1ec7c control resource, network, volume c\u1ee7a m\u1ed9t s\u1ed1 l\u01b0\u1ee3ng l\u1edbn container ng\xe0y c\xe0ng kh\xf3. Ch\xednh v\xec l\xfd do \u0111\xf3, m\u1ed9t s\u1ed1 n\u1ec1n t\u1ea3ng qu\u1ea3n l\xfd container \u0111\xe3 ra \u0111\u1eddi nh\u01b0 Docker Swarm, Kubernetes, ...\\n\\nV\u1edbi m\u1ed9t h\u1ec7 th\u1ed1ng nh\u1ecf, ta c\xf3 th\u1ec3 s\u1eed d\u1ee5ng Docker Swarm, s\u1eed d\u1ee5ng n\xf3 r\u1ea5t d\u1ec5 v\xe0 \u0111\u01a1n gi\u1ea3n. Kubernetes cho ph\xe9p ta customize nhi\u1ec1u th\u1ee9 trong h\u1ec7 th\u1ed1ng h\u01a1n, tuy nhi\xean c\xe1i gi\xe1 c\u1ee7a n\xf3 l\xe0 kh\xf3 s\u1eed d\u1ee5ng h\u01a1n nhi\u1ec1u Docker Swarm.\\n\\nNote: Ta kh\xf4ng bao gi\u1edd so s\xe1nh Kubernetes v\u1edbi Docker, v\xec k8s th\u1ee9 l\xe0 management tool, c\xf2n docker l\xe0 container runtime.\\n\\n# 2. Ki\u1ebfn tr\xfac h\u1ea1 t\u1ea7ng c\u1ee7a Kubernetes\\n\\n![](https://images.viblo.asia/8fd57971-e1c9-41dd-b205-0ce88a356e50.png)\\n\\n### 2.1 Master components\\n\\nNh\u1eefng components tr\xean master node s\u1ebd \u0111\xf3ng vai tr\xf2 l\xe0 control plane c\u1ee7a cluster. VD nh\u01b0: scheduling c\xe1c pod, ...\\n\\n##### 2.1.1 etcd\\n\\n\u0110\xe2y l\xe0 database ph\xe2n t\xe1n, s\u1eed d\u1ee5ng Raft l\xe0m c\u01a1 ch\u1ebf \u0111\u1ed3ng thu\u1eadn.\\n\\nState c\u1ee7a cluster (config, node info, IP addresses, ...) \u0111\u1ec1u \u0111\u01b0\u1ee3c l\u01b0u tr\u1eef t\u1ea1i \u0111\xe2y.\\n\\n##### 2.1.2 kube-scheduler\\n\\nC\xf3 nhi\u1ec7m v\u1ee5 schedule pod t\u1edbi nh\u1eefng node c\xf3 \u0111\u1ee7 resource, v\xe0 \u0111\u1ea3m b\u1ea3o pod \u0111\u1ea1t \u0111\u01b0\u1ee3c expected status.\\n\\nC\xf3 th\u1ec3 hi\u1ec3u \u0111\u01a1n gi\u1ea3n \u0111\xe2y l\xe0 m\u1ed9t v\xf2ng l\u1eb7p v\xf4 t\u1eadn, \u0111\u01b0a nh\u1eefng pod m\u1edbi \u0111\u01b0\u1ee3c t\u1ea1o v\xe0o 1 queue, t\u1eebng item trong \u0111\xf3 s\u1ebd \u0111\u01b0\u1ee3c schedule t\u1edbi node th\u1ecfa m\xe3n.\\n\\n##### 2.1.3 kube-apiserver\\n\\nAPI Server \u0111\u01a1n thu\u1ea7n l\xe0 1 REST API c\u1ee7a Kubernetes cluster.\\n\\nKhi mu\u1ed1n t\u1ea1o, c\u1eadp nh\u1eadt, hay x\xf3a nh\u1eefng resource c\u1ee7a h\u1ec7 th\u1ed1ng nh\u01b0 pod, ingress, ... th\xec \u0111\u1ec1u c\u1ea7n th\xf4ng qua API Server, ch\u1ee9 kh\xf4ng call th\u1eb3ng t\u1edbi kube-scheduler, etcd, ...\\n\\n##### 2.1.4 kube-controller-manager\\n\\nCh\u1ea1y nhi\u1ec1u controller process. M\u1ed7i controller c\xf3 nhi\u1ec7m v\u1ee5 kh\xe1c nhau nh\u01b0:\\n\\n- Node Controller\\n- Replication Controller\\n- ...\\n\\n### 2.2 Node components\\n\\nL\xe0 nh\u1eefng component \u0111\u01b0\u1ee3c c\xe0i \u0111\u1eb7t tr\xean t\u1ea5t c\u1ea3 c\xe1c node, gi\xfap qu\u1ea3n l\xfd container tr\xean node, logging, qu\u1ea3n l\xfd network, ...\\n\\n##### 2.2.1 kubelet\\n\\nC\xf3 nhi\u1ec7m v\u1ee5 qu\u1ea3n l\xfd container, \u0111\u1ea3m b\u1ea3o container ch\u1ea1y ch\xednh x\xe1c, kubelet ch\u1ec9 qu\u1ea3n l\xfd container do k8s t\u1ea1o.\\n\\n##### 2.2.2 kube-proxy\\n\\nL\xe0 m\u1ed9t network proxy, d\xf9ng \u0111\u1ec3 forward request t\u1edbi h\u1ea1 t\u1ea7ng c\u1ee7a k8s.\\n\\n##### 2.2.3 Container runtime\\n\\nCh\u1eafn ch\u1eafn ta kh\xf4ng th\u1ec3 thi\u1ebfu runtime cho container, n\xf3 c\xf3 th\u1ec3 l\xe0 rkt, Docker, ... hay b\u1ea5t c\u1ee9 th\u1ee9 g\xec kh\xe1c.\\n\\n### 2.3 Ho\u1ea1t \u0111\u1ed9ng\\n\\nCh\xfang ta s\u1ebd c\xf9ng xem nh\u1eefng component tr\xean s\u1ebd k\u1ebft h\u1ee3p v\u1edbi nhau ho\u1ea1t \u0111\u1ed9ng ra sao, th\xf4ng qua vi\u1ec7c t\u1ea1o 1 Pod qua `kubectl` CLI.\\n\\n**Pod** \u1edf \u0111\xe2y c\xf3 th\u1ec3 coi l\xe0 1 m\xe1y \u1ea3o, hay 1 container nh\u01b0 Docker cho d\u1ec5 h\xecnh dung.\\n\\n![](https://images.viblo.asia/f19795c9-fbc9-48e1-9391-53fc439c1391.jpg)\\n\\n- Tr\u01b0\u1edbc ti\xean ta s\u1eed d\u1ee5ng `kubectl` \u0111\u1ec3 y\xeau c\u1ea7u t\u1ea1o 1 Pod. B\u1ea3n ch\u1ea5t c\u1ee7a command n\xe0y l\xe0 s\u1ebd th\u1ef1c hi\u1ec7n 1 HTTP request t\u1edbi **apiserver** c\u1ee7a cluster.\\n- **apiserver** s\u1ebd th\u1ef1c hi\u1ec7n ghi l\u1ea1i current state, v\xe0 desired state c\u1ee7a cluster l\u1ea1i v\xe0o **etcd** (asynchronous)\\n- **etcd** s\u1ebd notify l\u1ea1i **apiserver** khi entry \u0111\u01b0\u1ee3c t\u1ea1o th\xe0nh c\xf4ng\\n- Ti\u1ebfp theo **kube-scheduler** s\u1ebd th\u1ef1c hi\u1ec7n vi\u1ec7c schedule Pod. Khi t\xecm th\u1ea5y node th\xedch h\u1ee3p, n\xf3 s\u1ebd b\xe1o cho **apiserver** l\xe0 Pod \u0111\xf3 \u0111\xe3 \u0111\u01b0\u1ee3c bind v\xe0o node n\xe0o. **apiserver** s\u1ebd l\u1ea1i update v\xe0o **etcd**\\n- **kubelet** t\u1ea1i node \u0111\xf3 s\u1ebd th\u1ef1c hi\u1ec7n vi\u1ec7c theo d\xf5i container t\u1ea1o b\u1edfi **container runtime** (Docker), xem ch\xfang c\xf3 ch\u1ea1y \u0111\xfang v\u1edbi PodSpec kh\xf4ng. **kubelet** s\u1ebd g\u1ecdi t\u1edbi **apiserver** \u0111\u1ec3 update state c\u1ee7a Pod \u0111\xf3 th\u01b0\u1eddng xuy\xean.\\n\\n# 3. Ki\u1ebfn tr\xfac c\u1ee7a \u1ee9ng d\u1ee5ng tr\xean Kubernetes\\n\\nTa s\u1ebd ch\u1ec9 t\u1eadp trung v\xe0o 3 y\u1ebfu t\u1ed1 ch\xednh \u0111\u1ec3 m\u1ed9t h\u1ec7 th\u1ed1ng c\xf3 th\u1ec3 ho\u1ea1t \u0111\u1ed9ng \u0111\u01b0\u1ee3c:\\n\\n- \u1ee8ng d\u1ee5ng\\n- Network\\n- Storage\\n\\n### 3.1 Pod\\n\\n##### Pod l\xe0 g\xec\\n\\n**Pod** l\xe0 \u0111\u01a1n v\u1ecb nh\u1ecf nh\u1ea5t trong cluster. M\u1ed7i Pod c\xf3 IP ri\xeang, v\xe0 c\xf3 th\u1ec3 ch\u1ee9a nhi\u1ec1u container, nh\u1eefng container trong c\xf9ng 1 Pod c\xf3 th\u1ec3 giao ti\u1ebfp v\u1edbi nhau qua localhost. V\xec v\u1eady, c\xf3 th\u1ec3 coi Pod l\xe0 m\u1ed9t m\xe1y \u1ea3o cho d\u1ec5 h\xecnh dung.\\n\\nTuy nhi\xean \u0111\u1ec3 \u0111\u01a1n gi\u1ea3n, ng\u01b0\u1eddi ta th\u01b0\u1eddng ch\u1ec9 ch\u1ea1y 1 container tr\xean m\u1ed7i Pod, khi \u0111\xf3 ta s\u1ebd l\xe0m vi\u1ec7c v\u1edbi Pod thay v\xec v\u1edbi t\u1eebng container ri\xeang l\u1ebb.\\n\\n##### Init container\\n\\nPod c\xf3 h\u1ed7 tr\u1ee3 init container (1 ho\u1eb7c nhi\u1ec1u \u0111\u1ec1u \u0111\u01b0\u1ee3c). Tr\u01b0\u1edbc khi app container (container ch\xednh - v\xed d\u1ee5 container v\u1edbi command `rails s`) ch\u1ea1y, t\u1ea5t c\u1ea3 init container s\u1ebd \u0111\u01b0\u1ee3c ch\u1ea1y l\u1ea7n l\u01b0\u1ee3t, c\xe1i tr\u01b0\u1edbc th\xe0nh c\xf4ng r\u1ed3i \u0111\u1ebfn c\xe1i sau ch\u1ea1y.\\n\\nV\xed d\u1ee5 nh\u01b0 1 \u1ee9ng d\u1ee5ng Rails, ta c\xf3 th\u1ec3 settings `rails s` l\xe0m app container, c\xf2n `rails db:create db:migrate` s\u1ebd l\xe0m init container.\\n\\n##### Controller\\n\\nController l\xe0 1 concept trong Kubernetes, n\xf3 d\xf9ng \u0111\u1ec3 theo d\xf5i 1 lo\u1ea1i Resource n\xe0o \u0111\xf3. **kube-controller-manager** c\xf3 nhi\u1ec7m v\u1ee5 qu\u1ea3n l\xfd nh\u1eefng controller n\xe0y.\\n\\nV\u1ec1 m\u1eb7t k\u1ef9 thu\u1eadt th\xec \u0111\xe2y \u0111\u01a1n thu\u1ea7n l\xe0 1 v\xf2ng l\u1eb7p v\xf4 h\u1ea1n (_control loop_) \u0111\u1ec3 c\xf3 th\u1ec3 \u0111i\u1ec1u ch\u1ec9nh state c\u1ee7a cluster sao cho n\xf3 \u0111\u1ea1t t\u1edbi \u0111\u01b0\u1ee3c desired state.\\n\\nTuy nhi\xean \u0111ang trong m\u1ee5c Pod n\xean ta s\u1ebd ch\u1ec9 \u0111\u1ec1 c\u1eadp t\u1edbi controller theo d\xf5i Pod trong ph\u1ea7n n\xe0y.\\n\\n- `Deployment`:\\n\\n  Ta s\u1ebd s\u1eed d\u1ee5ng `Deployment` khi c\u1ea7n deploy 1 ho\u1eb7c nhi\u1ec1u replica (th\u01b0\u1eddng l\xe0 stateless).\\n\\n  Th\u1ee9 t\u1ef1 kh\u1edfi \u0111\u1ed9ng, identify c\u1ee7a nh\u1eefng replica (Pod) l\xe0 ho\xe0n to\xe0n ng\u1eabu nhi\xean.\\n\\n- `StatefulSet`:\\n\\n  N\u1ebfu app c\u1ee7a ch\xfang ta l\xe0 stateful (v\xed d\u1ee5 nh\u01b0 1 set MySQL v\u1edbi 1 master v\xe0 2 slave), khi \u0111\xf3 vi\u1ec7c c\xf3 1 stable identity l\xe0 r\u1ea5t quan tr\u1ecdng. Ngo\xe0i ra v\u1edbi m\u1ed7i replica trong `StatefulSet`, Kubernetes s\u1ebd cung c\u1ea5p cho n\xf3 m\u1ed9t storage ri\xeang.\\n\\n  `StatefulSet` th\xeam prefix `0`, `1`, `2`, ... l\xe0 th\u1ee9 t\u1ef1 kh\u1edfi \u0111\u1ed9ng c\u1ee7a pod v\xe0o t\xean pod.\\n\\n  Khi \u0111\xf3 network identity, c\u0169ng nh\u01b0 storage c\u1ee7a Pod s\u1ebd tr\u1edf n\xean stable. N\u1ebfu mysql-0 c\u1ee7a ta l\xe0 master, n\xf3 s\u1ebd lu\xf4n l\xe0 master, v\xe0 n\xf3 c\u0169ng lu\xf4n request t\u1edbi storage c\u1ee7a master.\\n\\n- `DaemonSet`:\\n\\n  Ta d\xf9ng `DaemonSet` trong tr\u01b0\u1eddng h\u1ee3p mu\u1ed1n t\u1ea5t c\u1ea3 c\xe1c node \u0111\u1ec1u ph\u1ea3i ch\u1ea1y 1 Pod n\xe0o \u0111\xf3.\\n\\n  V\xed d\u1ee5 nh\u01b0 storage cluster nh\u01b0 **glusterd**, hay log agent nh\u01b0 **fluentd**, ...\\n\\n- `Job`:\\n\\n  Khi ta c\u1ea7n ch\u1ea1y one-off Pod. V\xed d\u1ee5 nh\u01b0 vi\u1ec7c import master data.\\n\\n- `CronJob`:\\n\\n  Nh\u01b0 t\xean g\u1ecdi c\u1ee7a n\xf3, c\u1ee9 \u0111\u1ecbnh k\xec n\xf3 s\u1ebd t\u1ea1o Pod \u0111\u1ec3 th\u1ef1c hi\u1ec7n job.\\n\\n### 3.2 Networking\\n\\n#### 3.2.1 Service\\n\\nTr\xean m\xf4i tr\u01b0\u1eddng production, r\u1ea5t hi\u1ebfm khi ta th\u1ea5y 1 service ch\u1ec9 ch\u1ea1y tr\xean 1 server. Thay v\xec th\u1ebf, th\u01b0\u1eddng s\u1ebd c\xf3 2 ho\u1eb7c nhi\u1ec1u h\u01a1n server c\xf9ng ch\u1ea1y, khi server n\xe0y ch\u1ebft, ta c\xf3 th\u1ec3 forward request t\u1edbi nh\u1eefng server heo-th\xec (healthy) c\xf2n l\u1ea1i (trong tr\u01b0\u1eddng h\u1ee3p c\xf3 set load balancer v\xe0 healthcheck), kh\xf4ng l\xe0m cho service c\u1ee7a ta ng\u1ecfm lu\xf4n.\\n\\nTuy nhi\xean IP c\u1ee7a Pod trong cluster lu\xf4n thay \u0111\u1ed5i, v\u1eady th\xec ta bi\u1ebft ph\u1ea3i setup cho load balancer nh\u01b0 th\u1ebf n\xe0o? V\xe0 \u0111\xe2y ch\xednh l\xe0 \u0111\u1ea5t di\u1ec5n c\u1ee7a `Service`.\\n\\n`Service` l\xe0 m\u1ed9t t\u1eadp h\u1ee3p c\xe1c Pod, th\u01b0\u1eddng s\u1ebd d\xf9ng `label` \u0111\u1ec3 group c\xe1c Pod.\\n\\nTh\xf4ng th\u01b0\u1eddng, m\u1ed7i `Service` s\u1ebd \u0111\u01b0\u1ee3c g\xe1n cho 1 cluster IP, Kubernetes s\u1ebd cung c\u1ea5p DNS name, v\xe0 \u0111\u1ed3ng th\u1eddi c\u0169ng load-balance cho c\xe1c Pod c\u1ee7a `Service`.\\n\\n![](https://images.viblo.asia/2a7f4968-7280-47eb-a225-60ab2f06ab6e.png)\\n\\nTa c\u0169ng c\xf3 th\u1ec3 s\u1eed d\u1ee5ng `Service` cho external endpoint.\\n\\nV\xed d\u1ee5 khi h\u1ec7 th\u1ed1ng c\u1ea7n call \u0111\u1ebfn _https://google.com.vn_. Tuy nhi\xean ta l\u1ea1i kh\xf4ng mu\u1ed1n call tr\u1ef1c ti\u1ebfp, hay hardcode trong code, m\xe0 mu\u1ed1n endpoint n\xe0y c\u0169ng tr\u1edf th\xe0nh 1 ph\u1ea7n c\u1ee7a cluster, \u0111\u1ec3 d\u1ec5 qu\u1ea3n l\xfd. Khi \u0111\xf3 ta c\xf3 th\u1ec3 thay \u0111\u1ed5i endpoint n\xe0y m\xe0 kh\xf4ng ph\u1ea3i \u0111\u1ee5ng \u0111\u1ebfn code, hay bi\u1ebfn ENV g\xec \u0111\xf3. Khi \u0111\xf3, ta s\u1ebd define 1 `Service`, v\xe0 set `Endpoint` th\u1ee7 c\xf4ng cho service n\xe0y, thay v\xec s\u1eed d\u1ee5ng `label`.\\n\\nNgo\xe0i ra c\xf2n c\xf3 `Headless Service`, lo\u1ea1i service n\xe0y s\u1ebd kh\xf4ng \u0111\u01b0\u1ee3c g\xe1n cluster IP. Ta s\u1ebd s\u1eed d\u1ee5ng khi ta mu\u1ed1n s\u1eed d\u1ee5ng c\xe1ch load balance ri\xeang, kh\xf4ng ph\u1ee5 thu\u1ed9c Kubernetes.\\n\\n#### 3.2.2 Load balancer\\n\\nKhi t\u1ea1o Service, n\u1ebfu \u0111\xe2y l\xe0 service cho ph\xe9p traffic t\u1eeb b\xean ngo\xe0i Internet, ta ho\xe0n to\xe0n c\xf3 th\u1ec3 s\u1eed d\u1ee5ng Load Balancer c\u1ee7a c\xe1c nh\xe0 cung c\u1ea5p d\u1ecbch v\u1ee5 cloud (th\u01b0\u1eddng l\xe0 L3 Load Balancer).\\n\\nKhi call t\u1edbi Load Balancer n\xf3i tr\xean, n\xf3 s\u1ebd tr\u1ef1c ti\u1ebfp forward traffic t\u1edbi service trong cluster, thu\u1eadt to\xe1n load-balance s\u1ebd do Load Balancer n\xe0y quy\u1ebft \u0111\u1ecbnh.\\n\\n![](https://images.viblo.asia/fdf97441-6cc1-4b42-ac48-342541d0421e.png)\\n\\n#### 3.2.3 Ingress\\n\\n`Ingress` ho\u1ea1t \u0111\u1ed9ng gi\u1ed1ng 1 Reverse Proxy hay Layer 7 Load Balancer. N\xf3 c\u0169ng c\xf3 n\xe9t t\u01b0\u01a1ng \u0111\u1ed3ng v\u1edbi API Gateway.\\n\\n`Ingress` c\xf3 th\u1ec3 \u0111i\u1ec1u h\u01b0\u1edbng c\u1ea3 internal traffic l\u1eabn external traffic d\u1ef1a v\xe0o URL, \u0111\u1ed3ng th\u1eddi cung c\u1ea5p th\xeam c\u1ea3 load balancing gi\u1eefa nh\u1eefng pod c\u1ee7a service. M\u1ed9t \u0111i\u1ec3m \u0111\xe1ng l\u01b0u \xfd l\xe0 `Ingress` s\u1ebd load balance tr\u1ef1c ti\u1ebfp c\xe1c backend Pod m\xe0 kh\xf4ng th\xf4ng qua service, do \u0111\xf3, ta c\xf3 th\u1ec3 t\xf9y ch\u1ec9nh \u0111\u01b0\u1ee3c thu\u1eadt to\xe1n, ... li\xean quan t\u1edbi LB cho to\xe0n b\u1ed9 `Ingress` c\u1ee7a cluster.\\n\\nNgo\xe0i ra, ng\u01b0\u1eddi ta c\u0169ng d\xf9ng `Ingress` \u0111\u1ec3 terminate TLS session.\\n\\n![](https://images.viblo.asia/5809feda-e282-4d5f-9cfb-11077d952add.jpg)\\n\\nKubernetes sau khi init m\u1eb7c \u0111\u1ecbnh s\u1ebd kh\xf4ng c\xf3 ingress controller. N\u1ebfu ta ch\u1ec9 t\u1ea1o `Ingress` th\xec s\u1ebd kh\xf4ng c\xf3 \xfd ngh\u0129a g\xec. \u0110\u1ec3 s\u1eed d\u1ee5ng `Ingress` ta s\u1ebd ph\u1ea3i setup th\u1ee7 c\xf4ng Ingress Controller. Tuy nhi\xean vi\u1ec7c n\xe0y kh\xe1 \u0111\u01a1n gi\u1ea3n, do nhi\u1ec1u h\xe3ng \u0111\xe3 build s\u1eb5n m\u1ecdi th\u1ee9, ta ch\u1ec9 c\u1ea7n l\u1ea5y file manifest c\u1ee7a h\u1ecd v\u1ec1 r\u1ed3i ch\u1ea1y l\xe0 \u0111\u01b0\u1ee3c.\\n\\n- nginx: [NGINX Ingress Controller](https://kubernetes.github.io/ingress-nginx/)\\n- traefik: [Kubernetes Ingress](https://docs.traefik.io/providers/kubernetes-ingress/)\\n- ...\\n\\n#### 3.2.4 Practice\\n\\n![](https://images.viblo.asia/5001a20e-979c-473f-b2da-92c8668f621e.png)\\n\\n- Traffic t\u1eeb ph\xeda client s\u1ebd \u0111\u01b0\u1ee3c t\u1eadp trung t\u1ea1i Layer 4 Load Balancer.\\n- L4 LB s\u1ebd ph\xe2n b\u1ed1 traffic t\u1edbi c\xe1c Node trong cluster (th\u01b0\u1eddng qua `NodePort`).\\n- `Ingress` \u0111\u01b0\u1ee3c map v\u1edbi `NodePort` \u0111\xf3 s\u1ebd terminate SSL, routing, v\xe0 load balance traffic t\u1edbi nh\u1eefng Pod th\xedch h\u1ee3p.\\n  - Traffic t\u1edbi `/web` s\u1ebd \u0111\u01b0\u1ee3c \u0111i\u1ec1u h\u01b0\u1edbng t\u1edbi Frontend Pods\\n  - Traffic t\u1edbi `/api` s\u1ebd \u0111\u01b0\u1ee3c \u0111i\u1ec1u h\u01b0\u1edbng t\u1edbi Backend Pods\\n\\n### 3.3 Storage - Volume\\n\\nM\u1ed9t h\u1ec7 th\u1ed1ng kh\xf3 c\xf3 th\u1ec3 ho\u1ea1t \u0111\u1ed9ng ch\u1ec9 v\u1edbi stateless service.\\n\\nV\u1edbi m\u1ed9t s\u1ed1 service nh\u01b0 database, hay nh\u01b0 t\xednh n\u0103ng upload file, ... N\u1ebfu ch\xfang ta kh\xf4ng s\u1eed d\u1ee5ng external service, th\xec service c\u1ee7a ta s\u1ebd tr\u1edf th\xe0nh stateful service. N\xf3 \u0111\xf2i h\u1ecfi d\u1eef li\u1ec7u trong qu\xe1 tr\xecnh x\u1eed l\xfd ph\u1ea3i \u0111\u01b0\u1ee3c l\u01b0u l\u1ea1i ngay c\u1ea3 khi b\u1ecb crash. Ngo\xe0i ra c\xf3 nh\u1eefng l\xfac ta s\u1ebd c\u1ea7n share d\u1eef li\u1ec7u gi\u1eefa nh\u1eefng container trong c\xf9ng 1 Pod. Nh\u1eefng l\xfac nh\u01b0 v\u1eady, ta s\u1ebd c\u1ea7n \u0111\u1ebfn **Volume**.\\n\\nKhi define Pod, ta s\u1ebd ch\u1ec9 r\xf5 Pod n\xe0y c\u1ea7n nh\u1eefng volume n\xe0o, sau \u0111\xf3 map nh\u1eefng volume \u0111\xf3 cho container.\\n\\n##### PersistentVolume\\n\\nKubernetes s\u1eed d\u1ee5ng `PersistentVolume` \u0111\u1ec3 t\u1ea1o n\xean 1 l\u1edbp abstract v\u1edbi nh\u1eefng h\u1ec7 th\u1ed1ng storage th\u1eadt ph\xeda sau. `PV` c\u0169ng c\xf3 life-cycle gi\u1ed1ng nh\u01b0 Pod.\\n\\nKhi ta s\u1eed d\u1ee5ng volume, ta s\u1ebd kh\xf4ng c\u1ea7n quan t\xe2m h\u1ec7 th\u1ed1ng \u0111\u1eb1ng sau ngang d\u1ecdc ra sao, th\u1ee9 duy nh\u1ea5t ta c\u1ea7n quan t\xe2m l\xe0 API c\u1ee7a `PersistentVolume`.\\n\\nTrong Kubernetes, `PV` c\xf3 th\u1ec3 \u0111\u01b0\u1ee3c t\u1ea1o b\u1eb1ng 2 c\xe1ch:\\n\\n- Dynamic Provisioning\\n- Static Provisioning\\n\\n##### Static Provisioning\\n\\nAdmin cluster s\u1ebd t\u1ea1o ra 1 s\u1ed1 `PV` tr\u01b0\u1edbc, sau \u0111\xf3 cung c\u1ea5p cho b\xean Dev/Ops. Nh\u1eefng `PV` n\xe0y \u0111\xe3 \u0111\u01b0\u1ee3c tr\u1ecf t\u1edbi h\u1ec7 th\u1ed1ng storage th\u1eadt \u0111ang ho\u1ea1t \u0111\u1ed9ng \u0111\u1eb1ng sau.\\n\\nC\xf3 th\u1ec3 xem danh s\xe1ch driver m\xe0 Kubernetes h\u1ed7 tr\u1ee3 t\u1ea1i [\u0111\xe2y](https://kubernetes.io/docs/concepts/storage/volumes/#types-of-volumes).\\n\\nV\xed d\u1ee5: Ta c\xf3 1 cluster Glusterfs v\u1edbi 3 node, t\u1ed5ng dung l\u01b0\u1ee3ng l\xe0 3TB. Khi c\u1ea7n 10GB cho vi\u1ec7c l\u01b0u tr\u1eef share resource, ta s\u1ebd t\u1ea1o `PersistentVolume` v\u1edbi dung l\u01b0\u1ee3ng 10GB, tr\u1ecf t\u1edbi cluster n\xf3i tr\xean. Sau \u0111\xf3 ta s\u1ebd s\u1eed d\u1ee5ng volume tr\xean t\u01b0\u01a1ng t\u1ef1 nh\u01b0 c\xe1c volume kh\xe1c trong h\u1ec7 th\u1ed1ng.\\n\\n##### Dynamic Provisioning\\n\\n`PV` s\u1ebd \u0111\u01b0\u1ee3c t\u1ea1o 1 c\xe1ch \u0111\u1ed9ng. T\u1ee9c l\xe0 khi n\xe0o Pod c\u1ee7a ta c\u1ea7n volume, th\xec `PV` s\u1ebd \u0111\u01b0\u1ee3c t\u1ea1o 1 c\xe1ch t\u1ef1 \u0111\u1ed9ng, nh\u1edd v\xe0o `StorageClass` (s\u1ebd \u0111\u1ec1 c\u1eadp sau).\\n\\nC\xe1ch l\xe0m n\xe0y \u0111\xf2i h\u1ecfi h\u1ec7 th\u1ed1ng storage c\u1ee7a ta c\u0169ng ph\u1ea3i support dynamic provisioning.\\n\\n##### PersistentVolumeClaim\\n\\n\u0110\u1ec3 c\xf3 th\u1ec3 s\u1eed d\u1ee5ng \u0111\u01b0\u1ee3c `PV`, ta c\u1ea7n t\u1ea1o th\xeam `PersistentVolumeClaim` (PVC).\\n\\nTa c\xf3 th\u1ec3 s\u1eed d\u1ee5ng Claim tr\xean cho config, hay volume, ... c\u1ee7a Pod.\\n\\n# 4. High Availability Setup\\n\\n![](https://images.viblo.asia/48635fac-b09b-4174-b279-4f8d0fa29fb6.png)\\n\\n# 5. Reference\\n\\nkubernetes.io - [Kubernetes Official Documentation](https://documentationo/docs/home/)\\n\\nyoutube.com - [June 2018 Online Meetup: Kubernetes Networking Master Class](https://www.youtube.com/watch?v=GXq3FS8M_kw)\\n\\nx-team.com - [INTRODUCTION TO KUBERNETES ARCHITECTURE](https://x-team.com/blog/introduction-kubernetes-architecture/)\\n\\novh.com - [Getting external traffic into Kubernetes \u2013 ClusterIp, NodePort, LoadBalancer, and Ingress](https://www.ovh.com/blog/getting-external-traffic-into-kubernetes-clusterip-nodeport-loadbalancer-and-ingress/)\\n\\nmedium.com - [Kubernetes Master Components: Etcd, API Server, Controller Manager, and Scheduler](https://medium.com/jorgeacetozi/kubernetes-master-components-etcd-api-server-controller-manager-and-scheduler-3a0179fc8186)\\n\\nmedium.com - [Kubernetes NodePort vs LoadBalancer vs Ingress? When should I use what?](https://medium.com/google-cloud/kubernetes-nodeport-vs-loadbalancer-vs-ingress-when-should-i-use-what-922f010849e0)"},{"id":"toi-uu-menh-de-where-mysql","metadata":{"permalink":"/blog/toi-uu-menh-de-where-mysql","editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/blog/2019-11-14-optimize-mysql-where-statement.md","source":"@site/blog/2019-11-14-optimize-mysql-where-statement.md","title":"T\u1ed1i \u01b0u m\u1ec7nh \u0111\u1ec1 WHERE (MySQL)","description":"C\xf3 2 h\u01b0\u1edbng t\u1ed1i \u01b0u Database ch\xednh:","date":"2019-11-14T00:00:00.000Z","formattedDate":"November 14, 2019","tags":[{"label":"mysql","permalink":"/blog/tags/mysql"},{"label":"database","permalink":"/blog/tags/database"},{"label":"optimization","permalink":"/blog/tags/optimization"}],"readingTime":8.075,"hasTruncateMarker":false,"authors":[{"name":"L\xea S\u0129 B\xedch","title":"Ruby on Rails/React Developer","url":"https://github.com/moonlight8978","imageURL":"https://avatars.githubusercontent.com/u/26299310?v=4"}],"frontMatter":{"slug":"toi-uu-menh-de-where-mysql","title":"T\u1ed1i \u01b0u m\u1ec7nh \u0111\u1ec1 WHERE (MySQL)","author":"L\xea S\u0129 B\xedch","author_title":"Ruby on Rails/React Developer","author_url":"https://github.com/moonlight8978","author_image_url":"https://avatars.githubusercontent.com/u/26299310?v=4","tags":["mysql","database","optimization"]},"unlisted":false,"prevItem":{"title":"Gi\u1edbi thi\u1ec7u v\u1ec1 Kubernetes","permalink":"/blog/gioi-thieu-ve-kubernetes"},"nextItem":{"title":"C\xf9ng t\xecm hi\u1ec3u v\u1ec1 ActionText trong Rails 6","permalink":"/blog/cung-tim-hieu-ve-actiontext-trong-rails-6"}},"content":"C\xf3 2 h\u01b0\u1edbng t\u1ed1i \u01b0u Database ch\xednh:\\r\\n\\r\\n### 1. T\u1ed1i \u01b0u t\u1ea7ng DB\\r\\n\\r\\n##### C\u1ea5u tr\xfac DB:\\r\\n\\r\\n- \u0110\u1ecdc nhi\u1ec1u => \xedt table, nhi\u1ec1u column\\r\\n- Ghi nhi\u1ec1u => nhi\u1ec1u table, \xedt column\\r\\n\\r\\n##### Index \u0111\xe3 \u1ed5n ch\u01b0a?\\r\\n\\r\\n##### Engine cho table\\r\\n\\r\\n- MyISAM: Table-locking, ph\xf9 h\u1ee3p v\u1edbi table \u0111\u1ecdc nhi\u1ec1u, ghi \xedt\\r\\n- InnoDB: Row-locking, \u0111\xe1p \u1ee9ng \u0111\u01b0\u1ee3c vi\u1ec7c ghi nhi\u1ec1u.\\r\\n\\r\\n##### Caching\\r\\n\\r\\n### 2. T\u1ed1i \u01b0u ph\u1ea7n c\u1ee9ng\\r\\n\\r\\n##### Disk seek:\\r\\n\\r\\n- Th\u1eddi gian HDD quay khi t\xecm d\u1eef li\u1ec7u, SDD kh\xf4ng c\u1ea7n quay \u0111\u1ec3 t\xecm d\u1eef li\u1ec7u.\\r\\n- Ph\xe2n t\xe1n d\u1eef li\u1ec7u \u0111\u1ec3 t\xecm tr\xean nhi\u1ec1u \u1ed5 \u0111\u0129a c\xf9ng l\xfac.\\r\\n\\r\\n##### Disk R/W:\\r\\n\\r\\n- Khi t\xecm \u0111\u01b0\u1ee3c d\u1eef li\u1ec7u th\xec s\u1ebd c\u1ea7n \u0111\u1ecdc d\u1eef li\u1ec7u v\xe0o RAM.\\r\\n- Ph\xe2n t\xe1n \u0111\u1ec3 \u0111\u1ecdc/ghi nhi\u1ec1u tr\xean nhi\u1ec1u \u1ed5 \u0111\u0129a c\xf9ng l\xfac.\\r\\n\\r\\n##### CPU cycle\\r\\n\\r\\n- Khi \u0111\xe3 load \u0111\u01b0\u1ee3c v\xe0o RAM r\u1ed3i, th\xec s\u1ebd t\u1edbi CPU x\u1eed l\xfd nh\u1eefng d\u1eef li\u1ec7u \u0111\xf3.\\r\\n\\r\\n##### Memory bandwidth:\\r\\n\\r\\n- Khi CPU c\u1ea7n nhi\u1ec1u d\u1eef li\u1ec7u, nh\u01b0ng cache l\u1ea1i kh\xf4ng \u0111\u1ee7, s\u1ebd c\u1ea7n \u0111\u1ebfn memory bandwith.\\r\\n\\r\\n# 2. T\u1ed1i \u01b0u c\xe2u l\u1ec7nh WHERE\\r\\n\\r\\n##### Ngo\xe0i SELECT th\xec c\xf2n \xe1p d\u1ee5ng \u0111\u01b0\u1ee3c cho c\u1ea3 UPDATE, DELETE, v.v.\\r\\n\\r\\n##### MySQL s\u1ebd t\u1ef1 \u0111\u1ed9ng t\u1ed1i \u01b0u nh\u1eefng tr\u01b0\u1eddng h\u1ee3p sau:\\r\\n\\r\\n- Lo\u1ea1i b\u1ecf nh\u1eefng d\u1ea5u ngo\u1eb7c th\u1eeba\\r\\n\\r\\n  ```sql\\r\\n  ((a AND b) AND c OR (((a AND b) AND (c AND d))))\\r\\n  => (a AND b AND c) OR (a AND b AND c AND d)\\r\\n  ```\\r\\n\\r\\n- Thay th\u1ebf bi\u1ebfn b\u1edfi h\u1eb1ng s\u1ed1\\r\\n\\r\\n  ```sql\\r\\n  (a<b AND b=c) AND a=5\\r\\n  => b>5 AND b=c AND a=5\\r\\n  ```\\r\\n\\r\\n- Lo\u1ea1i b\u1ecf nh\u1eefng \u0111i\u1ec1u ki\u1ec7n h\u1eb1ng\\r\\n\\r\\n  ```sql\\r\\n  (b>=5 AND b=5) OR (b=6 AND 5=5) OR (b=7 AND 5=6)\\r\\n  => b=5 OR b=6\\r\\n  ```\\r\\n\\r\\n- Bi\u1ec3u th\u1ee9c h\u1eb1ng (constant expression) s\u1ebd ch\u1ec9 \u0111\u01b0\u1ee3c t\xednh to\xe1n 1 l\u1ea7n duy nh\u1ea5t.\\r\\n\\r\\n  ```sql\\r\\n  SELECT *\\r\\n  FROM t\\r\\n  WHERE id = POW(1,2);\\r\\n\\r\\n  SELECT *\\r\\n  FROM t\\r\\n  WHERE id = FLOOR(1 + RAND() * 49);\\r\\n  ```\\r\\n\\r\\n- `HAVING` s\u1ebd \u0111\u01b0\u1ee3c g\u1ed9p v\u1edbi `WHERE` khi kh\xf4ng s\u1eed d\u1ee5ng `GROUP BY` hay nh\u1eefng function nh\u01b0 `COUNT()`, `MIN()`, `MAX()`, ...\\r\\n\\r\\n- \u0110\u1ed1i v\u1edbi **MyISAM** hay **MEMORY** table, k\u1ebft qu\u1ea3 c\u1ee7a `COUNT(*)` (kh\xf4ng c\xf3 \u0111i\u1ec1u ki\u1ec7n `WHERE` s\u1ebd \u0111\u01b0\u1ee3c l\u1ea5y tr\u1ef1c ti\u1ebfp t\u1eeb **information_schema**.\\r\\n\\r\\n=> Ta c\xf3 th\u1ec3 ng\u1eebng vi\u1ec7c t\u1ed1i \u01b0u l\u1ea1i, v\xe0 vi\u1ebft nh\u1eefng c\xe2u l\u1ec7nh SQL d\u1ec5 hi\u1ec3u, d\u1ec5 b\u1ea3o tr\xec.\\r\\n\\r\\n# 3. Range optimization\\r\\n\\r\\n- `range` l\xe0 m\u1ed9t **access method**\\r\\n- `range` s\u1eed d\u1ee5ng index \u0111\u1ec3 l\u1ea5y ra nh\u1eefng subset c\u1ee7a k\u1ebft qu\u1ea3 cu\u1ed1i c\xf9ng.\\r\\n- `range` support c\u1ea3 single-part l\u1eabn multiple-part index.\\r\\n\\r\\n#### Nh\u1eefng tr\u01b0\u1eddng h\u1ee3p sau, MySQL s\u1ebd coi nh\u01b0 l\xe0 `range condition`:\\r\\n\\r\\n- M\u1ec7nh \u0111\u1ec1 `WHERE` \u0111\u1ed1i v\u1edbi nh\u1eefng tr\u01b0\u1eddng \u0111\u01b0\u1ee3c \u0111\xe1nh index (s\u1eed d\u1ee5ng BTree ho\u1eb7c Hash), m\xe0 s\u1eed d\u1ee5ng nh\u1eefng to\xe1n t\u1eed sau: `=`, `<=>`, `IN()`, `IS NULL`, hay `IS NOT NULL`\\r\\n\\r\\n  \u0110\u1ed1i v\u1edbi, BTree, ngo\xe0i nh\u1eefng ph\xe9p to\xe1n tr\xean, c\xf2n support th\xeam `>`, `<`, `<=`, `>=`, `BETWEEN`, `!=`, hay `<>` v\u1edbi **constant value**, ho\u1eb7c `LIKE` c\u0169ng l\xe0 range condition. Ch\xfa \xfd khi s\u1eed d\u1ee5ng `LIKE`, v\u1ebf ph\u1ea3i ph\u1ea3i l\xe0 1 string h\u1eb1ng, v\xe0 kh\xf4ng b\u1eaft \u0111\u1ea7u b\u1edfi wildcard nh\u01b0 `%` hay `_`.\\r\\n\\r\\n  ```sql\\r\\n  SELECT *\\r\\n  FROM t1\\r\\n  WHERE key_col LIKE \'ab%\';\\r\\n  ```\\r\\n\\r\\n- K\u1ebft h\u1ee3p nhi\u1ec1u range condition s\u1eed d\u1ee5ng `AND` ho\u1eb7c `OR`, ta v\u1eabn thu \u0111\u01b0\u1ee3c range condition.\\r\\n\\r\\n#### Constant value\\r\\n\\r\\n##### L\xe0 gi\xe1 tr\u1ecb \u0111\u01b0\u1ee3c t\xednh to\xe1n tr\u01b0\u1edbc th\u1eddi \u0111i\u1ec3m runtime, khi runtime, gi\xe1 tr\u1ecb c\u1ee7a n\xf3 s\u1ebd kh\xf4ng thay \u0111\u1ed5i\\r\\n\\r\\n- H\u1eb1ng s\u1ed1 truy\u1ec1n th\u1eb3ng v\xe0o tham s\u1ed1 c\u1ee7a c\xe2u truy v\u1ea5n\\r\\n- M\u1ed9t c\u1ed9t c\u1ee7a `const` hay `system` table\\r\\n  - `const` table l\xe0 b\u1ea3ng ch\u1ec9 c\xf3 t\u1ed1i \u0111a 1 row (hay 0 ho\u1eb7c 1 row).\\r\\n  - `const` table c\xf3 th\u1ec3 l\xe0 k\u1ebft qu\u1ea3 c\u1ee7a 1 c\xe2u truy v\u1ea5n ch\u1ee9a m\u1ec7nh \u0111\u1ec1 `WHERE` \u0111\u1ed1i v\u1edbi 1 field unique, not null, c\xf3 d\u1ea1ng `column = constant`. Truy v\u1ea5n n\xe0y lu\xf4n tr\u1ea3 v\u1ec1 1 k\u1ebft qu\u1ea3 duy nh\u1ea5t.\\r\\n  - table c\xf3 1 row th\xec g\u1ecdi l\xe0 `system` table\\r\\n\\r\\n#### BTree, Hash index\\r\\n\\r\\n##### BTree:\\r\\n\\r\\n- Self-balancing tree, c\u1ea5u tr\xfac d\u1ea1ng c\xe2y, c\xf3 th\u1ec3 t\u1ef1 c\xe2n b\u1eb1ng nh\u1eb1m gi\u1eef chi\u1ec1u cao c\u1ee7a c\xe2y th\u1ea5p nh\u1ea5t c\xf3 th\u1ec3.\\r\\n- Tr\xe1nh nh\u1ea7m v\u1edbi Binary Tree (c\xe2y nh\u1ecb ph\xe2n)\\r\\n\\r\\n- Th\u1eddi gian t\xecm ki\u1ebfm O(logn)\\r\\n\\r\\n- Ph\xf9 h\u1ee3p v\u1edbi \u0111a d\u1ea1ng c\xe1c ph\xe9p to\xe1n: `=`, `<=>`, `IN()`, `IS NULL`, `IS NOT NULL`, `>`, `<`, `<=`, `>=`, `BETWEEN`, `!=`, `<>`, hay th\u1eadm ch\xed c\u1ea3 `LIKE`\\r\\n\\r\\n![](https://camo.githubusercontent.com/cb15fccfa6fafa1cea762a58c1dd51ad8f32fe2c/68747470733a2f2f63646e2d696d616765732d312e6d656469756d2e636f6d2f6d61782f313630302f312a70453453457a374370727a4664375a77772d617866512e6a706567)\\r\\n\\r\\n##### Hash:\\r\\n\\r\\n- B\u1ea3ng b\u0103m, l\xe0 c\u1ea5u tr\xfac d\u1eef li\u1ec7u l\u01b0u theo key-value\\r\\n\\r\\n- T\xecm ki\u1ebfm theo key r\u1ea5t nhanh - O(1)\\r\\n\\r\\n- Ph\xf9 h\u1ee3p v\u1edbi nh\u1eefng ph\xe9p to\xe1n: `=`, `<=>`, `IN()`, `IS NULL`, hay `IS NOT NULL`.\\r\\n\\r\\n![](https://camo.githubusercontent.com/b1df2be12b1c8779b7cf941d88d1cc8e2178753f/68747470733a2f2f696d616765732e7669626c6f2e617369612f30356236313638372d386230342d346536352d613834642d3361353363343035386437642e6a7067)\\r\\n\\r\\n## 3.1. Single-part index\\r\\n\\r\\n##### Single-part index l\xe0 nh\u1eefng index \u0111\u01b0\u1ee3c \u0111\xe1nh ri\xeang l\u1ebb cho 1 field.\\r\\n\\r\\n```sql\\r\\nCREATE INDEX index_name ON t1 (key_col);\\r\\n```\\r\\n\\r\\nKhi th\u1ef1c hi\u1ec7n truy v\u1ea5n v\u1edbi nh\u1eefng index lo\u1ea1i n\xe0y, v\u1edbi m\u1ed7i possible key (c\xf3 th\u1ec3 s\u1eed d\u1ee5ng `EXPLAIN` \u0111\u1ec3 check), MySQL s\u1ebd ti\u1ebfn h\xe0nh extract range condition. Nh\u1eefng \u0111i\u1ec1u ki\u1ec7n kh\xf4ng th\u1ec3 c\u1ea5u th\xe0nh range condition s\u1ebd b\u1ecb lo\u1ea1i b\u1ecf, nh\u1eefng \u0111i\u1ec1u ki\u1ec7n c\xf3 th\u1ec3 b\u1ecb overlap s\u1ebd \u0111\u01b0\u1ee3c g\u1ed9p v\u1edbi nhau.\\r\\n\\r\\nSau khi extract, MySQL s\u1ebd \xe1p d\u1ee5ng nh\u1eefng \u0111i\u1ec1u ki\u1ec7n \u0111\xf3 \u0111\u1ec3 t\u1eadn d\u1ee5ng \u0111\u01b0\u1ee3c t\u1ed1i \u0111a index c\u1ee7a table, sau \u0111\xf3 k\u1ebft h\u1ee3p th\xeam v\u1edbi nh\u1eefng \u0111i\u1ec1u ki\u1ec7n c\xf2n l\u1ea1i \u0111\u1ec3 l\u1ecdc ti\u1ebfp.\\r\\n\\r\\nMySQL ch\u1ec9 b\u1ecf qua index, n\u1ebfu nh\u01b0 n\xf3 tin r\u1eb1ng vi\u1ec7c duy\u1ec7t full table t\u1ed1i \u01b0u h\u01a1n, ho\u1eb7c d\xf9ng `FORCE INDEX`.\\r\\n\\r\\nVD:\\r\\n\\r\\n```sql\\r\\nSELECT *\\r\\nFROM t1\\r\\nWHERE (\\r\\n\\t(key1 < \'abc\' AND (key1 LIKE \'abcde%\' OR key1 LIKE \'%b\'))\\r\\n\\tOR (key1 < \'bar\' AND nonkey = 4)\\r\\n\\tOR (key1 < \'uux\' AND key1 > \'z\')\\r\\n);\\r\\n\\r\\n=> (key1 < \'abc\' AND (key1 LIKE \'abcde%\' OR TRUE)) OR\\r\\n(key1 < \'bar\' AND TRUE) OR\\r\\n(key1 < \'uux\' AND key1 > \'z\')\\r\\n\\r\\n=> (key1 < \'abc\' AND TRUE) OR (key1 < \'bar\' AND TRUE) OR (FALSE)\\r\\n\\r\\n=> key1 < \'abc\' OR key1 < \'bar\'\\r\\n\\r\\n=> key1 < \'bar\'\\r\\n```\\r\\n\\r\\n## 3.2. Multiple-part index\\r\\n\\r\\n##### Multiple-Part Index l\xe0 nh\u1eefng index \u0111\u01b0\u1ee3c \u0111\xe1nh cho nhi\u1ec1u tr\u01b0\u1eddng c\xf9ng l\xfac\\r\\n\\r\\n```sql\\r\\nCREATE INDEX index_name ON t1 (key_part1, key_part2)\\r\\n```\\r\\n\\r\\nRange condition s\u1ebd s\u1eed d\u1ee5ng **key tuple intervals** \u0111\u1ec3 t\xecm ki\u1ebfm. Key tuple intervals \u0111\u01b0\u1ee3c \u0111\u1ecbnh ngh\u0129a b\u1edfi nh\u1eefng key tuples, c\xf3 th\u1ee9 t\u1ef1.\\r\\n\\r\\n**Tuple** l\xe0 1 c\u1eb7p gi\xe1 tr\u1ecb. VD: (1, 2, 3), (1, \'a\', 3), ...\\r\\n\\r\\nL\u1ea5y v\xed d\u1ee5 v\u1ec1 1 multiple-part index `key1(key_part1, key_part2, key_part3)`, v\xe0 nh\u1eefng tuples \u1ee9ng v\u1edbi key tuple (key_part1, key_part2, key_part3) sau:\\r\\n\\r\\n```plaintext\\r\\nkey_part1  key_part2  key_part3\\r\\n  NULL       1          \'abc\'\\r\\n  NULL       1          \'xyz\'\\r\\n  NULL       2          \'foo\'\\r\\n   1         1          \'abc\'\\r\\n   1         1          \'xyz\'\\r\\n   1         2          \'abc\'\\r\\n   2         1          \'aaa\'\\r\\n```\\r\\n\\r\\n`key_part1 = 1` define interval sau:\\r\\n\\r\\n```plaintext\\r\\n(1,-inf,-inf) <= (key_part1,key_part2,key_part3) < (1,+inf,+inf)\\r\\n```\\r\\n\\r\\nInterval tr\xean s\u1ebd \u0111\u01b0\u1ee3c s\u1eed d\u1ee5ng b\u1edfi `range` access method.\\r\\n\\r\\nB\xean c\u1ea1nh \u0111\xf3, `key_part3 = \'abc\'` kh\xf4ng t\u1ea1o ra interval n\xe0o (gi\xe1 tr\u1ecb li\u1ec1n m\u1ea1ch nhau), v\xec th\u1ebf s\u1ebd kh\xf4ng th\u1ec3 s\u1eed d\u1ee5ng b\u1edfi `range`\\r\\n\\r\\nCh\xfa \xfd khi s\u1eed d\u1ee5ng:\\r\\n\\r\\n- V\u1edbi Hash index, n\u1ebfu index c\xf3 `N` part, th\xec condition c\u1ee7a ta ph\u1ea3i c\xf3 format sau\\r\\n\\r\\n  ```sql\\r\\n      key_part1 cmp const1\\r\\n  AND key_part2 cmp const2\\r\\n  AND ...\\r\\n  AND key_partN cmp constN;\\r\\n  ```\\r\\n\\r\\n  `cmp` l\xe0 m\u1ed9t trong nh\u1eefng to\xe1n t\u1eed `=`, `<=>`, ho\u1eb7c `IS NULL`\\r\\n\\r\\n- V\u1edbi BTree index, 1 interval c\xf3 th\u1ec3 s\u1eed d\u1ee5ng cho nh\u1eefng \u0111i\u1ec1u ki\u1ec7n k\u1ebft h\u1ee3p b\u1edfi `AND`, trong \u0111\xf3 m\u1ed7i \u0111i\u1ec1u ki\u1ec7n so s\xe1nh 1 key part v\u1edbi 1 h\u1eb1ng s\u1ed1, s\u1eed d\u1ee5ng `=`, `<=>`, `IS NULL`, `>`, `<`, `>=`, `<=`, `!=`, `<>`.\\r\\n\\r\\n  Optimizer trong khi t\xednh to\xe1n interval, s\u1ebd s\u1eed d\u1ee5ng th\xeam key part n\u1ebfu to\xe1n t\u1eed l\xe0 `=`, `<=>` hay `IS NULL`. C\xf2n n\u1ebfu l\xe0 `>`, `<`, `>=`, `<=`, `!=`, `<>`, `BETWEEN` hay `LIKE` th\xec s\u1ebd kh\xf4ng l\u1ea5y th\xeam key part n\u1eefa.\\r\\n\\r\\n  VD1:\\r\\n\\r\\n  ```sql\\r\\n  key_part1 = \'foo\' AND key_part2 >= 10 AND key_part3 > 10\\r\\n  ```\\r\\n\\r\\n  s\u1ebd s\u1eed d\u1ee5ng interval:\\r\\n\\r\\n  ```sql\\r\\n  (\'foo\',10,-inf) < (key_part1,key_part2,key_part3) < (\'foo\',+inf,+inf)\\r\\n  ```\\r\\n\\r\\n  VD2:\\r\\n\\r\\n  ```sql\\r\\n  (key_part1 = 1 AND key_part2 < 2) OR (key_part1 > 5)\\r\\n  ```\\r\\n\\r\\n  s\u1ebd s\u1eed d\u1ee5ng 2 interval:\\r\\n\\r\\n  ```sql\\r\\n  (1,-inf) < (key_part1,key_part2) < (1,2)\\r\\n  (5,-inf) < (key_part1,key_part2)\\r\\n  ```\\r\\n\\r\\n  Trong v\xed d\u1ee5 n\xe0y, interval th\u1ee9 nh\u1ea5t s\u1eed d\u1ee5ng 1 key part \u1edf v\u1ebf tr\xe1i, v\u1ebf ph\u1ea3i s\u1eed d\u1ee5ng 2 key part.\\r\\n\\r\\n  Interval th\u1ee9 2 ch\u1ec9 s\u1eed d\u1ee5ng 1 key part.\\r\\n\\r\\n  Gi\xe1 tr\u1ecb `key_len` khi th\u1ef1c hi\u1ec7n `EXPLAIN` s\u1ebd tr\u1ea3 v\u1ec1 \u0111\u1ed9 d\xe0i t\u1ed1i \u0111a c\u1ee7a key prefix \u0111\u01b0\u1ee3c s\u1eed d\u1ee5ng.\\r\\n\\r\\n### Index Dive\\r\\n\\r\\nIndex dive \u0111\u01b0\u1ee3c th\u1ef1c hi\u1ec7n trong khi optimizing \u0111\u1ec3 t\xednh to\xe1n estimate (s\u1ed1 row th\u1ecfa m\xe3n 1 condition), \u0111\u1ec3 quy\u1ebft \u0111\u1ecbnh xem c\xf3 n\xean d\xf9ng index hay kh\xf4ng. C\xf3 th\u1ec3 skip b\u1eb1ng c\xe1ch d\xf9ng `FORCE INDEX`\\r\\n\\r\\nN\u1ebfu \u0111i\u1ec1u ki\u1ec7n ph\u1ee9c t\u1ea1p th\xec index dive s\u1ebd m\u1ea5t nhi\u1ec1u th\u1eddi gian.\\r\\n\\r\\nNgo\xe0i index dive, MySQL c\u0169ng c\xf3 th\u1ec3 s\u1eed d\u1ee5ng index statistics \u0111\u1ec3 estimate, tuy nhi\xean \u0111\u1ed9 ch\xednh x\xe1c th\u1ea5p h\u01a1n, c\xf3 th\u1ec3 d\xf9ng `ANALYZE TABLE` \u0111\u1ec3 update l\u1ea1i index statistics, t\u0103ng c\u01b0\u1eddng \u0111\u1ed9 ch\xednh x\xe1c.\\r\\n\\r\\nIndex dive b\u1ecb skip trong tr\u01b0\u1eddng h\u1ee3p th\u1ecfa m\xe3n t\u1ea5t c\u1ea3 \u0111i\u1ec1u ki\u1ec7n sau (ch\u1ec9 \xe1p d\u1ee5ng cho single table query):\\r\\n\\r\\n- `FORCE INDEX`\\r\\n- Nonunique index, v\xe0 kh\xf4ng ph\u1ea3i `FULLTEXT` index.\\r\\n- Kh\xf4ng c\xf3 subquery\\r\\n- Kh\xf4ng c\xf3 `DISTINCT`, `GROUP BY`, ho\u1eb7c `ORDER BY`.\\r\\n\\r\\n##### Equality Range Optimization of Many-Valued Comparisons\\r\\n\\r\\n```sql\\r\\ncol_name IN(val1, ..., valN)\\r\\ncol_name = val1 OR ... OR col_name = valN\\r\\n```\\r\\n\\r\\nNh\u1eefng bi\u1ec3u th\u1ee9c nh\u01b0 tr\xean, v\u1edbi `col_name` \u0111\u01b0\u1ee3c \u0111\xe1nh index, v\xe0 so s\xe1nh v\u1edbi nhi\u1ec1u gi\xe1 tr\u1ecb, \u0111\u01b0\u1ee3c g\u1ecdi l\xe0 range comparisions (m\u1ed7i range l\xe0 1 gi\xe1 tr\u1ecb). Optimizer s\u1ebd estimate cost c\u1ee7a m\u1ed7i range nh\u01b0 sau:\\r\\n\\r\\n- N\u1ebfu index l\xe0 unique, cost = 1\\r\\n- N\u1ebfu kh\xf4ng unique, s\u1ebd c\u1ea7n s\u1eed d\u1ee5ng index dive ho\u1eb7c index statistics \u0111\u1ec3 estimate.\\r\\n\\r\\n\u1ee8ng v\u1edbi m\u1ed7i range l\xe0 2 l\u1ea7n dive (1 cho \u0111i\u1ec3m b\u1eaft \u0111\u1ea7u, 1 cho \u0111i\u1ec3m k\u1ebft th\xfac) c\u1ee7a range (interval)."},{"id":"cung-tim-hieu-ve-actiontext-trong-rails-6","metadata":{"permalink":"/blog/cung-tim-hieu-ve-actiontext-trong-rails-6","editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/blog/2019-07-20-rails-action-text.md","source":"@site/blog/2019-07-20-rails-action-text.md","title":"C\xf9ng t\xecm hi\u1ec3u v\u1ec1 ActionText trong Rails 6","description":"Rails 6 \u0111\xe3 b\u01b0\u1edbc v\xe0o giai \u0111o\u1ea1n beta v\u1edbi phi\xean b\u1ea3n v6.0.0.rc1. RC l\xe0 vi\u1ebft t\u1eaft c\u1ee7a Release Candidate, \u0111\xe2y l\xe0 phi\xean b\u1ea3n m\xe0 c\xf3 x\xe1c su\u1ea5t tr\u1edf th\xe0nh final release r\u1ea5t cao. Ta c\xf3 th\u1ec3 \xe1p d\u1ee5ng n\xf3 v\xe0o d\u1ef1 \xe1n ngay k\u1ec3 t\u1eeb b\xe2y gi\u1edd m\xe0 kh\xf4ng c\u1ea7n lo s\u1ee3 c\xf3 nh\u1eefng breaking change.","date":"2019-07-20T00:00:00.000Z","formattedDate":"July 20, 2019","tags":[{"label":"action-text","permalink":"/blog/tags/action-text"},{"label":"ruby-on-rails","permalink":"/blog/tags/ruby-on-rails"},{"label":"web","permalink":"/blog/tags/web"}],"readingTime":10.375,"hasTruncateMarker":false,"authors":[{"name":"L\xea S\u0129 B\xedch","title":"Ruby on Rails/React Developer","url":"https://github.com/moonlight8978","imageURL":"https://avatars.githubusercontent.com/u/26299310?v=4"}],"frontMatter":{"slug":"cung-tim-hieu-ve-actiontext-trong-rails-6","title":"C\xf9ng t\xecm hi\u1ec3u v\u1ec1 ActionText trong Rails 6","author":"L\xea S\u0129 B\xedch","author_title":"Ruby on Rails/React Developer","author_url":"https://github.com/moonlight8978","author_image_url":"https://avatars.githubusercontent.com/u/26299310?v=4","tags":["action-text","ruby-on-rails","web"]},"unlisted":false,"prevItem":{"title":"T\u1ed1i \u01b0u m\u1ec7nh \u0111\u1ec1 WHERE (MySQL)","permalink":"/blog/toi-uu-menh-de-where-mysql"},"nextItem":{"title":"C\xf9ng t\xecm hi\u1ec3u v\u1ec1 Railway Oriented Programming","permalink":"/blog/cung-tim-hieu-ve-railway-oriented-programming"}},"content":"Rails 6 \u0111\xe3 b\u01b0\u1edbc v\xe0o giai \u0111o\u1ea1n beta v\u1edbi phi\xean b\u1ea3n [v6.0.0.rc1](https://github.com/rails/rails/releases/tag/v6.0.0.rc1). RC l\xe0 vi\u1ebft t\u1eaft c\u1ee7a **R**elease **C**andidate, \u0111\xe2y l\xe0 phi\xean b\u1ea3n m\xe0 c\xf3 x\xe1c su\u1ea5t tr\u1edf th\xe0nh final release r\u1ea5t cao. Ta c\xf3 th\u1ec3 \xe1p d\u1ee5ng n\xf3 v\xe0o d\u1ef1 \xe1n ngay k\u1ec3 t\u1eeb b\xe2y gi\u1edd m\xe0 kh\xf4ng c\u1ea7n lo s\u1ee3 c\xf3 nh\u1eefng breaking change.\\n\\nN\u1ebfu b\u1ea1n s\u1eed d\u1ee5ng Docker, m\xecnh khuy\xean n\xean s\u1eed d\u1ee5ng ruby 2.6.3, v\xec tr\u01b0\u1edbc \u0111\xe2y m\xecnh \u0111\xe3 d\xf9ng th\u1eed ruby:2.7.0-preview1-alpine3.10 th\xec kh\xe1 nhi\u1ec1u l\u1ed7i khi up server, m\xe0 ch\u1ea3 bi\u1ebft ph\u1ea3i fix sao :sad:\\n\\n\u1ede Rails 6, c\xf3 kh\xe1 nhi\u1ec1u t\xednh n\u0103ng m\u1edbi hay ho:\\n\\n- Action Text\\n- Parallel Testing\\n- Action Model custom error message format.\\n- v\xe2n v\xe2n m\xe2y m\xe2y...\\n\\n\u1ede b\xe0i n\xe0y, m\xecnh s\u1ebd ch\u1ec9 t\u1eadp trung \u0111\u1ec1 c\u1eadp t\u1edbi Action Text. \u0110\xe2y l\xe0 m\u1ed9t package gi\xfap ta x\xe2y d\u1ef1ng WYSIWYG editor m\u1ed9t c\xe1ch nhanh ch\xf3ng, h\u01a1n n\u1eefa, vi\u1ec7c upload c\u0169ng \u0111\u01b0\u1ee3c integrate v\u1edbi Active Storage.\\n\\n**Ch\xfa \xfd:** B\xe0i kh\xe1 d\xe0i v\xe0 embed nhi\u1ec1u code :v\\n\\n# C\xe1ch d\xf9ng\\n\\n## C\xe0i \u0111\u1eb7t v\xe0 s\u1eed d\u1ee5ng\\n\\nV\xec l\xe0 Rails n\xean c\xe1ch s\u1eed d\u1ee5ng r\u1ea5t \u0111\u01a1n gi\u1ea3n, nh\u01b0ng ta s\u1ebd ch\u1ea3 bi\u1ebft n\xf3 ch\u1ea1y c\xe1i g\xec \u0111\u1eb1ng sau c\u1ea3 =))\\n\\nC\xe0i \u0111\u1eb7t Action Text b\u1eb1ng CLI command sau:\\n\\n```bash\\nrails action_text:install\\n```\\n\\nNh\u1edb h\xe3y ch\u1ea1y th\xeam c\u1ea3 command install Active Storage n\u1eefa.\\n\\n```bash\\nrails active_storage:install\\n```\\n\\n\u0110\u1ec3 \xe1p d\u1ee5ng cho field `content` c\u1ee7a model `Post`, ta s\u1ebd d\xf9ng t\u1edbi macro `has_rich_text`\\n\\n```ruby\\nclass CreatePosts < ActiveRecord::Migration[6.0]\\n  def change\\n    create_table :posts do |t|\\n      t.string :content\\n      t.string :category\\n\\n      t.timestamps\\n    end\\n  end\\nend\\n\\n```\\n\\n`content` \u1edf \u0111\xe2y m\xecnh d\xf9ng string, nh\u01b0ng khuy\u1ebfn kh\xedch d\xf9ng text h\u01a1n.\\n\\n```ruby\\nclass Post < ApplicationRecord\\n\\thas_rich_text :content\\nend\\n```\\n\\nTr\xean form, ta ch\u1ec9 vi\u1ec7c d\xf9ng `rich_text_area`\\n\\n```erb\\n<%= form_with(model: @post) do |form| %>\\n  <div class=\\"field\\">\\n    <%= form.label :content %>\\n    <%= form.rich_text_area :content %>\\n  </div>\\n<% end %>\\n```\\n\\nKhi permit params, ta c\u0169ng l\xe0m nh\u01b0 bao field kh\xe1c\\n\\n```ruby\\n\\nclass PostsController < ApplicationController\\n  def post_params\\n    params.require(:post).permit(:category, :content)\\n  end\\nend\\n```\\n\\nCu\u1ed1i c\xf9ng ta hi\u1ec3n th\u1ecb d\u1eef li\u1ec7u nh\u01b0 sau:\\n\\n```erb\\n<%= @post.content %>\\n```\\n\\nC\xe2u l\u1ec7nh tr\xean th\u1ef1c ch\u1ea5t \u0111ang ng\u1ea7m g\u1ecdi t\u1edbi `@post.content.to_s`\\n\\n\u0110\xe2y l\xe0 s\u1ea3n ph\u1ea9m c\u1ee7a ta:\\n\\nForm t\u1ea1o post v\u1edbi WYSIWYG editor - S\u1eed d\u1ee5ng Trix editor, do Basecamp ph\xe1t tri\u1ec3n, c\xe2y nh\xe0 l\xe1 v\u01b0\u1eddn lu\xf4n.\\n\\nC\xf3 th\u1ec3 k\xe9o th\u1ea3 file v\xe0o, file \u0111\xf3 s\u1ebd \u0111\u01b0\u1ee3c upload b\u1eb1ng Active Storage.\\n\\n![](https://images.viblo.asia/77b9bd23-5ba3-426b-b6fc-cac02edb0b42.png)\\n\\nHi\u1ec3n th\u1ecb d\u1eef li\u1ec7u \u1edf m\xe0n h\xecnh detail\\n\\n![](https://images.viblo.asia/6b1b8da0-ca7f-468b-9705-444a8cb2d736.png)\\n\\nC\xe1c b\u1ea1n th\u1ea5y sao? C\xe1 nh\xe2n m\xecnh th\u1ea5y x\u1ea5u nh\u01b0 c\u1edd h\xf3 v\u1eady =)) Tuy nhi\xean ta c\xf3 th\u1ec3 styling cho n\xf3.\\n\\n## Styling\\n\\nRails \u0111ang c\xf3 s\u1eb5n m\u1ed9t v\xe0i style c\u01a1 b\u1ea3n cho n\xf3 trong file `app/assets/stylesheets/actiontext.scss`, ta c\xf3 th\u1ec3 s\u1eeda n\xf3 \u0111\u1ec3 cho \u0111\u1eb9p h\u01a1n.\\n\\nV\u1edbi \u0111\u1ed1ng tool c\u1ee7a editor th\xec c\xf3 th\u1ec3 d\xf9ng selector `.trix-button-row`\\n\\nV\u1edbi template attachment (nh\u01b0 c\xe1i `monaco.ttf` \u1edf tr\xean), ta c\u0169ng c\xf3 th\u1ec3 custom l\u1ea1i, Rails cung c\u1ea5p s\u1eb5n template m\u1eb7c \u0111\u1ecbnh \u1edf file `app/views/active_storage/blobs/_blob.html.erb`\\n\\n# T\xecm hi\u1ec3u s\u1ef1 ma gi\xe1o\\n\\nR\u1ed3i ta \u0111\xe3 l\u01b0\u1edbt qua c\xe1ch s\u1eed d\u1ee5ng n\xf3, nh\u01b0ng m\xe0 c\xf3 qu\xe1 nhi\u1ec1u magic.\\n\\nLi\u1ec7u b\u1ea1n c\xf3 t\u1ef1 \u0111\u1eb7t ra nh\u1eefng c\xe2u h\u1ecfi th\u1ebf n\xe0y hay kh\xf4ng?\\n\\n- Kh\xf4ng bi\u1ebft c\xe1ch l\u01b0u tr\u1eef d\u1eef li\u1ec7u c\u1ee7a n\xf3 nh\u01b0 th\u1ebf n\xe0o?\\n- L\xe0m sao m\xe0 c\xe1i file trong kia integrate \u0111\u01b0\u1ee3c v\u1edbi Active Storage?\\n- V\xec sao l\u1ea1i c\xf3 th\u1ec3 custom l\u1ea1i nh\u1eefng attachment b\u1eb1ng template?\\n\\n- v\xe2n v\xe2n m\xe2y m\xe2y...\\n\\nTa s\u1ebd b\u1eaft tay v\xe0o t\xecm hi\u1ec3u n\xf3.\\n\\nH\xe3y b\u1eaft \u0111\u1ea7u v\u1edbi `has_rich_text`\\n\\n## Macro `has_rich_text`\\n\\n```ruby\\n# https://github.com/rails/rails/blob/6a5c8b91998c56e50b5cc934d968947cd319f735/actiontext/lib/action_text/attribute.rb#L26\\ndef has_rich_text(name)\\n  class_eval <<-CODE, __FILE__, __LINE__ + 1\\n    def #{name}\\n      rich_text_#{name} || build_rich_text_#{name}\\n    end\\n\\n    def #{name}=(body)\\n      self.#{name}.body = body\\n    end\\n  CODE\\n\\n  has_one :\\"rich_text_#{name}\\", -> { where(name: name) },\\n    class_name: \\"ActionText::RichText\\", as: :record, inverse_of: :record, autosave: true, dependent: :destroy\\n  # ... codes\\nend\\n```\\n\\nD\u1ec5 d\xe0ng th\u1ea5y r\u1eb1ng \u0111\xe2y l\xe0 1 macro gi\xfap \u0111\u1ecbnh ngh\u0129a getter, setter, v\xe0 c\u1ea3 association `has_one :rich_text_...` v\u1edbi `ActionText::RichText`.\\n\\nV\u1eady th\xec khi ta g\u1ecdi `@post.content`, th\u1ef1c ch\u1ea5t l\xe0 ta \u0111ang g\u1ecdi t\u1edbi `@post.rich_text_content`.\\n\\nV\xe0 n\xf3 c\u0169ng ch\u1ec9 ra 1 \u0111i\u1ec1u n\u1eefa l\xe0 Rails d\xf9ng 1 b\u1ea3ng ri\xeang \u0111\u1ec3 l\u01b0u l\u1ea1i \u0111\u1ed1ng rich text c\u1ee7a ta.\\n\\nH\xe3y d\xe0nh ch\xfat th\u1eddi gian nh\xecn v\xe0o th\u01b0 m\u1ee5c `db/migrate`, ta s\u1ebd th\u1ea5y file sau:\\n\\n```ruby\\n# db/migrate/20190718085159_create_action_text_tables.action_text.rb\\n# This migration comes from action_text (originally 20180528164100)\\nclass CreateActionTextTables < ActiveRecord::Migration[6.0]\\n  def change\\n    create_table :action_text_rich_texts do |t|\\n      t.string     :name, null: false\\n      t.text       :body, size: :long\\n      t.references :record, null: false, polymorphic: true, index: false\\n\\n      t.timestamps\\n\\n      t.index [ :record_type, :record_id, :name ], name: \\"index_action_text_rich_texts_uniqueness\\", unique: true\\n    end\\n  end\\nend\\n\\n```\\n\\nQu\u1ea3 th\u1eadt l\xe0 v\u1eady, `body` ch\xednh l\xe0 n\u01a1i l\u01b0u tr\u1eef \u0111\u1ed1ng text c\u1ee7a ta, c\xf2n `name`, `record_id`, v\xe0 `record_type` l\xe0 nh\u1eefng attribute cho polymorphic association, kh\xe1 quen thu\u1ed9c n\u1ebfu b\u1ea1n \u0111\xe3 d\xf9ng Active storage\\n\\nTa s\u1ebd \u0111i \u0111\u1ebfn b\u01b0\u1edbc ti\u1ebfp theo `rich_text_area`\\n\\n## Rails x\u1eed l\xfd, l\u01b0u tr\u1eef rich text nh\u01b0 th\u1ebf n\xe0o?\\n\\n```ruby\\n# https://github.com/rails/rails/blob/cc1a5d5620c4cd952b27f6c1bbd16d8780a34d0e/actiontext/app/helpers/action_text/tag_helper.rb#L20\\ndef rich_text_area_tag(name, value = nil, options = {})\\n  options = options.symbolize_keys\\n\\n  options[:input] ||= \\"trix_input_#{ActionText::TagHelper.id += 1}\\"\\n  options[:class] ||= \\"trix-content\\"\\n\\n  options[:data] ||= {}\\n  options[:data][:direct_upload_url] = main_app.rails_direct_uploads_url\\n  options[:data][:blob_url_template] = main_app.rails_service_blob_url(\\":signed_id\\", \\":filename\\")\\n\\n  editor_tag = content_tag(\\"trix-editor\\", \\"\\", options)\\n  input_tag = hidden_field_tag(name, value, id: options[:input])\\n\\n  input_tag + editor_tag\\nend\\n```\\n\\nC\xf3 th\u1ec3 th\u1ea5y \u0111\u01a1n gi\u1ea3n n\xf3 ch\u1ec9 init c\xe1i trix editor cho ta th\xf4i.\\n\\nVi\u1ec7c k\xe9o th\u1ea3 file, upload ho\xe0n to\xe0n \u0111\u01b0\u1ee3c handle b\u1edfi trix editor, ta kh\xf4ng custom \u0111\u01b0\u1ee3c template sau khi file upload th\xe0nh c\xf4ng.\\n\\nTuy nhi\xean Action Text c\xf3 th\xeam 1 callback sau khi file \u0111\u01b0\u1ee3c upload th\xe0nh c\xf4ng:\\n\\n```javascript\\n// https://github.com/rails/rails/blob/cc1a5d5620c4cd952b27f6c1bbd16d8780a34d0e/actiontext/app/javascript/actiontext/attachment_upload.js#L26\\nthis.attachment.setAttributes({\\n  sgid: attributes.attachable_sgid,\\n  url: this.createBlobUrl(attributes.signed_id, attributes.filename),\\n});\\n```\\n\\n\u0111\xe2y l\xe0 1 step r\u1ea5t quan tr\u1ecdng, nh\u01b0ng ta s\u1ebd ch\u01b0a c\u1ea7n ch\xfa \xfd t\u1edbi n\xf3 v\u1ed9i. Attachment c\u1ee7a ta sau khi upload th\xe0nh c\xf4ng s\u1ebd tr\xf4ng nh\u01b0 sau:\\n\\n```html\\n<figure\\n  contenteditable=\\"false\\"\\n  data-trix-attachment=\'{\\"contentType\\":\\"application/zip\\",\\"filename\\":\\"monaco.ttf-master.zip\\",\\"filesize\\":88996,\\"sgid\\":\\"BAh7CEkiCGdpZAY6BkVUSSIvZ2lkOi8vYXBwL0FjdGl2ZVN0b3JhZ2U6OkJsb2IvOD9leHBpcmVzX2luBjsAVEkiDHB1cnBvc2UGOwBUSSIPYXR0YWNoYWJsZQY7AFRJIg9leHBpcmVzX2F0BjsAVDA=--79d2aa5a0af367233a5420a4f0ae02657d3910ab\\",\\"url\\":\\"http://localhost:60100/rails/active_storage/blobs/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaHBEUT09IiwiZXhwIjpudWxsLCJwdXIiOiJibG9iX2lkIn19--e79bebbfa0f10319d319411c129291d12e752d22/monaco.ttf-master.zip\\"}\'\\n  data-trix-content-type=\\"application/zip\\"\\n  data-trix-id=\\"1108\\"\\n  class=\\"attachment attachment--file attachment--zip\\"\\n>\\n  <figcaption class=\\"attachment__caption\\">\\n    <span class=\\"attachment__name\\">monaco.ttf-master.zip</span>\\n    <span class=\\"attachment__size\\">86.91 KB</span>\\n  </figcaption>\\n</figure>\\n```\\n\\nTi\u1ebfp \u0111\u1ebfn l\xe0 submit d\u1eef li\u1ec7u, v\u1eady Rails s\u1ebd g\u1eedi g\xec l\xean?\\n\\n\u0110\u01a1n gi\u1ea3n l\xe0 Rails s\u1ebd g\u1eedi t\u1ea5t c\u1ea3 nh\u1eefng g\xec b\xean trong `<trix-editor></trix-editor>`\\n\\nInspect th\u1eed params, ta s\u1ebd th\u1ea5y:\\n\\n```ruby\\npost_params[:content]\\n# => \\"<div><a href=\\\\\\"http://localhost:60100/posts/new\\\\\\">http://localhost:60100/posts/new</a></div><div><strong>Hello world<br></strong><figure data-trix-attachment=\\\\\\"{&quot;content&quot;:&quot;<figure class=\\\\\\\\&quot;attachment attachment--file attachment--zip\\\\\\\\&quot;>\\\\\\\\n\\\\\\\\n  <figcaption class=\\\\\\\\&quot;attachment__caption\\\\\\\\&quot;>\\\\\\\\n      <span class=\\\\\\\\&quot;attachment__name\\\\\\\\&quot;>monaco.ttf-master.zip</span>\\\\\\\\n      <span class=\\\\\\\\&quot;attachment__size\\\\\\\\&quot;>86.9 KB</span>\\\\\\\\n  </figcaption>\\\\\\\\n</figure>\\\\\\\\n&quot;,&quot;contentType&quot;:&quot;application/zip&quot;,&quot;filename&quot;:&quot;monaco.ttf-master.zip&quot;,&quot;filesize&quot;:88996,&quot;sgid&quot;:&quot;BAh7CEkiCGdpZAY6BkVUSSIvZ2lkOi8vYXBwL0FjdGl2ZVN0b3JhZ2U6OkJsb2IvNz9leHBpcmVzX2luBjsAVEkiDHB1cnBvc2UGOwBUSSIPYXR0YWNoYWJsZQY7AFRJIg9leHBpcmVzX2F0BjsAVDA=--97b885c24fd3d87464525f34a7b6ea117e4c72e6&quot;,&quot;url&quot;:&quot;http://localhost:60100/rails/active_storage/blobs/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaHBEQT09IiwiZXhwIjpudWxsLCJwdXIiOiJibG9iX2lkIn19--940badfc5aee704ef3f98085f87f909baf870660/monaco.ttf-master.zip&quot;}\\\\\\" data-trix-content-type=\\\\\\"application/zip\\\\\\" class=\\\\\\"attachment attachment--content attachment--zip\\\\\\"><figure class=\\\\\\"attachment attachment--file attachment--zip\\\\\\">\\\\r\\\\n\\\\r\\\\n  <figcaption class=\\\\\\"attachment__caption\\\\\\">\\\\r\\\\n      <span class=\\\\\\"attachment__name\\\\\\">monaco.ttf-master.zip</span>\\\\r\\\\n      <span class=\\\\\\"attachment__size\\\\\\">86.9 KB</span>\\\\r\\\\n  </figcaption>\\\\r\\\\n</figure>\\\\r\\\\n<figcaption class=\\\\\\"attachment__caption\\\\\\"></figcaption></figure></div>\\"\\n```\\n\\nL\xe0m \u0111\u1eb9p n\xf3 ch\xfat\\n\\n```html\\n<div>\\n  <a href=\\"http://localhost:60100/posts/new\\"\\n    >http://localhost:60100/posts/new</a\\n  >\\n</div>\\n<div>\\n  <strong>Hello world<br /></strong>\\n  <figure\\n    data-trix-attachment=\\"...\\"\\n    data-trix-content-type=\\"application/zip\\"\\n    class=\\"attachment attachment--content attachment--zip\\"\\n  >\\n    <figure class=\\"attachment attachment--file attachment--zip\\">\\n      <figcaption class=\\"attachment__caption\\">\\n        <span class=\\"attachment__name\\">monaco.ttf-master.zip</span>\\n        <span class=\\"attachment__size\\">86.9 KB</span>\\n      </figcaption>\\n    </figure>\\n    <figcaption class=\\"attachment__caption\\"></figcaption>\\n  </figure>\\n</div>\\n```\\n\\nC\xf3 th\u1ec3 th\u1ea5y n\xf3 kh\xe1 gi\u1ed1ng v\u1edbi content c\u1ee7a `<trix-editor></trix-editor>` \u0111\xfang kh\xf4ng n\xe0o?\\n\\nTa s\u1ebd save \u0111\u1ed1ng params n\xe0y l\u1ea1i, v\xe0 xem DB ta ch\u1ee9a g\xec?\\n\\n```sql\\napp_development=# SELECT body FROM action_text_rich_texts WHERE id = 3;\\n```\\n\\n```html\\n<div>\\n  <a href=\\"http://localhost:60100/posts/new\\"\\n    >http://localhost:60100/posts/new</a\\n  >\\n</div>\\n<div>\\n  <strong>Hello world<br /></strong>\\n  <action-text-attachment\\n    sgid=\\"BAh7CEkiCGdpZAY6BkVUSSIvZ2lkOi8vYXBwL0FjdGl2ZVN0b3JhZ2U6OkJsb2IvNz9leHBpcmVzX2luBjsAVEkiDHB1cnBvc2UGOwBUSSIPYXR0YWNoYWJsZQY7AFRJIg9leHBpcmVzX2F0BjsAVDA=--97b885c24fd3d87464525f34a7b6ea117e4c72e6\\"\\n    content-type=\\"application/zip\\"\\n    url=\\"http://localhost:60100/rails/active_storage/blobs/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaHBEQT09IiwiZXhwIjpudWxsLCJwdXIiOiJibG9iX2lkIn19--940badfc5aee704ef3f98085f87f909baf870660/monaco.ttf-master.zip\\"\\n    filename=\\"monaco.ttf-master.zip\\"\\n    filesize=\\"88996\\"\\n  ></action-text-attachment>\\n</div>\\n```\\n\\nC\xe1c th\u1ebb kh\xe1c th\xec v\u1eabn v\u1eady, tuy nhi\xean attachments c\u1ee7a ta l\u1ea1i c\xf3 m\u1ed9t ch\xfat kh\xe1c bi\u1ec7t. \u1ede \u0111\xe2y \u0111\u1ed1ng `figure` \u0111\xe3 \u0111\u01b0\u1ee3c minify l\u1ea1i th\xe0nh `action-text-attachment ` \u0111\u1ec3 cho g\u1ecdn h\u01a1n.\\n\\nH\xe3y c\xf9ng \u0111i\u1ec1u tra xem t\u1ea1i sao l\u1ea1i nh\u01b0 v\u1eady? Tr\u01b0\u1edbc ti\xean ta v\xe0o xem `ActionText::RichText` c\u1ee7a ta ch\u1ee9a g\xec ma gi\xe1o\\n\\n```ruby\\n# https://github.com/rails/rails/blob/027085a5972a798cfea60f829a9edabbd67a2818/actiontext/app/models/action_text/rich_text.rb#L11\\nclass ActionText::RichText < ActiveRecord::Base\\n  serialize :body, ActionText::Content\\nend\\n```\\n\\nV\u1eady l\xe0 `body` c\u1ee7a ta \u0111ang \u0111\u01b0\u1ee3c serialize b\u1edfi `ActionText::Content`, m\xf2 \u0111\u1ebfn \u0111\xf3 ti\u1ebfp th\xf4i.\\n\\n```ruby\\n# https://github.com/rails/rails/blob/df8ee09ce71338cdf9816225df1bdebc707f3560/actiontext/lib/action_text/content.rb#L15\\nclass ActionText::Content\\n  class << self\\n    def fragment_by_canonicalizing_content(content)\\n      fragment = ActionText::Attachment.fragment_by_canonicalizing_attachments(content)\\n      fragment = ActionText::AttachmentGallery.fragment_by_canonicalizing_attachment_galleries(fragment)\\n      fragment\\n    end\\n  end\\n\\n  def initialize(content = nil, options = {})\\n    options.with_defaults! canonicalize: true\\n\\n    if options[:canonicalize]\\n      @fragment = self.class.fragment_by_canonicalizing_content(content)\\n    else\\n      @fragment = ActionText::Fragment.wrap(content)\\n    end\\n  end\\nend\\n```\\n\\nTa s\u1ebd quan t\xe2m t\u1edbi h\xe0m `initialize` tr\u01b0\u1edbc, khi serialize, m\u1eb7c \u0111\u1ecbnh l\xe0 ta \u0111ang kh\xf4ng d\xf9ng tham s\u1ed1, v\u1eady l\xe0 options s\u1eed d\u1ee5ng s\u1ebd l\xe0 `canonicalize: true`, xem ti\u1ebfp `fragment_by_canonicalizing_content` n\xe0o. C\xf3 v\u1ebb l\u1ea1i ph\u1ea3i m\xf2 `fragment_by_canonicalizing_attachments` ti\u1ebfp @@\\n\\n```ruby\\n# https://github.com/rails/rails/blob/df8ee09ce7/actiontext/lib/action_text/attachment.rb#L11\\nclass ActionText::Attachment\\n  TAG_NAME = \\"action-text-attachment\\"\\n  SELECTOR = TAG_NAME\\n\\n  class << self\\n    def fragment_by_canonicalizing_attachments(content)\\n      fragment_by_minifying_attachments(\\n        fragment_by_converting_trix_attachments(content)\\n      )\\n    end\\n  end\\nend\\n```\\n\\n`fragment_by_minifying_attachments`, b\u1ea1n c\xf3 th\u1ea5y t\u1eeb minify kh\xf4ng? C\xf3 v\u1ebb ta \u0111ang \u0111i \u0111\xfang h\u01b0\u1edbng. H\xe3y ti\u1ebfp t\u1ee5c, nh\u01b0ng h\xe3y b\u1eaft \u0111\u1ea7u b\u1eb1ng `fragment_by_converting_trix_attachments`\\n\\n```ruby\\n# https://github.com/rails/rails/blob/df8ee09ce71338cdf9816225df1bdebc707f3560/actiontext/lib/action_text/attachments/trix_conversion.rb#L9\\nmodule ActionText::Attachments::TrixConversion\\n  class_methods do\\n    def fragment_by_converting_trix_attachments(content)\\n      Fragment.wrap(content).replace(TrixAttachment::SELECTOR) do |node|\\n        from_trix_attachment(TrixAttachment.new(node))\\n      end\\n    end\\n  end\\nend\\n```\\n\\nN\xf4m na l\xe0 \u0111o\u1ea1n n\xe0y s\u1ebd replace to\xe0n b\u1ed9 `ActionText::TrixAttachment::SELECTOR = \\"[data-trix-attachment]` b\u1eb1ng th\u1ebb `ActionText::Attachment::SELECTOR = \\"action-text-attachment\\"`.\\n\\n```ruby\\nmodule ActionText::Attachments::Minification\\n  class_methods do\\n    def fragment_by_minifying_attachments(content)\\n      Fragment.wrap(content).replace(ActionText::Attachment::SELECTOR) do |node|\\n        node.tap { |n| n.inner_html = \\"\\" }\\n      end\\n    end\\n  end\\nend\\n```\\n\\nH\xe0m `fragment_by_minifying_attachments` c\u1ee7a ch\xfang ta s\u1ebd remove to\xe0n b\u1ed9 inner content c\u1ee7a th\u1ebb `action-text-attachment`.\\n\\nSau m\u1ed9t h\u1ed3i l\xf2ng v\xf2ng, cu\u1ed1i c\xf9ng ta \u0111\xe3 bi\u1ebft \u0111\u01b0\u1ee3c t\u1ea1i sao \u0111\u1ed1ng `figure` r\u1ed1i r\u1eafm kia tr\u1edf th\xe0nh `action-text-attachment` g\u1ecdn g\xe0ng h\u01a1n r\u1ea5t nhi\u1ec1u.\\n\\n## Hi\u1ec3n th\u1ecb d\u1eef li\u1ec7u\\n\\nH\xe3y v\xe0o m\xe0n h\xecnh detail, v\xe0 th\u1eed inspect element, ta s\u1ebd th\u1ea5y attachment c\u1ee7a ta l\u1ea1i tr\u1edf v\u1ec1 d\u1ea1ng \u0111\u1ea7y \u0111\u1ee7:\\n\\n```ruby\\n<%= @post.content =>\\n```\\n\\n\u0110\xe2y l\xe0 nh\u1eefng g\xec ta thu \u0111\u01b0\u1ee3c.\\n\\n```html\\n<div class=\\"trix-content\\">\\n  <div>\\n    <a href=\\"http://localhost:60100/posts/new\\"\\n      >http://localhost:60100/posts/new</a\\n    >\\n  </div>\\n  <div>\\n    <strong>Hello world<br /></strong>\\n    <action-text-attachment\\n      sgid=\\"BAh7CEkiCGdpZAY6BkVUSSIvZ2lkOi8vYXBwL0FjdGl2ZVN0b3JhZ2U6OkJsb2IvNz9leHBpcmVzX2luBjsAVEkiDHB1cnBvc2UGOwBUSSIPYXR0YWNoYWJsZQY7AFRJIg9leHBpcmVzX2F0BjsAVDA=--97b885c24fd3d87464525f34a7b6ea117e4c72e6\\"\\n      content-type=\\"application/zip\\"\\n      url=\\"http://localhost:60100/rails/active_storage/blobs/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaHBEQT09IiwiZXhwIjpudWxsLCJwdXIiOiJibG9iX2lkIn19--940badfc5aee704ef3f98085f87f909baf870660/monaco.ttf-master.zip\\"\\n      filename=\\"monaco.ttf-master.zip\\"\\n      filesize=\\"88996\\"\\n    >\\n      <figure class=\\"attachment attachment--file attachment--zip\\">\\n        <figcaption class=\\"attachment__caption\\">\\n          <span class=\\"attachment__name\\">monaco.ttf-master.zip</span>\\n          <span class=\\"attachment__size\\">86.9 KB</span>\\n        </figcaption>\\n      </figure>\\n    </action-text-attachment>\\n  </div>\\n</div>\\n```\\n\\nB\u1ea1n c\xf2n nh\u1edb m\xecnh ghi \u1edf tr\xean, khi ta vi\u1ebft `@post.content`, th\u1ef1c ch\u1ea5t ta \u0111ang g\u1ecdi `@post.content.to_s` ch\u1ee9?\\n\\nTh\u1eed \u0111\xe0o s\xe2u v\xe0o ch\xfat:\\n\\n```ruby\\n# https://github.com/rails/rails/blob/df8ee09ce7/actiontext/lib/action_text/content.rb#L90\\ndef to_rendered_html_with_layout\\n  renderer.render(partial: \\"action_text/content/layout\\", locals: { content: self })\\nend\\n\\ndef to_s\\n  to_rendered_html_with_layout\\nend\\n```\\n\\n```erb\\n<%# https://github.com/rails/rails/blob/df8ee09ce7/actiontext/app/views/action_text/content/_layout.html.erb %>\\n<div class=\\"trix-content\\">\\n  <%= render_action_text_content(content) %>\\n</div>\\n```\\n\\n```ruby\\n# https://github.com/rails/rails/blob/0ec2a907545e47f816993b9fd8cabb552454b1a2/actiontext/app/helpers/action_text/content_helper.rb#L12\\ndef render_action_text_content(content)\\n  sanitize_action_text_content(render_action_text_attachments(content))\\nend\\n\\ndef sanitize_action_text_content(content)\\n  sanitizer.sanitize(content.to_html, tags: allowed_tags, attributes: allowed_attributes, scrubber: scrubber).html_safe\\nend\\n\\ndef render_action_text_attachments(content)\\n  content.render_attachments do |attachment|\\n    unless attachment.in?(content.gallery_attachments)\\n      attachment.node.tap do |node|\\n        node.inner_html = render(attachment, in_gallery: false).chomp\\n      end\\n    end\\n  end.render_attachment_galleries do |attachment_gallery|\\n    render(layout: attachment_gallery, object: attachment_gallery) do\\n      attachment_gallery.attachments.map do |attachment|\\n        attachment.node.inner_html = render(attachment, in_gallery: true).chomp\\n        attachment.to_html\\n      end.join(\\"\\").html_safe\\n    end.chomp\\n  end\\nend\\n```\\n\\n\u0110\u1ea1i kh\xe1i l\xe0 Rails s\u1ebd sanitize \u0111\u1ed1ng rich text c\u1ee7a ta \u0111\u1ec3 tr\xe1nh XSS attack, v\xe0 render template \u0111\u1ed1i v\u1edbi nh\u1eefng attachment.\\n\\n## Integrate v\u1edbi Active Storage\\n\\nH\xe3y quay tr\u1edf l\u1ea1i v\u1edbi model `ActionText::RichText`\\n\\n```ruby\\n# https://github.com/rails/rails/blob/df8ee09ce7/actiontext/app/models/action_text/rich_text.rb#L14\\nclass ActionText::RichText < ActiveRecord::Base\\n  has_many_attached :embeds\\n\\n  before_save do\\n    self.embeds = body.attachments.map(&:attachable) if body.present?\\n  end\\nend\\n```\\n\\nTa d\u1ec5 d\xe0ng hi\u1ec3u 1 c\xe1ch t\u1ed5ng quan l\xe0 Rails s\u1ebd ti\u1ebfn h\xe0nh extract to\xe0n b\u1ed9 attachment trong body, g\xe1n v\xe0o embeds. Sau \u0111\xf3 s\u1ebd save \u0111\u1ed1ng association n\xe0y l\u1ea1i.\\n\\nTh\u1eed xem Rails s\u1ebd extract attachments ra l\xe0m sao.\\n\\n```ruby\\n# https://github.com/rails/rails/blob/027085a5972a798cfea60f829a9edabbd67a2818/actiontext/lib/action_text/content.rb#L53\\ndef attachables\\n  @attachables ||= attachment_nodes.map do |node|\\n    ActionText::Attachable.from_node(node)\\n  end\\nend\\n\\n# https://github.com/rails/rails/blob/027085a5972a798cfea60f829a9edabbd67a2818/actiontext/lib/action_text/content.rb#L113\\ndef attachment_nodes\\n  @attachment_nodes ||= fragment.find_all(ActionText::Attachment::SELECTOR)\\nend\\n```\\n\\nRails s\u1ebd t\xecm ki\u1ebfm t\u1ea5t c\u1ea3 th\u1ebb `action-text-attachment`, extract nh\u1eefng th\xf4ng tin c\u1ea7n thi\u1ebft \u0111\u1ec3 init \u0111\u01b0\u1ee3c `ActiveStorage::Blob` object.\\n\\nTa c\u1ea7n ngh\xeda qua h\xe0m `Attachable.from_node` n\u1eefa\\n\\n```ruby\\n# https://github.com/rails/rails/blob/027085a5972a798cfea60f829a9edabbd67a2818/actiontext/lib/action_text/attachable.rb#L10\\ndef from_node(node)\\n  if attachable = attachable_from_sgid(node[\\"sgid\\"])\\n    attachable\\n  elsif attachable = ActionText::Attachables::ContentAttachment.from_node(node)\\n    attachable\\n  elsif attachable = ActionText::Attachables::RemoteImage.from_node(node)\\n    attachable\\n  else\\n    ActionText::Attachables::MissingAttachable\\n  end\\nend\\n```\\n\\nTrong tr\u01b0\u1eddng h\u1ee3p n\xe0y, Rails s\u1ebd lu\xf4n extract theo strategy l\xe0 `sgid`, c\xe1c b\u1ea1n kh\xf4ng c\u1ea7n quan t\xe2m t\u1edbi 3 nh\xe1nh d\u01b0\u1edbi l\xe0m g\xec cho m\u1ea5t c\xf4ng.\\n\\nC\xf2n nh\u1edb ph\u1ea7n tr\xean m\xecnh \u0111\xe3 \u0111\u1ec1 c\u1eadp t\u1edbi `sgid` ch\u1ee9?\\n\\n```js\\n//github.com/rails/rails/blob/cc1a5d5620c4cd952b27f6c1bbd16d8780a34d0e/actiontext/app/javascript/actiontext/attachment_upload.js#L26\\nhttps: this.attachment.setAttributes({\\n  sgid: attributes.attachable_sgid,\\n  url: this.createBlobUrl(attributes.signed_id, attributes.filename),\\n});\\n```\\n\\nCallback n\xe0y \u0111\u01b0\u1ee3c g\u1ecdi sau khi file \u0111\u01b0\u1ee3c upload th\xe0nh c\xf4ng. V\u1eady `sgid` l\xe0 c\xe1i g\xec?\\n\\n`sigd` \u0111\u01b0\u1ee3c encrypt t\u1eeb `id` c\u1ee7a attachment sau khi upload. Khi g\u1eedi l\xean, server s\u1ebd decrypt n\xf3 \u0111\u1ec3 l\u1ea5y l\u1ea1i `id`, g\xe1n attachment v\xe0o record.\\n\\nT\u1ea1i sao l\u1ea1i c\u1ea7n encrypt? C\xe1c b\u1ea1n c\u1ee9 t\u01b0\u1edfng t\u01b0\u1ee3ng, n\u1ebfu d\xf9ng th\u1eb3ng id, do ta upload \u1ea3nh tr\u01b0\u1edbc khi t\u1ea1o record, n\xean khi g\u1eedi params t\u1eeb client l\xean, ch\u1eafc ch\u1eafn s\u1ebd ph\u1ea3i \u0111\u01b0a attachment id v\xe0o \u0111\u1ec3 server l\u01b0u \u0111\xfang association. Client n\xf3 g\u1eedi \u0111\xfang th\xec kh\xf4ng sao, nh\u01b0ng n\u1ebfu n\xf3 g\u1eedi id attachment c\u1ee7a ng\u01b0\u1eddi kh\xe1c th\xec sao? Attachment \u0111\xf3 s\u1ebd chuy\u1ec3n ch\u1ee7 ngay l\u1eadp t\u1ee9c :v C\xf2n n\u1ebfu encrypt th\xec user \u0111\u1ed1 m\xe0 m\xf2 \u0111\u01b0\u1ee3c m\xe3 hash c\u1ee7a attachment ng\u01b0\u1eddi kh\xe1c.\\n\\n`attachable_from_sgid(node[\\"sgid\\"])` s\u1ebd tr\u1ea3 v\u1ec1 `ActiveStorage::Blob` object\\n\\n```ruby\\n# https://github.com/rails/rails/blob/f1b8bb4e1f16e4029ddf05515db0c01942521116/actiontext/lib/action_text/attachable.rb#L22\\ndef from_attachable_sgid(sgid, options = {})\\n  method = sgid.is_a?(Array) ? :locate_many_signed : :locate_signed\\n  record = GlobalID::Locator.public_send(method, sgid, options.merge(for: LOCATOR_NAME))\\n  record || raise(ActiveRecord::RecordNotFound)\\nend\\n```\\n\\nN\u1ebfu kh\xf4ng tin, b\u1ea1n h\xe3y th\u1eed `rails c` v\xe0 g\u1ecdi h\xe0m:\\n\\n```ruby\\nGlobalID::Locator.locate_signed(sgid, { for: \\"attachable\\" })\\n```\\n\\n# K\u1ebft lu\u1eadn\\n\\n`Action Text` \u0111\u01b0\u1ee3c thi\u1ebft k\u1ebf kh\xe1 hay, code g\u1ecdn, t\u1ea5t c\u1ea3 method \u0111\u1ec1u r\u1ea5t ng\u1eafn, d\u1ec5 hi\u1ec3u.\\n\\nDo l\xe0 built-in n\xean ta c\u0169ng ch\u1ea3 c\u1ea7n c\xe0i c\u1eafm g\xec th\xeam m\u1ec7t ng\u01b0\u1eddi. N\u1ebfu \u0111\xe3 upgrade l\xean Rails 6, b\u1ea1n h\xe3y th\u1eed tr\u1ea3i nghi\u1ec7m n\xf3 xem.\\n\\nC\xf2n \u0111\u1ed1i v\u1edbi phi\xean b\u1ea3n th\u1ea5p h\u01a1n, ta c\u0169ng c\xf3 th\u1ec3 \xe1p d\u1ee5ng flow c\u1ee7a Action Text \u0111\u1ec3 build m\u1ed9t package h\u1ed7 tr\u1ee3 richtext."},{"id":"cung-tim-hieu-ve-railway-oriented-programming","metadata":{"permalink":"/blog/cung-tim-hieu-ve-railway-oriented-programming","editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/blog/2019-03-16-railway-oriented-programming.md","source":"@site/blog/2019-03-16-railway-oriented-programming.md","title":"C\xf9ng t\xecm hi\u1ec3u v\u1ec1 Railway Oriented Programming","description":"Khi m\u1edbi b\u1eaft \u0111\u1ea7u code, c\xf3 th\u1ec3 ch\xfang ta r\u1ea5t ng\u1ea1i handle nh\u1eefng exception m\xe0 ngay c\u1ea3 1 h\xe0m \u0111\u01a1n gi\u1ea3n nh\u1ea5t c\u0169ng c\xf3 th\u1ec3 tung ra. Tuy nhi\xean, th\u1ef1c t\u1ebf khi x\xe2y d\u1ef1ng h\u1ec7 th\u1ed1ng, ta ph\u1ea3i \u0111\u1eb7c bi\u1ec7t ch\xfa \xfd \u0111\u1ebfn nh\u1eefng exception, kh\xf4ng th\xec \u1ee9ng d\u1ee5ng c\u1ee7a ta c\xf3 th\u1ec3 th\u0103ng b\u1ea5t c\u1ee9 l\xfac n\xe0o :v","date":"2019-03-16T00:00:00.000Z","formattedDate":"March 16, 2019","tags":[{"label":"ruby","permalink":"/blog/tags/ruby"},{"label":"javascript","permalink":"/blog/tags/javascript"},{"label":"functional-programing","permalink":"/blog/tags/functional-programing"},{"label":"railway-oriented-programming","permalink":"/blog/tags/railway-oriented-programming"}],"readingTime":7.095,"hasTruncateMarker":false,"authors":[{"name":"L\xea S\u0129 B\xedch","title":"Ruby on Rails/React Developer","url":"https://github.com/moonlight8978","imageURL":"https://avatars.githubusercontent.com/u/26299310?v=4"}],"frontMatter":{"slug":"cung-tim-hieu-ve-railway-oriented-programming","title":"C\xf9ng t\xecm hi\u1ec3u v\u1ec1 Railway Oriented Programming","author":"L\xea S\u0129 B\xedch","author_title":"Ruby on Rails/React Developer","author_url":"https://github.com/moonlight8978","author_image_url":"https://avatars.githubusercontent.com/u/26299310?v=4","tags":["ruby","javascript","functional-programing","railway-oriented-programming"]},"unlisted":false,"prevItem":{"title":"C\xf9ng t\xecm hi\u1ec3u v\u1ec1 ActionText trong Rails 6","permalink":"/blog/cung-tim-hieu-ve-actiontext-trong-rails-6"},"nextItem":{"title":"M\u1ed9t v\xe0i mindset khi l\xe0m vi\u1ec7c v\u1edbi React","permalink":"/blog/mot-vai-mindset-khi-lam-viec-voi-react"}},"content":"Khi m\u1edbi b\u1eaft \u0111\u1ea7u code, c\xf3 th\u1ec3 ch\xfang ta r\u1ea5t ng\u1ea1i handle nh\u1eefng exception m\xe0 ngay c\u1ea3 1 h\xe0m \u0111\u01a1n gi\u1ea3n nh\u1ea5t c\u0169ng c\xf3 th\u1ec3 tung ra. Tuy nhi\xean, th\u1ef1c t\u1ebf khi x\xe2y d\u1ef1ng h\u1ec7 th\u1ed1ng, ta ph\u1ea3i \u0111\u1eb7c bi\u1ec7t ch\xfa \xfd \u0111\u1ebfn nh\u1eefng exception, kh\xf4ng th\xec \u1ee9ng d\u1ee5ng c\u1ee7a ta c\xf3 th\u1ec3 th\u0103ng b\u1ea5t c\u1ee9 l\xfac n\xe0o :v\\n\\nV\u1eady th\xec l\xe0m sao \u0111\u1ec3 handle ch\xfang 1 c\xe1ch th\u1eadt _clean_. C\xf3 kh\xe1 nhi\u1ec1u h\u01b0\u1edbng ti\u1ebfp c\u1eadn, tuy nhi\xean ta h\xe3y c\xf9ng th\u1eed tr\u1ea3i nghi\u1ec7m theo h\u01b0\u1edbng _Railway Oriented_ xem n\xf3 c\xf3 g\xec hay.\\n\\nB\xe0i gi\u1edbi thi\u1ec7u g\u1ed1c \u0111\u01b0\u1ee3c vi\u1ebft s\u1eed d\u1ee5ng ng\xf4n ng\u1eef F#, nh\u01b0ng ta ho\xe0n to\xe0n c\xf3 th\u1ec3 \xe1p d\u1ee5ng v\xe0o c\xe1c ng\xf4n ng\u1eef kh\xe1c nh\u01b0 Javascript, Ruby, ...\\n\\n_Railway Oriented Programming_ ph\xf9 h\u1ee3p v\u1edbi style l\u1eadp tr\xecnh h\xe0m (Functional Programming - FP)\\n\\nT\xean g\u1ecdi l\xe0 _Railway_ c\u0169ng b\u1edfi tr\xf4ng n\xf3 kh\xe1 gi\u1ed1ng v\u1edbi \u0111\u01b0\u1eddng ray t\xe0u h\u1ecfa.\\n\\n# V\u1ea5n \u0111\u1ec1\\n\\nH\xe3y b\u1eaft \u0111\u1ea7u v\u1edbi 1 usecase r\u1ea5t c\u01a1 b\u1ea3n\\n\\n> Ng\u01b0\u1eddi d\xf9ng mu\u1ed1n c\u1eadp nh\u1eadt profile c\u1ee7a h\u1ecd.\\n\\nSau khi ng\u01b0\u1eddi d\xf9ng submit th\xf4ng tin \u1edf web, ta hay c\xf9ng ph\xe2n t\xedch nh\u1eefng x\u1eed l\xfd \u1edf ph\xeda server\\n\\n![](https://images.viblo.asia/e37fd6b1-91fc-4340-8938-154196463a70.jpg)\\n\\nT\xecnh hu\u1ed1ng \u0111\u1eb9p nh\u1ea5t x\u1ea3y ra l\xe0 t\u1eeb b\u01b0\u1edbc 1-5, \u1ee9ng d\u1ee5ng ta s\u1ebd ch\u1ea1y tr\u01a1n tru, kh\xf4ng c\xf3 b\u1ea5t c\u1ee9 1 l\u1ed7i n\xe0o.\\n\\nNh\u01b0ng m\xe0 ...\\n\\n> \u0110\u1eddi kh\xf4ng nh\u01b0 m\u01a1, t\xecnh kh\xf4ng nh\u01b0 th\u01a1.\\n\\nT\u1eeb b\u01b0\u1edbc 1-4 \u0111\u1ec1u c\xf3 th\u1ec3 c\xf3 l\u1ed7i x\u1ea3y ra, v\xe0 t\u1ea5t nhi\xean ng\u01b0\u1eddi d\xf9ng s\u1ebd kh\xf4ng h\u1ec1 mu\u1ed1n nh\xecn th\u1ea5y c\u1ea3nh n\xe0y\\n\\n![](https://images.viblo.asia/e05c2f5c-ee9e-4f78-958d-bd54ff7b291c.jpg)\\n\\nV\u1eady th\xec nh\u1eefng g\xec ta c\u1ea7n l\xe0m l\xe0 x\u1eed l\xfd nh\u1eefng l\u1ed7i n\xe0y, kh\xf4ng th\xec ng\u01b0\u1eddi d\xf9ng m\u1ed9t \u0111i kh\xf4ng tr\u1edf l\u1ea1i lu\xf4n.\\n\\n![](https://images.viblo.asia/d7ea1ee4-2326-408a-be91-e361803f7f0b.jpeg)\\n\\nV\xe0 ta s\u1ebd vi\u1ebft code cho n\xf3:\\n\\n```javascript\\nfunction updateUser(user) {\\n  const request = receiveRequest();\\n  if (!isValidRequest(request)) {\\n    return \\"Request is forbidden\\";\\n  }\\n  if (!isValidUser(request)) {\\n    return \\"User information is invalid\\";\\n  }\\n  try {\\n    saveToDatabase(request);\\n  } catch (error) {\\n    return \\"DB error\\";\\n  }\\n  try {\\n    sendEmail(request);\\n  } catch (error) {\\n    return \\"Mailer error\\";\\n  }\\n  return \\"OK\\";\\n}\\n```\\n\\nCode tr\xean \u0111\u01b0\u1ee3c vi\u1ebft theo style Imperative, v\xec th\u1ebf n\xean ta c\xf3 th\u1ec3 return b\u1ea5t c\u1ee9 l\xfac n\xe0o ta mu\u1ed1n. \u0110i\u1ec1u \u0111\xf3 l\xe0m h\xe0m c\u1ee7a ta c\xf3 th\u1ec3 return theo r\u1ea5t nhi\u1ec1u c\xe1ch (nhi\u1ec1u ki\u1ec3u response kh\xe1c nhau).\\n\\n![](https://images.viblo.asia/13ab6aca-df34-41a5-89fe-85e6b8de4523.png)\\n\\nTa s\u1ebd design l\u1ea1i flow theo style FP.\\n\\n![](https://images.viblo.asia/e20339fb-142c-46a8-8d29-965f6ebcf63f.png)\\n\\nH\xe0m c\u1ee7a ta gi\u1edd \u0111\xe2y:\\n\\n- Ch\u1ec9 c\xf3 2 ki\u1ec3u tr\u1ea3 v\u1ec1: `Success` ho\u1eb7c `Failure`.\\n\\n  - Success:\\n\\n    ```js\\n    // @flow\\n    type Success = { data: object };\\n    ```\\n\\n  - Failure:\\n\\n    ```js\\n    // @flow\\n    type Failure = { error: string };\\n    ```\\n\\n- Use case \u0111\u01b0\u1ee3c x\xe2y d\u1ef1ng t\u1eeb 1 series c\xe1c h\xe0m con t\u01b0\u01a1ng \u1ee9ng v\u1edbi m\u1ed7i step.\\n\\nTa s\u1ebd \xe1p d\u1ee5ng _Railway Oriented Programming_ \u0111\u1ec3 gi\u1ea3i quy\u1ebft v\u1ea5n \u0111\u1ec1 n\xe0y.\\n\\n# Railway Oriented Programming\\n\\n#### Monad\\n\\nTrong l\u1eadp tr\xecnh h\xe0m, c\xf3 m\u1ed9t c\xe1ch \u0111\u1ec3 handle l\u1ed7i l\xe0 d\xf9ng _monad_.\\n\\nMonad th\u01b0\u1eddng \u0111i k\xe8m v\u1edbi Applicative v\xe0 Functor n\u1eefa, b\u1ecdn n\xe0y kh\xe1 l\xe0 xo\u1eafn n\xe3o n\xean m\xecnh s\u1ebd kh\xf4ng \u0111\u1ec1 c\u1eadp \u1edf \u0111\xe2y.\\n\\nTa s\u1ebd ch\u1ec9 quan t\xe2m t\u1edbi: _Either_ monad.\\n\\n```js\\n// @flow\\ntype Either<A, B> = A | B;\\ntype FunctionReturnMonad<A, B> = () => Either<A, B>;\\n```\\n\\nHi\u1ec3u m\u1ed9t c\xe1ch n\xf4m na s\u1ebd l\xe0: h\xe0m c\u1ee7a ta s\u1ebd lu\xf4n tr\u1ea3 v\u1ec1 A ho\u1eb7c B, nh\u01b0ng kh\xf4ng bao gi\u1edd tr\u1ea3 v\u1ec1 c\u1ea3 2.\\n\\n#### Switch\\n\\nH\xe3y b\u1eaft \u0111\u1ea7u v\u1edbi 1 function c\xf3 th\u1ec3 g\xe2y ra l\u1ed7i:\\n\\n```js\\nfunction validateNameNotBlank(user) {\\n  if (user.name === \\"\\") {\\n    return { error: \\"Name is blank\\" };\\n  }\\n  return { data: user };\\n}\\n```\\n\\n![](https://images.viblo.asia/4214182b-82ca-4ff1-9f86-7161b063632d.jpg)\\n\\n\u0110\xe2y ch\xednh l\xe0 1 switch, n\xf3 r\u1ebd nh\xe1nh lu\u1ed3ng x\u1eed l\xfd c\u1ee7a ta th\xe0nh `Success` v\xe0 `Failure`.\\n\\n#### K\u1ebft n\u1ed1i nhi\u1ec1u switch\\n\\n![](https://images.viblo.asia/b6cf8618-c07c-4502-86a3-90b1b6ab3530.png)\\n\\n\u0110\xe2y l\xe0 _\u0111\u01b0\u1eddng ray_ ho\xe0n ch\u1ec9nh m\xe0 ta c\u1ea7n x\xe2y d\u1ef1ng t\u1eeb nh\u1eefng switch ri\xeang l\u1ebb tr\xean.\\n\\nC\xf3 th\u1ec3 nh\u1eadn th\u1ea5y m\u1ed9t v\xe0i \u0111i\u1ec3m quan tr\u1ecdng \u1edf railway n\xe0y:\\n\\n- Khi m\u1ed9t step b\u1ecb l\u1ed7i, n\xf3 s\u1ebd kh\xf4ng return function ngay l\u1eadp t\u1ee9c, m\xe0 s\u1ebd ti\u1ebfp t\u1ee5c ch\u1ea1y v\xe0o c\xe1c function ti\u1ebfp theo cho t\u1edbi khi k\u1ebft th\xfac flow.\\n\\n  Tuy nhi\xean k\u1ebft qu\u1ea3 cu\u1ed1i c\xf9ng nh\u1eadn \u0111\u01b0\u1ee3c ch\u1ec9 l\xe0 l\u1ed7i \u0111\u1ea7u ti\xean ph\xe1t sinh.\\n\\n- Nh\u1eefng h\xe0m c\u1ee7a t\u1eebng step \u0111\u1ec1u ph\u1ea3i x\u1eed l\xfd c\u1ea3 tr\u01b0\u1eddng h\u1ee3p c\xf3 d\u1eef li\u1ec7u v\xe0 tr\u01b0\u1eddng h\u1ee3p h\xe0m tr\u01b0\u1edbc tr\u1ea3 v\u1ec1 l\u1ed7i\\n\\nB\xe2y gi\u1edd v\u1ea5n \u0111\u1ec1 l\xe0 l\xe0m th\u1ebf n\xe0o \u0111\u1ec3 n\u1ed1i nh\u1eefng switch l\u1ea1i v\u1edbi nhau?\\n\\nC\xe2u tr\u1ea3 l\u1eddi l\xe0 `compose`. Tuy nhi\xean ta kh\xf4ng th\u1ec3 compose theo c\xe1ch th\xf4ng th\u01b0\u1eddng \u0111\u01b0\u1ee3c.\\n\\nV\xed d\u1ee5 nh\u01b0:\\n\\nN\u1ebfu \u0111\u1ea7u v\xe0o v\xe0 \u0111\u1ea7u ra c\u1ee7a ta c\xf9ng interface\\n\\n```js\\nconst mul2 = (num) => num * 2;\\nconst add1 = (num) => num + 1;\\nmul2(add1(1)); // 4\\n```\\n\\nTr\u1edf l\u1ea1i h\xe0m `validateBlank` \u1edf tr\xean, n\u1ebfu ta c\xf3 nhi\u1ec1u h\xe0m `validate` kh\xe1c t\u01b0\u01a1ng t\u1ef1\\n\\n![](https://images.viblo.asia/02d95ea0-c572-481b-bb2b-d2801667e9a0.png)\\n\\nTa c\xf3 th\u1ec3 th\u1ea5y \u0111\u1ea7u v\xe0o ch\u1ec9 c\xf3 1, m\xe0 l\u1ea1i c\xf3 nh\u1eefng 2 \u0111\u1ea7u ra.\\n\\n\u0110\u1ec3 c\xf3 th\u1ec3 compose, ta s\u1ebd ph\u1ea3i bi\u1ebfn ch\xfang th\xe0nh nh\u1eefng function c\xf3 th\u1ec3 handle c\u1ea3 tr\u01b0\u1eddng h\u1ee3p `Success` l\u1eabn `Failure`.\\n\\nC\xf3 th\u1ec3 s\u1eed d\u1ee5ng HOC\\n\\n```js\\nconst transformToTwoTrackInput =\\n  (func) =>\\n  ({ data, error }) => {\\n    return data ? func(data) : { error };\\n  };\\n\\nconst twoTrackValidateNameNotBlank =\\n  transformToTwoTrackInput(validateNameNotBlank);\\nconst twoTrackValidateName50 = transformToTwoTrackInput(validateName50);\\nconst twoTrackValidateEmailNotBlank = transformToTwoTrackInput(\\n  validateEmailNotBlank\\n);\\n\\nconst user = { email: \\"\\", name: \\"\\" };\\ntwoTrackValidateEmailNotBlank(\\n  twoTrackValidateName50(twoTrackValidateNameNotBlank({ data: user }))\\n); // { error: \'name is blank\' }\\n```\\n\\nNh\u01b0 v\u1eady l\xe0 ta \u0111\xe3 k\u1ebft n\u1ed1i \u0111\u01b0\u1ee3c nh\u1eefng m\u1ea3nh gh\xe9p tr\xean v\u1edbi nhau.\\n\\n![](https://images.viblo.asia/59045ab0-2465-4163-8c25-1b7529749196.png)\\n\\n#### M\u1ed9t v\xe0i ki\u1ec3u function th\u01b0\u1eddng g\u1eb7p\\n\\n##### Single track function\\n\\nN\u1ebfu m\u1ed9t function kh\xf4ng g\xe2y ra l\u1ed7i (ch\u1ec9 c\xf3 1 \u0111\u1ea7u v\xe0o v\xe0 1 \u0111\u1ea7u ra) th\xec n\xf3 s\u1ebd kh\xf4ng th\u1ec3 n\xe0o compose \u0111\u01b0\u1ee3c v\xe0o railway c\u1ee7a ch\xfang ta.\\n\\nKhi \u0111\xf3 ta ph\u1ea3i wrap n\xf3 b\u1edfi 2-track function, gi\u1ed1ng v\u1edbi HOC \u1edf tr\xean.\\n\\n![](https://images.viblo.asia/754c4226-95b0-4b98-81dc-e64ed7842ee9.jpg)\\n\\n```js\\nconst trimEmail(user) {\\n  return {\\n    ...user,\\n    email: user.email.trim()\\n  }\\n}\\n\\nconst transformSingleTrackToTwoTrackInput = func => ({ data, error }) => {\\n  return data ? func(data) : { error }\\n}\\n\\nconst user = { email: \'  sample@email.com\' }\\ntransformSingleTrackToTwoTrackInput(trimEmail)({ data: user })\\n```\\n\\n##### Dead-end function\\n\\nDead-end function l\xe0 nh\u1eefng h\xe0m void, kh\xf4ng c\xf3 gi\xe1 tr\u1ecb tr\u1ea3 v\u1ec1\\n\\n![](https://images.viblo.asia/55f5aa49-c5c8-498f-a175-edd967b3d5c2.jpg)\\n\\nM\xe0u t\xedm ch\xednh l\xe0 n\u01a1i ta s\u1ebd \u0111\u1eb7t _dead-end function_ v\xe0o\\n\\n```js\\nconst transformDeadEndFunction =\\n  (func) =>\\n  ({ data, error }) => {\\n    if (data) {\\n      func();\\n      return { data };\\n    } else {\\n      return { error };\\n    }\\n  };\\n```\\n\\n##### Function throw Exception\\n\\nTa c\xf3 th\u1ec3 \u0111\u1eb7t try-catch \u0111\u1ec3 tr\u1ea3 v\u1ec1 Failure\\n\\n```js\\nconst transformExceptionFunction =\\n  (func) =>\\n  ({ data, error }) => {\\n    if (data) {\\n      try {\\n        func();\\n      } catch (error) {\\n        return { error: error.message || error };\\n      }\\n      return { data };\\n    } else {\\n      return { error };\\n    }\\n  };\\n```\\n\\n_Note_: Convert t\u1ea5t c\u1ea3 Exception th\xe0nh `Failure`\\n\\n#### K\u1ebft qu\u1ea3\\n\\nTa kh\xf4ng th\u1ec3 tr\u1ea3 v\u1ec1 d\u1eef li\u1ec7u ki\u1ec3u two-track cho client \u0111\u01b0\u1ee3c, v\xec v\u1eady ta s\u1ebd c\xf3 th\xeam 1 b\u01b0\u1edbc cu\u1ed1i \u0111\u1ec3 tr\u1ea3 v\u1ec1 th\xf4ng tin cho client.\\n\\n![](https://images.viblo.asia/08650333-ae3a-4fa8-b960-09c7b11fbd79.jpg)\\n\\n```js\\nfunction returnMessage({ data, error }) {\\n  return data ? JSON.stringify(data) : error.toString();\\n}\\n```\\n\\n# ROP trong m\u1ed9t s\u1ed1 ng\xf4n ng\u1eef kh\xe1c\\n\\n#### Ruby (framework Rails)\\n\\nN\u1ebfu c\xe1c b\u1ea1n s\u1eed d\u1ee5ng Rails, h\xe3y th\u1eed tr\u1ea3i nghi\u1ec7m qua gem `trailblazer`. Logic c\u1ee7a \u1ee9ng d\u1ee5ng gi\u1edd s\u1ebd t\u1eadp trung ch\u1ee7 y\u1ebfu trong c\xe1c `Operation` thay v\xec controller nh\u01b0 x\u01b0a n\u1eefa, m\xe0 nh\u1eefng operation n\xe0y \u0111\u01b0\u1ee3c vi\u1ebft theo style ROP.\\n\\n![](https://images.viblo.asia/f425b9c2-0d14-460b-8540-f289e8859972.gif)\\n\\n```ruby\\nclass Song::Create < Trailblazer::Operation\\n  step    Model(Song, :new) # init model\\n  step    :assign_current_user!\\n  step    Contract::Build(constant: SongForm) # create form object\\n  step    Contract::Validate() # validate form object\\n  failure :log_error!\\n  step    Contract::Persist() # save song to db\\n\\n  def log_error!(options)\\n    logger.debug \\"Errors occurred while creating song.\\"\\n  end\\n\\n  def assign_current_user!(options)\\n    options[\\"model\\"].created_by = options[\\"current_user\\"]\\n  end\\nend\\n```\\n\\nFlow c\u1ee7a Operation kh\xf4ng ho\xe0n to\xe0n gi\u1ed1ng v\u1edbi ROP nh\u01b0 ta \u0111\xe3 th\u1ea5y \u1edf tr\xean, m\u1ed9t khi b\u1ea1n \u0111\xe3 v\xe0o nh\xe1nh Failure, n\xf3 s\u1ebd trigger to\xe0n b\u1ed9 nh\u1eefng step handle error ph\xeda sau.\\n\\nKh\xf4ng li\xean quan l\u1eafm nh\u01b0ng trong `trailblazer` ecosystem c\xf3 kh\xe1 nhi\u1ec1u gem th\xfa v\u1ecb nh\u01b0: `reform` (form object pattern), v\xe0 `cells` (view components).\\n\\n#### Javascript\\n\\nN\u1ebfu ta \u0111\u1ec3 \xfd, `Promise` c\u1ee7a Javascript c\u0169ng kh\xe1 gi\u1ed1ng v\u1edbi ROP.\\n\\n```js\\nconst user = { username: \\"sample\\", email: \\"sample\\" };\\n\\nconst validatePresenceOfUsername = (data) => {\\n  if (!!data.username) {\\n    return user;\\n  }\\n  throw \\"Username is blank\\";\\n};\\n\\nconst validateFormatOfEmail = (data) => {\\n  if (data.email && data.email.match(/@/g)) {\\n    return user;\\n  }\\n  throw \\"Email is in invalid format\\";\\n};\\n\\nconst logError = (error) => console.error(error);\\n\\nPromise.resolve(user)\\n  .then(validatePresenceOfUsername)\\n  .then(validateFormatOfEmail)\\n  .catch(logError); // => \'Email is in invalid format\\n```\\n\\n# Tham kh\u1ea3o\\n\\nhttps://fsharpforfunandprofit.com/rop/\\n\\nhttps://fsharpforfunandprofit.com/posts/function-composition/\\n\\nhttps://dorp.io/posts/railway-oriented-programming/\\n\\nhttps://github.com/trailblazer/trailblazer\\n\\nhttp://trailblazer.to/gems/operation/2.0/api.html"},{"id":"mot-vai-mindset-khi-lam-viec-voi-react","metadata":{"permalink":"/blog/mot-vai-mindset-khi-lam-viec-voi-react","editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/blog/2019-02-16-react-mindset.md","source":"@site/blog/2019-02-16-react-mindset.md","title":"M\u1ed9t v\xe0i mindset khi l\xe0m vi\u1ec7c v\u1edbi React","description":"Ng\xe0y nay, c\xf4ng ngh\u1ec7 ng\xe0y c\xe0ng ph\xe1t tri\u1ec3n, v\xe0 th\u1ebf gi\u1edbi Web c\u0169ng v\u1eady. \u0110a s\u1ed1 web hi\u1ec7n \u0111\u1ea1i \u0111\u1ec1u \u0111\xe3 n\xf3i l\u1eddi t\u1ea1m bi\u1ec7t v\u1edbi nh\u1eefng d\xf2ng Ruby, PHP, hay Java \u0111\u01b0\u1ee3c nh\xfang trong HTML/JS. Ph\u1ea7n giao di\u1ec7n ng\u01b0\u1eddi d\xf9ng \u0111\u01b0\u1ee3c ch\xednh browser ph\xeda client x\u1eed l\xfd, thay v\xec server \xf4m h\u1ebft nh\u01b0 x\u01b0a. C\xe1c th\u01b0 vi\u1ec7n/framework nh\u01b0 React, Angular, Vue, ... \u0111\u1ec1u \u0111\xe3 tr\u1edf n\xean qu\xe1 quen thu\u1ed9c.","date":"2019-02-16T00:00:00.000Z","formattedDate":"February 16, 2019","tags":[{"label":"reactjs","permalink":"/blog/tags/reactjs"},{"label":"web","permalink":"/blog/tags/web"},{"label":"javascript","permalink":"/blog/tags/javascript"}],"readingTime":10.96,"hasTruncateMarker":false,"authors":[{"name":"L\xea S\u0129 B\xedch","title":"Ruby on Rails/React Developer","url":"https://github.com/moonlight8978","imageURL":"https://avatars.githubusercontent.com/u/26299310?v=4"}],"frontMatter":{"slug":"mot-vai-mindset-khi-lam-viec-voi-react","title":"M\u1ed9t v\xe0i mindset khi l\xe0m vi\u1ec7c v\u1edbi React","author":"L\xea S\u0129 B\xedch","author_title":"Ruby on Rails/React Developer","author_url":"https://github.com/moonlight8978","author_image_url":"https://avatars.githubusercontent.com/u/26299310?v=4","tags":["reactjs","web","javascript"]},"unlisted":false,"prevItem":{"title":"C\xf9ng t\xecm hi\u1ec3u v\u1ec1 Railway Oriented Programming","permalink":"/blog/cung-tim-hieu-ve-railway-oriented-programming"},"nextItem":{"title":"C\xf9ng t\xecm hi\u1ec3u v\u1ec1 nguy\xean t\u1eed c\u1ee7a th\u1ebf gi\u1edbi FrontEnd (Ph\u1ea7n 2 - Density-independent Pixel)","permalink":"/blog/cung-tim-hieu-ve-nguyen-tu-cua-the-gioi-front-end-phan-2-density-independent-pixel"}},"content":"Ng\xe0y nay, c\xf4ng ngh\u1ec7 ng\xe0y c\xe0ng ph\xe1t tri\u1ec3n, v\xe0 th\u1ebf gi\u1edbi Web c\u0169ng v\u1eady. \u0110a s\u1ed1 web hi\u1ec7n \u0111\u1ea1i \u0111\u1ec1u \u0111\xe3 n\xf3i l\u1eddi t\u1ea1m bi\u1ec7t v\u1edbi nh\u1eefng d\xf2ng Ruby, PHP, hay Java \u0111\u01b0\u1ee3c nh\xfang trong HTML/JS. Ph\u1ea7n giao di\u1ec7n ng\u01b0\u1eddi d\xf9ng \u0111\u01b0\u1ee3c ch\xednh browser ph\xeda client x\u1eed l\xfd, thay v\xec server \xf4m h\u1ebft nh\u01b0 x\u01b0a. C\xe1c th\u01b0 vi\u1ec7n/framework nh\u01b0 React, Angular, Vue, ... \u0111\u1ec1u \u0111\xe3 tr\u1edf n\xean qu\xe1 quen thu\u1ed9c.\\n\\nN\u1ebfu b\u1ea1n c\xf3 \xfd \u0111\u1ecbnh h\u1ecdc hay \u0111\xe3 chuy\u1ec3n sang React th\xec mong b\xe0i vi\u1ebft c\xf3 th\u1ec3 gi\xfap c\xe1c b\u1ea1n c\xf3 nh\u1eefng mindset t\u1ed1t h\u01a1n khi l\xe0m vi\u1ec7c v\u1edbi n\xf3.\\n\\n\u0110\xe2y \u0111\u1ec1u l\xe0 nh\u1eefng th\u1ee9 m\xecnh cho r\u1eb1ng c\u1ea7n quan t\xe2m sau 1 th\u1eddi gian l\xe0m vi\u1ec7c v\u1edbi React.\\n\\nB\xe0i vi\u1ebft n\xe0y kh\xf4ng n\xf3i v\u1ec1 vi\u1ec7c h\u01b0\u1edbng d\u1eabn code React.\\n\\n# Component\\n\\n### React is all about components\\n\\nReact \u0111\u01b0\u1ee3c design theo h\u01b0\u1edbng Component, m\u1ed7i ph\u1ea7n t\u1eed nh\u1ecf nh\u1ea5t nh\u01b0 th\u1ebb `<span>`, hay `<button>` \u0111\u1ec1u c\xf3 th\u1ec3 wrap th\xe0nh m\u1ed9t component \u0111\u1ec3 t\xe1i s\u1eed d\u1ee5ng 1 c\xe1ch t\u1ed1i \u0111a.\\n\\n```jsx\\n// path/to/button.jsx\\nexport function Button({ children, type, onClick }) {\\n  return (\\n    <button type=\\"button\\" className={`btn btn-${type}`} onClick={onClick}>\\n      {children}\\n    </button>\\n  );\\n}\\n```\\n\\nV\xe0 \u1edf \u0111\xe2u c\u1ea7n component n\xe0y, ta s\u1ebd import n\xf3 v\xe0o \u0111\u1ec3 s\u1eed d\u1ee5ng.\\n\\n```jsx\\nimport { Button } from \\"./path/to/button\\";\\n\\nfunction Screen() {\\n  return (\\n    <Button type=\\"primary\\" onClick={() => console.log(\\"Clicked\\")}>\\n      Click me\\n    </Button>\\n  );\\n}\\n```\\n\\nV\u1edbi nh\u1eefng ng\xf4n ng\u1eef server side truy\u1ec1n th\u1ed1ng, ta s\u1ebd vi\u1ebft nh\u01b0 sau (slim ruby):\\n\\n```slim\\n/ path/to/a.slim\\nbutton.btn.btn-primary\\n  | Button A\\n```\\n\\n```slim\\n/ path/to/b.slim\\nbutton.btn.btn-primary\\n  | Button B\\n```\\n\\nC\xf3 th\u1ec3 th\u1ea5y l\xe0 code c\u1ee7a ta tr\xf4ng s\xe1ng s\u1ee7a h\u01a1n r\u1ea5t nhi\u1ec1u.\\n\\nTr\xean th\u1ef1c t\u1ebf, ta c\u0169ng n\xean vi\u1ebft nh\u1eefng component nh\u1ecf nh\u1ea5t c\xf3 th\u1ec3 nh\u01b0 v\u1eady, n\xf3 s\u1ebd gi\xfap giao di\u1ec7n app ta \u0111\u1ed3ng b\u1ed9, v\xe0 debug c\u0169ng tr\u1edf n\xean d\u1ec5 h\u01a1n.\\n\\nHay th\u1eed v\u1edbi m\u1ed9t component ph\u1ee9c t\u1ea1p h\u01a1n h\u01a1n x\xedu:\\n\\n```jsx\\nfunction List({ items, renderItem, emptyText }) {\\n  if (items.length === 0) {\\n    return (\\n      <div>\\n        <span>{emptyText}</span>\\n      </div>\\n    );\\n  }\\n\\n  return <div>{items.map((item) => renderItem(item))}</div>;\\n}\\n```\\n\\n### C\u1ea5u tr\xfac th\u01b0 m\u1ee5c\\n\\n\u0110\u1ed1i v\u1edbi nh\u1eefng d\u1ef1 \xe1n l\u1edbn, c\xf3 m\u1ed9t c\u1ea5u tr\xfac th\u01b0 m\u1ee5c r\xf5 r\xe0ng s\u1ebd khi\u1ebfn vi\u1ec7c code tr\u1edf n\xean d\u1ec5 ch\u1ecbu h\u01a1n nhi\u1ec1u.\\n\\nL\u1ea1i quay l\u1ea1i c\xe1c ng\xf4n ng\u1eef server side MVC c\u0169 - Rails. \u0110\xe2y l\xe0 m\u1ed9t c\u1ea5u tr\xfac kh\xf3 m\xe0 c\xf3 th\u1ec3 thay \u0111\u1ed5i trong t\u1ea5t c\u1ea3 c\xe1c d\u1ef1 \xe1n:\\n\\n![](https://images.viblo.asia/70c519f5-7322-4384-a76f-caae42495028.png)\\n\\nD\xf9 v\u1edbi s\u1ef1 h\u1ed7 tr\u1ee3 c\u1ee7a c\xe1c Editor/IDE hi\u1ec7n \u0111\u1ea1i trong vi\u1ec7c t\xecm ki\u1ebfm, m\u1edf file, th\xec c\u0169ng kh\xe1 m\u1ea5t th\u1eddi gian \u0111\u1ec3 c\xf3 th\u1ec3 t\xecm \u0111\u01b0\u1ee3c nh\u1eefng file li\xean quan.\\n\\nV\u1edbi React th\xec flexible h\u01a1n, b\u1ea1n c\xf3 th\u1ec3 t\u1ed5 ch\u1ee9c theo ki\u1ec3u tr\xean (VD cho 1 project d\xf9ng Redux)\\n\\n![](https://images.viblo.asia/a6cd4317-a0e0-4990-bdbe-5eea297d9ced.png)\\n\\nNh\u01b0ng v\u1edbi m\xecnh th\xec m\xecnh th\xedch c\xe1ch t\u1ed5 ch\u1ee9c theo component/m\xe0n h\xecnh h\u01a1n.\\n\\n![](https://images.viblo.asia/f70e763d-8744-497a-9a0c-6abcfc380195.png)\\n\\nM\xecnh h\u1ecdc \u0111\u01b0\u1ee3c c\u1ea5u tr\xfac tr\xean t\u1eeb m\u1ed9t d\u1ef1 \xe1n trong list awesome react native - [Gitpoint](https://github.com/gitpoint/git-point), d\xf9 n\xf3 \u0111\u01b0\u1ee3c vi\u1ebft b\u1eb1ng React Native nh\u01b0ng b\u1ea3n ch\u1ea5t v\u1eabn l\xe0 React n\xean kh\xf4ng c\xf3 v\u1ea5n \u0111\u1ec1 g\xec h\u1ebft.\\n\\nTuy nhi\xean c\u1ea5u tr\xfac n\xe0y g\u1eb7p 1 nh\u01b0\u1ee3c \u0111i\u1ec3m \u1edf ch\u1ed7 n\u1ebfu 2 m\xe0n h\xecnh m\xe0 share nhau chung 1 state (redux) th\xec s\u1ebd g\xe2y b\u1ed1i r\u1ed1i, ho\u1eb7c l\xe0 l\u1eb7p code. V\u1edbi m\xecnh, m\xecnh ch\u1ecdn gi\u1ea3i ph\xe1p t\u1ea1o 1 th\u01b0 m\u1ee5c shared, r\u1ed3i c\u0169ng t\u1ed5 ch\u1ee9c file gi\u1ed1ng c\u1ea5u tr\xfac c\u1ee7a th\u01b0 m\u1ee5c `screens`. C\xf2n kh\xf4ng th\xec ch\u1ea5p nh\u1eadn vi\u1ec7c code b\u1ecb l\u1eb7p 1 ch\xfat.\\n\\n# Functional Programming (FP)\\n\\nN\u1ebfu nh\u01b0 Ruby, Java l\xe0 c\xe1c ng\xf4n ng\u1eef l\u1eadp tr\xecnh h\u01b0\u1edbng \u0111\u1ed1i t\u01b0\u1ee3ng (OOP) th\xec Javascript l\u1ea1i mang phong c\xe1ch l\u1eadp tr\xecnh h\xe0m, m\u1eb7c d\xf9 v\u1eabn c\xf3 class, object n\u1ebfu b\u1ea1n mu\u1ed1n d\xf9ng (Prototype)\\n\\nV\u1edbi OOP, ta th\u01b0\u1eddng xuy\xean thay \u0111\u1ed5i tr\u1ea1ng th\xe1i (c\xe1c bi\u1ebfn instance) c\u1ee7a object, nh\u01b0ng FP l\u1ea1i kh\xf4ng th\xedch \u0111i\u1ec1u n\xe0y, m\xe0 th\u01b0\u1eddng h\u01b0\u1edbng t\u1edbi t\xednh b\u1ea5t bi\u1ebfn (Immutability) v\xe0 pure function. Ta h\xe3y c\u0169ng t\xecm hi\u1ec3u th\xeam v\u1ec1 ch\xfang\\n\\n### Pure Functions\\n\\nL\u1ea5y v\xed d\u1ee5 v\u1edbi vi\u1ec7c c\u1ed9ng 2 s\u1ed1 t\u1ef1 nhi\xean\\n\\n```js\\nconst z = 10;\\nconst add = (x, y) => x + y;\\nadd(1, 2); // 3\\nadd(1, 3); // 4\\n```\\n\\nH\xe0m `add` nh\u1eadn 2 tham s\u1ed1 `x` v\xe0 `y`, n\xf3 ch\u1ec9 s\u1eed d\u1ee5ng 2 tham s\u1ed1 \u0111\u1ea7u v\xe0o n\xe0y \u0111\u1ec3 th\u1ef1c hi\u1ec7n ph\xe9p t\xednh, m\xe0 kh\xf4ng s\u1eed d\u1ee5ng/l\xe0m thay \u0111\u1ed5i c\xe1c bi\u1ebfn ngo\xe0i ph\u1ea1m vi h\xe0m.\\n\\nH\u01a1n n\u1eefa n\xf3 lu\xf4n tr\u1ea3 v\u1ec1 c\xf9ng 1 gi\xe1 tr\u1ecb n\u1ebfu nh\u01b0 tham s\u1ed1 \u0111\u1ea7u v\xe0o kh\xf4ng thay \u0111\u1ed5i.\\n\\nC\xf2n xem h\xe0m d\u01b0\u1edbi \u0111\xe2y\\n\\n```js\\nconst bonus = 5;\\nconst add = (x, y) => x + y + bonus;\\nadd(1, 2); // 3\\nadd(1, 2); // 3\\n```\\n\\nD\xf9 lu\xf4n tr\u1ea3 v\u1ec1 m\u1ed9t gi\xe1 tr\u1ecb v\u1edbi c\xf9ng tham s\u1ed1, tuy nhi\xean h\xe0m l\u1ea1i ph\u1ee5 thu\u1ed9c v\xe0o bi\u1ebfn `bonus` (external variable) n\xean \u0111\xe2y \u0111\u01b0\u1ee3c xem l\xe0 1 impure function.\\n\\nNgo\xe0i ra impure function c\u0169ng g\xe2y ra c\xe1c side effects nh\u01b0 c\xe1c h\xe0m sau:\\n\\n- G\u1ecdi HTTP request\\n- Ghi d\u1eef li\u1ec7u\\n- `Math.random()`, `new Date()`\\n- ....\\n\\nGi\xe1 tr\u1ecb tr\u1ea3 v\u1ec1 c\u1ee7a ch\xfang kh\xf4ng ph\u1ea3i l\xfac n\xe0o c\u0169ng gi\u1ed1ng nhau, \u0111i\u1ec1u \u0111\xf3 khi\u1ebfn k\u1ebft qu\u1ea3 c\u1ee7a h\xe0m kh\xf3 m\xe0 l\u01b0\u1eddng tr\u01b0\u1edbc \u0111\u01b0\u1ee3c, khi test ta th\u01b0\u1eddng ph\u1ea3i mock 1 gi\xe1 tr\u1ecb c\u1ed1 \u0111\u1ecbnh.\\n\\nPure function s\u1ebd gi\xfap app ch\xfang ta \xedt l\u1ed7i h\u01a1n, ngo\xe0i ra c\u0169ng d\u1ec5 d\xe0ng test h\u01a1n.\\n\\nTrong React, n\xf3i \u0111\u1ebfn pure function ta th\u01b0\u1eddng ngh\u0129 \u0111\u1ebfn stateless component - Functional Component, n\xf3 s\u1ebd ch\u1ec9 s\u1eed d\u1ee5ng props \u0111\u1ec3 t\xednh to\xe1n v\xe0 render d\u1ef1a tr\xean nh\u1eefng props \u0111\xf3. Tuy nhi\xean nh\u1eefng update g\u1ea7n \u0111\xe2y \u0111\xe3 th\xeam [Hook](https://reactjs.org/docs/hooks-intro.html), n\xf3 l\xe0m cho Functional Component c\u0169ng c\xf3 th\u1ec3 c\xf3 state. C\xe1 nh\xe2n m\xecnh kh\xf4ng th\xedch c\xe1i Hook n\xe0y l\u1eafm.\\n\\nNh\u01b0ng app c\u1ee7a ta kh\xf4ng ch\u1ec9 to\xe0n pure function \u0111\u01b0\u1ee3c, s\u1ebd ph\u1ea3i c\xf3 nh\u1eefng h\xe0m g\u1ecdi API, thay \u0111\u1ed5i state, l\u1ea5y state \u0111\u1ec3 t\xednh to\xe1n, l\u01b0u d\u1eef li\u1ec7u v\xe0o localStorage, ... nh\u01b0ng h\xe3y c\u1ed1 g\u1eafng gi\u1ea3m thi\u1ec3u s\u1ed1 l\u01b0\u1ee3ng side effects xu\u1ed1ng th\u1ea5p nh\u1ea5t c\xf3 th\u1ec3.\\n\\n### Immutability\\n\\nM\u1ed9t \u0111i\u1ec1u quan tr\u1ecdng n\u1eefa l\xe0 t\xednh b\u1ea5t bi\u1ebfn.\\n\\nFunctional programming n\xf3i chung v\xe0 React n\xf3i ri\xeang, ta th\u01b0\u1eddng tr\xe1nh vi\u1ec7c s\u1eeda tr\u1ef1c ti\u1ebfp 1 bi\u1ebfn n\xe0o \u0111\xf3, hay state. Thay v\xe0o \u0111\xf3, ta s\u1ebd t\u1ea1o 1 bi\u1ebfn m\u1edbi.\\n\\n```js\\nconst person = {\\n  age: 12,\\n};\\nperson.name = \\"Name\\";\\n\\nlet array = [1, 2, 3];\\narray.push(4);\\n```\\n\\nN\u1ebfu trong d\u1ef1 \xe1n c\u1ee7a b\u1ea1n c\xf3 nh\u1eefng d\xf2ng code nh\u01b0 tr\xean, th\xec code b\u1ea1n \u0111\xe3 m\u1ea5t t\xednh b\u1ea5t bi\u1ebfn.\\nThay v\xec tr\u1ef1c ti\u1ebfp ch\u1ec9nh s\u1eeda 1 bi\u1ebfn nh\u01b0 v\u1eady. Ta n\xean t\u1ea1o 1 bi\u1ebfn m\u1edbi v\u1edbi nh\u1eefng gi\xe1 tr\u1ecb c\u0169, sau \u0111\xf3 th\xeam gi\xe1 tr\u1ecb m\u1edbi v\xe0o.\\n\\n```js\\nconst updatedPerson = {\\n  age: person.age,\\n  name: \\"Name\\",\\n};\\n// hay\\nconst updatedPerson = {\\n  ...person,\\n  name: \\"Name\\",\\n};\\n```\\n\\nD\u1ec5 d\xe0ng nh\u1eadn th\u1ea5y `updatedPerson.age` v\u1eabn tham chi\u1ebfu \u0111\u1ebfn gi\xe1 tr\u1ecb c\u0169 c\u1ee7a `person.name`, tuy nhi\xean ta s\u1eed d\u1ee5ng bi\u1ebfn `updatedPerson` n\xe0y th\u1ebf n\xe0o \u0111i n\u1eefa, th\xec c\u0169ng s\u1ebd kh\xf4ng \u1ea3nh h\u01b0\u1edfng \u0111\u1ebfn gi\xe1 tr\u1ecb c\u1ee7a `person`\\n\\nNh\u01b0ng t\u1ea1i sao l\u1ea1i ph\u1ea3i l\xe0m v\u1eady? Th\u1eed x\xe9t 1 v\xf2ng l\u1eb7p \u0111\u01a1n gi\u1ea3n nh\u01b0:\\n\\n```js\\nlet s = 0;\\nlet index = 0;\\nfor (index = 0; index < data.length; index++) {\\n  s += data[index];\\n}\\n```\\n\\nGi\u1ea3 s\u1eed \u0111ang trong qu\xe1 tr\xecnh l\u1eb7p, thi `data[n]` b\u1ecb thay \u0111\u1ed5i, ch\u1eb3ng ph\u1ea3i `s += data[index]` s\u1ebd sai lu\xf4n hay sao.\\n\\nC\xf2n trong React, ta c\xf3 `React.PureComponent` n\xf3 s\u1ebd shallow compare props v\xe0 state \u0111\u1ec3 quy\u1ebft \u0111\u1ecbnh xem c\xf3 update component hay kh\xf4ng.\\n\\n```jsx\\nexport class SampleComponent extends React.PureComponent {\\n  state = {\\n    filter: {\\n      name: \\"A name\\",\\n      age: 21,\\n    },\\n  };\\n\\n  //  shouldComponentUpdate(nextProps, nextState) {\\n  //\\t  return shallowCompare(this, nextProps, nextState)\\n  // \\t}\\n\\n  handleClick = () => (this.state.filter.name = \\"New name\\");\\n\\n  render() {\\n    return (\\n      <div>\\n        <h3>{this.state.filter.name}</h3>\\n        <button onClick={this.handleClick}>Click me</button>\\n      </div>\\n    );\\n  }\\n}\\n```\\n\\n`React.PureComponent` \u0111\xe3 \u0111\u1ecbnh ngh\u0129a s\u1eb5n cho ta ph\u01b0\u01a1ng th\u1ee9c `shouldComponentUpdate` nh\u01b0 ph\u1ea7n m\xecnh comment.\\n\\nH\xe0m `shallowCompare` ch\u1ec9 \u0111\u01a1n thu\u1ea7n l\u1eb7p t\u1ea5t c\u1ea3 c\xe1c key c\xf3 trong props v\xe0 state, so s\xe1nh v\u1edbi state/props c\u0169.\\n\\nN\xf3 s\u1ebd th\u1ef1c hi\u1ec7n vi\u1ec7c so s\xe1nh `currentState.filter === nextState.filter` (so s\xe1nh b\u1eb1ng tham chi\u1ebfu).\\n\\nVi\u1ec7c n\xe0y c\xf3 l\u1ee3i h\u01a1n r\u1ea5t nhi\u1ec1u so v\u1edbi vi\u1ec7c deep compare t\u1ea5t c\u1ea3 c\xe1c gi\xe1 tr\u1ecb trong filter (c\u1ea3 v\u1ec1 th\u1eddi gian l\u1eabn \u0111\u1ed9 ph\u1ee9c t\u1ea1p).\\n\\nTuy nhi\xean, khi ch\xfang ta tr\u1ef1c ti\u1ebfp ch\u1ec9nh s\u1eeda `this.state.filter.name = \'New name\'`, s\u1ebd khi\u1ebfn filter kh\xf4ng h\u1ec1 thay \u0111\u1ed5i v\u1ec1 tham chi\u1ebfu. Khi \u0111\xf3:\\n\\n```js\\ncurrentState.filter === nextState.filter; // true\\ncurrentState.filter.name === nextState.filter.name; // false\\n```\\n\\nv\xe0 `SampleComponent` c\u1ee7a ta c\u0169ng s\u1ebd kh\xf4ng re-render, cho d\xf9 b\u1ea1n c\xf3 click \u0111\u1ebfn sang n\u0103m.\\n\\n![](https://images.viblo.asia/ecee315c-f2a5-4eb6-a290-af2c100a8724.png)\\n\\nThay v\xe0o \u0111\xf3 ta s\u1ebd l\xe0m nh\u01b0 sau\\n\\n```js\\nhandleClick = () => {\\n  this.setState({ filter: { ...this.state.filter, name: \\"New name\\" } });\\n};\\n```\\n\\nTa copy to\xe0n b\u1ed9 tham chi\u1ebfu c\xe1c attribute c\u1ee7a `state.filter` c\u0169 sang 1 object m\u1edbi, v\xe0 sau \u0111\xf3 thay \u0111\u1ed5i bi\u1ebfn `name` c\u1ee7a object m\u1edbi n\xe0y, ta kh\xf4ng h\u1ec1 l\xe0m thay \u0111\u1ed5i `state.filter` c\u0169.\\n\\nKhi \u0111\xf3 `currentState.filter === nextState.filter` s\u1ebd tr\u1ea3 v\u1ec1 `false`. `SampleComponent` c\u1ee7a ta \u0111\u01b0\u1ee3c re-render l\u1ea1i. V\xe0 n\u1ebfu c\xf3 action n\xe0o kh\xf4ng l\xe0m thay \u0111\u1ed5i `state`, component c\u1ee7a ta c\u0169ng s\u1ebd kh\xf4ng re-render. V\u1eady l\xe0 c\u1ea3 React v\xe0 ta \u0111\u1ec1u happy - _m\u1ed9t ng\u01b0\u1eddi kh\u1ecfe, 2 ng\u01b0\u1eddi vui :v_\\n\\n### Higher-Order Functions (HOF)\\n\\n> HOF nh\u1eadn tham s\u1ed1 l\xe0 h\xe0m, ho\u1eb7c tr\u1ea3 v\u1ec1 m\u1ed9t h\xe0m kh\xe1c, ho\u1eb7c l\xe0 c\u1ea3 2.\\n\\nVD 1 h\xe0m nh\u1eadn tham s\u1ed1 h\xe0m:\\n\\n```js\\nconst name = \\"React\\";\\nconst phoneNumber = \\"0969696969\\";\\nconst numberValidator = (str) => str.match(/\\\\d+/g);\\nconst validate = (value, validator) => !!validator(value);\\n\\nvalidate(name, numberValidator); // false\\nvalidate(phoneNumber, numberValidator); // false\\n```\\n\\nHay 1 h\xe0m tr\u1ea3 v\u1ec1 1 h\xe0m:\\n\\n```js\\nfunction makeAdder(constantValue) {\\n  return function adder(value) {\\n    return constantValue + value;\\n  };\\n}\\n```\\n\\nta g\u1ecdi h\xe0m n\xe0y nh\u01b0 sau: `makeAdder(10)(20)`\\n\\nTho\u1ea1t nh\xecn c\xf3 v\u1ebb s\u1ee3, nh\u01b0ng n\u1ebfu vi\u1ebft minh b\u1ea1ch ra\\n\\n```js\\nconst add10 = makeAdder(10);\\nadd10(20); // 30\\n```\\n\\nM\u1ecdi th\u1ee9 tr\u1edf n\xean r\xf5 r\xe0ng h\u01a1n nhi\u1ec1u, `makerAdder(10)` tr\u1ea3 v\u1ec1 m\u1ed9t h\xe0m, sau \u0111\xf3 ta g\u1ecdi h\xe0m n\xe0y v\u1edbi tham s\u1ed1 l\xe0 20\\n\\n```js\\nconst add10 = makeAdder(10);\\n// add10 = function adder(value) {\\n//\\t return 10 + value\\n// }\\nadd10(20);\\n```\\n\\nTrong React, ta c\u0169ng th\u01b0\u1eddng xuy\xean \xe1p d\u1ee5ng k\u1ef9 thu\u1eadt n\xe0y, tuy nhi\xean ngo\xe0i HOF, th\xec ta c\xf2n c\xf3 Higher-Order Component (HOC), nh\u1eb1m ch\u1ec9 nh\u1eefng h\xe0m nh\u1eadn v\xe0o tham s\u1ed1 l\xe0 1 Component v\xe0 tr\u1ea3 v\u1ec1 1 Component kh\xe1c.\\n\\nVD:\\n\\n```jsx\\nfunction protectRoute(Component, requiredRole) {\\n  return function ProtectedRoute(props) {\\n    const currentRole = localStorage.getItem(\\"role\\");\\n    if (currentRole < requiredRole) {\\n      return <Redirect to=\\"/sign_in\\" />;\\n    }\\n    return <Component {...props} />;\\n  };\\n}\\n```\\n\\n### Declarative Programming\\n\\nTa c\xf3 2 thi\xean h\u01b0\u1edbng l\u1eadp tr\xecnh \u0111\u1ed1i l\u1eadp nhau, \u0111\xf3 l\xe0:\\n\\n- Imperative Programming: m\xf4 t\u1ea3 control flow c\u1ee7a vi\u1ec7c c\u1ea7n l\xe0m\\n- Declarative Programming: ch\u1ec9 vi\u1ebft ra nh\u1eefng g\xec c\u1ea7n l\xe0m m\xe0 kh\xf4ng m\xf4 t\u1ea3 r\xf5 control flow c\u1ee7a t\u1eebng b\u01b0\u1edbc.\\n\\nVD ti\xeau bi\u1ec3u \u0111\xf3 l\xe0 1 v\xf2ng l\u1eb7p c\u01a1 b\u1ea3n:\\n\\nStyle Imperative:\\n\\n```js\\nconst arr = [1, 2];\\nconst newArr = [];\\nfor (let i = 0; i < arr.length; i += 1) {\\n  newArr.push(arr[i] + 1);\\n}\\nconsole.log(newArr); // [2, 3]\\n```\\n\\nV\u1edbi style n\xe0y, b\u1ea1n n\xeau l\u1ea7n l\u01b0\u1ee3t t\u1eebng b\u01b0\u1edbc code b\u1ea1n th\u1ef1c hi\u1ec7n nh\u01b0 th\u1ebf n\xe0o, ta ph\u1ea3i \u0111i s\xe2u v\xe0o implementation h\u01a1n.\\n\\nTrong khi \u0111\xf3 v\u1edbi Declarative:\\n\\n```js\\nconst arr = [1, 2];\\nconst newArr = arr.map((element) => element + 1); // [2, 3]\\n```\\n\\nTa s\u1ebd ch\u1ec9 n\xf3i r\u1eb1ng ta c\u1ea7n 1 m\u1ea3ng m\u1edbi t\u1eeb arr, m\xe0 m\u1ed7i ph\u1ea7n t\u1eed c\u1ee7a n\xf3 t\u0103ng l\xean 1. Code c\u1ee7a ta v\u1eeba d\u1ec5 hi\u1ec3u v\xe0 v\u1eeba \u0111\u1eb9p h\u01a1n.\\n\\nM\u1ed9t s\u1ed1 ng\xf4n ng\u1eef ti\xeau bi\u1ec3u:\\n\\n- Imperative: C/C++, Java, ...\\n- Declarative: SQL, HTML, ...\\n- T\u1ea1p ph\u1ebf l\xf9: Javascript =)), ...\\n\\n\u1ede tr\xean l\xe0 nh\u1eefng g\xec m\xecnh search \u0111\u01b0\u1ee3c tr\xean google khi b\u1eaft \u0111\u1ea7u t\xecm hi\u1ec3u v\u1ec1 Declarative Programming. Tuy nhi\xean, v\u1eabn kh\xe1 l\xe0 kh\xf3 hi\u1ec3u, v\xe0 kh\xf3 ph\xe2n bi\u1ec7t gi\u1eefa 2 th\u1eb1ng Imperative v\xe0 Declarative\\n\\nTuy nhi\xean khi \u0111\u1ecdc \u0111\u01b0\u1ee3c comment [n\xe0y](https://stackoverflow.com/questions/1784664/what-is-the-difference-between-declarative-and-imperative-programming#comment29365241_1784702), m\u1ecdi th\u1ee9 \u0111\xe3 tr\u1edf n\xean s\xe1ng s\u1ee7a h\u01a1n nhi\u1ec1u. M\xecnh coi n\xf3 l\xe0 1 l\u1edbp abstract, m\xe0 khi g\u1ecdi h\xe0m \u0111\xf3, ta ch\u1ec9 c\u1ea7n quan t\xe2m \u0111\u1ebfn _what to do_ m\xe0 kh\xf4ng ph\u1ea3i ngh\u0129 xem _how to do_.\\n\\nH\xe3y s\u1eed d\u1ee5ng c\xe1c h\xe0m c\xf3 s\u1eb5n c\u1ee7a javascript nh\u01b0: `.map`, `.reduce`, `.filter`, ... v\xe0 b\u1ea1n s\u1ebd nh\u1eadn th\u1ea5y \u0111\u01b0\u1ee3c v\u1ebb \u0111\u1eb9p c\u1ee7a Declarative Programming.\\n\\nQuay tr\u1edf l\u1ea1i v\u1edbi React, v\u1eady th\xec t\xednh Declarative c\u1ee7a n\xf3 \u1edf \u0111\xe2u?\\n\\nCh\xednh b\u1ea3n th\xe2n c\xe1c component React \u0111\xe3 r\u1ea5t \'declarative\' r\u1ed3i.\\n\\nH\xe3y \u0111\u1ecdc ph\u1ea7n description c\u1ee7a React tr\xean [Github](https://github.com/facebook/react)\\n\\n> A declarative, efficient, and flexible JavaScript library for building user interfaces.\\n\\nTh\u1eed so s\xe1nh 2 \u0111o\u1ea1n m\xe3 sau:\\n\\n```js\\n// jQuery\\n$(\\".like\\").click(function () {\\n  const $btn = $(this);\\n  if ($btn.hasClass(\\"liked\\")) {\\n    $btn.removeClass(\\"liked\\");\\n  } else {\\n    $btn.addClass(\\"liked\\");\\n  }\\n});\\n```\\n\\n```jsx\\n// React\\nclass LikeButton extends React.Component {\\n  // ...codes\\n  render() {\\n    if (this.state.liked) {\\n      return <HighlightButton>Like</HighlightButton>;\\n    }\\n    return <Button>Like</Button>;\\n  }\\n}\\n```\\n\\nV\u1edbi jQuery, ta ph\u1ea3i m\xf4 t\u1ea3 ch\xednh x\xe1c code ta c\u1ea7n l\xe0m g\xec.\\n\\nTrong khi \u0111\xf3 v\u1edbi React: _Ti\u1ec3u nh\u1ecb, like r\u1ed3i th\xec cho c\xe1i `HightlightButton` ra \u0111\xe2y, kh\xf4ng th\xec `Button` th\u01b0\u1eddng th\xf4i._\\n\\nTa s\u1ebd quan t\xe2m \u0111\u1ebfn vi\u1ec7c component c\u1ea7n hi\u1ec3n th\u1ecb c\xe1i g\xec t\u01b0\u01a1ng \u1ee9ng v\u1edbi m\u1ed7i (props/state) c\u1ee7a n\xf3.\\n\\n# Link tham kh\u1ea3o\\n\\nhttps://github.com/facebook/react\\n\\nhttps://github.com/jondot/awesome-react-native\\n\\nhttps://github.com/gitpoint/git-point\\n\\nhttps://medium.freecodecamp.org/all-the-fundamental-react-js-concepts-jammed-into-this-single-medium-article-c83f9b53eac2?gi=7fb0830efbd4\\n\\nhttps://medium.com/@cscalfani/so-you-want-to-be-a-functional-programmer-part-1-1f15e387e536\\n\\nhttps://www.miles.no/blogg/tema/teknisk/why-care-about-functional-programming-part-1-immutability\\n\\nhttps://blog.logrocket.com/immutability-in-react-ebe55253a1cc\\n\\nhttps://stackoverflow.com/questions/1784664/what-is-the-difference-between-declarative-and-imperative-programming#comment29365241_1784702"},{"id":"cung-tim-hieu-ve-nguyen-tu-cua-the-gioi-front-end-phan-2-density-independent-pixel","metadata":{"permalink":"/blog/cung-tim-hieu-ve-nguyen-tu-cua-the-gioi-front-end-phan-2-density-independent-pixel","editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/blog/2018-11-25-density-independent-pixel.md","source":"@site/blog/2018-11-25-density-independent-pixel.md","title":"C\xf9ng t\xecm hi\u1ec3u v\u1ec1 nguy\xean t\u1eed c\u1ee7a th\u1ebf gi\u1edbi FrontEnd (Ph\u1ea7n 2 - Density-independent Pixel)","description":"\u1ede k\xec tr\u01b0\u1edbc, ta \u0111\xe3 c\xf9ng nhau t\xecm hi\u1ec3u v\u1ec1 Pixel c\u1ee7a CSS, \u0111\xf3 l\xe0 1 \u0111\u01a1n v\u1ecb \u0111\u1ed9c l\u1eadp, kh\xf4ng b\u1ecb ph\u1ee5 thu\u1ed9c v\xe0o \u0111\u1ed9 ph\xe2n gi\u1ea3i hay c\xe1c th\xf4ng s\u1ed1 kh\xe1c c\u1ee7a m\xe0n h\xecnh. \u0110\u1ed1i v\u1edbi m\u1ed9t lo\u1ea1i m\xe0n h\xecnh (x\xe9t theo kho\u1ea3ng c\xe1ch t\u1eeb m\u1eaft t\u1edbi m\xe0n h\xecnh), n\xf3 lu\xf4n l\xe0 1 h\u1eb1ng s\u1ed1 kh\xf4ng \u0111\u1ed5i. \u0110i\u1ec1u \u0111\xf3 \u0111\xe3 gi\xfap cho l\u1eadp tr\xecnh vi\xean Web d\u1ec5 th\u1edf h\u01a1n r\u1ea5t nhi\u1ec1u.","date":"2018-11-25T00:00:00.000Z","formattedDate":"November 25, 2018","tags":[{"label":"frontend","permalink":"/blog/tags/frontend"},{"label":"android","permalink":"/blog/tags/android"}],"readingTime":8.19,"hasTruncateMarker":false,"authors":[{"name":"L\xea S\u0129 B\xedch","title":"Ruby on Rails/React Developer","url":"https://github.com/moonlight8978","imageURL":"https://avatars.githubusercontent.com/u/26299310?v=4"}],"frontMatter":{"slug":"cung-tim-hieu-ve-nguyen-tu-cua-the-gioi-front-end-phan-2-density-independent-pixel","title":"C\xf9ng t\xecm hi\u1ec3u v\u1ec1 nguy\xean t\u1eed c\u1ee7a th\u1ebf gi\u1edbi FrontEnd (Ph\u1ea7n 2 - Density-independent Pixel)","author":"L\xea S\u0129 B\xedch","author_title":"Ruby on Rails/React Developer","author_url":"https://github.com/moonlight8978","author_image_url":"https://avatars.githubusercontent.com/u/26299310?v=4","tags":["frontend","android"]},"unlisted":false,"prevItem":{"title":"M\u1ed9t v\xe0i mindset khi l\xe0m vi\u1ec7c v\u1edbi React","permalink":"/blog/mot-vai-mindset-khi-lam-viec-voi-react"},"nextItem":{"title":"C\xf9ng t\xecm hi\u1ec3u v\u1ec1 nguy\xean t\u1eed c\u1ee7a th\u1ebf gi\u1edbi FrontEnd (Ph\u1ea7n 1 - Pixel)","permalink":"/blog/cung-tim-hieu-ve-nguyen-tu-cua-the-gioi-front-end-phan-1-pixel"}},"content":"[\u1ede k\xec tr\u01b0\u1edbc](https://viblo.asia/p/cung-tim-hieu-ve-nguyen-tu-cua-the-gioi-front-end-phan-1-pixel-4P856PoOZY3), ta \u0111\xe3 c\xf9ng nhau t\xecm hi\u1ec3u v\u1ec1 Pixel c\u1ee7a CSS, \u0111\xf3 l\xe0 1 \u0111\u01a1n v\u1ecb \u0111\u1ed9c l\u1eadp, kh\xf4ng b\u1ecb ph\u1ee5 thu\u1ed9c v\xe0o \u0111\u1ed9 ph\xe2n gi\u1ea3i hay c\xe1c th\xf4ng s\u1ed1 kh\xe1c c\u1ee7a m\xe0n h\xecnh. \u0110\u1ed1i v\u1edbi m\u1ed9t lo\u1ea1i m\xe0n h\xecnh (x\xe9t theo kho\u1ea3ng c\xe1ch t\u1eeb m\u1eaft t\u1edbi m\xe0n h\xecnh), n\xf3 lu\xf4n l\xe0 1 h\u1eb1ng s\u1ed1 kh\xf4ng \u0111\u1ed5i. \u0110i\u1ec1u \u0111\xf3 \u0111\xe3 gi\xfap cho l\u1eadp tr\xecnh vi\xean Web d\u1ec5 th\u1edf h\u01a1n r\u1ea5t nhi\u1ec1u.\\n\\n\u1ede Android c\u0169ng c\xf3 m\u1ed9t \u0111\u01a1n v\u1ecb gi\u1ed1ng nh\u01b0 v\u1eady, Google \u0111\u1eb7t t\xean cho n\xf3 l\xe0 DP (hay DIP - Density Independent Pixel). Ngo\xe0i ra \u0111\u01a1n v\u1ecb n\xe0y c\xf2n d\xf9ng trong React Native [[link]](https://facebook.github.io/react-native/docs/height-and-width.html#fixed-dimensions)\\n\\n# 2. M\u1ed9t s\u1ed1 kh\xe1i ni\u1ec7m c\u1ea7n nh\u1eafc l\u1ea1i\\n\\n#### Pixel thi\u1ebft b\u1ecb:\\n\\nL\xe0 1 \u0111i\u1ec3m \u1ea3nh, n\xf3 ph\u1ee5 thu\u1ed9c v\xe0o k\xedch th\u01b0\u1edbc m\xe0n h\xecnh, v\xe0 \u0111\u1ed9 ph\xe2n gi\u1ea3i m\xe0n h\xecnh. Th\xf4ng th\u01b0\u1eddng, 1px thi\u1ebft b\u1ecb tr\xean c\xe1c m\xe0n h\xecnh \u0111\u1ec1u c\xf3 gi\xe1 tr\u1ecb kh\xe1c nhau.\\n\\nPixel n\xe0y l\xe0 pixel v\u1eadt l\xfd c\u1ee7a thi\u1ebft b\u1ecb kh\xe1c ho\xe0n to\xe0n so v\u1edbi \u0111\u01a1n v\u1ecb px m\xe0 ta hay s\u1eed d\u1ee5ng trong CSS.\\n\\n#### \u0110\u1ed9 ph\xe2n gi\u1ea3i thi\u1ebft b\u1ecb - Resolution:\\n\\nC\xe1c b\u1ea1n th\u01b0\u1eddng th\u1ea5y m\xe0n h\xecnh c\xf3 \u0111\u1ed9 ph\xe2n gi\u1ea3i 4k, HD, FullHD, k\xe8m theo n\xf3 l\xe0 2 con s\u1ed1 c\xf3 d\u1ea1ng P1xP2 ph\u1ea3i kh\xf4ng n\xe0o?\\n\\nNh\u1eefng con s\u1ed1 n\xe0y th\u1ec3 hi\u1ec7n s\u1ed1 pixel c\xf3 tr\xean m\xe0n h\xecnh, P1 l\xe0 s\u1ed1 pixel ph\xe2n b\u1ed1 theo chi\u1ec1u d\xe0i, c\xf2n P2 l\xe0 theo chi\u1ec1u r\u1ed9ng.\\n\\n![](https://images.viblo.asia/d4b0da95-f9d9-44ff-92e9-71931821321a.jpg)\\n\\n(_\u1ea3nh ch\u1ec9 mang t\xednh ch\u1ea5t minh h\u1ecda, m\xecnh k ph\u1ea3i seeder \u0111\xe2u nh\xe1 =))_)\\n\\nTV tr\xean c\xf3 chi\u1ec1u d\xe0i 52.4 inch, c\xf3 3840px theo chi\u1ec1u ngang. 1px s\u1ebd c\xf3 gi\xe1 tr\u1ecb\\n\\n`1px = 52.4 / 3840 = 0.01365 (inch)`\\n\\n#### DPI, PPI:\\n\\nDPI - **Dots Per Inch**. PPI - **Points Per Inch**\\n\\nCh\xfang \u0111\u1ec1u l\xe0 s\u1ed1 pixel/\u0111i\u1ec3m \u1ea3nh c\xf3 tr\xean 1 inch \u0111\u1ed9 d\xe0i v\u1eadt l\xfd c\u1ee7a thi\u1ebft b\u1ecb, bi\u1ec3u th\u1ecb m\u1eadt \u0111\u1ed9 pixel tr\xean m\xe0n h\xecnh.\\n\\nDPI th\u1ea5p, 1px c\xf3 k\xedch th\u01b0\u1edbc l\u1edbn, h\xecnh \u1ea3nh c\xf3 th\u1ec3 s\u1ebd b\u1ecb r\u0103ng c\u01b0a, kh\xf4ng s\u1eafc n\xe9t b\u1eb1ng DPI cao\\n\\n![](https://images.viblo.asia/1e74f9f2-8d4e-407c-9023-9f4d248598cf.jpg)\\n\\nL\u1ea5y l\u1ea1i VD m\xe0n h\xecnh TV tr\xean:\\n\\n`DPI = 3840 / 52.4 = 73.28 (pixels/inch)`\\n\\n# 3. Density Independent Pixels\\n\\n### 3.1 \u0110\u1eb7t v\u1ea5n \u0111\u1ec1\\n\\nC\xe1c \u0111i\u1ec7n tho\u1ea1i Android c\xf3 nhi\u1ec1u lo\u1ea1i k\xedch th\u01b0\u1edbc (phone, tablet, TV, ...), h\u01a1n n\u1eefa ch\xfang l\u1ea1i c\xf2n c\xf3 \u0111\u1ed9 ph\xe2n gi\u1ea3i kh\xe1c nhau, d\u1eabn \u0111\u1ebfn k\xedch th\u01b0\u1edbc pixel lu\xf4n thay \u0111\u1ed5i, g\xe2y kh\xf3 kh\u0103n cho nh\xe0 ph\xe1t tri\u1ec3n khi d\u1ef1ng giao di\u1ec7n.\\n\\nL\u1ea5y v\xed d\u1ee5 \u0111\u01a1n gi\u1ea3n nh\u1ea5t v\u1ec1 2 \u0111i\u1ec7n tho\u1ea1i c\xf3 c\xf9ng k\xedch th\u01b0\u1edbc \u0111\u01b0\u1eddng ch\xe9o 5inch, nh\u01b0ng 1 chi\u1ebfc FullHD 1080x1920, 1 chi\u1ebfc 4K 2160 x 3840.\\n\\nN\u1ebfu b\u1ea1n l\xe0 dev, b\u1ea1n s\u1ebd mu\u1ed1n 1 button trong app c\u1ee7a m\xecnh hi\u1ec3n th\u1ecb tr\xean 2 \u0111i\u1ec7n tho\u1ea1i n\xe0y gi\u1ed1ng nhau ph\u1ea3i kh\xf4ng n\xe0o?\\n\\nTh\u1ebf nh\u01b0ng n\u1ebfu l\xe0m vi\u1ec7c v\u1edbi px thi\u1ebft b\u1ecb, ta s\u1ebd g\u1eb7p 1 ch\xfat r\u1eafc r\u1ed1i v\xec v\u1edbi c\xf9ng 1 k\xedch th\u01b0\u1edbc, \u0111i\u1ec7n tho\u1ea1i 4K lu\xf4n c\u1ea7n g\u1ea5p \u0111\xf4i s\u1ed1 px so v\u1edbi FullHD.\\n\\n![](https://images.viblo.asia/4b56fc09-40ee-4f95-b7fc-8409b2961e99.jpg)\\n\\n2 c\xe1i \u0111\xe3 m\u1ec7t, tr\xean th\u1ef1c t\u1ebf, ta c\xf3 ty t\u1ef7 lo\u1ea1i m\xe0n h\xecnh, v\u1eady th\xec style sao cho xu\u1ec3, ch\u01b0a k\u1ec3 c\xf2n \u0111\u1ebfn t\u1ed1i \u01b0u c\xe1c file \u1ea3nh cho app.\\n\\nCh\xednh v\xec v\u1eady, `dp` ra \u0111\u1eddi.\\n\\n### 3.2. DP\\n\\nGoogle \u0111\u1ecbnh ngh\u0129a n\xf3 nh\u01b0 sau:\\n\\n> One dp is a virtual pixel unit that\'s roughly equal to one pixel on a medium-density screen (160dpi; the \\"baseline\\" density). Android translates this value to the appropriate number of real pixels for each other density.\\n\\nN\u1ebfu b\u1ea1n \u0111\xe3 \u0111\u1ecdc b\xe0i tr\u01b0\u1edbc c\u1ee7a m\xecnh v\u1ec1 CSS pixel, th\xec c\xf3 th\u1ec3 th\u1ea5y n\xf3 kh\xe1 quen thu\u1ed9c ph\u1ea3i kh\xf4ng n\xe0o, \u0111\xe2y c\u0169ng l\xe0 1 _virtual unit_.\\n\\n**1dp t\u01b0\u01a1ng \u0111\u01b0\u01a1ng 1 px tr\xean m\xe0n h\xecnh 160dpi**. C\xf3 ngh\u0129a l\xe0 `1dp = 1 / 160 = 0.00625 (inch) = 1px (160dpi)`\\n\\n\u0110\u1ec3 quy \u0111\u1ed5i `dp` sang `px` tr\xean c\xe1c lo\u1ea1i m\xe0n h\xecnh kh\xe1c, ta nh\xe2n dp v\u1edbi 1 s\u1ed1, g\u1ecdi l\xe0 scale factor (t\u1ec9 l\u1ec7 DPI c\u1ee7a m\xe0n h\xecnh so v\u1edbi chu\u1ea9n 160dpi).\\n\\nV\xed d\u1ee5 m\xe1y 320dpi. `1dp = 1 * 320 / 160 = 2px`\\n\\nAndroid s\u1ebd t\u1ef1 \u0111\u1ed9ng convert sang pixel thi\u1ebft b\u1ecb cho ta, n\xean ta ch\u1ec9 c\u1ea7n d\xf9ng `dp` l\xe0 tr\xean m\u1ecdi thi\u1ebft b\u1ecb, ph\u1ea7n t\u1eed c\u1ee7a ta s\u1ebd \u0111\u1ec1u c\xf3 k\xedch th\u01b0\u1edbc b\u1eb1ng nhau (ngo\u1ea1i l\u1ec7 s\u1ebd \u0111\u1ec1 c\u1eadp sau).\\n\\nKhi ta d\u1ef1ng UI, n\xean t\u1eadn d\u1ee5ng t\u1ed1i \u0111a `dp`, tr\xe1nh s\u1eed d\u1ee5ng `px`.\\n\\nB\xean c\u1ea1nh \u0111\xf3, Google c\u0169ng khuy\xean ta kh\xf4ng n\xean s\u1eed d\u1ee5ng `dp` cho text, m\xe0 h\xe3y d\xf9ng `sp`. \u0110\xe2y c\u0169ng l\xe0 m\u1ed9t lo\u1ea1i density-independent, nh\u01b0ng n\xf3 c\xf3 th\u1ec3 b\u1ecb \u1ea3nh h\u01b0\u1edfng b\u1edfi t\xf9y ch\u1ecdn c\u1ee7a ng\u01b0\u1eddi d\xf9ng. Ng\u01b0\u1eddi d\xf9ng ch\u1ecdn c\u1ee1 ch\u1eef to, th\xec 1sp c\u0169ng l\u1edbn l\xean theo. V\xec v\u1eady, c\u0169ng tr\xe1nh d\xf9ng `sp` khi thi\u1ebft k\u1ebf layout.\\n\\n### 3.3 Density Bucket\\n\\n`dp` ra \u0111\u1eddi, nh\u01b0ng c\u0169ng ch\u01b0a gi\u1ea3i quy\u1ebft \u0111\u01b0\u1ee3c h\u1ebft c\xe1c v\u1ea5n \u0111\u1ec1. \u0110\xf3 ch\xednh l\xe0 v\u1ec1 resource h\xecnh \u1ea3nh. Style cho \u1ea3nh th\xec c\xf3 th\u1ec3 s\u1eed d\u1ee5ng dp \u0111\u01b0\u1ee3c (\u1ea3nh s\u1ebd b\u1ecb k\xe9o to, ho\u1eb7c co l\u1ea1i cho \u0111\u1ee7 size c\u1ea7n thi\u1ebft), nh\u01b0ng resource th\xec \u0111\xe2u c\xf3 th\u1ec3 to nh\u1ecf t\xf9y \xfd \u0111\u01b0\u1ee3c, th\xf4ng s\u1ed1 c\u1ee7a n\xf3 lu\xf4n l\xe0 c\u1ed1 \u0111\u1ecbnh.\\n\\nL\u1ea5y v\xed d\u1ee5 v\u1ec1 1 h\xecnh \u1ea3nh 500x500px (resolution), v\u1edbi 2 m\xe0n h\xecnh c\xf3 k\xedch th\u01b0\u1edbc b\u1eb1ng nhau, nh\u01b0ng kh\xe1c \u0111\u1ed9 ph\xe2n gi\u1ea3i (kh\xe1c DPI), 1 chi\u1ebfc l\xe0 360x640, 1 chi\u1ebfc l\xe0 720x1280.\\n\\nH\xecnh \u1ea3nh tr\xean n\u1ebfu hi\u1ec3n th\u1ecb tr\xean m\xe0n h\xecnh 360x640 th\xec ch\u1eb3ng ph\u1ea3i s\u1ebd d\u01b0 th\u1eeba sao? V\xec chi\u1ec1u r\u1ed9ng m\xe0n h\xecnh ch\u1ec9 c\xf3 360px. C\xf2n tr\xean m\xe0n h\xecnh 720x1280, th\xec n\xf3 ch\u1ea3 \u0111\xe1ng l\xe0 bao. V\xec v\u1eady ta c\u1ea7n s\u1eed d\u1ee5ng h\xecnh \u1ea3nh c\xf3 \u0111\u1ed9 ph\xe2n gi\u1ea3i th\u1ea5p h\u01a1n cho m\xe0n h\xecnh 360x640.\\n\\nNh\u01b0ng kh\xf4ng l\u1ebd c\u1ee9 m\u1ed7i \u0111\u1ed9 ph\xe2n gi\u1ea3i l\u1ea1i t\u1ea1o 1 h\xecnh \u1ea3nh t\u01b0\u01a1ng \u1ee9ng? V\u1eady th\xec app size c\u1ee7a ta s\u1ebd b\xf9ng n\u1ed5 lu\xf4n.\\n\\nV\xec l\u1ebd \u0111\xf3 m\xe0 ra \u0111\u1eddi `density bucket`.\\n\\n\u0110\u1ec3 cho \u0111\u01a1n gi\u1ea3n, c\xe1c lo\u1ea1i m\xe0n h\xecnh c\xf3 DPI g\u1ea7n b\u1eb1ng nhau s\u1ebd \u0111\u01b0\u1ee3c l\xe0m tr\xf2n r\u1ed3i gom v\xe0o 1 nh\xf3m. V\xed d\u1ee5 nh\u01b0 m\xe1y 293dpi, Android s\u1ebd coi nh\u01b0 m\xe1y \u0111\xf3 l\xe0 320dpi, khi \u0111\xf3 1dp = 2px. C\xf2n nhi\u1ec1u lo\u1ea1i kh\xe1c n\u1eefa, nh\u01b0ng m\xecnh ch\u1ec9 n\xeau ra 4 bucket \u0111\xe1ng ch\xfa \xfd, best practice l\xe0 support c\u1ea3 4 bucket n\xe0y.\\n\\n| Bucket name      | Density bucket | DPI | Scale Factor |\\n| ---------------- | -------------- | --- | ------------ |\\n| Medium           | mdpi           | 160 | 1.00         |\\n| High             | hdpi           | 240 | 1.50         |\\n| Extra High       | xhdpi          | 320 | 2.00         |\\n| Extra Extra High | xxhdpi         | 480 | 3.00         |\\n\\nNh\u1eefng g\xec b\u1ea1n c\u1ea7n l\xe0m l\xe0 n\xe9m h\u1ebft h\xecnh \u1ea3nh c\u1ee7a c\xe1c bucket v\xe0o th\u01b0 m\u1ee5c t\u01b0\u01a1ng \u1ee9ng. Android s\u1ebd t\u1ef1 detect v\xe0 ch\u1ecdn h\xecnh \u1ea3nh t\u1ed1i \u01b0u nh\u1ea5t cho b\u1ea1n (l\u1ea5y t\u1eeb DPI cao nh\u1ea5t v\u1ec1).\\n\\n![](https://images.viblo.asia/653192f1-8c27-469d-a007-1ac22681ea23.png)\\n\\n![](https://images.viblo.asia/d606e411-f5cc-4151-b13e-4b2dfd626097.png)\\n\\nC\u0169ng v\xec vi\u1ec7c l\xe0m tr\xf2n DPI n\xe0y, m\xe0 1dp c\u1ee7a ta tr\xean c\xe1c thi\u1ebft b\u1ecb c\xf3 th\u1ec3 kh\xf4ng b\u1eb1ng nhau, nh\u01b0ng **lu\xf4n x\u1ea5p x\u1ec9 1/160 = 0.00625 inch**\\n\\n| Density | Bucket         | Scale factor | Physical Size (inch)   |\\n| ------- | -------------- | ------------ | ---------------------- |\\n| 293dpi  | xhdpi - 320dpi | 2            | 1 \\\\* 2 / 293 = 0.00686 |\\n| 320dpi  | xhdpi          | 2            | 1 \\\\* 2 / 320 = 0.00625 |\\n| 330 dpi | xhdpi          | 2            | 1 \\\\* 2 / 330 = 0.00606 |\\n\\n\u0110i\u1ec1u n\xe0y c\u0169ng \u0111em \u0111\u1ebfn cho ta 1 l\u1ee3i \xedch, \u0111\xf3 l\xe0 v\u1edbi c\xe1c s\u1ed1 m\xe1y density kh\xe1c nhau, nh\u01b0ng c\xf9ng \u0111\u1ed9 ph\xe2n gi\u1ea3i, k\xedch th\u01b0\u1edbc b\u1ec1 ngang c\u1ee7a ta t\xednh b\u1eb1ng dp \u0111\u1ec1u b\u1eb1ng nhau. L\u1ea5y v\xed d\u1ee5 3 m\xe1y 720x1280, 1 m\xe1y 293 dpi, 1 m\xe1y 320 dpi, 1 m\xe1y 330 dpi.\\n\\n| Density | Width (without Density Bucket) | Width (with density bucket) |\\n| ------- | ------------------------------ | --------------------------- |\\n| 293dpi  | 720 / (293 / 160) = 393dp      | 360dp                       |\\n| 320dpi  | 720 / (320 / 160) = 360dp      | 360dp                       |\\n| 330dpi  | 720 / (330 / 160) = 349dp      | 360dp                       |\\n\\n# 4. V\xed d\u1ee5\\n\\nSau khi nh\u1ed3i 1 \u0111\u1ed1ng l\xfd thuy\u1ebft v\xe0o \u0111\u1ea7u, ta h\xe3y th\u1eed l\xe0m 1 b\xe0i t\u1eadp nho nh\u1ecf, \u0111\u1ec3 \xe1p d\u1ee5ng ch\xfang. H\xe3y th\u1eed t\u1ef1 t\xednh to\xe1n th\xf4ng s\u1ed1 cho \u0111i\u1ec7n tho\u1ea1i c\u1ee7a m\xecnh xem.\\n\\n\u0110i\u1ec7n tho\u1ea1i m\xecnh 5inch, \u0111\u1ed9 ph\xe2n gi\u1ea3i 720x1280.\\n\\nTa d\u1ec5 d\xe0ng t\xednh to\xe1n \u0111\u01b0\u1ee3c chi\u1ec1u d\xe0i v\xe0 chi\u1ec1u r\u1ed9ng c\u1ee7a m\xe1y, d\u1ef1a v\xe0o \u0111\u1ecbnh l\xfd Pytago:\\n\\n```tx\\n5**2 = (1280 * x)**2 + (720 * x)**2\\nwidth = 720 * x = 2.4513 (inch)\\nheight = 1280 * x = 4.3579 (inch)\\n```\\n\\nT\u1eeb \u0111\xf3 ta c\xf3 th\u1ec3 t\xednh t\u1ea5t c\u1ea3 c\xe1c th\xf4ng s\u1ed1 kh\xe1c:\\n\\n| Th\xf4ng s\u1ed1       | Gi\xe1 tr\u1ecb                   |\\n| -------------- | ------------------------- |\\n| Device density | 720 / 2.4513 = 294 dpi    |\\n| Density bucket | xhdpi - 320dpi            |\\n| Scale factor   | 320 / 160 = 2.00          |\\n| Width          | 720 / 2 = 360dp           |\\n| Height         | 1280 / 2 = 640dp          |\\n| DIP            | 1dp = 2px = 0.0068 (inch) |\\n\\n# 5. K\u1ebft lu\u1eadn\\n\\nS\u1ef1 ra \u0111\u1eddi c\u1ee7a `dp` v\xe0 `density bucket` qu\u1ea3 th\u1ef1c \u0111\xe3 gi\xfap ta tr\xe1nh \u0111\u01b0\u1ee3c kh\xf4ng \xedt r\u1eafc r\u1ed1i trong khi ph\xe1t tri\u1ec3n \u1ee9ng d\u1ee5ng Android, t\u1ed1i \u01b0u h\xecnh \u1ea3nh cho app. B\xe0i vi\u1ebft kh\xf4ng tr\xe1nh kh\u1ecfi sai s\xf3t, n\u1ebfu c\xf3 s\u1ea1n, h\xe3y c\u1ee9 g\xf3p \xfd, m\xecnh s\u1ebd ti\u1ebfp thu v\xe0 ch\u1ec9nh s\u1eeda cho ph\xf9 h\u1ee3p.\\n\\n\u0110\xe2y c\xf3 l\u1ebd l\xe0 b\xe0i cu\u1ed1i c\u1ee7a m\xecnh trong series v\u1ec1 nh\u1eefng th\u1ee9 b\xe9 nh\u1ecf m\xe0 \xedt ai \u0111\u1ec3 \xfd trong khi thi\u1ebft k\u1ebf giao di\u1ec7n Web, mobile. C\xe1m \u01a1n m\u1ecdi ng\u01b0\u1eddi \u0111\xe3 \u0111\u1ecdc b\xe0i! - n\u1ebfu c\xe1c b\u1ea1n \u0111\u1ecdc \u0111\u1ebfn t\u1eadn d\xf2ng n\xe0y =))\\n\\n# 6. Link tham kh\u1ea3o\\n\\n1. https://developer.android.com/training/multiscreen/screendensities\\n2. https://www.highgroundgaming.com/tas/gaming-mouse-guide/low-vs-high-dpi-example/\\n3. https://facebook.github.io/react-native/docs/height-and-width.html#fixed-dimensions\\n4. https://www.avconcepts.com/2015/09/24/4k-ultra-hd-vs-hd-projection/\\n5. https://www.captechconsulting.com/blogs/understanding-density-independence-in-android\\n6. https://medium.com/@sashaserg/a-mysterious-density-independent-pixel-a-quick-introduction-to-android-design-111d68be7cf5"},{"id":"cung-tim-hieu-ve-nguyen-tu-cua-the-gioi-front-end-phan-1-pixel","metadata":{"permalink":"/blog/cung-tim-hieu-ve-nguyen-tu-cua-the-gioi-front-end-phan-1-pixel","editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/blog/2018-10-27-css-pixel.md","source":"@site/blog/2018-10-27-css-pixel.md","title":"C\xf9ng t\xecm hi\u1ec3u v\u1ec1 nguy\xean t\u1eed c\u1ee7a th\u1ebf gi\u1edbi FrontEnd (Ph\u1ea7n 1 - Pixel)","description":"N\u1ebfu l\xe0 m\u1ed9t nh\xe0 ph\xe1t tri\u1ec3n \u1ee9ng d\u1ee5ng Web hay Android, th\xec ch\u1eafc h\u1eb3n b\u1ea1n \u0111\xe3 d\xf9ng c\xe1c \u0111\u01a1n v\u1ecb \u0111\u1ed9 d\xe0i nh\u01b0 px, dp \u0111\u1ec3 t\u1ea1o style cho c\xe1c ph\u1ea7n t\u1eed tr\xean giao di\u1ec7n.","date":"2018-10-27T00:00:00.000Z","formattedDate":"October 27, 2018","tags":[{"label":"frontend","permalink":"/blog/tags/frontend"},{"label":"css","permalink":"/blog/tags/css"},{"label":"html","permalink":"/blog/tags/html"}],"readingTime":6.465,"hasTruncateMarker":false,"authors":[{"name":"L\xea S\u0129 B\xedch","title":"Ruby on Rails/React Developer","url":"https://github.com/moonlight8978","imageURL":"https://avatars.githubusercontent.com/u/26299310?v=4"}],"frontMatter":{"slug":"cung-tim-hieu-ve-nguyen-tu-cua-the-gioi-front-end-phan-1-pixel","title":"C\xf9ng t\xecm hi\u1ec3u v\u1ec1 nguy\xean t\u1eed c\u1ee7a th\u1ebf gi\u1edbi FrontEnd (Ph\u1ea7n 1 - Pixel)","author":"L\xea S\u0129 B\xedch","author_title":"Ruby on Rails/React Developer","author_url":"https://github.com/moonlight8978","author_image_url":"https://avatars.githubusercontent.com/u/26299310?v=4","tags":["frontend","css","html"]},"unlisted":false,"prevItem":{"title":"C\xf9ng t\xecm hi\u1ec3u v\u1ec1 nguy\xean t\u1eed c\u1ee7a th\u1ebf gi\u1edbi FrontEnd (Ph\u1ea7n 2 - Density-independent Pixel)","permalink":"/blog/cung-tim-hieu-ve-nguyen-tu-cua-the-gioi-front-end-phan-2-density-independent-pixel"},"nextItem":{"title":"TDD/BDD - N\xf3i d\u1ec5 h\u01a1n l\xe0m","permalink":"/blog/tdd-bdd-noi-de-hon-lam"}},"content":"![](https://images.viblo.asia/356f907a-e15f-4de7-a14c-e60c6553537b.png)\\n\\n# 1. M\u1edf \u0111\u1ea7u\\n\\nN\u1ebfu l\xe0 m\u1ed9t nh\xe0 ph\xe1t tri\u1ec3n \u1ee9ng d\u1ee5ng Web hay Android, th\xec ch\u1eafc h\u1eb3n b\u1ea1n \u0111\xe3 d\xf9ng c\xe1c \u0111\u01a1n v\u1ecb \u0111\u1ed9 d\xe0i nh\u01b0 `px`, `dp` \u0111\u1ec3 t\u1ea1o style cho c\xe1c ph\u1ea7n t\u1eed tr\xean giao di\u1ec7n.\\n\\nC\xf3 l\u1ebd nhi\u1ec1u ng\u01b0\u1eddi s\u1ebd ngh\u0129 r\u1eb1ng: M\xe0n h\xecnh m\xecnh FullHD, \u0111\u1ed9 ph\xe2n gi\u1ea3i 1920x1080, th\xec c\u1ee9 1920px m\xe0 v\xe3 v\xe0o css th\xf4i, ngh\u0129 ng\u1ee3i l\xe0m g\xec nhi\u1ec1u. Nh\u01b0ng li\u1ec7u c\xf3 th\u1eadt l\xe0 nh\u01b0 v\u1eady kh\xf4ng? Ch\xfang ta h\xe3y c\xf9ng t\xecm hi\u1ec3u\\n\\nTL;DR\\n\\n> 1px = 1/96 inch\\n>\\n> 1dp = 1/160 inch\\n\\n# 2. Pixel - nguy\xean t\u1eed c\u1ee7a th\u1ebf gi\u1edbi Web\\n\\n**L\u01b0u \xfd:**\\nTr\u01b0\u1edbc ti\xean, ta c\u1ea7n ph\u1ea3i l\xe0m r\xf5 1 \u0111i\u1ec1u: 1px c\u1ee7a CSS kh\xe1c v\u1edbi 1px c\u1ee7a thi\u1ebft b\u1ecb (\u0111\u1ed9 ph\xe2n gi\u1ea3i). 1px CSS c\xf3 th\u1ec3 t\u01b0\u01a1ng \u1ee9ng v\u1edbi 1 ho\u1eb7c nhi\u1ec1u px c\u1ee7a thi\u1ebft b\u1ecb.\\n\\nC\xf3 r\u1ea5t nhi\u1ec1u lo\u1ea1i m\xe0n h\xecnh, \u0111\u1ed9 ph\xe2n gi\u1ea3i, k\xedch th\u01b0\u1edbc kh\xe1c nhau. N\xf3 l\xe0m kh\xf3 l\u1eadp tr\xecnh vi\xean trong vi\u1ec7c d\u1ef1ng giao di\u1ec7n, \u0111\u01b0\u1ee3c m\xe0n h\xecnh n\xe0y th\xec l\u1ea1i h\u1ecfng m\xe0n h\xecnh kia. V\xec v\u1eady w3 \u0111\xe3 quy \u01b0\u1edbc 1 \u0111\u01a1n v\u1ecb chu\u1ea9n, d\xf9ng cho m\u1ecdi thi\u1ebft b\u1ecb: **px**.\\n\\n\u0110\u1ecbnh ngh\u0129a tr\xean [w3](https://www.w3.org/TR/css-values-4/#px)\\n\\n> 1px = 1/96th of 1in\\n\\nTuy nhi\xean, khi nh\xecn xu\u1ed1ng d\u01b0\u1edbi m\u1ed9t ch\xfat, ta c\xf3 th\u1ec3 th\u1ea5y th\xeam\\n\\n> For a CSS device, these dimensions are anchored either:\\n>\\n> \u200b i. by relating the physical units to their physical measurements, or\\n>\\n> \u200b ii. by relating the pixel unit to the reference pixel.\\n\\nNh\xecn s\u01a1 qua th\xec kh\xe1 l\xe0 kh\xf3 hi\u1ec3u, nh\u01b0ng ta c\xf3 th\u1ec3 h\xecnh dung \u0111\u01b0\u1ee3c 1 \u0111i\u1ec1u, pixel c\xf3 th\u1ec3 \u0111\u01b0\u1ee3c t\xednh to\xe1n theo 2 c\xe1ch.\\n\\n###### 2.1 By relating the physical units to their physical measurements\\n\\n\xdd \u0111\u1ea7u l\xe0 d\xe0nh cho c\xe1c thi\u1ebft b\u1ecb \u0111\xf2i h\u1ecfi \u0111\u1ed9 ch\xednh x\xe1c cao v\u1ec1 \u0111\u1ed9 d\xe0i, v\xed d\u1ee5 nh\u01b0 m\xe1y in. Ta ph\u1ea3i s\u1eed d\u1ee5ng c\xe1c \u0111\u01a1n v\u1ecb `inch`, `cm`, ... \u0111\xfang nh\u01b0 \u0111\u1ed9 d\xe0i th\u1ef1c t\u1ebf c\u1ee7a ch\xfang. Khi \u0111\xf3, `1px` s\u1ebd t\u01b0\u01a1ng \u0111\u01b0\u01a1ng **0.267mm** (25.6/96). Ta s\u1ebd kh\xf4ng \u0111\u1ec1 c\u1eadp \u0111\u1ebfn nh\u1eefng lo\u1ea1i thi\u1ebft b\u1ecb n\xe0y trong b\xe0i.\\n\\n###### 2.2 By relating the pixel unit to the reference pixel\\n\\n\u0110\u1ed1i v\u1edbi c\xe1c thi\u1ebft b\u1ecb tr\xecnh chi\u1ebfu (b\u1ea5t k\u1ec3 \u0111\u1ed9 ph\xe2n gi\u1ea3i, m\xe0n h\xecnh Retina hay th\u1ee9 g\xec th\u1ea7n th\xe1nh kh\xe1c), c\xe1c thi\u1ebft b\u1ecb m\xe0 c\xf3 kho\u1ea3ng c\xe1ch nh\xecn b\u1ea5t th\u01b0\u1eddng, **px** s\u1ebd l\xe0 \u0111\u01a1n v\u1ecb \u0111\u1ec3 t\xednh ra `inch`, `cm`, ...\\n\\nV\xe0 w3 khuy\xean r\u1eb1ng, n\xean s\u1eed d\u1ee5ng **reference pixel** \u0111\u1ec3 t\xednh ra t\u1ec9 l\u1ec7 quy \u0111\u1ed5i 1px CSS n\xe0y v\u1edbi s\u1ed1 pixel thi\u1ebft b\u1ecb (m\xe0n h\xecnh 4096\u2009\xd7\u20092160 c\xf3 th\u1ec3 s\u1ebd kh\xf4ng c\xf2n l\xe0 4096px trong CSS n\u1eefa). Hay n\xf3i c\xe1ch kh\xe1c l\xe0 t\xednh xem 1px CSS b\u1eb1ng bao nhi\xeau.\\n\\nL\u1ea1i m\u1ed9t \u0111\u01a1n v\u1ecb h\u1ea1i n\xe3o n\u1eefa, v\xe0 w3 \u0111\u1ecbnh ngh\u0129a n\xf3 nh\u01b0 sau:\\n\\n> The reference pixel is the visual angle of one pixel on a device with a pixel density of 96dpi and a distance from the reader of an arm\u2019s length. For a nominal arm\u2019s length of 28 inches, the visual angle is therefore about 0.0213 degrees. For reading at arm\u2019s length, 1px thus corresponds to about 0.26 mm (1/96 inch).\\n\\nNh\u01b0 v\u1eady, `reference pixel` l\xe0 m\u1ed9t **visual angle** c\u1ee7a **1px** tr\xean m\xe0n h\xecnh **96dpi**. Kho\u1ea3ng c\xe1ch nh\xecn l\xe0 1 s\u1ea3i tay (kho\u1ea3ng 28in \u0111\u1ed1i v\u1edbi ng\u01b0\u1eddi b\xecnh th\u01b0\u1eddng) - \u0111\xe2y l\xe0 kho\u1ea3ng c\xe1ch ng\u1ed3i PC th\xf4ng th\u01b0\u1eddng.\\n\\nT\u1eeb kh\xe1i ni\u1ec7m n\xe0y l\u1ea1i \u0111\u1ebb ra kh\xe1i ni\u1ec7m kh\xe1c :v Ta h\xe3y b\u1eaft \u0111\u1ea7u v\u1edbi DPI\\n\\n**DPI** (Dots Per Inch): t\u01b0\u01a1ng \u0111\u01b0\u01a1ng v\u1edbi PPI (Pixels Per Inch), n\xf3 cho ta bi\u1ebft 1inch m\xe0n h\xecnh thi\u1ebft b\u1ecb c\xf3 bao nhi\xeau pixel thi\u1ebft b\u1ecb. 96dpi ngh\u0129a l\xe0 1inch c\xf3 96 pixel. Nh\u01b0 v\u1eady 1px c\u1ee7a m\xe0n h\xecnh 96dpi s\u1ebd l\xe0 2.56 / 96 ~ **0.26mm**\\n\\nDPI c\xe0ng l\u1edbn, m\xe0n h\xecnh hi\u1ec3n th\u1ecb c\xe0ng chi ti\u1ebft. DPI \u0111\u01b0\u1ee3c t\xednh d\u1ef1a tr\xean k\xedch th\u01b0\u1edbc thi\u1ebft b\u1ecb v\xe0 \u0111\u1ed9 ph\xe2n gi\u1ea3i c\u1ee7a thi\u1ebft b\u1ecb.\\n\\nVD m\xe0n h\xecnh c\xf4ng ty m\xecnh d\xf9ng l\xe0 Dell P2319H, 23in (58,42cm), \u0111\u1ed9 ph\xe2n gi\u1ea3i 1920x1080\\n\\n![](https://images.viblo.asia/c5529984-c033-4c36-abb1-9dd73be39f03.jpg)\\n\\n\xc1p d\u1ee5ng Pytago: ta c\xf3\\n\\n```\\n(1920x)^2 + (1080x)^2 = 58.42^2 (cm^2)\\n```\\n\\nT\xednh nhanh, ta \u0111\u01b0\u1ee3c x = 0.0265cm. Nh\u01b0 v\u1eady, m\xe1y m\xecnh c\xf3 chi\u1ec1u r\u1ed9ng l\xe0 1920x = 19.89in, v\xe0 DPI = 1920 / 19.89 = 96.53\\n\\n**Visual angle** l\xe0 g\xf3c v \u0111\u01b0\u1ee3c bi\u1ec3u th\u1ecb d\u01b0\u1edbi h\xecnh sau:\\n\\n![](https://images.viblo.asia/835cce17-7a60-43d8-adc0-ead0a1d00de8.jpg)\\n\\n\xc1p d\u1ee5ng v\xe0o, b\u1ea5m m\xe1y t\xednh:\\n\\n```\\nv = 2 x arctan((2.56/96) / (2x28x2.56)) => 0.0213 (\u0111\u1ed9)\\n```\\n\\nV\u1edbi reference pixel l\xe0 **0.0213 \u0111\u1ed9**, kho\u1ea3ng c\xe1ch nh\xecn **28in**, 1px CSS lu\xf4n c\xf3 gi\xe1 tr\u1ecb l\xe0 **0.26mm**. V\xec v\u1eady gi\u1eefa 2 m\xe0n h\xecnh PC c\xf9ng k\xedch th\u01b0\u1edbc, nh\u01b0ng c\xf3 \u0111\u1ed9 ph\xe2n gi\u1ea3i kh\xe1c nhau (v\xed d\u1ee5 1 c\xe1i FullHD, 1 c\xe1i 4K), 1 element c\xf3 width 10px s\u1ebd lu\xf4n c\xf3 k\xedch th\u01b0\u1edbc v\u1eadt l\xfd b\u1eb1ng nhau (2.6mm).\\n\\n![](https://images.viblo.asia/4f52ddec-b90b-42f3-9556-b3cf12e6f4d8.png)\\n\\nV\u1edbi m\xe0n h\xecnh FullHD, 1px CSS s\u1ebd \u1ee9ng v\u1edbi 1px c\u1ee7a thi\u1ebft b\u1ecb, c\xf2n v\u1edbi m\xe0n Retina c\u0103ng \u0111\xe9t, 1px CSS \u1ee9ng v\u1edbi 2px thi\u1ebft b\u1ecb, nh\u01b0ng k\xedch th\u01b0\u1edbc th\u1eadt c\u1ee7a ch\xfang \u0111\u1ec1u l\xe0 0.26mm.\\n\\nKho\u1ea3ng c\xe1ch t\u1edbi m\xe0n h\xecnh c\xe0ng cao, \u0111\u1ed9 l\u1edbn c\u1ee7a 1px c\xe0ng t\u0103ng l\xean. \u1ede kho\u1ea3ng c\xe1ch 3.5m, 1px c\xf3 gi\xe1 tr\u1ecb l\xean t\u1edbi 1.3mm, v\xe0 1in l\xfac n\xe0y kho\u1ea3ng 124.8mm (g\u1ea5p g\u1ea7n 5 l\u1ea7n gi\xe1 tr\u1ecb th\u1ef1c).\\n\\n![](https://images.viblo.asia/a666ffa1-d5ba-4e25-9f16-4231d6f0a08a.png)\\n\\nLoanh quanh m\u1ed9t h\u1ed3i, ta v\u1eabn ch\u01b0a gi\u1ea3i th\xedch \u0111\u01b0\u1ee3c v\u1ea5n \u0111\u1ec1 ban \u0111\u1ea7u: Ta c\xf3 th\u1ec3 coi 1px tr\xean m\xe0n h\xecnh PC l\xe0 1px CSS hay kh\xf4ng?\\n\\nC\xe2u tr\u1ea3 l\u1eddi l\xe0 c\xf3. B\u1edfi v\xec m\xe0n h\xecnh PC, laptop hi\u1ec7n nay \u0111a s\u1ed1 \u0111\u1ec1u c\xf3 \u0111\u1ed9 ph\xe2n gi\u1ea3i kho\u1ea3ng 96dpi, n\xean 1px thi\u1ebft b\u1ecb v\u1eeba \u0111\xfang v\u1edbi 1px CSS.\\n\\n# 3. Pixel tr\xean tr\xecnh duy\u1ec7t Mobile\\n\\nLi\u1ec7u c\xe1c b\u1ea1n c\xf3 bao gi\u1edd th\u1eafc m\u1eafc: M\xe0n h\xecnh \u0111i\u1ec7n tho\u1ea1i to\xe0n HD 720x1280, FullHD 1080x1920, ... m\xe0 sao khi responsive l\u1ea1i ph\u1ea3i s\u1eed d\u1ee5ng media query < 576px?\\n\\nCh\u1eafc h\u1eb3n c\xe1c b\u1ea1n \u0111\xe3 t\u1ef1 c\xf3 c\xe2u tr\u1ea3 l\u1eddi cho m\xecnh. V\xec khi s\u1eed d\u1ee5ng **reference pixel**, 1px tr\xean \u0111i\u1ec7n tho\u1ea1i s\u1ebd kh\xf4ng c\xf2n l\xe0 1px c\u1ee7a CSS n\u1eefa.\\n\\nDo DPI \u0111i\u1ec7n tho\u1ea1i cao ch\u0103ng? V\xed d\u1ee5 \u0111i\u1ec7n tho\u1ea1i m\xecnh c\xf3 DPI l\xe0 294, \u0111\u1ed9 ph\xe2n gi\u1ea3i 720x1280, v\u1eady th\xec 1px CSS (0.26mm) = 3px thi\u1ebft b\u1ecb (0.087mm). V\u1eady th\xec l\xe0 240x427?\\n\\nKh\xf4ng, m\u1ed9t ph\u1ea7n \u0111\xfang l\xe0 do DPI, v\xe0 1 l\xfd do n\u1eefa l\xe0 v\xec ta c\u1ea7m \u0111i\u1ec7n tho\u1ea1i g\u1ea7n h\u01a1n nhi\u1ec1u so v\u1edbi kho\u1ea3ng c\xe1ch ng\u1ed3i tr\u01b0\u1edbc m\xe0n h\xecnh PC, Laptop (kho\u1ea3ng 18in)\\n\\n![](https://images.viblo.asia/ff59e444-6b0f-430e-85b2-b4afa3494ec9.jpg)\\n\\n\xc1p d\u1ee5ng \u0111\u1ecbnh l\xfd Talet trong tam gi\xe1c, ta t\xednh \u0111\u01b0\u1ee3c 1px CSS gi\u1edd ch\u1ec9 c\xf2n:\\n\\n```\\n18 * 0.26 / 28 = 0.167mm\\n```\\n\\nL\u1ea1i l\u1ea5y \u0111i\u1ec7n tho\u1ea1i 5in, \u0111\u1ed9 ph\xe2n gi\u1ea3i 720x1280 c\u1ee7a m\xecnh, 1px = 0.087mm\\n\\nD\u1ec5 th\u1ea5y 1px CSS = 2px thi\u1ebft b\u1ecb. V\xec th\u1ebf m\xe0n h\xecnh r\u1ed9ng 720px c\u1ee7a ta gi\u1edd ch\u1ec9 c\xf2n 360px trong m\u1eaft CSS. T\u1ec9 l\u1ec7 2:1 n\xe0y, g\u1ecdi l\xe0 `devicePixelRatio`\\n\\nCon s\u1ed1 n\xe0y s\u1ebd \u0111\u01b0\u1ee3c nh\xe0 s\u1ea3n xu\u1ea5t t\xednh to\xe1n v\xe0 cung c\u1ea5p khi s\u1ea3n xu\u1ea5t 1 thi\u1ebft b\u1ecb n\xe0o \u0111\xf3. V\u1edbi Javascript, ta c\xf3 th\u1ec3 d\xf9ng h\xe0m sau \u0111\u1ec3 l\u1ea5y \u0111\u01b0\u1ee3c `devicePixelRatio`:\\n\\n```js\\nwindow.devicePixelRatio;\\n```\\n\\n# 4. K\u1ebft lu\u1eadn\\n\\nTh\u1ebf gi\u1edbi Frontend kh\xe1 h\u1ea1i n\xe3o v\u1edbi c\xe1c lo\u1ea1i m\xe0n h\xecnh kh\xe1c nhau, n\xean ng\u01b0\u1eddi ta \u0111\xe3 ph\u1ea3i quy \u01b0\u1edbc 1 \u0111\u01a1n v\u1ecb chu\u1ea9n d\xf9ng cho m\u1ecdi thi\u1ebft b\u1ecb trong c\xf9ng 1 kho\u1ea3ng c\xe1ch nh\xecn. \u0110i\u1ec1u n\xe0y \u0111\xe3 gi\xfap anh em dev ch\xfang ta d\u1ec5 th\u1edf h\u01a1n nhi\u1ec1u.\\n\\nHy v\u1ecdng b\xe0i vi\u1ebft n\xe0y gi\xfap m\u1ecdi ng\u01b0\u1eddi hi\u1ec3u th\xeam v\u1ec1 \u0111\u01a1n v\u1ecb px m\xe0 m\xecnh v\u1eabn s\u1eed d\u1ee5ng th\u01b0\u1eddng ng\xe0y.\\n\\n\u0110\u1ecbnh vi\u1ebft th\xeam c\u1ea3 v\u1ec1 `dp` trong Android m\xe0 c\u1ea3m th\u1ea5y b\xe0i d\xe0i qu\xe1 r\u1ed3i, c\xf3 l\u1ebd m\xecnh s\u1ebd \u0111\u1ec3 k\u1ef3 t\u1edbi, mong c\xe1c b\u1ea1n \u1ee7ng h\u1ed9.\\n\\n# 5. Tham kh\u1ea3o\\n\\n- [w3](https://www.w3.org/TR/css-values-4/#px)\\n- [html5rocks](https://www.html5rocks.com/en/mobile/high-dpi/)\\n- [Mozilla Docs](https://developer.mozilla.org/en-US/docs/Web/API/Window/devicePixelRatio)\\n\\n- H\xecnh \u1ea3nh th\xec l\u1ea5y t\xf9m lum qu\xe1 m\xe0 qu\xean l\u01b0u ngu\u1ed3n T.T"},{"id":"tdd-bdd-noi-de-hon-lam","metadata":{"permalink":"/blog/tdd-bdd-noi-de-hon-lam","editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/blog/2018-09-22-introduce-to-bdd.md","source":"@site/blog/2018-09-22-introduce-to-bdd.md","title":"TDD/BDD - N\xf3i d\u1ec5 h\u01a1n l\xe0m","description":"M\u1ed9t v\xe0i l\u01b0u \xfd tr\u01b0\u1edbc khi b\u1eaft \u0111\u1ea7u.","date":"2018-09-22T00:00:00.000Z","formattedDate":"September 22, 2018","tags":[{"label":"tdd","permalink":"/blog/tags/tdd"},{"label":"bdd","permalink":"/blog/tags/bdd"},{"label":"testing","permalink":"/blog/tags/testing"},{"label":"ruby-on-rails","permalink":"/blog/tags/ruby-on-rails"}],"readingTime":6.255,"hasTruncateMarker":false,"authors":[{"name":"L\xea S\u0129 B\xedch","title":"Ruby on Rails/React Developer","url":"https://github.com/moonlight8978","imageURL":"https://avatars.githubusercontent.com/u/26299310?v=4"}],"frontMatter":{"slug":"tdd-bdd-noi-de-hon-lam","title":"TDD/BDD - N\xf3i d\u1ec5 h\u01a1n l\xe0m","author":"L\xea S\u0129 B\xedch","author_title":"Ruby on Rails/React Developer","author_url":"https://github.com/moonlight8978","author_image_url":"https://avatars.githubusercontent.com/u/26299310?v=4","tags":["tdd","bdd","testing","ruby-on-rails"]},"unlisted":false,"prevItem":{"title":"C\xf9ng t\xecm hi\u1ec3u v\u1ec1 nguy\xean t\u1eed c\u1ee7a th\u1ebf gi\u1edbi FrontEnd (Ph\u1ea7n 1 - Pixel)","permalink":"/blog/cung-tim-hieu-ve-nguyen-tu-cua-the-gioi-front-end-phan-1-pixel"}},"content":"M\u1ed9t v\xe0i l\u01b0u \xfd tr\u01b0\u1edbc khi b\u1eaft \u0111\u1ea7u.\\n\\n- Code demo trong b\xe0i s\u1ebd s\u1eed d\u1ee5ng rspec, capybara, factory_bot (Ruby/Rails), h\u01b0\u1edbng t\u1edbi \u0111\u1ed1i t\u01b0\u1ee3ng Web developer.\\n- B\xe0i vi\u1ebft kh\xf4ng tr\xe1nh kh\u1ecfi thi\u1ebfu s\xf3t, n\u1ebfu c\xf3 ch\u1ed7 n\xe0o kh\xf4ng \u0111\xfang, m\u1ecdi ng\u01b0\u1eddi c\u1ee9 qu\u0103ng g\u1ea1ch \u1edf d\u01b0\u1edbi comment :v\\n\\n\xd4ng cha ta c\xf3 c\xe2u \\"D\u1ee5c t\u1ed1c b\u1ea5t \u0111\u1ea1t\\". Tr\u01b0\u1edbc khi \u0111i v\xe0o chi ti\u1ebft, ta h\xe3y c\xf9ng \u0111i\u1ec3m qua m\u1ed9t v\xe0i kh\xe1i ni\u1ec7m tr\u01b0\u1edbc.\\n\\n# 1. Test l\xe0 g\xec?\\n\\nN\u1ebfu b\u1ea1n l\xe0 m\u1ed9t developer, ch\u1eafc h\u1eb3n s\u1ebd kh\xf4ng l\u1ea1 l\u1eabm g\xec kh\xe1i ni\u1ec7m \\"testing\\".\\n\\nV\xed d\u1ee5 khi b\u1ea1n l\u1eadp tr\xecnh ch\u1ee9c n\u0103ng \u0111\u0103ng nh\u1eadp c\u1ee7a 1 trang web. Sau m\u1ed9t h\u1ed3i h\xec h\u1ee5c code, ch\u1eafc h\u1eb3n b\u1ea1n s\u1ebd v\xe0o trang \u0111\xf3, ti\u1ebfn h\xe0nh \u0111\u0103ng nh\u1eadp, r\u1ed3i ch\u1edd xem code m\xecnh c\xf3 ch\u1ea1y \u0111\xfang hay kh\xf4ng :v\\n\\nTuy nhi\xean gi\u1edd \u0111\xe2y, \u0111a s\u1ed1 \u0111\u1ec1u s\u1eed d\u1ee5ng c\xe1c automated test script \u0111\u1ec3 t\u1ef1 \u0111\u1ed9ng h\xf3a qu\xe1 tr\xecnh test. H\u01a1n th\u1ebf, n\xf3 c\xf2n gi\xfap nh\u1eefng ng\u01b0\u1eddi maintainer sau n\xe0y c\xf3 th\u1ec3 hi\u1ec3u ~~c\xe1i \u0111\u1ed1ng h\u1ed5 l\u1ed1n~~ code b\u1ea1n \u0111\u1ec3 l\u1ea1i ch\u1ea1y nh\u01b0 th\u1ebf n\xe0o.\\n\\nTest kh\xe1c v\u1edbi Debug.\\n\\nC\xe1c lo\u1ea1i test n\xean ch\xfa \xfd:\\n\\n- Unit test: test ri\xeang l\u1ebb t\u1eebng class/function, vi\u1ebft kh\xe1 d\u1ec5.\\n- Integration test, Feature test: \u1edf \u0111\xe2y b\u1eaft \u0111\u1ea7u c\xf3 s\u1ef1 k\u1ebft h\u1ee3p gi\u1eefa nhi\u1ec1u module v\u1edbi nhau \u0111\u1ec3 m\xf4 t\u1ea3 1 (hay nhi\u1ec1u) ch\u1ee9c n\u0103ng c\u1ee7a \u1ee9ng d\u1ee5ng.\\n\\nM\xe0u s\u1eafc \u0111\u1eb7c tr\u01b0ng:\\n\\n- \u0110\u1ecf: xin chia bu\u1ed3n test c\u1ee7a b\u1ea1n \u0111\xe3 t\u1ea1ch =))\\n- Xanh: ch\xfac m\u1eebng, test \u0111\xe3 pass, code c\u1ee7a b\u1ea1n \\"c\xf3 th\u1ec3\\" \u0111\xe3 ch\u1ea1y \u0111\xfang.\\n\\n# 2. TDD - Test Driven Development\\n\\nD\u1ecbch ra th\xec s\u1ebd l\xe0 **Ph\xe1t tri\u1ec3n v\u1edbi tr\u1ecdng t\xe2m l\xe0 ki\u1ec3m th\u1eed (test)**, hay n\xf4m na l\xe0 test tr\u01b0\u1edbc code sau.\\n\\n![TDD](https://images.viblo.asia/bd25076f-2ddb-4b27-888e-d58ab8e8c286.png)\\n\\n- Tr\u01b0\u1edbc ti\xean ta vi\u1ebft c\xe1c test script v\xe0 ch\u1ea1y ch\xfang, t\u1ea5t nhi\xean l\xe0 s\u1ebd fail v\xec l\xe0m g\xec c\xf3 code =))\\n\\n  VD ta mu\u1ed1n vi\u1ebft 1 h\xe0m t\xednh s\u1ed1 Fibonacci:\\n\\n  ![Fibonacci](https://wikimedia.org/api/rest_v1/media/math/render/svg/6693d2c78bc8132bb9b65be861148ca574a738ef)\\n\\n  ```ruby\\n  # spec/fibonacci_spec.rb\\n  describe \\"#fibonacci_of\\" do\\n    context \\"one\\" do\\n      it \\"returns 1\\" do\\n        expect(fibonacci_of(1)).to eq 1\\n      end\\n    end\\n\\n    context \\"two\\" do\\n      it \\"returns 1\\" do\\n        expect(fibonacci_of(2)).to eq 1\\n      end\\n    end\\n\\n    context \\"greater than two\\" do\\n      it \\"returns sum of two elements before\\" do\\n        expect(fibonacci_of(4)).to eq 3\\n      end\\n    end\\n  end\\n  ```\\n\\n- R\u1ed3i ta m\u1edbi b\u1eaft tay v\xe0o code, ch\u1ea1y test, n\u1ebfu fail th\xec l\u1ea1i h\xec h\u1ee5c s\u1eeda, h\u1ecfng \u0111\xe2u v\xe1 \u0111\xf3. L\xfac n\xe0y b\u1ea1n ch\u01b0a c\u1ea7n b\u1eadn t\xe2m v\u1ec1 vi\u1ec7c code m\xecnh c\xf3 d\u1ec5 hi\u1ec3u/\u0111\u1eb9p kh\xf4ng.\\n\\n  V\xe0 sau 1 h\u1ed3i th\xec cu\u1ed1i c\xf9ng test ta c\u0169ng pass :v\\n\\n  ```ruby\\n  # fibonacci.rb\\n  def fibonacci_of(n)\\n    case n\\n    when 1\\n      1\\n    when 2\\n      1\\n    else\\n      fibonacci_of(n - 1) + fibonacci_of(n - 2)\\n    end\\n  end\\n  ```\\n\\n- Ta s\u1ebd nh\xecn l\u1ea1i \u0111\u1ed1ng h\u1ed5 l\u1ed1n m\xe0 ta v\u1eeba vi\u1ebft ra, t\u1ec9a t\xf3t l\u1ea1i cho \u0111\u1eb9p m\u1eaft, t\xe1ch service c\xe1c th\u1ee9. V\xe0 nh\u1edb r\u1eb1ng \u0111\u1eebng l\xe0m cho test \u0111\u1ecf l\xf2m.\\n\\n  ```ruby\\n  # fibonacci.rb\\n  def fibonacci_of(n)\\n    return 1 if [1, 2].include?(n)\\n    fibonacci_of(n - 1) + fibonacci_of(n - 2)\\n  end\\n  ```\\n\\n**L\u01b0u \xfd:** Kh\xf4ng ph\u1ea3i c\u1ee9 test pass l\xe0 app c\u1ee7a ta \u0111\xe3 ch\u1ea1y \u0111\xfang, vi\u1ec7c n\xe0y c\xf2n bao g\u1ed3m nhi\u1ec1u y\u1ebfu t\u1ed1 kh\xe1c nh\u01b0\\n\\n- Ta c\xf3 hi\u1ec3u \u0111\xfang y\xeau c\u1ea7u c\u1ee7a kh\xe1ch h\xe0ng kh\xf4ng\\n- Test c\u1ee7a ta \u0111\xe3 bao g\u1ed3m h\u1ebft c\xe1c tr\u01b0\u1eddng h\u1ee3p c\xf3 th\u1ec3 ch\u01b0a\\n\\nC\xf3 th\u1ec3 d\u1ec5 d\xe0ng nh\u1eadn th\u1ea5y, h\xe0m `#fibonacci_of` \u1edf tr\xean s\u1ebd ch\u1ebft ngay l\u1eadp t\u1ee9c n\u1ebfu g\u1eb7p tham s\u1ed1 `<= 0`.\\n\\n# 3. BDD - Behavior Driven Development\\n\\n![BDD](http://blog.andolasoft.com/wp-content/uploads/2015/05/TDD-vs-BDD.jpg)\\n\\nK\u1ebf th\u1eeba ng\u01b0\u1eddi ti\u1ec1n nhi\u1ec7m TDD v\u1edbi ph\u01b0\u01a1ng ch\xe2m \\"Test tr\u01b0\u1edbc code sau\\", BDD ch\u1ec9 kh\xe1c ch\xfat l\xe0 ta s\u1ebd t\u1eadp trung v\xe0o h\xe0nh vi ng\u01b0\u1eddi d\xf9ng (feature).\\n\\nTheo \u0111\xf3, ta s\u1ebd vi\u1ebft c\xe1c feature test tr\u01b0\u1edbc (m\xf4 t\u1ea3 m\u1ed9t t\xednh n\u0103ng c\u1ee7a \u1ee9ng d\u1ee5ng, ho\u1eb7c usecase/userstory). V\u1edbi m\u1ed7i feature test \u0111\xf3, ta c\xf3 th\u1ec3 s\u1ebd ph\u1ea3i tri\u1ec3n khai th\xeam 1 v\xe0i unit test/integration test cho c\xe1c class/function c\u1ea7n thi\u1ebft trong feature test.\\n\\nV\xed d\u1ee5: Ta mu\u1ed1n x\xe2y d\u1ef1ng t\xednh n\u0103ng t\u1ea1o album cho \u1ee9ng d\u1ee5ng qu\u1ea3n l\xfd album nh\u1ea1c.\\n\\nTr\u01b0\u1edbc h\u1ebft h\xe3y h\xecnh dung t\xednh n\u0103ng n\xe0y trong \u0111\u1ea7u:\\n\\n> Admin t\u1eeb trang index albums (/albums), b\u1ea5m n\xfat \\"Add album\\", 1 form s\u1ebd hi\u1ec7n ra \u0111\u1ec3 nh\u1eadp th\xf4ng tin album (bao g\u1ed3m title v\xe0 artist name).\\n>\\n> N\u1ebfu anh admin n\xe0y nh\u1eadp \u0111\xfang, h\xe3y redirect sang trang index v\xe0 hi\u1ec3n th\u1ecb album m\u1edbi n\xe0y, c\xf2n kh\xf4ng th\xec h\xe3y hi\u1ec7n l\u1ed7i \u0111\u1ec3 anh admin c\xf2n bi\u1ebft \u0111\u01b0\u1eddng m\xe0 l\u1ea7n.\\n\\nFeature test c\u1ee7a ta s\u1ebd nh\u01b0 sau:\\n\\n```ruby\\n# spec/features/create_album_spec.rb\\nRSpec.feature \\"album creating process\\", type: :feature do\\n  context \\"all fields are filled correctly\\" do\\n    it \\"create a new album\\" do\\n      visit \'/albums\'\\n      click_link \'Add album\'\\n\\n      within \'form#album_form\' do\\n        fill_in \'Title\', with: \'Chay ngay di\'\\n        fill_in \'Artist name\', with: \\"Sep\'ss\\"\\n      end\\n      click_button \'Create\'\\n\\n      expect(page).to have_content(\'Chay ngay di\')\\n    end\\n  end\\n\\n  context \\"title is blank\\" do\\n    it \\"show errors\\" do\\n      visit \'/albums\'\\n      click_link \'Add album\'\\n\\n      within \'form#album_form\' do\\n        fill_in \'Artist name\', with: \\"Sep\'ss\\"\\n      end\\n      click_button \'Create\'\\n\\n      expect(page).to have_content(\\"Title can\'t be blank\\")\\n    end\\n  end\\nend\\n\\n```\\n\\nN\u1ebfu l\xe0m theo \u0111\xfang flow c\u1ee7a Rails, ta s\u1ebd ph\u1ea3i vi\u1ebft unit test cho:\\n\\n- Controller: index, create - test xem logic b\xean trong \u0111\xe3 \u0111\xfang ch\u01b0a, status code ra sao.\\n- View: new, index - test xem tr\u01b0\u1eddng h\u1ee3p c\xf3 l\u1ed7i th\xec form hi\u1ec3n th\u1ecb sao, hay tr\u01b0\u1eddng h\u1ee3p kh\xf4ng c\xf3 album th\xec view index c\xf3 th\xf4ng b\xe1o cho ng\u01b0\u1eddi d\xf9ng bi\u1ebft hay kh\xf4ng.\\n- Model: album - test xem validate c\xf3 ho\u1ea1t \u0111\u1ed9ng hay kh\xf4ng.\\n\\nChi ti\u1ebft th\xec m\xecnh xin l\u01b0\u1ee3c b\u1edbt v\xec d\xe0i qu\xe1, b\u1ea1n c\xf3 th\u1ec3 tham kh\u1ea3o th\xeam \u1edf [\u0111\xe2y](http://hanamirb.org/guides/1.2/getting-started/).\\n\\nN\u1ebfu b\u1ea1n b\u0103n kho\u0103n n\xean test c\xe1i g\xec trong Rails, c\xf3 th\u1ec3 tham kh\u1ea3o b\xe0i [n\xe0y](https://m.patrikonrails.com/how-i-test-my-rails-applications-cf150e347a6b).\\n\\n# 3. C\xe1c nguy\xean t\u1eafc khi vi\u1ebft test (TDD)\\n\\n1. Ch\u1ec9 vi\u1ebft code khi n\xf3 c\u1ea7n thi\u1ebft \u0111\u1ec3 test c\u1ee7a b\u1ea1n pass.\\n\\n   VD b\u1ea1n vi\u1ebft m\u1ed9t h\xe0m l\u1ea5y v\u1ec1 email c\u1ee7a ng\u01b0\u1eddi d\xf9ng theo `id`.\\n\\n   ```ruby\\n   def get_user_mail_by_id(id)\\n     user = User.find(id)\\n     user.mail\\n   end\\n   ```\\n\\n   \u1ede \u0111\xe2y b\u1eaft bu\u1ed9c ph\u1ea3i truy v\u1ea5n CSDL \u0111\u1ec3 t\xecm ra user. Kh\xf4ng d\xf9ng `find` th\xec l\u1ea5y th\xf4ng tin user th\u1ebf n\xe0o :v\\n\\n2. Ch\u1ec9 vi\u1ebft n\xean unit test trong ph\u1ea1m vi v\u1eeba \u0111\u1ee7.\\n\\n# 4. \u01afu \u0111i\u1ec3m\\n\\n- Nh\u1eefng ng\u01b0\u1eddi n\xe3o to tr\xean th\u1ebf gi\u1edbi \u0111\xe3 ch\u1ee9ng minh \u0111\u01b0\u1ee3c TDD gi\xfap thay \u0111\u1ed5i mindset c\u1ee7a b\u1ea1n, v\xe0 b\u1ea1n s\u1ebd tr\u1edf th\xe0nh nh\u1eefng l\u1eadp tr\xecnh vi\xean t\u1ed1t h\u01a1n.\\n\\n  N\xf3 \u0111\xf2i h\u1ecfi b\u1ea1n ph\u1ea3i thu t\u1eadp trung h\u01a1n v\xe0o nh\u1eefng chi ti\u1ebft nh\u1ecf \u0111\u1ec3 test c\u1ee7a m\xecnh pass, h\u01a1n l\xe0 suy ngh\u0129 v\u1ea9n v\u01a1 v\u1ec1 c\u1ea3 c\xe1i app to \u0111\xf9ng.\\n\\n- Ngo\xe0i ki\u1ec3m th\u1eed, test c\u0169ng l\xe0 docs cho maintainer sau n\xe0y, n\xf3 cung c\u1ea5p chi ti\u1ebft v\u1ec1 c\xe1c \u0111\u1eb7c t\u1ea3 k\u1ef9 thu\u1eadt (specification) c\u1ee7a app.\\n\\n- \xcdt bug h\u01a1n, d\u1ec5 b\u1ea3o tr\xec, ph\xe1t hi\u1ec7n l\u1ed7i s\u1edbm.\\n\\n- Cho b\u1ea1n bi\u1ebft code m\xe0 b\u1ea1n v\u1eeba vi\u1ebft xong n\xf3 l\xe0m h\u1ecfng c\u1ea3 app kh\xf4ng =))\\n\\n# 5. K\u1ebft lu\u1eadn\\n\\n- TDD/BDD th\u1ef1c s\u1ef1 r\u1ea5t t\u1ed1t, n\u1ebfu b\u1ea1n mu\u1ed1n tr\u1edf th\xe0nh m\u1ed9t l\u1eadp tr\xecnh vi\xean t\u1ed1t h\u01a1n, h\xe3y c\u1ed1 g\u1eafng tryhard :v\\n\\n- Th\u01b0\u1eddng m\u1ecdi ng\u01b0\u1eddi hay c\xf3 xu h\u01b0\u1edbng code xong m\u1edbi vi\u1ebft test, v\xe0 m\xecnh c\u0169ng l\xe0 m\u1ed9t trong s\u1ed1 \u0111\xf3 =)). Tuy v\u1eady, h\xe3y c\u1ed1 g\u1eafng vi\u1ebft test case c\u1ee7a m\xecnh th\u1eadt minh b\u1ea1ch, d\u1ec5 hi\u1ec3u, v\xec ch\xednh b\u1ea3n th\xe2n ta v\xe0 c\xe1c maintainer sau n\xe0y.\\n\\n# 6. Tham kh\u1ea3o\\n\\n- [Test-Driven Development (TDD) Resource Site](https://medium.com/pacroy/test-driven-development-tdd-resource-site-tdd-pacroy-com-a02e02396f32)\\n- [Rails: Things you must know about TDD and BDD](http://blog.andolasoft.com/2014/06/rails-things-you-must-know-about-tdd-and-bdd.html)\\n- [9 Benefits of Test Driven Development](https://www.madetech.com/blog/9-benefits-of-test-driven-development)\\n- [20 ADVANTAGES OF TEST DRIVEN DEVELOPMENT](https://apiumhub.com/tech-blog-barcelona/advantages-of-test-driven-development/)\\n- [Hanami Official Guide](http://hanamirb.org/guides/1.2/getting-started/)\\n\\n- [How I test Rails applications](https://m.patrikonrails.com/how-i-test-my-rails-applications-cf150e347a6b)"}]}')}}]);