<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.0">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="moonlight8978's Blog Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="moonlight8978's Blog Blog Atom Feed"><title data-react-helmet="true">Blog | moonlight8978&#x27;s Blog</title><meta data-react-helmet="true" property="og:title" content="Blog | moonlight8978&#x27;s Blog"><meta data-react-helmet="true" name="description" content="Blog"><meta data-react-helmet="true" property="og:description" content="Blog"><meta data-react-helmet="true" property="og:url" content="https://moonlight8978.github.io/blog"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="blog_posts_list"><link data-react-helmet="true" rel="shortcut icon" href="https://avatars.githubusercontent.com/u/26299310?v=4"><link data-react-helmet="true" rel="canonical" href="https://moonlight8978.github.io/blog"><link data-react-helmet="true" rel="alternate" href="https://moonlight8978.github.io/blog" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://moonlight8978.github.io/blog" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.5f3c8191.css">
<link rel="preload" href="/assets/js/runtime~main.2e9fde40.js" as="script">
<link rel="preload" href="/assets/js/main.f5ae6226.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="https://avatars.githubusercontent.com/u/26299310?v=4" alt="moonlight8978" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="https://avatars.githubusercontent.com/u/26299310?v=4" alt="moonlight8978" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">My Site</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/docs/intro">Programming notes</a><a class="navbar__item navbar__link" href="/books/intro">Book notes</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle displayOnlyInLargeViewport_GrZ2 react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT">üåú</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">üåû</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="https://avatars.githubusercontent.com/u/26299310?v=4" alt="moonlight8978" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="https://avatars.githubusercontent.com/u/26299310?v=4" alt="moonlight8978" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">My Site</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/blog">Blog</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/intro">Programming notes</a></li><li class="menu__list-item"><a class="menu__link" href="/books/intro">Book notes</a></li><li class="menu__list-item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper blog-wrapper blog-list-page"><div class="container margin-vert--lg"><div class="row"><div class="col col--3"><div class="sidebar_2ahu thin-scrollbar"><h3 class="sidebarItemTitle_2hhb">All posts</h3><ul class="sidebarItemList_2xAf"><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/cung-tim-hieu-ve-puma-ruby-on-rails">C√πng t√¨m hi·ªÉu v·ªÅ Puma (Ruby on Rails)</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/cuoi-react-native-xem-appium-phan-1-cung-tim-hieu-cach-hoat-dong-cua-appium">C∆∞·ª°i React Native xem Appium (Ph·∫ßn 1 - C√πng t√¨m hi·ªÉu c√°ch ho·∫°t ƒë·ªông c·ªßa Appium)</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/gioi-thieu-ve-kubernetes">Gi·ªõi thi·ªáu v·ªÅ Kubernetes</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/toi-uu-menh-de-where-mysql">T·ªëi ∆∞u m·ªánh ƒë·ªÅ WHERE (MySQL)</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/cung-tim-hieu-ve-actiontext-trong-rails-6">C√πng t√¨m hi·ªÉu v·ªÅ ActionText trong Rails 6</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/cung-tim-hieu-ve-railway-oriented-programming">C√πng t√¨m hi·ªÉu v·ªÅ Railway Oriented Programming</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/mot-vai-mindset-khi-lam-viec-voi-react">M·ªôt v√†i mindset khi l√†m vi·ªác v·ªõi React</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/cung-tim-hieu-ve-nguyen-tu-cua-the-gioi-front-end-phan-2-density-independent-pixel">C√πng t√¨m hi·ªÉu v·ªÅ nguy√™n t·ª≠ c·ªßa th·∫ø gi·ªõi FrontEnd (Ph·∫ßn 2 - Density-independent Pixel)</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/cung-tim-hieu-ve-nguyen-tu-cua-the-gioi-front-end-phan-1-pixel">C√πng t√¨m hi·ªÉu v·ªÅ nguy√™n t·ª≠ c·ªßa th·∫ø gi·ªõi FrontEnd (Ph·∫ßn 1 - Pixel)</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/tdd-bdd-noi-de-hon-lam">TDD/BDD - N√≥i d·ªÖ h∆°n l√†m</a></li></ul></div></div><main class="col col--7"><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_GeHD"><a href="/blog/cung-tim-hieu-ve-puma-ruby-on-rails">C√πng t√¨m hi·ªÉu v·ªÅ Puma (Ruby on Rails)</a></h2><div class="margin-vert--md"><time datetime="2021-05-31T00:00:00.000Z" class="blogPostDate_fNvV">May 31, 2021 ¬∑ 11 min read</time></div><div class="avatar margin-vert--md"><a href="https://github.com/moonlight8978" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img src="https://avatars.githubusercontent.com/u/26299310?v=4" alt="L√™ Sƒ© B√≠ch"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/moonlight8978" target="_blank" rel="noopener noreferrer">L√™ Sƒ© B√≠ch</a></h4><small class="avatar__subtitle">Ruby on Rails/React Developer</small></div></div></header><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="1-m·ªü-ƒë·∫ßu"></a>1. M·ªü ƒë·∫ßu<a class="hash-link" href="#1-m·ªü-ƒë·∫ßu" title="Direct link to heading">#</a></h2><p>Ch·∫Øc h·∫≥n Puma kh√¥ng ph·∫£i m·ªôt c√°i t√™n xa l·∫° ƒë·ªëi v·ªõi m·ªói Rails developer, m·ªôt ph·∫ßn c≈©ng v√¨ ƒë√¢y l√† appserver m·∫∑c ƒë·ªãnh khi t·∫°o m·ªõi m·ªôt project Rails.</p><p>H√£y c√πng nh√¨n qua nh·ªØng config c∆° b·∫£n khi ch·∫°y 1 ·ª©ng d·ª•ng Rails v·ªõi Puma server. <a href="https://github.com/rails/rails/blob/0f5700ac3589081126fbfde1e4037dc1d4166cce/railties/lib/rails/generators/rails/app/templates/config/puma.rb.tt" target="_blank" rel="noopener noreferrer">link</a></p><div class="codeBlockContainer_K1bP"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_eoMF">config/puma.rb</div><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar codeBlockWithTitle_2JqI"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">max_threads_count = ENV.fetch(&quot;RAILS_MAX_THREADS&quot;) { 5 }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">min_threads_count = ENV.fetch(&quot;RAILS_MIN_THREADS&quot;) { max_threads_count }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">threads min_threads_count, max_threads_count</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">worker_timeout 3600 if ENV.fetch(&quot;RAILS_ENV&quot;, &quot;development&quot;) == &quot;development&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">port ENV.fetch(&quot;PORT&quot;) { 3000 }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">environment ENV.fetch(&quot;RAILS_ENV&quot;) { &quot;development&quot; }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">pidfile ENV.fetch(&quot;PIDFILE&quot;) { &quot;tmp/pids/server.pid&quot; }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">workers ENV.fetch(&quot;WEB_CONCURRENCY&quot;) { 2 }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">preload_app!</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">plugin :tmp_restart</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>ƒê·ªëi v·ªõi nh·ªØng ng∆∞·ªùi m·ªõi b·∫Øt ƒë·∫ßu, khi deploy puma, c√≥ l·∫Ω s·∫Ω t·ª´ ch·ªëi hi·ªÉu ƒë·ªëng config tr√™n v√† set m·ªôt s·ªë bi·∫øn m√¥i tr∆∞·ªùng nh∆∞ sau:</p><ul><li><code>WEB_CONCURRENCY</code>: b·∫±ng v·ªõi s·ªë l∆∞·ª£ng vcore/process c·ªßa m√°y</li><li><code>RAILS_MAX_THREADS</code>: ·ªù th√¨ nhi·ªÅu RAM th√¨ set 16, 32 cho o√°ch, kh√¥ng th√¨ th√¥i d√πng m·∫∑c ƒë·ªãnh 5 v√† m·∫∑c do d√≤ng ƒë·ªùi x√¥ ƒë·∫©y :v</li></ul><p>H√£y c√πng t√¨m hi·ªÉu th√™m v·ªÅ Puma ƒë·ªÉ g√≥p ph·∫ßn l√†m ch·ªß t·ª´ng d√≤ng code trong app c·ªßa ch√∫ng ta.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="2-multi-processing-v√†-multi-threading"></a>2. Multi-processing v√† Multi-threading<a class="hash-link" href="#2-multi-processing-v√†-multi-threading" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="21-puma-d√πng-lo·∫°i-n√†o"></a>2.1. Puma d√πng lo·∫°i n√†o?<a class="hash-link" href="#21-puma-d√πng-lo·∫°i-n√†o" title="Direct link to heading">#</a></h3><ul><li>Khi ch·∫°y 1 Rails app m·ªõi t·∫°o, h√£y ƒë·ªÉ √Ω l√∫c boot server, b·∫°n s·∫Ω th·∫•y:</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly log"><div tabindex="0" class="prism-code language-log codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Puma starting in single mode...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">* Puma version: 5.3.1 (ruby 3.0.1-p64) (&quot;Sweetnighter&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">*  Min threads: 5</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">*  Max threads: 5</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">*  Environment: development</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">*          PID: 1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">* Listening on http://0.0.0.0:3000</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Use Ctrl-C to stop</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>ƒê√¢y l√† d·∫•u hi·ªáu cho ta th·∫•y, Rails ƒëang ch·∫°y ·ªü ch·∫ø ƒë·ªô single process (1 process), v√† multi-thread (c·ª• th·ªÉ l√† 5 thread)</p><ul><li>C√≤n khi config deploy, c√≥ th·ªÉ b·∫°n s·∫Ω ƒë∆∞·ª£c 1 ng∆∞·ªùi c√≥ kinh nghi·ªám h∆°n b·∫£o r·∫±ng <em>&quot;B·ªè comment c√°i d√≤ng <code>workers ENV.fetch(&quot;WEB_CONCURRENCY&quot;) { 2 }</code> ƒëi em √™i&quot;</em></li></ul><p>V√† ƒë√¢y l√† k·∫øt qu·∫£ khi ta l√†m nh∆∞ v·∫≠y</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly log"><div tabindex="0" class="prism-code language-log codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">[1] Puma starting in cluster mode...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[1] * Puma version: 5.3.1 (ruby 3.0.1-p64) (&quot;Sweetnighter&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[1] *  Min threads: 5</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[1] *  Max threads: 5</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[1] *  Environment: development</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[1] *   Master PID: 1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[1] *      Workers: 2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[1] *     Restarts: (ÔøΩÔøΩÔøΩ) hot (ÔøΩÔøΩÔøΩ) phased</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[1] * Preloading application</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[1] * Listening on htp://0.0.0.0:3000</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[1] Use Ctrl-C to stop</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[1] - Worker 0 (PID: 16) booted in 0.02s, phase: 0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[1] - Worker 1 (PID: 17) booted in 0.05s, phase: 0</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Puma ƒëang ch·∫°y ƒë·ªìng th·ªùi multi-process (2 process) v√† multi-thread (5 thread)</p><blockquote><p>Multi-process, multi-thread l√† c√°i c·ªßa n·ª£ g√¨ v·∫≠y?</p></blockquote><p>Ch√∫ng ta s·∫Ω t√¨m hi·ªÉu v·ªÅ n√≥ ngay sau ƒë√¢y. Tuy nhi√™n ch√∫ng ta s·∫Ω focus v√†o cluster mode c·ªßa Puma nh√©.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="22-multi-threading"></a>2.2. Multi-threading<a class="hash-link" href="#22-multi-threading" title="Direct link to heading">#</a></h3><p>Tr∆∞·ªõc ti√™n ta h√£y nh·ªõ l·∫°i ƒë·ªãnh nghƒ©a v·ªÅ <code>process</code> - ti·∫øn tr√¨nh, m·ªói khi ta ch·∫°y 1 command n√†o ƒë√≥ (v√≠ d·ª• nh∆∞ <code>ruby xxx.rb</code> hay b·∫≠t chrome ch·∫≥ng h·∫°n), OS s·∫Ω t·∫°o 1 process ƒë·ªÉ x·ª≠ l√Ω command c·ªßa ta.</p><p>M·ªói <em>process</em> c√≥ th·ªÉ t·∫°o ra nhi·ªÅu <em>thread</em> ƒë·ªÉ x·ª≠ l√Ω task (v√≠ d·ª• m·ªói tab chrome ƒë∆∞·ª£c handle b·ªüi 1 thread). C√°c thread ƒë∆∞·ª£c t·∫°o b·ªüi 1 process s·∫Ω share nhau 1 v√πng nh·ªõ (memory), trong shared memory n√†y, m·ªói thread s·∫Ω c√≥ stack, register (google ƒë·ªÉ bi·∫øt th√™m ƒë·ªëng n√†y l√† g√¨ =)) ) ri√™ng c·ªßa m√¨nh. Tuy nhi√™n, vi·ªác chung ƒë·ª•ng memory nh∆∞ tr√™n s·∫Ω d·∫´n ƒë·∫øn 1 v·∫•n ƒë·ªÅ l√† nhi·ªÅu thread c√πng ch·ªçc t·ªõi 1 resource n√†o ƒë√≥, d·∫´n t·ªõi conflict v·ªÅ data, hay c√≤n ƒë∆∞·ª£c bi·∫øt ƒë·∫øn v·ªõi c√°i t√™n nguy hi·ªÉm h∆°n l√† <strong>race condition</strong>. Code c·ªßa ta s·∫Ω c·∫ßn <em>thread-safe</em> (c√°c b·∫°n c√≥ th·ªÉ google th√™m :v)</p><p>ƒê·ªëi v·ªõi ·ª©ng d·ª•ng Ruby th√¨ khi ch·∫°y ·ªü m√¥i tr∆∞·ªùng MRI... √Ä ƒë·∫•y l·∫°i nh·∫Øc t·ªõi MRI, ch·∫Øc nhi·ªÅu ng∆∞·ªùi s·∫Ω th·∫Øc m·∫Øc li·ªáu ƒë√≥ l√† g√¨. ƒê√¢y l√† t√™n c·ªßa 1 Ruby Runtime. Ruby 1 chu·∫©n spec, implement ki·ªÉu g√¨ c≈©ng ƒë∆∞·ª£c, mi·ªÖn l√† ƒë√°p ·ª©ng ƒë∆∞·ª£c spec ƒë√≥ th√¨ ƒë·ªÅu l√† Ruby. C√≥ th·ªÉ k·ªÉ ƒë·∫øn c√°c Runtime ph·ªï bi·∫øn sau</p><ul><li><p>MRI - aka CRuby: Matz‚Äôs Ruby Interpreter (Matz - hay Matsumoto Yukihiro) l√† ng∆∞·ªùi t·∫°o ra runtime n√†y, ƒë∆∞·ª£c vi·∫øt b·∫±ng C, n√™n c√≤n g·ªçi l√† CRuby</p><p>ƒêa s·ªë l√† d√πng MRI</p></li><li><p>JRuby: Ruby implement b·∫±ng Java</p></li><li><p>Rubinius</p></li><li><p>mruby</p></li><li><p>...</p></li></ul><p>MRI c√≥ 1 c∆° ch·∫ø l√† <strong>Global Interpreter Lock</strong> (GIL), khi ch·∫°y multi-thread, n√≥ ch·ªâ cho ph√©p 1 thread ch·∫°y source code Ruby t·∫°i 1 th·ªùi ƒëi·ªÉm, n√™n l√† ta c√≥ nhi·ªÅu thread ƒëi chƒÉng n·ªØa th√¨ c≈©ng ch·ªâ c√≥ 1 thread ƒë∆∞·ª£c ch·∫°y m√† th√¥i.</p><p>Tuy nhi√™n v·ªõi c√°c thao t√°c IO nh∆∞ ƒë·ªçc DB, request external resource, ƒë·ªçc ghi file, ... th√¨ GIL kh√¥ng block. Puma ƒë√£ t·∫≠n d·ª•ng ƒëi·ªÅu n√†y, khi 1 thread ƒëang x·ª≠ l√Ω IO, n√≥ s·∫Ω quay tr·ªü l·∫°i x·ª≠ l√Ω ·ªü process, nh·∫≠n th√™m c√°c request kh√°c ƒë·ªÉ x·ª≠ l√Ω.</p><p>Ch√≠nh v√¨ v·∫≠y, ngay c·∫£ khi ch·ªâ ch·∫°y ·ªü single mode, Puma v·∫´n c√≥ th·ªÉ handle ƒë∆∞·ª£c concurrent request. Tuy nhi√™n v·ªõi c√°c request c·∫ßn th·ªùi gian d√†i ƒë·ªÉ x·ª≠ l√Ω, do ch·ªâ c√≥ 1 thread ƒë∆∞·ª£c ch·∫°y, n√™n request sau s·∫Ω ph·∫£i ch·ªù request tr∆∞·ªõc x·ª≠ l√Ω xong, d·∫´n ƒë·∫øn Puma b·ªã th·ªçt trong tr∆∞·ªùng h·ª£p n√†y.</p><p>Ta c√≥ th·ªÉ ki·ªÉm tra v·ªÅ tr·∫°ng th√°i c√°c thread c·ªßa Puma b·∫±ng ƒëo·∫°n code sau:</p><div class="codeBlockContainer_K1bP"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_eoMF">app/controllers/homes_controller.rb</div><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar codeBlockWithTitle_2JqI"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">class HomesController &lt; ApplicationController</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  def show</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Thread.list.select { |t| t.name&amp;.match?(/puma threadpool \d+/) }.each do |t|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      Rails.logger.info(&quot;Thread #{t.name}: #{t.status}, alive: #{t.alive?}, current: #{t == Thread.current}&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    head :ok</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>V√¨ sao l·∫°i l√† <code>/puma threadpool \d+/</code>? C√°c b·∫°n c√≥ th·ªÉ xem t·∫°i <a href="https://github.com/puma/puma/blob/3e80f7c704e5585da4faa32edf0fa7a0abed3689/lib/puma/thread_pool.rb#L104" target="_blank" rel="noopener noreferrer">ƒë√¢y</a>.</p><div class="codeBlockContainer_K1bP"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_eoMF">config/routes.rb</div><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar codeBlockWithTitle_2JqI"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Rails.application.routes.draw do</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  resource :home</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_eoMF">config/puma.rb</div><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar codeBlockWithTitle_2JqI"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">max_threads_count = ENV.fetch(&#x27;RAILS_MAX_THREADS&#x27;, 5)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">min_threads_count = ENV.fetch(&#x27;RAILS_MIN_THREADS&#x27;) { max_threads_count }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">threads min_threads_count, max_threads_count</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">worker_timeout 3600 if ENV.fetch(&#x27;RAILS_ENV&#x27;, &#x27;development&#x27;) == &#x27;development&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">port ENV.fetch(&#x27;PORT&#x27;, 3000)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">environment ENV.fetch(&#x27;RAILS_ENV&#x27;, &#x27;development&#x27;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">pidfile ENV.fetch(&#x27;PIDFILE&#x27;, &#x27;tmp/pids/server.pid&#x27;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">plugin :tmp_restart</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly curl"><div tabindex="0" class="prism-code language-curl codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">curl http://localhost:3000/home</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">tail -n 50 log/development.log</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>V√† ƒë√¢y l√† output:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly log"><div tabindex="0" class="prism-code language-log codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Thread puma threadpool 001: sleep, alive: true, current: false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Thread puma threadpool 002: sleep, alive: true, current: false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Thread puma threadpool 003: sleep, alive: true, current: false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Thread puma threadpool 004: sleep, alive: true, current: false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Thread puma threadpool 005: run, alive: true, current: true</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>ƒê√≥ ch√≠nh l√† 5 thread c·ªßa ch√∫ng ta, nh∆∞ v√≠ d·ª• l√† thread 5 ƒëang ti·∫øn h√†nh x·ª≠ l√Ω request, c√≤n nh·ªØng thread kh√°c n·∫øu r·∫£nh n√≥ s·∫Ω ·ªü tr·∫°ng th√°i <code>sleep</code>. ·ªû ƒë√¢y c√≥ 1 ƒëi·ªÉm ƒë√°ng ch√∫ √Ω l√† sau khi k·∫øt th√∫c request, thread kh√¥ng b·ªã kill m√† ch·ªâ v·ªÅ tr·∫°ng th√°i <code>sleep</code>, do v·∫≠y n·∫øu ta tu·ª≥ ti·ªán modify bi·∫øn global, n√≥ s·∫Ω ·∫£nh h∆∞·ªüng t·ªõi request ti·∫øp theo m√† thread ƒë√≥ handle.</p><p>V√≠ d·ª•:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">before_action :set_locale</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">def set_locale</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  I18n.locale = params[:locale] || I18n.default_locale</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Kh√¥ng c·∫ßn bi·∫øt code c√°i g√¨, nh∆∞ng modify 1 bi·∫øn global t·∫°i runtime nh∆∞ tr√™n l√† ƒë√£ th·∫•y nguy hi·ªÉm r·ªìi. V√† ta h√£y ti·∫øn h√†nh test xem</p><div class="codeBlockContainer_K1bP"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_eoMF">app/controllers/homes_controller.rb</div><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar codeBlockWithTitle_2JqI"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">class HomesController &lt; ApplicationController</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  def show</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Thread.current.tap { |t| Rails.logger.info(&quot;Current thread #{t.name}: #{t.status}, alive: #{t.alive?}&quot;) }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Rails.logger.info(&quot;Before: #{I18n.locale}&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    I18n.locale = params[:locale]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Rails.logger.info(&quot;After: #{I18n.locale}&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    head :ok</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>r·ªìi sau ƒë√≥ spam kho·∫£ng ch·ª•c c√°i request</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><div tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">curl</span><span class="token plain"> http://localhost:3000/home?locale</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">vi</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>v√† ta s·∫Ω th·∫•y k·∫øt qu·∫£ nh∆∞ sau</p><div class="codeBlockContainer_K1bP"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_eoMF">log/development.log</div><div class="codeBlockContent_hGly log"><div tabindex="0" class="prism-code language-log codeBlock_23N8 thin-scrollbar codeBlockWithTitle_2JqI"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Current thread puma threadpool 003: run, alive: true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Before: en</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">After: vi</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Current thread puma threadpool 003: run, alive: true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Before: vi</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">After: vi</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>C√≥ th·ªÉ d·ªÖ d√†ng nh·∫≠n ra r·∫±ng vi·ªác set <code>I18n.locale = &quot;vi&quot;</code> ·ªü request tr∆∞·ªõc ƒë√£ b·ªã leak sang request sau. N·∫øu ·ªü t·∫•t c·∫£ c√°c request, tr∆∞·ªõc khi x·ª≠ l√Ω ta ƒë·ªÅu set <code>I18n.locale</code> th√¨ vi·ªác leak tr√™n s·∫Ω √≠t ·∫£nh h∆∞·ªüng h∆°n.</p><p>Tuy nhi√™n h√£y th·ª≠ t∆∞·ªüng t∆∞·ª£ng khi app c·ªßa b·∫°n c√≥ ch·ª©a c·∫£ code admin v√† api, b√™n admin c√≥ th·ªÉ ƒë·ªïi ng√¥n ng·ªØ, c√≤n api th√¨ kh√¥ng, th√¨ k·∫øt qu·∫£ s·∫Ω ra sao. Khi admin ƒë·ªïi ng√¥n ng·ªØ, t√¨nh c·ªù, 1 user v√¥ ph√∫c n√†o ƒë√≥ request t·ªõi tr√∫ng c√°i thread v·ª´a handle vi·ªác admin ƒë·ªïi ng√¥n ng·ªØ, v√† API s·∫Ω tr·∫£ v·ªÅ locale c·ªßa √¥ng admin kia :v</p><p>Ch√≠nh v√¨ v·∫≠y, ·ªü docs c·ªßa Rails c≈©ng c√≥ recommend ch√∫ng ta x·ª≠ l√Ω chuy·ªÉn locale b·∫±ng <code>I18n.with_locale</code>, c√°c b·∫°n c√≥ th·ªÉ xem t·∫°i <a href="https://guides.rubyonrails.org/i18n.html#managing-the-locale-across-requests" target="_blank" rel="noopener noreferrer">ƒë√¢y</a></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">around_action :switch_locale</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">def switch_locale(&amp;action)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  locale = params[:locale] || I18n.default_locale</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  I18n.with_locale(locale, &amp;action)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>T√∫m v√°y l·∫°i l√† multi-threading h·ªó tr·ª£ concurrent r·∫•t t·ªët, tuy nhi√™n c≈©ng ·∫©n ch·ª©a 1 v√†i v·∫•n ƒë·ªÅ. N√™n s·∫Ω c·∫ßn ch√∫ √Ω h∆°n khi code.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="23-multi-processing"></a>2.3. Multi-processing<a class="hash-link" href="#23-multi-processing" title="Direct link to heading">#</a></h3><p>M√°y t√≠nh hi·ªán nay ƒëa s·ªë ƒë·ªÅu c√≥ kh√° nhi·ªÅu core, v√† ƒë·ªÅu h·ªó tr·ª£ ƒëa nhi·ªám ƒë·ªÉ t·ªëi ∆∞u ho√° vi·ªác x·ª≠ l√Ω song song. V·∫≠y v·ªõi webserver th√¨ sao? C√≥ c·∫ßn ch·ª©, multi-processing gi√∫p ta c√≥ th·ªÉ x·ª≠ l√Ω th√™m nhi·ªÅu request ƒë·ªìng th·ªùi h∆°n n·ªØa. Tr·ª´ khi server c·ªßa ta qu√° y·∫øu, ch·ª© kh√¥ng th√¨ t·ªôi g√¨, nh√† ch·∫£ c√≥ g√¨ ngo√†i core m√† l·∫°i ch·∫°y ƒë∆°n nh√¢n th√¨ ph√≠ c·ªßa gi·ªùi qu√° :v</p><p>M·∫∑c ƒë·ªãnh Puma s·∫Ω ch·∫°y ·ªü single mode, khi ƒë√≥ ch·ªâ c√≥ 1 process, process n√†y s·∫Ω ƒë·∫£m nh·∫≠n h·∫øt t·ª´ vi·ªác l∆∞u code c·ªßa app, ti·∫øp nh·∫≠n request, ... sau ƒë√≥ s·∫Ω ƒë·∫©y request sang cho c√°c thread x·ª≠ l√Ω nh∆∞ ƒë√£ m√¥ t·∫£ ·ªü tr√™n.</p><p>C√≤n ƒë·ªëi v·ªõi cluster mode, tr∆∞·ªõc h·∫øt Puma s·∫Ω t·∫°o ra m·ªôt master process. T·ª´ process n√†y, d·ª±a v√†o gi√° tr·ªã c·ªßa config d∆∞·ªõi, Puma s·∫Ω <em>fork</em> ƒë·ªÉ t·∫°o ra s·ªë process t∆∞∆°ng ·ª©ng, hay c√≤n g·ªçi l√† <em>worker</em>.</p><div class="codeBlockContainer_K1bP"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_eoMF">config/puma.rb</div><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar codeBlockWithTitle_2JqI"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">workers ENV.fetch(&quot;WEB_CONCURRENCY&quot;) { 2 }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>L·∫°i n√≥i v·ªÅ fork, ƒë√¢y l√† qu√° tr√¨nh m√† 1 process t·∫°o ra 1 process m·ªõi, g·ªçi l√† <em>child process</em>. M·ªói child process ƒë·ªÅu c√≥ process id (PID) ri√™ng bi·ªát, v√† m·ªôt m√¥i tr∆∞·ªùng ri√™ng t√°ch bi·ªát ho√†n to√†n v·ªõi parent process (source code, memory, stack, ...). Kh√¥ng nh∆∞ thread v·∫´n share code v·ªõi process, nh∆∞ng c√≥ stack, register ri√™ng. Do v·∫≠y, c√≥ th·ªÉ n√≥i forking an to√†n v√† b·∫£o m·∫≠t h∆°n so v·ªõi multi-thread.</p><p>Quay tr·ªü l·∫°i v·ªõi Puma, ·ªü cluster mode, master process ch·ªâ ƒë·∫£m nh·∫≠n vi·ªác ti·∫øp nh·∫≠n request, sau ƒë√≥ s·∫Ω b·∫Øn sang c√°c worker ƒë·ªÉ ch√∫ng t·ª± x·ª≠ v·ªõi c√°c thread m√† ch√∫ng spawn. C√°c worker c·ªßa Puma ƒë·ªÅu c√≥ 1 b·∫£n copy source code app ri√™ng, n√™n khi ch·∫°y nhi·ªÅu worker, h√£y ch·∫Øc ch·∫Øn l√† server c·ªßa b·∫°n c√≥ ƒë·ªß RAM :v</p><p>·ªû Ruby, c√≥ th·ªÉ ki·ªÉm tra xem app c·ªßa ta ƒëang ch·∫°y ·ªü process n√†o b·∫±ng c√°ch s·ª≠ d·ª•ng</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Process.pid  # Current child process</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Process.ppid # Parent process</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>H√£y th·ª≠ ·ªü app Rails c·ªßa ta xem</p><div class="codeBlockContainer_K1bP"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_eoMF">app/controllers/homes_controller.rb</div><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar codeBlockWithTitle_2JqI"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">class HomesController &lt; ApplicationController</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  def show</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Rails.logger.info(&quot;Current: #{Process.pid}. Parent: #{Process.ppid}&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    head :ok</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_eoMF">config/puma.rb</div><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar codeBlockWithTitle_2JqI"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">workers 2</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_eoMF">log/development.log</div><div class="codeBlockContent_hGly log"><div tabindex="0" class="prism-code language-log codeBlock_23N8 thin-scrollbar codeBlockWithTitle_2JqI"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Processing by HomesController#show as */*</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Current: 128. Parent: 1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Processing by HomesController#show as */*</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Current: 129. Parent: 1</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><div tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">ps</span><span class="token plain"> aux</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># root         1  0.5  7.1 236000 145864 pts/0   Ssl+ 03:28   0:04 puma 5.3.1 (tcp://0.0.0.0:3000) [app]</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># root         7  0.0  0.1   3544  3192 pts/1    Ss   03:29   0:00 zsh</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># root       128  0.0  6.9 288680 142008 pts/0   Sl+  03:29   0:00 puma: cluster worker 0: 1 [app]</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># root       129  0.0  6.9 288720 142116 pts/0   Sl+  03:29   0:00 puma: cluster worker 1: 1 [app]</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># root       219  0.0  0.0   1640   856 pts/1    R+   03:40   0:00 ps aux</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="3-k·∫øt-lu·∫≠n"></a>3. K·∫øt lu·∫≠n<a class="hash-link" href="#3-k·∫øt-lu·∫≠n" title="Direct link to heading">#</a></h2><p>C·∫£ multi-threading v√† multi-processing ƒë·ªÅu quan tr·ªçng, ch√∫ng g√≥p ph·∫ßn gi√∫p app ta x·ª≠ l√Ω ƒëc concurrent request. Hy v·ªçng b√†i vi·∫øt c√≥ th·ªÉ gi√∫p √≠ch cho c√°c b·∫°n √≠t nhi·ªÅu.</p><p>Ngo√†i ra, v·ªÅ v·∫•n ƒë·ªÅ set s·ªë worker v√† thread ·ªü ph·∫ßn ƒë·∫ßu ƒë√£ n√≥i, t·ªët nh·∫•t ch·∫Øc v·∫´n l√†:</p><ul><li><code>WEB_CONCURRENCY</code> = vcore, ngo√†i ra c√≤n ph·ª• thu·ªôc v√†o RAM n·ªØa</li><li><code>RAILS_MAX_THREADS</code> kh√¥ng c√≥ con s·ªë c·ª• th·ªÉ, ph·ª• thu·ªôc v√†o RAM v√† CPU, nhi·ªÅu RAM, CPU kho·∫ª th√¨ set ƒë∆∞·ª£c c√†ng nhi·ªÅu, nh∆∞ng c≈©ng kh√° l√† h√™n xui, ph·∫£i ti·∫øn h√†nh test r·ªìi m·ªõi cƒÉn ch·ªânh con s·ªë ph√π h·ª£p ƒë∆∞·ª£c =))</li></ul><p>N·∫øu c√≥ sai s√≥t g√¨ c√°c b·∫°n c·ª© g·∫°ch ƒë√° tho·∫£i m√°i √† :v chi ti·∫øt c√≥ th·ªÉ tham kh·∫£o ·ªü <a href="https://devcenter.heroku.com/articles/deploying-rails-applications-with-the-puma-web-server#workers" target="_blank" rel="noopener noreferrer">ƒë√¢y</a></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="4-tham-kh·∫£o"></a>4. Tham kh·∫£o<a class="hash-link" href="#4-tham-kh·∫£o" title="Direct link to heading">#</a></h2><ul><li><a href="https://www.speedshop.co/2015/07/29/scaling-ruby-apps-to-1000-rpm.html" target="_blank" rel="noopener noreferrer">https://www.speedshop.co/2015/07/29/scaling-ruby-apps-to-1000-rpm.html</a></li><li><a href="https://devcenter.heroku.com/articles/concurrency-and-database-connections" target="_blank" rel="noopener noreferrer">https://devcenter.heroku.com/articles/concurrency-and-database-connections</a></li><li><a href="https://devcenter.heroku.com/articles/deploying-rails-applications-with-the-puma-web-server" target="_blank" rel="noopener noreferrer">https://devcenter.heroku.com/articles/deploying-rails-applications-with-the-puma-web-server</a></li><li><a href="http://www.geekride.com/fork-forking-vs-threading-thread-linux-kernel/" target="_blank" rel="noopener noreferrer">http://www.geekride.com/fork-forking-vs-threading-thread-linux-kernel/</a></li><li><a href="https://www.studytonight.com/operating-system/multithreading" target="_blank" rel="noopener noreferrer">https://www.studytonight.com/operating-system/multithreading</a></li><li><a href="https://www.tutorialspoint.com/how-to-create-a-process-in-linux#:~:text=A%20new%20process%20can%20be,newly%20is%20called%20child%20process" target="_blank" rel="noopener noreferrer">https://www.tutorialspoint.com/how-to-create-a-process-in-linux#:~:text=A%20new%20process%20can%20be,newly%20is%20called%20child%20process</a>.</li></ul></div><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog/tags/puma">puma</a><a class="margin-horiz--sm" href="/blog/tags/ruby-on-rails">ruby-on-rails</a><a class="margin-horiz--sm" href="/blog/tags/multi-threading">multi-threading</a><a class="margin-horiz--sm" href="/blog/tags/multi-processing">multi-processing</a></div></footer></article><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_GeHD"><a href="/blog/cuoi-react-native-xem-appium-phan-1-cung-tim-hieu-cach-hoat-dong-cua-appium">C∆∞·ª°i React Native xem Appium (Ph·∫ßn 1 - C√πng t√¨m hi·ªÉu c√°ch ho·∫°t ƒë·ªông c·ªßa Appium)</a></h2><div class="margin-vert--md"><time datetime="2021-01-04T00:00:00.000Z" class="blogPostDate_fNvV">January 4, 2021 ¬∑ 14 min read</time></div><div class="avatar margin-vert--md"><a href="https://github.com/moonlight8978" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img src="https://avatars.githubusercontent.com/u/26299310?v=4" alt="L√™ Sƒ© B√≠ch"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/moonlight8978" target="_blank" rel="noopener noreferrer">L√™ Sƒ© B√≠ch</a></h4><small class="avatar__subtitle">Ruby on Rails/React Developer</small></div></div></header><div class="markdown"><p>Do d√≤ng ƒë·ªùi ƒë∆∞a ƒë·∫©y v√† kh√°ch th√¨ ti·ªÅn √≠t nh∆∞ng l·∫°i th√≠ch h√≠t h√†ng th∆°m (to√†n ƒë√≤i 80~100 coverage -_-) n√™n m√¨nh c≈©ng ƒë√£ kinh qua <a href="https://github.com/callstack/react-native-testing-library" target="_blank" rel="noopener noreferrer">react-native-testing-library</a> m·ªôt th·ªùi gian kha kh√°, v√† c≈©ng ngh·ªãch th·ª≠ <a href="https://github.com/wix/Detox" target="_blank" rel="noopener noreferrer">Detox</a>, nh∆∞ng ch∆∞a th·∫±ng n√†o l√†m m√¨nh h√†i l√≤ng:</p><ul><li>Testing-library: Khi test e2e th√¨ ph·∫£i mock qu√° nhi·ªÅu, kh√° kh√≥ ƒë·ªÉ mock component sao cho ho·∫°t ƒë·ªông gi·ªëng nh∆∞ component th·∫≠t. C√≥ nh·ªØng l√∫c m√¨nh ch·ªâ vi·∫øt ƒë·ªÉ cho % coverage l√™n ch·ª© c√°c fn c·ªßa test ƒë√≥ b·ªã mock h·∫øt, th√†nh ra ch·∫£ c√≥ √Ω nghƒ©a g√¨ nhi·ªÅu. C√°c th√†nh ph·∫ßn UI b·ªã mock h·∫øt, n√™n test pass m√† v·∫´n ch·∫øt l√† ƒëi·ªÅu b√¨nh th∆∞·ªùng nh∆∞ c√¢n ƒë∆∞·ªùng h·ªôp s·ªØa.</li><li>Detox: ch∆°i v·ªõi m·ªói simulator, device th·∫≠t ko r√µ t·ªõi gi·ªù ƒë√£ ƒë∆∞·ª£c ƒë√°nh ƒëi·ªán t·ª≠ ch∆∞a.</li></ul><p>V√† g·∫ßn ƒë√¢y th√¨ m√¨nh ƒë·ªçc l·∫°i <a href="https://reactnative.dev/docs/testing-overview#end-to-end-tests" target="_blank" rel="noopener noreferrer">docs c·ªßa React Native</a> c√≥ recommend th√™m 1 th·∫±ng - Appium. Appium s·ª≠ d·ª•ng driver nh∆∞ XCUITest, UIAutomator, Espresso, ... ƒê∆∞·ª£c c√°c teito (tay to :v) native ·ªü c√¥ng ty b·∫£o m·∫•y th·∫±ng driver tr√™n to√†n l√† h√†ng h·ªãn b√™n native d√πng ƒë·ªÉ ch·∫°y test, n√™n th·ª≠ ngh·ªãch lu√¥n. Sau m·ªôt th·ªùi gian m√†y m√≤ th√¨ kh√° h√†i l√≤ng.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="t·∫°i-sao-l·∫°i-d√πng-appium-m√†-ko-ch·∫°y-c∆°m-cho-kh·ªèe"></a>T·∫°i sao l·∫°i d√πng Appium m√† ko ch·∫°y c∆°m cho kh·ªèe?<a class="hash-link" href="#t·∫°i-sao-l·∫°i-d√πng-appium-m√†-ko-ch·∫°y-c∆°m-cho-kh·ªèe" title="Direct link to heading">#</a></h4><p>N√≥i th·∫ø ch·ª© th·ª±c ra th√¨ ch·∫°y c∆°m kh√¥ng h·ªÅ kh·ªèe t√≠ n√†o ƒë√¢u c√°c b·∫°n.</p><p>Khi ta ph√°t tri·ªÉn 1 feature m·ªõi cho app, ta ph·∫£i test cho c·∫£ nh·ªØng t√≠nh nƒÉng ƒë√£ c√≥, ·∫£nh h∆∞·ªüng t·ªõi ch√∫ng l√† ƒëi·ªÅu kh√≥ tr√°nh kh·ªèi.</p><p>Th√¥ng th∆∞·ªùng dev ch√∫ng ta s·∫Ω nghƒ© l√† &quot;C√≥ tester r·ªìi xo·∫Øn g√¨&quot; ƒë√∫ng kh√¥ng n√†o? Tuy nhi√™n ph·∫≠n dev qu√®n th√¨ c≈©ng v·∫´n ph·∫£i check qua nh·ªØng case c∆° b·∫£n, (test th√™m case d·ªã c√†ng t·ªët) tr∆∞·ªõc khi chuy·ªÉn qua cho tester. Nh∆∞ng kh√¥ng l·∫Ω c·ª© vi·∫øt m·ªôt feature l√† ng·ªìi b·∫≠t app l√™n b·∫•m t·ª´ng n√∫t, ch∆∞a k·ªÉ <del>xe ƒë·∫°p m·ªõi ( m√¨nh c√≥ m·ªôt ng∆∞·ªùi b·∫°n r·∫•t hay nh·∫ßm newbie v√† newbike =)) )</del> newbie kh√¥ng n·∫Øm r√µ h·ªá th·ªëng, lack case l√† ƒëi·ªÅu t·∫•t nhi√™n, h∆°n n·ªØa con ng∆∞·ªùi ch√∫ng ta kh√¥ng gi·ªèi trong nh·ªØng vi·ªác nh√†m ch√°n c√≥ t√≠nh l·∫∑p l·∫°i cao nh∆∞ test app, v√¨ v·∫≠y d√π c√≥ l√† b√¥ l√£o th√¨ c≈©ng s·∫Ω c√≥ l√∫c nh·∫ßm l·∫´n.</p><p>Ngo√†i ra, ·ªü cu·ªën &quot;The Effective Engineer&quot; c·ªßa Edmond Lau (n·∫øu ko c√≥ g√¨ sai s√≥t th√¨ l√† trang 159) c√≥ vi·∫øt:</p><blockquote><p>If you have to do something manually more than twice, then write a tool for the third time</p></blockquote><p>V·∫≠y th√¨ sao ch√∫ng ta kh√¥ng ƒë·ªÉ m√°y l√†m nh·ªØng c√¥ng vi·ªác nh√†m ch√°n nh∆∞ test, v√† focus v√†o nh·ªØng vi·ªác khi·∫øn ta h·ª©ng th√∫ h∆°n. H√£y c√πng h·ªçc vi·∫øt test t·ª± ƒë·ªông cho ·ª©ng d·ª•ng React Native c·ªßa ch√∫ng ta th√¥i n√†o!</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="m·ªôt-v√†i-ki·∫øn-th·ª©c-c·∫ßn-c√≥"></a>M·ªôt v√†i ki·∫øn th·ª©c c·∫ßn c√≥<a class="hash-link" href="#m·ªôt-v√†i-ki·∫øn-th·ª©c-c·∫ßn-c√≥" title="Direct link to heading">#</a></h3><ul><li>React Native, Babel (kh√¥ng c·∫ßn qu√° m√°t t∆°)</li><li>N·∫Øm ƒë∆∞·ª£c c∆° b·∫£n v·ªÅ vi·∫øt unit test (v·ªõi jest, hay g√¨ ƒë√≥ t∆∞∆°ng t·ª±)</li><li>Typescript (optional): do ·ªü b√†i vi·∫øt s·∫Ω d√πng Typescript</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="hardware"></a>Hardware<a class="hash-link" href="#hardware" title="Direct link to heading">#</a></h3><ul><li>M√°y Mac/Hackintosh ƒë·ªÉ build iOS ho·∫∑c m√°y Win (ch·ªâ ch·∫°y ƒë∆∞·ª£c Android th√¥i)</li><li>1 con ƒëi·ªán tho·∫°i iOS ho·∫∑c Android - n√≥i kh√¥ng v·ªõi integration test tr√™n simulator :v</li></ul><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="2-ch·∫°y-th·ª≠-v√≠-d·ª•-nh·ªè"></a>2. Ch·∫°y th·ª≠ v√≠ d·ª• nh·ªè<a class="hash-link" href="#2-ch·∫°y-th·ª≠-v√≠-d·ª•-nh·ªè" title="Direct link to heading">#</a></h1><p>T·ª± d∆∞ng nh·ªìi m·ªôt ƒë·ªëng l√Ω thuy·∫øt su√¥ng, trong khi kh√¥ng bi·∫øt m√¨nh s·∫Ω l√†m g√¨ c√≥ ph·∫£i r·∫•t ch√°n kh√¥ng n√†o? V√¨ v·∫≠y tr∆∞·ªõc ti√™n ta h√£y ch·∫°y th·ª≠ m·ªôt v√≠ d·ª• nh·ªè sau tr∆∞·ªõc ƒë√£: ƒêƒÉng k√≠ account</p><p>V√≠ d·ª• sau d√πng Typescript + WebdriverIO, v√† c√≥ c·∫•u tr√∫c t∆∞∆°ng ƒë∆∞∆°ng v·ªõi v√≠ d·ª• tr√™n trang ch·ªß c·ªßa Appium <a href="https://github.com/appium/appium/tree/master/sample-code/javascript-webdriverio" target="_blank" rel="noopener noreferrer">link</a> (C√°c b·∫°n c≈©ng c√≥ th·ªÉ v√†o link tr√™n b·∫±ng truy c·∫≠p <a href="http://appium.io/" target="_blank" rel="noopener noreferrer">trang ch·ªß Appium</a> r·ªìi b·∫•m v√†o n√∫t Examples), t·∫•t nhi√™n ƒë·ªÉ go pro th√¨ ta s·∫Ω ko code nh∆∞ v·∫≠y, m√¨nh s·∫Ω th·ª±c hi·ªán refactor v√† chuy·ªÉn ƒë·ªïi m√¥i tr∆∞·ªùng ch·∫°y test ·ªü c√°c b√†i sau ( n·∫øu c√≥ =)) ).</p><p>Sau khi setup Babel c√πng v·ªõi Jest (do Jest lu√¥n ƒëi k√®m v·ªõi React Native n√™n m√¨nh d√πng lu√¥n ƒë·ªÉ demo cho th√¢n thi·ªán), h√£y vi·∫øt 1 ƒëo·∫°n test ƒë∆°n gi·∫£n cho qu√° tr√¨nh sign up c·ªßa ta.
Hi·ªán t·∫°i m√¨nh ch·ªâ fill nh·ªØng field text input, v√¨ field select, date picker vi·∫øt kh√° d√†i, n√™n m√¨nh s·∫Ω ƒë·ªÅ c·∫≠p sau.</p><blockquote><p>N√≥i nhi·ªÅu qu√°, code ƒë√¢u?</p></blockquote><p>V√¢ng, code ƒë√¢y (·ªü d∆∞·ªõi c√≥ gi·∫£i th√≠ch code)</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword module" style="font-style:italic">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">BrowserObject</span><span class="token imports punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token imports"> remote</span><span class="token imports punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token imports"> </span><span class="token imports maybe-class-name">RemoteOptions</span><span class="token imports"> </span><span class="token imports punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword module" style="font-style:italic">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;webdriverio&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> iOS</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token maybe-class-name">RemoteOptions</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  path</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;/wd/hub&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  host</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;localhost&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  port</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">4723</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  capabilities</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    platformName</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;iOS&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    automationName</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;XCUITest&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    deviceName</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;iPhone (2)&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    platformVersion</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;14.1&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    app</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;org.reactjs.native.example.LearnRnE2eTest&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    udid</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> process</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">env</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token constant" style="color:rgb(130, 170, 255)">IOS_DEVICE_UUID</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    xcodeOrgId</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;xxx&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    xcodeSigningId</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Apple Development&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> android</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token maybe-class-name">RemoteOptions</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  path</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;/wd/hub&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  host</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;localhost&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  port</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">4723</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  capabilities</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    automationName</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;UiAutomator2&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    platformName</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;android&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    platformVersion</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;8.0.0&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    deviceName</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;BH9057609A&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    appPackage</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;com.learnrne2etest&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    appActivity</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;.MainActivity&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">let</span><span class="token plain"> client</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token maybe-class-name">BrowserObject</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">beforeEach</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">async</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  client </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="font-style:italic">await</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">remote</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">iOS</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token console class-name" style="color:rgb(255, 203, 107)">console</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">error</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">client</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">afterEach</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">async</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword control-flow" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">client</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword control-flow" style="font-style:italic">await</span><span class="token plain"> client</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">deleteSession</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:rgb(130, 170, 255)">scrollTo</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">async</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">a11yId</span><span class="token parameter operator" style="color:rgb(137, 221, 255)">:</span><span class="token parameter"> string</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword control-flow" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">client</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">options</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">capabilities</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">platformName</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">===</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;android&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword control-flow" style="font-style:italic">await</span><span class="token plain"> client</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">execute</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;mobile: scroll&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      strategy</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;accessibility id&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      selector</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> a11yId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">it</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;sign up the user&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">async</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> toRegistrationScreenButton </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="font-style:italic">await</span><span class="token plain"> client</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">$</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;~login/toRegistrationScreenButton&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword control-flow" style="font-style:italic">await</span><span class="token plain"> toRegistrationScreenButton</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">click</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> registerButton </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="font-style:italic">await</span><span class="token plain"> client</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">$</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;~registration/registerButton&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword control-flow" style="font-style:italic">await</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">scrollTo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;registration/toLoginScreenButton&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword control-flow" style="font-style:italic">await</span><span class="token plain"> registerButton</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">click</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword control-flow" style="font-style:italic">await</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">scrollTo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;registration/usernameInput-error&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">let</span><span class="token plain"> usernameError </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="font-style:italic">await</span><span class="token plain"> client</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">$</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;~registration/usernameInput-error&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">expect</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword control-flow" style="font-style:italic">await</span><span class="token plain"> usernameError</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">getText</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">toMatch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Please enter username&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> passwordError </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="font-style:italic">await</span><span class="token plain"> client</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">$</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;~registration/passwordInput-error&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">expect</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword control-flow" style="font-style:italic">await</span><span class="token plain"> passwordError</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">getText</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">toMatch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Please enter password&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">let</span><span class="token plain"> passwordConfirmationError </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="font-style:italic">await</span><span class="token plain"> client</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">$</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;~registration/passwordConfirmationInput-error&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">expect</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword control-flow" style="font-style:italic">await</span><span class="token plain"> passwordConfirmationError</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">getText</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">toMatch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Please confirm your password&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> fullNameError </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="font-style:italic">await</span><span class="token plain"> client</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">$</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;~registration/fullNameInput-error&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">expect</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword control-flow" style="font-style:italic">await</span><span class="token plain"> fullNameError</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">getText</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">toMatch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Please enter your full name&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> usernameInput </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="font-style:italic">await</span><span class="token plain"> client</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">$</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;~registration/usernameInput&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword control-flow" style="font-style:italic">await</span><span class="token plain"> usernameInput</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">setValue</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;user..01&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  usernameError </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="font-style:italic">await</span><span class="token plain"> client</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">$</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;~registration/usernameInput-error&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">expect</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword control-flow" style="font-style:italic">await</span><span class="token plain"> usernameError</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">getText</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">toMatch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Username must be alphabet and numbers&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword control-flow" style="font-style:italic">await</span><span class="token plain"> usernameInput</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">setValue</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;user&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> passwordInput </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="font-style:italic">await</span><span class="token plain"> client</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">$</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;~registration/passwordInput&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword control-flow" style="font-style:italic">await</span><span class="token plain"> passwordInput</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">setValue</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;password&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> passwordConfirmationInput </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="font-style:italic">await</span><span class="token plain"> client</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">$</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;~registration/passwordConfirmationInput&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword control-flow" style="font-style:italic">await</span><span class="token plain"> passwordConfirmationInput</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">setValue</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;password123&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  passwordConfirmationError </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="font-style:italic">await</span><span class="token plain"> client</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">$</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;~registration/passwordConfirmationInput-error&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">expect</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword control-flow" style="font-style:italic">await</span><span class="token plain"> passwordConfirmationError</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">getText</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">toMatch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Password confirmation must match your password&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword control-flow" style="font-style:italic">await</span><span class="token plain"> passwordConfirmationInput</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">setValue</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;password&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> fullNameInput </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="font-style:italic">await</span><span class="token plain"> client</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">$</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;~registration/fullNameInput&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword control-flow" style="font-style:italic">await</span><span class="token plain"> fullNameInput</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">setValue</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Test&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword control-flow" style="font-style:italic">await</span><span class="token plain"> client</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">hideKeyboard</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword control-flow" style="font-style:italic">await</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">scrollTo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;registration/toLoginScreenButton&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword control-flow" style="font-style:italic">await</span><span class="token plain"> registerButton</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">click</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword control-flow" style="font-style:italic">await</span><span class="token plain"> client</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">waitUntil</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      client</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">$</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;~registrationCompleted/toLoginScreenButton&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">then</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">element</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> element</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">isDisplayed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> timeout</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">10000</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Chi ti·∫øt source code c√≥ th·ªÉ xem t·∫°i <a href="https://github.com/moonlight8978/learn-rn-e2e-test/tree/jest/e2e" target="_blank" rel="noopener noreferrer">ƒë√¢y</a></p><p>Source code c·ªßa c√°c m√†n h√¨nh c√≥ th·ªÉ xem t·∫°i ƒë√¢y:</p><ul><li>Login screen <a href="https://github.com/moonlight8978/learn-rn-e2e-test/blob/jest/rn-app/src/screens/login/login.tsx" target="_blank" rel="noopener noreferrer">link</a></li><li>Registration screen <a href="https://github.com/moonlight8978/learn-rn-e2e-test/blob/jest/rn-app/src/screens/registration/registration.tsx" target="_blank" rel="noopener noreferrer">link</a></li></ul><p>V√† ƒë√¢y l√† th√†nh ph·∫©m:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ yarn test</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">PASS</span><span class="token plain">  __tests__</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">sign</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">up</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">spec</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">ts</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">18.817</span><span class="token plain"> s</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ‚úì sign up the </span><span class="token function" style="color:rgb(130, 170, 255)">user</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">17179</span><span class="token plain"> ms</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token maybe-class-name">Test</span><span class="token plain"> </span><span class="token maybe-class-name">Suites</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> passed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> total</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token maybe-class-name">Tests</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain">       </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> passed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> total</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token maybe-class-name">Snapshots</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain">   </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> total</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token maybe-class-name">Time</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain">        </span><span class="token number" style="color:rgb(247, 140, 108)">18.869</span><span class="token plain"> s</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> estimated </span><span class="token number" style="color:rgb(247, 140, 108)">29</span><span class="token plain"> s</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token maybe-class-name">Ran</span><span class="token plain"> all test suites</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token property-access">‚ú®</span><span class="token plain">  </span><span class="token maybe-class-name">Done</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">in</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">21.80</span><span class="token plain">s</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><table><thead><tr><th align="center">iOS</th><th align="center">Android</th></tr></thead><tbody><tr><td align="center"><img src="https://images.viblo.asia/30a3e57a-44ab-4c56-b4cf-0047bb221353.gif"></td><td align="center"><img src="https://images.viblo.asia/907005db-f46a-40ea-9b3c-f269fe06646d.gif"></td></tr></tbody></table><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="v√≠-d·ª•-tr√™n-l√†m-g√¨"></a>V√≠ d·ª• tr√™n l√†m g√¨?<a class="hash-link" href="#v√≠-d·ª•-tr√™n-l√†m-g√¨" title="Direct link to heading">#</a></h3><ol><li><p>T·ª´ m√†n <strong>Login</strong>, b·∫•m v√†o button „ÄåCreate an account„Äç <code>login/toRegistrationScreenButton</code> ƒë·ªÉ v√†o m√†n <strong>Registration</strong></p></li><li><p>T·∫°i m√†n <strong>Registration</strong></p><p>1.1.B·∫•m v√†o n√∫t „ÄåRegister„Äç<code>registration/registerButton</code>, do m√°y Android c·ªßa m√¨nh m√†n h∆°i ng·∫Øn, n√™n tr∆∞·ªõc khi click ph·∫£i scroll t·ªõi element ƒë√≥ tr∆∞·ªõc.</p><p>1.2. Do ch∆∞a fill g√¨ n√™n expect error message hi·ªÉn th·ªã t∆∞∆°ng ·ª©ng</p><p>1.3. Fill „Äåuser..01„Äçv√†o input username, do field n√†y ch·ªâ nh·∫≠n alphabet v√† s·ªë, n√™n gi√° tr·ªã ƒë√≥ ko h·ª£p l·ªá, expect hi·ªÉn th·ªã error message</p><p>1.4. Fill username 1 gi√° tr·ªã h·ª£p l·ªá „Äåuser„Äç</p><p>1.5. Fill password „Äåpassword„Äç</p><p>1.6. Fill password confirmation„Äåpassword123„Äç, do ko match password ƒë√£ nh·∫≠p n√™n s·∫Ω hi·ªÉn th·ªã error</p><p>1.7. Fill password confirmation h·ª£p l·ªá „Äåpassword„Äç</p><p>1.8. Fill full name</p><p>1.9. B·∫•m v√†o n√∫t „ÄåRegister„Äç</p></li><li><p>User ƒë∆∞·ª£c chuy·ªÉn qua m√†n RegistrationCompleted, n√™n ta expect button ·ªü m√†n n√†y ƒë∆∞·ª£c hi·ªÉn th·ªã.</p></li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="ph√¢n-t√≠ch-m·ªôt-v√†i-note-v·ªÅ-c√∫-ph√°p"></a>Ph√¢n t√≠ch m·ªôt v√†i note v·ªÅ c√∫ ph√°p<a class="hash-link" href="#ph√¢n-t√≠ch-m·ªôt-v√†i-note-v·ªÅ-c√∫-ph√°p" title="Direct link to heading">#</a></h3><p>C√∫ ph√°p c·ªßa WebdriverIO nh√¨n kh√° trong s√°ng v√† d·ªÖ hi·ªÉu, n√™n m√¨nh s·∫Ω kh√¥ng gi·∫£i th√≠ch nhi·ªÅu, tuy nhi√™n c√≥ m·ªôt v√†i ch√∫ √Ω d∆∞·ªõi ƒë√¢y cho c√°c b·∫°n.</p><ul><li><p>Khi t√¨m element, m√¨nh ƒë√£ d√πng <code>~</code>, ƒë√¢y l√† shorthand ƒë·ªÉ t√¨m element theo <code>accessibility id</code> c·ªßa WebdriverIO, tu·ª≥ theo OS m√† ta s·∫Ω ph·∫£i g√°n prop kh√°c nhau ƒë·ªÉ c√≥ th·ªÉ d√πng ƒë∆∞·ª£c strategy t√¨m theo <code>accessibility id</code> n√†y <a href="https://github.com/webdriverio/native-demo-app/blob/master/js/config/TestProperties.js" target="_blank" rel="noopener noreferrer">link</a>, ch·ªâ v√¨ c√°i n√†y m√† m√¨nh m·∫•t v√†i ti·∫øng, ko hi·ªÉu t·∫°i sao ko t√¨m th·∫•y element =))</p><ul><li>·ªû b√™n iOS ta ph·∫£i d√πng <code>testID</code>, v√† tr√°nh g√°n <code>accessibilityLabel</code> v√† <code>accessibilityHint</code> cho component.</li><li>·ªû b√™n Android, h√£y d√πng <code>accessibilityLabel</code></li></ul><ul><li>C√°c b·∫°n c√≥ th·ªÉ tham kh·∫£o c√°c strategy kh√°c ·ªü docs c·ªßa webdriverio <a href="https://webdriver.io/docs/selectors.html" target="_blank" rel="noopener noreferrer">link</a></li></ul></li><li><p>T·∫°i sao l·∫°i d√πng <code>accessibility id</code> m√† kh√¥ng d√πng content c·ªßa n√≥?</p><ul><li>ƒê√∫ng ra l√† khi b·∫•m button hay thao t√°c tr√™n m√†n h√¨nh, ch√∫ng ta n√™n d√πng text c·ªßa n√≥, ƒë·ªÉ khi text (requirement) thay ƒë·ªïi th√¨ test c≈©ng o·∫≥ng. Nh∆∞ng m√† c∆° b·∫£n l√† do <del>h∆°i b·∫≠n</del> l∆∞·ªùi =)) v√† tr∆∞·ªùng h·ª£p accessibility id ƒë√∫ng nh∆∞ng text sai th√¨ ph·∫£i ch·∫•p nh·∫≠n th√¥i √† =))</li></ul></li></ul><ul><li><p>Do API c·ªßa WebdriverIO to√†n tr·∫£ v·ªÅ Promise, n√™n h·∫ßu nh∆∞ c√¢u l·ªánh n√†o c≈©ng c·∫ßn ph·∫£i d√πng <code>async/await</code>, c√°c b·∫°n c√≥ th·ªÉ s·ª≠ d·ª•ng k√®m package <a href="https://www.npmjs.com/package/@wdio/sync" target="_blank" rel="noopener noreferrer"><code>@wdio/sync</code></a> ƒë·ªÉ API c·ªßa WebdriverIO tr·ªü n√™n ƒë·ªìng b·ªô.</p></li><li><p>C√°c b·∫°n c√≥ ƒë·ªÉ √Ω ƒëo·∫°n code ·ªü <code>beforeEach</code> v√† <code>afterEach</code> kh√¥ng? M·ªói test, ch√∫ng ta ƒëang t·∫°o ra m·ªôt session m·ªõi, v√† xo√° session ƒë√≥ sau m·ªói test. N·∫øu d√πng CLI c·ªßa wdio th√¨ s·∫Ω thu·∫≠n ti·ªán h∆°n.</p></li><li><p>Options <code>xcodeOrgId</code> v√† <code>xcodeSigningId</code> b√™n trong <code>capabilities</code> c·ªßa <code>RemoteOptions</code> iOS</p><ul><li><p>ƒê·ªÉ ch·∫°y test tr√™n thi·∫øt b·ªã iOS, Appium s·∫Ω c√†i m·ªôt ph·∫ßn m·ªÅm t√™n l√† <code>WebDriverAgent</code> l√™n thi·∫øt b·ªã, v√† ƒë·ªÉ c√†i ƒë·∫∑t ƒë∆∞·ª£c, ta ph·∫£i cung c·∫•p developer team v√† signing certificate.</p><p>C√°c b·∫°n c√≥ th·ªÉ xem th√™m t·∫°i ƒë√¢y <a href="http://appium.io/docs/en/drivers/ios-xcuitest-real-devices/" target="_blank" rel="noopener noreferrer">link</a></p><p><img src="https://images.viblo.asia/8915c299-098f-4f94-a9a4-cbdf450e371b.jpg"></p></li></ul></li><li><p>ƒê·ªëi v·ªõi thi·∫øt b·ªã th·∫≠t th√¨ ta c·∫ßn th√™m UUID, c√≥ th·ªÉ xem c√°ch t√¨m UUID t·∫°i <a href="https://www.idownloadblog.com/2018/11/20/how-to-find-udid-iphone-xs-max-xr/" target="_blank" rel="noopener noreferrer">ƒë√¢y</a></p></li><li><p><code>capabilities</code> c·ªßa Android</p><ul><li><p>ƒê·ªÉ l·∫•y <code>deviceName</code>, h√£y ch·∫°y <code>adb devices</code></p></li><li><p><code>com.learnrne2etest</code> v√† <code>.MainActivity</code> c√≥ th·ªÉ l·∫•y t·ª´ <code>android/app/src/main/AndroidManifest.xml</code></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly xml"><div tabindex="0" class="prism-code language-xml codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">manifest</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">package</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">com.learnrne2etest</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">&lt;!-- ... --&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">activity</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name namespace" style="color:rgb(178, 204, 214)">android:</span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">name</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">.MainActivity</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">&lt;!-- ... --&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">activity</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">manifest</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Ho·∫∑c tham kh·∫£o b√†i sau <a href="http://www.automationtestinghub.com/apppackage-and-appactivity-name/" target="_blank" rel="noopener noreferrer">link</a></p></li></ul></li></ul><p>C∆∞·ª°i ng·ª±a xem hoa nh∆∞ v·∫≠y ƒë·ªß r·ªìi, ch√∫ng ta h√£y c√πng t√¨m hi·ªÉu th√™m v·ªÅ c√°ch ho·∫°t ƒë·ªông c·ªßa Appium</p><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="3-ki·∫øn-tr√∫c-flow-c·ªßa-appium"></a>3. Ki·∫øn tr√∫c, flow c·ªßa Appium<a class="hash-link" href="#3-ki·∫øn-tr√∫c-flow-c·ªßa-appium" title="Direct link to heading">#</a></h1><p><img src="https://images.viblo.asia/d5fa4bea-70c4-4bfa-9d89-03aac8d9a92c.jpg"></p><p>Appium d·ª±a tr√™n ki·∫øn tr√∫c client-server, b·∫£n th√¢n Appium l√† 1 server, c√≥ th·ªÉ d·ªÖ d√†ng nh·∫≠n th·∫•y ƒëi·ªÅu n√†y ·ªü ƒëo·∫°n config.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ts"><div tabindex="0" class="prism-code language-ts codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> iOS</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token maybe-class-name">RemoteOptions</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  path</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;/wd/hub&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  host</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;localhost&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  port</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">4723</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// ...</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="31-test-library--webdriver-client"></a>3.1. Test library + WebDriver client<a class="hash-link" href="#31-test-library--webdriver-client" title="Direct link to heading">#</a></h4><p>Khi vi·∫øt test, ta s·∫Ω d√†nh ph·∫ßn l·ªõn th·ªùi gian ƒë·ªÉ l√†m vi·ªác v·ªõi ch√∫ng, nh∆∞ v√≠ d·ª• ·ªü ph·∫ßn 2, ta ƒë√£ s·ª≠ d·ª•ng Jest (v·ªõi c√°c c√¢u l·ªánh <code>it</code>, <code>describe</code>, <code>afterEach</code>, <code>afterAll</code>) l√† c√¥ng c·ª• ƒë·ªÉ ch·∫°y test, v√† WebdriverIO (v·ªõi <code>$</code>, <code>click()</code>, <code>setValue(value)</code>) ƒë·ªÉ giao ti·∫øp v·ªõi Appium server.</p><p>Ngo√†i b·ªô ƒë√¥i n√†y, ch√∫ng ta c√≥ th·ªÉ s·ª≠ d·ª•ng b·∫•t c·ª© ng√¥n ng·ªØ n√†o m√† ta th√≠ch (mi·ªÖn l√† Appium n√≥ support :v), t·ª´ Ruby, Python cho ƒë·∫øn PHP, C#, c√≥ th·ªÉ xem list t·∫°i <a href="http://appium.io/docs/en/about-appium/appium-clients/index.html" target="_blank" rel="noopener noreferrer">ƒë√¢y</a></p><p>Nh∆∞ng m√† m√¨nh recommend combo sau:</p><ul><li><p>Ng√¥n ng·ªØ: JS/TS th√¢n thi·ªán v·ªõi React Native dev</p></li><li><p>WebDriver client: <a href="https://webdriver.io/" target="_blank" rel="noopener noreferrer">WebdriverIO</a> v√¨ trong ƒë√°m client, th·∫±ng n√†y nhi·ªÅu star tr√™n github nh·∫•t =))</p></li></ul><ul><li>Test library: <a href="https://jasmine.github.io/index.html" target="_blank" rel="noopener noreferrer">jasmine</a><ul><li>V√¨ n√≥ c√≥ c√∫ ph√°p gi·ªëng Jest, m√† anh em code React Native th√¨ qu√° quen thu·ªôc v·ªõi Jest r·ªìi</li><li>L√† 1 trong 3 test framework ƒë∆∞·ª£c WebdriverIO support s·∫µn ƒë·ªÉ go pro =)) (ngo√†i ra c√≤n c√≥ mocha v√† cucumber), d√πng Jest n·∫øu l·ªói th√¨ ph·∫£i t·ª± m√†y m√≤ th√¥i :v</li></ul></li></ul><p>Nh∆∞ ƒë√£ n√≥i ·ªü tr√™n, Appium √°p d·ª•ng ki·∫øn tr√∫c client-server. Khi ta vi·∫øt nh·ªØng c√¢u l·ªánh sau</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ts"><div tabindex="0" class="prism-code language-ts codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// ./__tests__/sign-up.spec.ts</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">await</span><span class="token plain"> passwordConfirmationInput</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">setValue</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;password123&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>n·∫øu ƒë·ªÉ √Ω log ta c√≥ th·ªÉ th·∫•y nh·ªØng d√≤ng log d∆∞·ªõi ƒë√¢y, webdriverio ch·ªâ ƒë∆°n thu·∫ßn g·ª≠i 1 HTTP request t·ªõi server, server l√†m g√¨ th√¨ ch√∫ng ta s·∫Ω t√¨m hi·ªÉu sau :v</p><ul><li>iOS</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token constant" style="color:rgb(130, 170, 255)">HTTP</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">--</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">POST</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">wd</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">hub</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">session</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">b891507e</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">4</span><span class="token plain">d84</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">4e62</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">a5b2</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">e9110c529c9e</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">element</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token number" style="color:rgb(247, 140, 108)">6</span><span class="token maybe-class-name">F000000</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">0000</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">0000</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token constant" style="color:rgb(130, 170, 255)">E00E</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">000000000000</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">value</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token constant" style="color:rgb(130, 170, 255)">HTTP</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;text&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;password123&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">debug</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token constant" style="color:rgb(130, 170, 255)">W3C</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">b891507e</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token maybe-class-name">Calling</span><span class="token plain"> </span><span class="token maybe-class-name">AppiumDriver</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">setValue</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">with</span><span class="token plain"> args</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;password123&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;6F000000-0000-0000-E00E-000000000000&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;b891507e-4d84-4e62-a5b2-e9110c529c9e&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">debug</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token maybe-class-name">XCUITest</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token maybe-class-name">Executing</span><span class="token plain"> command </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;setValue&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">debug</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token constant" style="color:rgb(130, 170, 255)">WD</span><span class="token plain"> </span><span class="token known-class-name class-name" style="color:rgb(255, 203, 107)">Proxy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token maybe-class-name">Matched</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;/element/6F000000-0000-0000-E00E-000000000000/value&#x27;</span><span class="token plain"> to command name </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;setValue&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">debug</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token maybe-class-name">Protocol</span><span class="token plain"> </span><span class="token maybe-class-name">Converter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token maybe-class-name">Added</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;text&#x27;</span><span class="token plain"> property </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;password123&quot;</span><span class="token plain"> to </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;setValue&#x27;</span><span class="token plain"> request body</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">debug</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token constant" style="color:rgb(130, 170, 255)">WD</span><span class="token plain"> </span><span class="token known-class-name class-name" style="color:rgb(255, 203, 107)">Proxy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token maybe-class-name">Proxying</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token constant" style="color:rgb(130, 170, 255)">POST</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">element</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token number" style="color:rgb(247, 140, 108)">6</span><span class="token maybe-class-name">F000000</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">0000</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">0000</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token constant" style="color:rgb(130, 170, 255)">E00E</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">000000000000</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> to </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token constant" style="color:rgb(130, 170, 255)">POST</span><span class="token plain"> http</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token number" style="color:rgb(247, 140, 108)">127.0</span><span class="token number" style="color:rgb(247, 140, 108)">.0</span><span class="token number" style="color:rgb(247, 140, 108)">.1</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token number" style="color:rgb(247, 140, 108)">8100</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">session</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token number" style="color:rgb(247, 140, 108)">01</span><span class="token maybe-class-name">BFCDD1</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">27</span><span class="token maybe-class-name">D7</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">4904</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token constant" style="color:rgb(130, 170, 255)">A95A</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token constant" style="color:rgb(130, 170, 255)">C75086994546</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">element</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token number" style="color:rgb(247, 140, 108)">6</span><span class="token maybe-class-name">F000000</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">0000</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">0000</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token constant" style="color:rgb(130, 170, 255)">E00E</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">000000000000</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">with</span><span class="token plain"> body</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;value&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;p&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;a&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;s&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;s&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;w&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;o&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;r&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;d&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;1&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;2&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;3&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;text&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;password123&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">debug</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token constant" style="color:rgb(130, 170, 255)">WD</span><span class="token plain"> </span><span class="token known-class-name class-name" style="color:rgb(255, 203, 107)">Proxy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token maybe-class-name">Got</span><span class="token plain"> response </span><span class="token keyword" style="font-style:italic">with</span><span class="token plain"> status </span><span class="token number" style="color:rgb(247, 140, 108)">200</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;value&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token keyword null nil" style="font-style:italic">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;sessionId&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;01BFCDD1-27D7-4904-A95A-C75086994546&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">debug</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token constant" style="color:rgb(130, 170, 255)">W3C</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">b891507e</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token maybe-class-name">Responding</span><span class="token plain"> to client </span><span class="token keyword" style="font-style:italic">with</span><span class="token plain"> driver</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">setValue</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> result</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token keyword null nil" style="font-style:italic">null</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token constant" style="color:rgb(130, 170, 255)">HTTP</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token operator" style="color:rgb(137, 221, 255)">--</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">POST</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">wd</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">hub</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">session</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">b891507e</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">4</span><span class="token plain">d84</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">4e62</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">a5b2</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">e9110c529c9e</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">element</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token number" style="color:rgb(247, 140, 108)">6</span><span class="token maybe-class-name">F000000</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">0000</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">0000</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token constant" style="color:rgb(130, 170, 255)">E00E</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">000000000000</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">value </span><span class="token number" style="color:rgb(247, 140, 108)">200</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">821</span><span class="token plain"> ms </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">14</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><ul><li>Android</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token console class-name" style="color:rgb(255, 203, 107)">console</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">info</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token number" style="color:rgb(247, 140, 108)">2020</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">12</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">31</span><span class="token maybe-class-name">T02</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token number" style="color:rgb(247, 140, 108)">12</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token number" style="color:rgb(247, 140, 108)">23.288</span><span class="token plain">Z </span><span class="token constant" style="color:rgb(130, 170, 255)">INFO</span><span class="token plain"> webdriver</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">COMMAND</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">findElement</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;accessibility id&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;login/toRegistrationScreenButton&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    at node_modules</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">@wdio</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">logger</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">build</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">node</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">js</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token number" style="color:rgb(247, 140, 108)">76</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token number" style="color:rgb(247, 140, 108)">9</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token console class-name" style="color:rgb(255, 203, 107)">console</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">info</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token number" style="color:rgb(247, 140, 108)">2020</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">12</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">31</span><span class="token maybe-class-name">T02</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token number" style="color:rgb(247, 140, 108)">12</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token number" style="color:rgb(247, 140, 108)">23.289</span><span class="token plain">Z </span><span class="token constant" style="color:rgb(130, 170, 255)">INFO</span><span class="token plain"> webdriver</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token constant" style="color:rgb(130, 170, 255)">POST</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> http</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">localhost</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token number" style="color:rgb(247, 140, 108)">4723</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">wd</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">hub</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">session</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token number" style="color:rgb(247, 140, 108)">7</span><span class="token plain">fc4b801</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">deae</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">49</span><span class="token plain">dc</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">947</span><span class="token plain">d</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">292</span><span class="token plain">d67ba5467</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">element</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    at node_modules</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">@wdio</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">logger</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">build</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">node</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">js</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token number" style="color:rgb(247, 140, 108)">76</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token number" style="color:rgb(247, 140, 108)">9</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token console class-name" style="color:rgb(255, 203, 107)">console</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">info</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token number" style="color:rgb(247, 140, 108)">2020</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">12</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">31</span><span class="token maybe-class-name">T02</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token number" style="color:rgb(247, 140, 108)">12</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token number" style="color:rgb(247, 140, 108)">23.289</span><span class="token plain">Z </span><span class="token constant" style="color:rgb(130, 170, 255)">INFO</span><span class="token plain"> webdriver</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">DATA</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    using</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;accessibility id&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    value</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;login/toRegistrationScreenButton&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    at node_modules</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">@wdio</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">logger</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">build</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">node</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">js</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token number" style="color:rgb(247, 140, 108)">76</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token number" style="color:rgb(247, 140, 108)">9</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token console class-name" style="color:rgb(255, 203, 107)">console</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">info</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token number" style="color:rgb(247, 140, 108)">2020</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">12</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">31</span><span class="token maybe-class-name">T02</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token number" style="color:rgb(247, 140, 108)">12</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token number" style="color:rgb(247, 140, 108)">23.414</span><span class="token plain">Z </span><span class="token constant" style="color:rgb(130, 170, 255)">INFO</span><span class="token plain"> webdriver</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">RESULT</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;element-6066-11e4-a52e-4f735466cecf&#x27;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;bb82f194-16d1-4ba0-a520-33f47e117211&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token constant" style="color:rgb(130, 170, 255)">ELEMENT</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;bb82f194-16d1-4ba0-a520-33f47e117211&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    at node_modules</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">@wdio</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">logger</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">build</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">node</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">js</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token number" style="color:rgb(247, 140, 108)">76</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token number" style="color:rgb(247, 140, 108)">9</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="32-appium-server-automation-tool-devices"></a>3.2. Appium server, Automation tool, Devices<a class="hash-link" href="#32-appium-server-automation-tool-devices" title="Direct link to heading">#</a></h4><p>ƒê√¢y l√† ph·∫ßn x∆∞∆°ng s·ªëng trong ki·∫øn tr√∫c c·ªßa Appium, n√≥ ƒë·∫£m nh·∫≠n vi·ªác handle request t·ª´ client, giao ti·∫øp v·ªõi native automation tool ƒë·ªÉ th·ª±c thi nh·ªØng command m√† ta c·∫ßn.</p><p>Appium server expose ra API theo chu·∫©n JSON Wire Protocol (WebDriver Protocol). Tu·ª≥ v√†o target l√† iOS hay Android, n√≥ s·∫Ω c√≥ c√°ch ho·∫°t ƒë·ªông ri√™ng ƒë·ªÉ ph√π h·ª£p v·ªõi n·ªÅn t·∫£ng ƒë√≥.</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="321-appium-meets-ios"></a>3.2.1. Appium meets iOS<a class="hash-link" href="#321-appium-meets-ios" title="Direct link to heading">#</a></h5><p>Quay tr·ªü l·∫°i ƒëo·∫°n log ·ªü ph·∫ßn 3.1, n√≥ ƒë√£ √≠t nhi·ªÅu g·ª£i √Ω cho ta c√°ch ho·∫°t ƒë·ªông c·ªßa Appium</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token constant" style="color:rgb(130, 170, 255)">HTTP</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">--</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">POST</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">wd</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">hub</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">session</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">b891507e</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">4</span><span class="token plain">d84</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">4e62</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">a5b2</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">e9110c529c9e</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">element</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token number" style="color:rgb(247, 140, 108)">6</span><span class="token maybe-class-name">F000000</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">0000</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">0000</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token constant" style="color:rgb(130, 170, 255)">E00E</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">000000000000</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">value</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">debug</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token constant" style="color:rgb(130, 170, 255)">WD</span><span class="token plain"> </span><span class="token known-class-name class-name" style="color:rgb(255, 203, 107)">Proxy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token maybe-class-name">Proxying</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token constant" style="color:rgb(130, 170, 255)">POST</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">element</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token number" style="color:rgb(247, 140, 108)">6</span><span class="token maybe-class-name">F000000</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">0000</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">0000</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token constant" style="color:rgb(130, 170, 255)">E00E</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">000000000000</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> to </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token constant" style="color:rgb(130, 170, 255)">POST</span><span class="token plain"> http</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token number" style="color:rgb(247, 140, 108)">127.0</span><span class="token number" style="color:rgb(247, 140, 108)">.0</span><span class="token number" style="color:rgb(247, 140, 108)">.1</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token number" style="color:rgb(247, 140, 108)">8100</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">session</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token number" style="color:rgb(247, 140, 108)">01</span><span class="token maybe-class-name">BFCDD1</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">27</span><span class="token maybe-class-name">D7</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">4904</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token constant" style="color:rgb(130, 170, 255)">A95A</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token constant" style="color:rgb(130, 170, 255)">C75086994546</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">element</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token number" style="color:rgb(247, 140, 108)">6</span><span class="token maybe-class-name">F000000</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">0000</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">0000</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token constant" style="color:rgb(130, 170, 255)">E00E</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">000000000000</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>C√≥ th·ªÉ d·ªÖ th·∫•y Appium server ƒë∆°n gi·∫£n ch·ªâ proxy request c·ªßa ta t·ªõi 1 server kh√°c ch·∫°y ·ªü port 8100 <code>http://127.0.0.1:8100</code>.</p><blockquote><p>O√°t d·ªù ph∆∞·ªõc? Th·∫±ng n√†o ƒëang ch·∫°y ·ªü port 8100 v·∫≠y?</p></blockquote><p>ƒê√≥ l√† <a href="https://github.com/facebookarchive/WebDriverAgent" target="_blank" rel="noopener noreferrer">WebDriverAgent server</a>, ban ƒë·∫ßu ƒë∆∞·ª£c ph√°t tri·ªÉn b·ªüi √¥ng l·ªõn <strong>Facebook</strong>, appium ƒë√£ fork v·ªÅ th√™m m·∫Øm th√™m mu·ªëi g√¨ ƒë√≥ v√†o.</p><p>WDA gi√∫p giao ti·∫øp v·ªõi XCUITest ƒë·ªÉ c√≥ th·ªÉ ƒëi·ªÅu khi·ªÉn device/simulator iOS t·ª´ xa. B·∫£n th√¢n n√≥ c≈©ng ƒë√£ support s·∫µn Webdriver Protocol, v·∫≠y n√™n ch·∫Øc h·∫≥n dev Appium ƒë√£ nghƒ© nh∆∞ sau</p><blockquote><p>T·ªôi g√¨ m√† ph·∫£i code l·∫°i, c√≥ s·∫µn h√†ng ngon r·ªìi th√¨ d√πng lu√¥n th√¥i =))</p></blockquote><p>WDA l√†m g√¨ v·ªõi device th√¨ m√¨nh xin skip, v√¨ c≈©ng ko bi·∫øt =)) C√°c b·∫°n c√≥ th·ªÉ t·ª± m√¨nh t√¨m hi·ªÉu s√¢u h∆°n n·∫øu c√≥ h·ª©ng th√∫ v·ªõi n√≥.</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="322-appium-meets-android"></a>3.2.2. Appium meets Android<a class="hash-link" href="#322-appium-meets-android" title="Direct link to heading">#</a></h5><p>V·ªõi Android, ta c√≥ √≠t g·ª£i √Ω h∆°n</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token number" style="color:rgb(247, 140, 108)">2020</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">12</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">31</span><span class="token maybe-class-name">T02</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token number" style="color:rgb(247, 140, 108)">12</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token number" style="color:rgb(247, 140, 108)">23.289</span><span class="token plain">Z </span><span class="token constant" style="color:rgb(130, 170, 255)">INFO</span><span class="token plain"> webdriver</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token constant" style="color:rgb(130, 170, 255)">POST</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> http</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">localhost</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token number" style="color:rgb(247, 140, 108)">4723</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">wd</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">hub</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">session</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token number" style="color:rgb(247, 140, 108)">7</span><span class="token plain">fc4b801</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">deae</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">49</span><span class="token plain">dc</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">947</span><span class="token plain">d</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">292</span><span class="token plain">d67ba5467</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">element</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token number" style="color:rgb(247, 140, 108)">2020</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">12</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">31</span><span class="token maybe-class-name">T02</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token number" style="color:rgb(247, 140, 108)">12</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token number" style="color:rgb(247, 140, 108)">23.414</span><span class="token plain">Z </span><span class="token constant" style="color:rgb(130, 170, 255)">INFO</span><span class="token plain"> webdriver</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">RESULT</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;element-6066-11e4-a52e-4f735466cecf&#x27;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;bb82f194-16d1-4ba0-a520-33f47e117211&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token constant" style="color:rgb(130, 170, 255)">ELEMENT</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;bb82f194-16d1-4ba0-a520-33f47e117211&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Kh√¥ng th·∫•y proxy g√¨ ƒë√≥ ph·∫£i kh√¥ng n√†o? ƒê√∫ng v·∫≠y, v√¨ n√≥ c√≥ proxy ƒë√¢u :v</p><p>·ªû version m·ªõi nh·∫•t, Appium s·ª≠ d·ª•ng <a href="https://github.com/appium/appium-android-driver" target="_blank" rel="noopener noreferrer">appium-android-driver</a> ƒë·ªÉ giao ti·∫øp v·ªõi UIAutomator2. V·∫≠y giao ti·∫øp th·∫ø n√†o?</p><p>M·ªói khi b·∫Øt ƒë·∫ßu ch·∫°y test, Appium s·∫Ω c√†i app <strong>Appium Settings</strong> tr√™n device c·ªßa ta, th·∫±ng n√†y s·∫Ω m·ªü port <a href="https://github.com/appium/appium-android-driver/blob/19b949383e9e1300edd25982e33bb76689a001d2/lib/driver.js#L17" target="_blank" rel="noopener noreferrer">4724</a> tr√™n device c·ªßa ta v√† expose ra m·ªôt v√†i API h·ªá th·ªëng. Appium server <em>abc</em> v·ªõi app ƒë√£ c√†i tr√™n (qua HTTP), v√† n√≥ s·∫Ω <em>xyz</em> v·ªõi UIAutomator2 ƒë·ªÉ th·ª±c hi·ªán c√°c command.</p><p><img src="https://images.viblo.asia/0b1ef505-609d-4412-b9d6-65508df7358d.jpg"></p><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="4-k·∫øt-lu·∫≠n"></a>4. K·∫øt lu·∫≠n<a class="hash-link" href="#4-k·∫øt-lu·∫≠n" title="Direct link to heading">#</a></h1><p>L√† m·ªôt dev, ch√∫ng ta kh√¥ng ƒë∆∞·ª£c ch·ªß quan, l·ªá thu·ªôc v√†o b√™n tester, m√† h√£y t·ª± m√¨nh ki·ªÉm th·ª≠ tr∆∞·ªõc khi chuy·ªÉn qua cho h·ªç. Test ch·∫°y c∆°m l√† m·ªôt c√¥ng vi·ªác nh√†m ch√°n, v·∫≠y th√¨ t·∫°i sao ch√∫ng ta kh√¥ng l√†m cho n√≥ th√∫ v·ªã h∆°n b·∫±ng c√°ch automate n√≥. Tuy s·∫Ω c√≥ l√∫c c·∫ßn m·ªôt s·ªë th·ªß thu·∫≠t, hay l√† ph·∫£i d√πng nhi·ªÅu command kh√° l·∫±ng nh·∫±ng ( nh∆∞ c√°i datepicker ch·∫≥ng h·∫°n =)) ), nh∆∞ng m·ªôt khi ch·∫°y ƒë∆∞·ª£c nh·∫•t ƒë·ªãnh n√≥ s·∫Ω ƒëem l·∫°i cho c√°c b·∫°n m·ªôt c·∫£m gi√°c ph√™ nh∆∞ con t√™ t√™ =))</p><p>Code e2e c·ªßa b√†i vi·∫øt ch·ªâ l√† nh·ªØng ƒëo·∫°n code t·∫°m b·ª£, c√°c b·∫°n mu·ªën go pro c√≥ th·ªÉ tham kh·∫£o <a href="https://github.com/webdriverio/appium-boilerplate" target="_blank" rel="noopener noreferrer">appium-boilerplate</a> c·ªßa webdriverio v·ªÅ c√°ch chia module, c≈©ng nh∆∞ setup project. N·∫øu c√≥ th·ªùi gian m√¨nh s·∫Ω vi·∫øt th√™m v·ªÅ vi·ªác refactor ƒë·ªëng code t·∫°m b·ª£ tr√™n ƒë·ªÉ go pro =)) Gi·ªù th√¨ xin t·∫°m bi·ªát c√°c b·∫°n.</p></div><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog/tags/react-native">react-native</a><a class="margin-horiz--sm" href="/blog/tags/e-2-e-testing">e2e-testing</a><a class="margin-horiz--sm" href="/blog/tags/appium">appium</a></div></footer></article><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_GeHD"><a href="/blog/gioi-thieu-ve-kubernetes">Gi·ªõi thi·ªáu v·ªÅ Kubernetes</a></h2><div class="margin-vert--md"><time datetime="2019-11-21T00:00:00.000Z" class="blogPostDate_fNvV">November 21, 2019 ¬∑ 11 min read</time></div><div class="avatar margin-vert--md"><a href="https://github.com/moonlight8978" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img src="https://avatars.githubusercontent.com/u/26299310?v=4" alt="L√™ Sƒ© B√≠ch"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/moonlight8978" target="_blank" rel="noopener noreferrer">L√™ Sƒ© B√≠ch</a></h4><small class="avatar__subtitle">Ruby on Rails/React Developer</small></div></div></header><div class="markdown"><p>Ng√†y nay, container ƒë√£ l√† 1 th·ª© g√¨ ƒë√≥ qu√° ph·ªï bi·∫øn, nh·ªØng n·ªÅn t·∫£ng cloud c·ªßa Amazon, Google, hay Microsoft, v.v... ƒë·ªÅu ƒë√£ h·ªó tr·ª£ deploy container. V√† ·ªü local, hay nh·ªØng server test, m·ªçi ng∆∞·ªùi c≈©ng ƒëang d·∫ßn chu·∫©n sang container v√¨ s·ª± ti·ªán l·ª£i c·ªßa ch√∫ng.</p><p>Tuy nhi√™n khi s·ªë l∆∞·ª£ng container l·ªõn d·∫ßn, ch√∫ng ng√†y c√†ng tr·ªü n√™n r·∫Øc r·ªëi, vi·ªác control resource, network, volume c·ªßa m·ªôt s·ªë l∆∞·ª£ng l·ªõn container ng√†y c√†ng kh√≥. Ch√≠nh v√¨ l√Ω do ƒë√≥, m·ªôt s·ªë n·ªÅn t·∫£ng qu·∫£n l√Ω container ƒë√£ ra ƒë·ªùi nh∆∞ Docker Swarm, Kubernetes, ...</p><p>V·ªõi m·ªôt h·ªá th·ªëng nh·ªè, ta c√≥ th·ªÉ s·ª≠ d·ª•ng Docker Swarm, s·ª≠ d·ª•ng n√≥ r·∫•t d·ªÖ v√† ƒë∆°n gi·∫£n. Kubernetes cho ph√©p ta customize nhi·ªÅu th·ª© trong h·ªá th·ªëng h∆°n, tuy nhi√™n c√°i gi√° c·ªßa n√≥ l√† kh√≥ s·ª≠ d·ª•ng h∆°n nhi·ªÅu Docker Swarm.</p><p>Note: Ta kh√¥ng bao gi·ªù so s√°nh Kubernetes v·ªõi Docker, v√¨ k8s th·ª© l√† management tool, c√≤n docker l√† container runtime.</p><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="2-ki·∫øn-tr√∫c-h·∫°-t·∫ßng-c·ªßa-kubernetes"></a>2. Ki·∫øn tr√∫c h·∫° t·∫ßng c·ªßa Kubernetes<a class="hash-link" href="#2-ki·∫øn-tr√∫c-h·∫°-t·∫ßng-c·ªßa-kubernetes" title="Direct link to heading">#</a></h1><p><img src="https://images.viblo.asia/8fd57971-e1c9-41dd-b205-0ce88a356e50.png"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="21-master-components"></a>2.1 Master components<a class="hash-link" href="#21-master-components" title="Direct link to heading">#</a></h3><p>Nh·ªØng components tr√™n master node s·∫Ω ƒë√≥ng vai tr√≤ l√† control plane c·ªßa cluster. VD nh∆∞: scheduling c√°c pod, ...</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="211-etcd"></a>2.1.1 etcd<a class="hash-link" href="#211-etcd" title="Direct link to heading">#</a></h5><p>ƒê√¢y l√† database ph√¢n t√°n, s·ª≠ d·ª•ng Raft l√†m c∆° ch·∫ø ƒë·ªìng thu·∫≠n.</p><p>State c·ªßa cluster (config, node info, IP addresses, ...) ƒë·ªÅu ƒë∆∞·ª£c l∆∞u tr·ªØ t·∫°i ƒë√¢y.</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="212-kube-scheduler"></a>2.1.2 kube-scheduler<a class="hash-link" href="#212-kube-scheduler" title="Direct link to heading">#</a></h5><p>C√≥ nhi·ªám v·ª• schedule pod t·ªõi nh·ªØng node c√≥ ƒë·ªß resource, v√† ƒë·∫£m b·∫£o pod ƒë·∫°t ƒë∆∞·ª£c expected status.</p><p>C√≥ th·ªÉ hi·ªÉu ƒë∆°n gi·∫£n ƒë√¢y l√† m·ªôt v√≤ng l·∫∑p v√¥ t·∫≠n, ƒë∆∞a nh·ªØng pod m·ªõi ƒë∆∞·ª£c t·∫°o v√†o 1 queue, t·ª´ng item trong ƒë√≥ s·∫Ω ƒë∆∞·ª£c schedule t·ªõi node th·ªèa m√£n.</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="213-kube-apiserver"></a>2.1.3 kube-apiserver<a class="hash-link" href="#213-kube-apiserver" title="Direct link to heading">#</a></h5><p>API Server ƒë∆°n thu·∫ßn l√† 1 REST API c·ªßa Kubernetes cluster.</p><p>Khi mu·ªën t·∫°o, c·∫≠p nh·∫≠t, hay x√≥a nh·ªØng resource c·ªßa h·ªá th·ªëng nh∆∞ pod, ingress, ... th√¨ ƒë·ªÅu c·∫ßn th√¥ng qua API Server, ch·ª© kh√¥ng call th·∫≥ng t·ªõi kube-scheduler, etcd, ...</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="214-kube-controller-manager"></a>2.1.4 kube-controller-manager<a class="hash-link" href="#214-kube-controller-manager" title="Direct link to heading">#</a></h5><p>Ch·∫°y nhi·ªÅu controller process. M·ªói controller c√≥ nhi·ªám v·ª• kh√°c nhau nh∆∞:</p><ul><li>Node Controller</li><li>Replication Controller</li><li>...</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="22-node-components"></a>2.2 Node components<a class="hash-link" href="#22-node-components" title="Direct link to heading">#</a></h3><p>L√† nh·ªØng component ƒë∆∞·ª£c c√†i ƒë·∫∑t tr√™n t·∫•t c·∫£ c√°c node, gi√∫p qu·∫£n l√Ω container tr√™n node, logging, qu·∫£n l√Ω network, ...</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="221-kubelet"></a>2.2.1 kubelet<a class="hash-link" href="#221-kubelet" title="Direct link to heading">#</a></h5><p>C√≥ nhi·ªám v·ª• qu·∫£n l√Ω container, ƒë·∫£m b·∫£o container ch·∫°y ch√≠nh x√°c, kubelet ch·ªâ qu·∫£n l√Ω container do k8s t·∫°o.</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="222-kube-proxy"></a>2.2.2 kube-proxy<a class="hash-link" href="#222-kube-proxy" title="Direct link to heading">#</a></h5><p>L√† m·ªôt network proxy, d√πng ƒë·ªÉ forward request t·ªõi h·∫° t·∫ßng c·ªßa k8s.</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="223-container-runtime"></a>2.2.3 Container runtime<a class="hash-link" href="#223-container-runtime" title="Direct link to heading">#</a></h5><p>Ch·∫Øn ch·∫Øn ta kh√¥ng th·ªÉ thi·∫øu runtime cho container, n√≥ c√≥ th·ªÉ l√† rkt, Docker, ... hay b·∫•t c·ª© th·ª© g√¨ kh√°c.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="23-ho·∫°t-ƒë·ªông"></a>2.3 Ho·∫°t ƒë·ªông<a class="hash-link" href="#23-ho·∫°t-ƒë·ªông" title="Direct link to heading">#</a></h3><p>Ch√∫ng ta s·∫Ω c√πng xem nh·ªØng component tr√™n s·∫Ω k·∫øt h·ª£p v·ªõi nhau ho·∫°t ƒë·ªông ra sao, th√¥ng qua vi·ªác t·∫°o 1 Pod qua <code>kubectl</code> CLI.</p><p><strong>Pod</strong> ·ªü ƒë√¢y c√≥ th·ªÉ coi l√† 1 m√°y ·∫£o, hay 1 container nh∆∞ Docker cho d·ªÖ h√¨nh dung.</p><p><img src="https://images.viblo.asia/f19795c9-fbc9-48e1-9391-53fc439c1391.jpg"></p><ul><li>Tr∆∞·ªõc ti√™n ta s·ª≠ d·ª•ng <code>kubectl</code> ƒë·ªÉ y√™u c·∫ßu t·∫°o 1 Pod. B·∫£n ch·∫•t c·ªßa command n√†y l√† s·∫Ω th·ª±c hi·ªán 1 HTTP request t·ªõi <strong>apiserver</strong> c·ªßa cluster.</li><li><strong>apiserver</strong> s·∫Ω th·ª±c hi·ªán ghi l·∫°i current state, v√† desired state c·ªßa cluster l·∫°i v√†o <strong>etcd</strong> (asynchronous)</li><li><strong>etcd</strong> s·∫Ω notify l·∫°i <strong>apiserver</strong> khi entry ƒë∆∞·ª£c t·∫°o th√†nh c√¥ng</li><li>Ti·∫øp theo <strong>kube-scheduler</strong> s·∫Ω th·ª±c hi·ªán vi·ªác schedule Pod. Khi t√¨m th·∫•y node th√≠ch h·ª£p, n√≥ s·∫Ω b√°o cho <strong>apiserver</strong> l√† Pod ƒë√≥ ƒë√£ ƒë∆∞·ª£c bind v√†o node n√†o. <strong>apiserver</strong> s·∫Ω l·∫°i update v√†o <strong>etcd</strong></li><li><strong>kubelet</strong> t·∫°i node ƒë√≥ s·∫Ω th·ª±c hi·ªán vi·ªác theo d√µi container t·∫°o b·ªüi <strong>container runtime</strong> (Docker), xem ch√∫ng c√≥ ch·∫°y ƒë√∫ng v·ªõi PodSpec kh√¥ng. <strong>kubelet</strong> s·∫Ω g·ªçi t·ªõi <strong>apiserver</strong> ƒë·ªÉ update state c·ªßa Pod ƒë√≥ th∆∞·ªùng xuy√™n.</li></ul><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="3-ki·∫øn-tr√∫c-c·ªßa-·ª©ng-d·ª•ng-tr√™n-kubernetes"></a>3. Ki·∫øn tr√∫c c·ªßa ·ª©ng d·ª•ng tr√™n Kubernetes<a class="hash-link" href="#3-ki·∫øn-tr√∫c-c·ªßa-·ª©ng-d·ª•ng-tr√™n-kubernetes" title="Direct link to heading">#</a></h1><p>Ta s·∫Ω ch·ªâ t·∫≠p trung v√†o 3 y·∫øu t·ªë ch√≠nh ƒë·ªÉ m·ªôt h·ªá th·ªëng c√≥ th·ªÉ ho·∫°t ƒë·ªông ƒë∆∞·ª£c:</p><ul><li>·ª®ng d·ª•ng</li><li>Network</li><li>Storage</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="31-pod"></a>3.1 Pod<a class="hash-link" href="#31-pod" title="Direct link to heading">#</a></h3><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="pod-l√†-g√¨"></a>Pod l√† g√¨<a class="hash-link" href="#pod-l√†-g√¨" title="Direct link to heading">#</a></h5><p><strong>Pod</strong> l√† ƒë∆°n v·ªã nh·ªè nh·∫•t trong cluster. M·ªói Pod c√≥ IP ri√™ng, v√† c√≥ th·ªÉ ch·ª©a nhi·ªÅu container, nh·ªØng container trong c√πng 1 Pod c√≥ th·ªÉ giao ti·∫øp v·ªõi nhau qua localhost. V√¨ v·∫≠y, c√≥ th·ªÉ coi Pod l√† m·ªôt m√°y ·∫£o cho d·ªÖ h√¨nh dung.</p><p>Tuy nhi√™n ƒë·ªÉ ƒë∆°n gi·∫£n, ng∆∞·ªùi ta th∆∞·ªùng ch·ªâ ch·∫°y 1 container tr√™n m·ªói Pod, khi ƒë√≥ ta s·∫Ω l√†m vi·ªác v·ªõi Pod thay v√¨ v·ªõi t·ª´ng container ri√™ng l·∫ª.</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="init-container"></a>Init container<a class="hash-link" href="#init-container" title="Direct link to heading">#</a></h5><p>Pod c√≥ h·ªó tr·ª£ init container (1 ho·∫∑c nhi·ªÅu ƒë·ªÅu ƒë∆∞·ª£c). Tr∆∞·ªõc khi app container (container ch√≠nh - v√≠ d·ª• container v·ªõi command <code>rails s</code>) ch·∫°y, t·∫•t c·∫£ init container s·∫Ω ƒë∆∞·ª£c ch·∫°y l·∫ßn l∆∞·ª£t, c√°i tr∆∞·ªõc th√†nh c√¥ng r·ªìi ƒë·∫øn c√°i sau ch·∫°y.</p><p>V√≠ d·ª• nh∆∞ 1 ·ª©ng d·ª•ng Rails, ta c√≥ th·ªÉ settings <code>rails s</code> l√†m app container, c√≤n <code>rails db:create db:migrate</code> s·∫Ω l√†m init container.</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="controller"></a>Controller<a class="hash-link" href="#controller" title="Direct link to heading">#</a></h5><p>Controller l√† 1 concept trong Kubernetes, n√≥ d√πng ƒë·ªÉ theo d√µi 1 lo·∫°i Resource n√†o ƒë√≥. <strong>kube-controller-manager</strong> c√≥ nhi·ªám v·ª• qu·∫£n l√Ω nh·ªØng controller n√†y.</p><p>V·ªÅ m·∫∑t k·ªπ thu·∫≠t th√¨ ƒë√¢y ƒë∆°n thu·∫ßn l√† 1 v√≤ng l·∫∑p v√¥ h·∫°n (<em>control loop</em>) ƒë·ªÉ c√≥ th·ªÉ ƒëi·ªÅu ch·ªânh state c·ªßa cluster sao cho n√≥ ƒë·∫°t t·ªõi ƒë∆∞·ª£c desired state.</p><p>Tuy nhi√™n ƒëang trong m·ª•c Pod n√™n ta s·∫Ω ch·ªâ ƒë·ªÅ c·∫≠p t·ªõi controller theo d√µi Pod trong ph·∫ßn n√†y.</p><ul><li><p><code>Deployment</code>:</p><p>Ta s·∫Ω s·ª≠ d·ª•ng <code>Deployment</code> khi c·∫ßn deploy 1 ho·∫∑c nhi·ªÅu replica (th∆∞·ªùng l√† stateless).</p><p>Th·ª© t·ª± kh·ªüi ƒë·ªông, identify c·ªßa nh·ªØng replica (Pod) l√† ho√†n to√†n ng·∫´u nhi√™n.</p></li><li><p><code>StatefulSet</code>:</p><p>N·∫øu app c·ªßa ch√∫ng ta l√† stateful (v√≠ d·ª• nh∆∞ 1 set MySQL v·ªõi 1 master v√† 2 slave), khi ƒë√≥ vi·ªác c√≥ 1 stable identity l√† r·∫•t quan tr·ªçng. Ngo√†i ra v·ªõi m·ªói replica trong <code>StatefulSet</code>, Kubernetes s·∫Ω cung c·∫•p cho n√≥ m·ªôt storage ri√™ng.</p><p><code>StatefulSet</code> th√™m prefix <code>0</code>, <code>1</code>, <code>2</code>, ... l√† th·ª© t·ª± kh·ªüi ƒë·ªông c·ªßa pod v√†o t√™n pod.</p><p>Khi ƒë√≥ network identity, c≈©ng nh∆∞ storage c·ªßa Pod s·∫Ω tr·ªü n√™n stable. N·∫øu mysql-0 c·ªßa ta l√† master, n√≥ s·∫Ω lu√¥n l√† master, v√† n√≥ c≈©ng lu√¥n request t·ªõi storage c·ªßa master.</p></li><li><p><code>DaemonSet</code>:</p><p>Ta d√πng <code>DaemonSet</code> trong tr∆∞·ªùng h·ª£p mu·ªën t·∫•t c·∫£ c√°c node ƒë·ªÅu ph·∫£i ch·∫°y 1 Pod n√†o ƒë√≥.</p><p>V√≠ d·ª• nh∆∞ storage cluster nh∆∞ <strong>glusterd</strong>, hay log agent nh∆∞ <strong>fluentd</strong>, ...</p></li><li><p><code>Job</code>:</p><p>Khi ta c·∫ßn ch·∫°y one-off Pod. V√≠ d·ª• nh∆∞ vi·ªác import master data.</p></li><li><p><code>CronJob</code>:</p><p>Nh∆∞ t√™n g·ªçi c·ªßa n√≥, c·ª© ƒë·ªãnh k√¨ n√≥ s·∫Ω t·∫°o Pod ƒë·ªÉ th·ª±c hi·ªán job.</p></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="32-networking"></a>3.2 Networking<a class="hash-link" href="#32-networking" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="321-service"></a>3.2.1 Service<a class="hash-link" href="#321-service" title="Direct link to heading">#</a></h4><p>Tr√™n m√¥i tr∆∞·ªùng production, r·∫•t hi·∫øm khi ta th·∫•y 1 service ch·ªâ ch·∫°y tr√™n 1 server. Thay v√¨ th·∫ø, th∆∞·ªùng s·∫Ω c√≥ 2 ho·∫∑c nhi·ªÅu h∆°n server c√πng ch·∫°y, khi server n√†y ch·∫øt, ta c√≥ th·ªÉ forward request t·ªõi nh·ªØng server heo-th√¨ (healthy) c√≤n l·∫°i (trong tr∆∞·ªùng h·ª£p c√≥ set load balancer v√† healthcheck), kh√¥ng l√†m cho service c·ªßa ta ng·ªèm lu√¥n.</p><p>Tuy nhi√™n IP c·ªßa Pod trong cluster lu√¥n thay ƒë·ªïi, v·∫≠y th√¨ ta bi·∫øt ph·∫£i setup cho load balancer nh∆∞ th·∫ø n√†o? V√† ƒë√¢y ch√≠nh l√† ƒë·∫•t di·ªÖn c·ªßa <code>Service</code>.</p><p><code>Service</code> l√† m·ªôt t·∫≠p h·ª£p c√°c Pod, th∆∞·ªùng s·∫Ω d√πng <code>label</code> ƒë·ªÉ group c√°c Pod.</p><p>Th√¥ng th∆∞·ªùng, m·ªói <code>Service</code> s·∫Ω ƒë∆∞·ª£c g√°n cho 1 cluster IP, Kubernetes s·∫Ω cung c·∫•p DNS name, v√† ƒë·ªìng th·ªùi c≈©ng load-balance cho c√°c Pod c·ªßa <code>Service</code>.</p><p><img src="https://images.viblo.asia/2a7f4968-7280-47eb-a225-60ab2f06ab6e.png"></p><p>Ta c≈©ng c√≥ th·ªÉ s·ª≠ d·ª•ng <code>Service</code> cho external endpoint.</p><p>V√≠ d·ª• khi h·ªá th·ªëng c·∫ßn call ƒë·∫øn <em><a href="https://google.com.vn" target="_blank" rel="noopener noreferrer">https://google.com.vn</a></em>. Tuy nhi√™n ta l·∫°i kh√¥ng mu·ªën call tr·ª±c ti·∫øp, hay hardcode trong code, m√† mu·ªën endpoint n√†y c≈©ng tr·ªü th√†nh 1 ph·∫ßn c·ªßa cluster, ƒë·ªÉ d·ªÖ qu·∫£n l√Ω. Khi ƒë√≥ ta c√≥ th·ªÉ thay ƒë·ªïi endpoint n√†y m√† kh√¥ng ph·∫£i ƒë·ª•ng ƒë·∫øn code, hay bi·∫øn ENV g√¨ ƒë√≥. Khi ƒë√≥, ta s·∫Ω define 1 <code>Service</code>, v√† set <code>Endpoint</code> th·ªß c√¥ng cho service n√†y, thay v√¨ s·ª≠ d·ª•ng <code>label</code>.</p><p>Ngo√†i ra c√≤n c√≥ <code>Headless Service</code>, lo·∫°i service n√†y s·∫Ω kh√¥ng ƒë∆∞·ª£c g√°n cluster IP. Ta s·∫Ω s·ª≠ d·ª•ng khi ta mu·ªën s·ª≠ d·ª•ng c√°ch load balance ri√™ng, kh√¥ng ph·ª• thu·ªôc Kubernetes.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="322-load-balancer"></a>3.2.2 Load balancer<a class="hash-link" href="#322-load-balancer" title="Direct link to heading">#</a></h4><p>Khi t·∫°o Service, n·∫øu ƒë√¢y l√† service cho ph√©p traffic t·ª´ b√™n ngo√†i Internet, ta ho√†n to√†n c√≥ th·ªÉ s·ª≠ d·ª•ng Load Balancer c·ªßa c√°c nh√† cung c·∫•p d·ªãch v·ª• cloud (th∆∞·ªùng l√† L3 Load Balancer).</p><p>Khi call t·ªõi Load Balancer n√≥i tr√™n, n√≥ s·∫Ω tr·ª±c ti·∫øp forward traffic t·ªõi service trong cluster, thu·∫≠t to√°n load-balance s·∫Ω do Load Balancer n√†y quy·∫øt ƒë·ªãnh.</p><p><img src="https://images.viblo.asia/fdf97441-6cc1-4b42-ac48-342541d0421e.png"></p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="323-ingress"></a>3.2.3 Ingress<a class="hash-link" href="#323-ingress" title="Direct link to heading">#</a></h4><p><code>Ingress</code> ho·∫°t ƒë·ªông gi·ªëng 1 Reverse Proxy hay Layer 7 Load Balancer. N√≥ c≈©ng c√≥ n√©t t∆∞∆°ng ƒë·ªìng v·ªõi API Gateway.</p><p><code>Ingress</code> c√≥ th·ªÉ ƒëi·ªÅu h∆∞·ªõng c·∫£ internal traffic l·∫´n external traffic d·ª±a v√†o URL, ƒë·ªìng th·ªùi cung c·∫•p th√™m c·∫£ load balancing gi·ªØa nh·ªØng pod c·ªßa service. M·ªôt ƒëi·ªÉm ƒë√°ng l∆∞u √Ω l√† <code>Ingress</code> s·∫Ω load balance tr·ª±c ti·∫øp c√°c backend Pod m√† kh√¥ng th√¥ng qua service, do ƒë√≥, ta c√≥ th·ªÉ t√πy ch·ªânh ƒë∆∞·ª£c thu·∫≠t to√°n, ... li√™n quan t·ªõi LB cho to√†n b·ªô <code>Ingress</code> c·ªßa cluster.</p><p>Ngo√†i ra, ng∆∞·ªùi ta c≈©ng d√πng <code>Ingress</code> ƒë·ªÉ terminate TLS session.</p><p><img src="https://images.viblo.asia/5809feda-e282-4d5f-9cfb-11077d952add.jpg"></p><p>Kubernetes sau khi init m·∫∑c ƒë·ªãnh s·∫Ω kh√¥ng c√≥ ingress controller. N·∫øu ta ch·ªâ t·∫°o <code>Ingress</code> th√¨ s·∫Ω kh√¥ng c√≥ √Ω nghƒ©a g√¨. ƒê·ªÉ s·ª≠ d·ª•ng <code>Ingress</code> ta s·∫Ω ph·∫£i setup th·ªß c√¥ng Ingress Controller. Tuy nhi√™n vi·ªác n√†y kh√° ƒë∆°n gi·∫£n, do nhi·ªÅu h√£ng ƒë√£ build s·∫µn m·ªçi th·ª©, ta ch·ªâ c·∫ßn l·∫•y file manifest c·ªßa h·ªç v·ªÅ r·ªìi ch·∫°y l√† ƒë∆∞·ª£c.</p><ul><li>nginx: <a href="https://kubernetes.github.io/ingress-nginx/" target="_blank" rel="noopener noreferrer">NGINX Ingress Controller</a></li><li>traefik: <a href="https://docs.traefik.io/providers/kubernetes-ingress/" target="_blank" rel="noopener noreferrer">Kubernetes Ingress</a></li><li>...</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="324-practice"></a>3.2.4 Practice<a class="hash-link" href="#324-practice" title="Direct link to heading">#</a></h4><p><img src="https://images.viblo.asia/5001a20e-979c-473f-b2da-92c8668f621e.png"></p><ul><li>Traffic t·ª´ ph√≠a client s·∫Ω ƒë∆∞·ª£c t·∫≠p trung t·∫°i Layer 4 Load Balancer.</li><li>L4 LB s·∫Ω ph√¢n b·ªë traffic t·ªõi c√°c Node trong cluster (th∆∞·ªùng qua <code>NodePort</code>).</li><li><code>Ingress</code> ƒë∆∞·ª£c map v·ªõi <code>NodePort</code> ƒë√≥ s·∫Ω terminate SSL, routing, v√† load balance traffic t·ªõi nh·ªØng Pod th√≠ch h·ª£p.<ul><li>Traffic t·ªõi <code>/web</code> s·∫Ω ƒë∆∞·ª£c ƒëi·ªÅu h∆∞·ªõng t·ªõi Frontend Pods</li><li>Traffic t·ªõi <code>/api</code> s·∫Ω ƒë∆∞·ª£c ƒëi·ªÅu h∆∞·ªõng t·ªõi Backend Pods</li></ul></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="33-storage---volume"></a>3.3 Storage - Volume<a class="hash-link" href="#33-storage---volume" title="Direct link to heading">#</a></h3><p>M·ªôt h·ªá th·ªëng kh√≥ c√≥ th·ªÉ ho·∫°t ƒë·ªông ch·ªâ v·ªõi stateless service.</p><p>V·ªõi m·ªôt s·ªë service nh∆∞ database, hay nh∆∞ t√≠nh nƒÉng upload file, ... N·∫øu ch√∫ng ta kh√¥ng s·ª≠ d·ª•ng external service, th√¨ service c·ªßa ta s·∫Ω tr·ªü th√†nh stateful service. N√≥ ƒë√≤i h·ªèi d·ªØ li·ªáu trong qu√° tr√¨nh x·ª≠ l√Ω ph·∫£i ƒë∆∞·ª£c l∆∞u l·∫°i ngay c·∫£ khi b·ªã crash. Ngo√†i ra c√≥ nh·ªØng l√∫c ta s·∫Ω c·∫ßn share d·ªØ li·ªáu gi·ªØa nh·ªØng container trong c√πng 1 Pod. Nh·ªØng l√∫c nh∆∞ v·∫≠y, ta s·∫Ω c·∫ßn ƒë·∫øn <strong>Volume</strong>.</p><p>Khi define Pod, ta s·∫Ω ch·ªâ r√µ Pod n√†y c·∫ßn nh·ªØng volume n√†o, sau ƒë√≥ map nh·ªØng volume ƒë√≥ cho container.</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="persistentvolume"></a>PersistentVolume<a class="hash-link" href="#persistentvolume" title="Direct link to heading">#</a></h5><p>Kubernetes s·ª≠ d·ª•ng <code>PersistentVolume</code> ƒë·ªÉ t·∫°o n√™n 1 l·ªõp abstract v·ªõi nh·ªØng h·ªá th·ªëng storage th·∫≠t ph√≠a sau. <code>PV</code> c≈©ng c√≥ life-cycle gi·ªëng nh∆∞ Pod.</p><p>Khi ta s·ª≠ d·ª•ng volume, ta s·∫Ω kh√¥ng c·∫ßn quan t√¢m h·ªá th·ªëng ƒë·∫±ng sau ngang d·ªçc ra sao, th·ª© duy nh·∫•t ta c·∫ßn quan t√¢m l√† API c·ªßa <code>PersistentVolume</code>.</p><p>Trong Kubernetes, <code>PV</code> c√≥ th·ªÉ ƒë∆∞·ª£c t·∫°o b·∫±ng 2 c√°ch:</p><ul><li>Dynamic Provisioning</li><li>Static Provisioning</li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="static-provisioning"></a>Static Provisioning<a class="hash-link" href="#static-provisioning" title="Direct link to heading">#</a></h5><p>Admin cluster s·∫Ω t·∫°o ra 1 s·ªë <code>PV</code> tr∆∞·ªõc, sau ƒë√≥ cung c·∫•p cho b√™n Dev/Ops. Nh·ªØng <code>PV</code> n√†y ƒë√£ ƒë∆∞·ª£c tr·ªè t·ªõi h·ªá th·ªëng storage th·∫≠t ƒëang ho·∫°t ƒë·ªông ƒë·∫±ng sau.</p><p>C√≥ th·ªÉ xem danh s√°ch driver m√† Kubernetes h·ªó tr·ª£ t·∫°i <a href="https://kubernetes.io/docs/concepts/storage/volumes/#types-of-volumes" target="_blank" rel="noopener noreferrer">ƒë√¢y</a>.</p><p>V√≠ d·ª•: Ta c√≥ 1 cluster Glusterfs v·ªõi 3 node, t·ªïng dung l∆∞·ª£ng l√† 3TB. Khi c·∫ßn 10GB cho vi·ªác l∆∞u tr·ªØ share resource, ta s·∫Ω t·∫°o <code>PersistentVolume</code> v·ªõi dung l∆∞·ª£ng 10GB, tr·ªè t·ªõi cluster n√≥i tr√™n. Sau ƒë√≥ ta s·∫Ω s·ª≠ d·ª•ng volume tr√™n t∆∞∆°ng t·ª± nh∆∞ c√°c volume kh√°c trong h·ªá th·ªëng.</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="dynamic-provisioning"></a>Dynamic Provisioning<a class="hash-link" href="#dynamic-provisioning" title="Direct link to heading">#</a></h5><p><code>PV</code> s·∫Ω ƒë∆∞·ª£c t·∫°o 1 c√°ch ƒë·ªông. T·ª©c l√† khi n√†o Pod c·ªßa ta c·∫ßn volume, th√¨ <code>PV</code> s·∫Ω ƒë∆∞·ª£c t·∫°o 1 c√°ch t·ª± ƒë·ªông, nh·ªù v√†o <code>StorageClass</code> (s·∫Ω ƒë·ªÅ c·∫≠p sau).</p><p>C√°ch l√†m n√†y ƒë√≤i h·ªèi h·ªá th·ªëng storage c·ªßa ta c≈©ng ph·∫£i support dynamic provisioning.</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="persistentvolumeclaim"></a>PersistentVolumeClaim<a class="hash-link" href="#persistentvolumeclaim" title="Direct link to heading">#</a></h5><p>ƒê·ªÉ c√≥ th·ªÉ s·ª≠ d·ª•ng ƒë∆∞·ª£c <code>PV</code>, ta c·∫ßn t·∫°o th√™m <code>PersistentVolumeClaim</code> (PVC).</p><p>Ta c√≥ th·ªÉ s·ª≠ d·ª•ng Claim tr√™n cho config, hay volume, ... c·ªßa Pod.</p><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="4-high-availability-setup"></a>4. High Availability Setup<a class="hash-link" href="#4-high-availability-setup" title="Direct link to heading">#</a></h1><p><img src="https://images.viblo.asia/48635fac-b09b-4174-b279-4f8d0fa29fb6.png"></p><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="5-reference"></a>5. Reference<a class="hash-link" href="#5-reference" title="Direct link to heading">#</a></h1><p>kubernetes.io - <a href="https://documentationo/docs/home/" target="_blank" rel="noopener noreferrer">Kubernetes Official Documentation</a></p><p>youtube.com - <a href="https://www.youtube.com/watch?v=GXq3FS8M_kw" target="_blank" rel="noopener noreferrer">June 2018 Online Meetup: Kubernetes Networking Master Class</a></p><p>x-team.com - <a href="https://x-team.com/blog/introduction-kubernetes-architecture/" target="_blank" rel="noopener noreferrer">INTRODUCTION TO KUBERNETES ARCHITECTURE</a></p><p>ovh.com - <a href="https://www.ovh.com/blog/getting-external-traffic-into-kubernetes-clusterip-nodeport-loadbalancer-and-ingress/" target="_blank" rel="noopener noreferrer">Getting external traffic into Kubernetes ‚Äì ClusterIp, NodePort, LoadBalancer, and Ingress</a></p><p>medium.com - <a href="https://medium.com/jorgeacetozi/kubernetes-master-components-etcd-api-server-controller-manager-and-scheduler-3a0179fc8186" target="_blank" rel="noopener noreferrer">Kubernetes Master Components: Etcd, API Server, Controller Manager, and Scheduler</a></p><p>medium.com - <a href="https://medium.com/google-cloud/kubernetes-nodeport-vs-loadbalancer-vs-ingress-when-should-i-use-what-922f010849e0" target="_blank" rel="noopener noreferrer">Kubernetes NodePort vs LoadBalancer vs Ingress? When should I use what?</a></p></div><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog/tags/devops">devops</a><a class="margin-horiz--sm" href="/blog/tags/kubernetes">kubernetes</a><a class="margin-horiz--sm" href="/blog/tags/introduction">introduction</a></div></footer></article><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_GeHD"><a href="/blog/toi-uu-menh-de-where-mysql">T·ªëi ∆∞u m·ªánh ƒë·ªÅ WHERE (MySQL)</a></h2><div class="margin-vert--md"><time datetime="2019-11-14T00:00:00.000Z" class="blogPostDate_fNvV">November 14, 2019 ¬∑ 9 min read</time></div><div class="avatar margin-vert--md"><a href="https://github.com/moonlight8978" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img src="https://avatars.githubusercontent.com/u/26299310?v=4" alt="L√™ Sƒ© B√≠ch"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/moonlight8978" target="_blank" rel="noopener noreferrer">L√™ Sƒ© B√≠ch</a></h4><small class="avatar__subtitle">Ruby on Rails/React Developer</small></div></div></header><div class="markdown"><p>C√≥ 2 h∆∞·ªõng t·ªëi ∆∞u Database ch√≠nh:</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="1-t·ªëi-∆∞u-t·∫ßng-db"></a>1. T·ªëi ∆∞u t·∫ßng DB<a class="hash-link" href="#1-t·ªëi-∆∞u-t·∫ßng-db" title="Direct link to heading">#</a></h3><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="c·∫•u-tr√∫c-db"></a>C·∫•u tr√∫c DB:<a class="hash-link" href="#c·∫•u-tr√∫c-db" title="Direct link to heading">#</a></h5><ul><li>ƒê·ªçc nhi·ªÅu =&gt; √≠t table, nhi·ªÅu column</li><li>Ghi nhi·ªÅu =&gt; nhi·ªÅu table, √≠t column</li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="index-ƒë√£-·ªïn-ch∆∞a"></a>Index ƒë√£ ·ªïn ch∆∞a?<a class="hash-link" href="#index-ƒë√£-·ªïn-ch∆∞a" title="Direct link to heading">#</a></h5><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="engine-cho-table"></a>Engine cho table<a class="hash-link" href="#engine-cho-table" title="Direct link to heading">#</a></h5><ul><li>MyISAM: Table-locking, ph√π h·ª£p v·ªõi table ƒë·ªçc nhi·ªÅu, ghi √≠t</li><li>InnoDB: Row-locking, ƒë√°p ·ª©ng ƒë∆∞·ª£c vi·ªác ghi nhi·ªÅu.</li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="caching"></a>Caching<a class="hash-link" href="#caching" title="Direct link to heading">#</a></h5><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="2-t·ªëi-∆∞u-ph·∫ßn-c·ª©ng"></a>2. T·ªëi ∆∞u ph·∫ßn c·ª©ng<a class="hash-link" href="#2-t·ªëi-∆∞u-ph·∫ßn-c·ª©ng" title="Direct link to heading">#</a></h3><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="disk-seek"></a>Disk seek:<a class="hash-link" href="#disk-seek" title="Direct link to heading">#</a></h5><ul><li>Th·ªùi gian HDD quay khi t√¨m d·ªØ li·ªáu, SDD kh√¥ng c·∫ßn quay ƒë·ªÉ t√¨m d·ªØ li·ªáu.</li><li>Ph√¢n t√°n d·ªØ li·ªáu ƒë·ªÉ t√¨m tr√™n nhi·ªÅu ·ªï ƒëƒ©a c√πng l√∫c.</li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="disk-rw"></a>Disk R/W:<a class="hash-link" href="#disk-rw" title="Direct link to heading">#</a></h5><ul><li>Khi t√¨m ƒë∆∞·ª£c d·ªØ li·ªáu th√¨ s·∫Ω c·∫ßn ƒë·ªçc d·ªØ li·ªáu v√†o RAM.</li><li>Ph√¢n t√°n ƒë·ªÉ ƒë·ªçc/ghi nhi·ªÅu tr√™n nhi·ªÅu ·ªï ƒëƒ©a c√πng l√∫c.</li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="cpu-cycle"></a>CPU cycle<a class="hash-link" href="#cpu-cycle" title="Direct link to heading">#</a></h5><ul><li>Khi ƒë√£ load ƒë∆∞·ª£c v√†o RAM r·ªìi, th√¨ s·∫Ω t·ªõi CPU x·ª≠ l√Ω nh·ªØng d·ªØ li·ªáu ƒë√≥.</li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="memory-bandwidth"></a>Memory bandwidth:<a class="hash-link" href="#memory-bandwidth" title="Direct link to heading">#</a></h5><ul><li>Khi CPU c·∫ßn nhi·ªÅu d·ªØ li·ªáu, nh∆∞ng cache l·∫°i kh√¥ng ƒë·ªß, s·∫Ω c·∫ßn ƒë·∫øn memory bandwith.</li></ul><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="2-t·ªëi-∆∞u-c√¢u-l·ªánh-where"></a>2. T·ªëi ∆∞u c√¢u l·ªánh WHERE<a class="hash-link" href="#2-t·ªëi-∆∞u-c√¢u-l·ªánh-where" title="Direct link to heading">#</a></h1><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="ngo√†i-select-th√¨-c√≤n-√°p-d·ª•ng-ƒë∆∞·ª£c-cho-c·∫£-update-delete-vv"></a>Ngo√†i SELECT th√¨ c√≤n √°p d·ª•ng ƒë∆∞·ª£c cho c·∫£ UPDATE, DELETE, v.v.<a class="hash-link" href="#ngo√†i-select-th√¨-c√≤n-√°p-d·ª•ng-ƒë∆∞·ª£c-cho-c·∫£-update-delete-vv" title="Direct link to heading">#</a></h5><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="mysql-s·∫Ω-t·ª±-ƒë·ªông-t·ªëi-∆∞u-nh·ªØng-tr∆∞·ªùng-h·ª£p-sau"></a>MySQL s·∫Ω t·ª± ƒë·ªông t·ªëi ∆∞u nh·ªØng tr∆∞·ªùng h·ª£p sau:<a class="hash-link" href="#mysql-s·∫Ω-t·ª±-ƒë·ªông-t·ªëi-∆∞u-nh·ªØng-tr∆∞·ªùng-h·ª£p-sau" title="Direct link to heading">#</a></h5><ul><li><p>Lo·∫°i b·ªè nh·ªØng d·∫•u ngo·∫∑c th·ª´a</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sql"><div tabindex="0" class="prism-code language-sql codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> b</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> c </span><span class="token operator" style="color:rgb(137, 221, 255)">OR</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> b</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">c </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> d</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> b </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> c</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">OR</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> b </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> c </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> d</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></li><li><p>Thay th·∫ø bi·∫øn b·ªüi h·∫±ng s·ªë</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sql"><div tabindex="0" class="prism-code language-sql codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">b </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> b</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">c</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> a</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> b</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> b</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">c </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> a</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">5</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></li><li><p>Lo·∫°i b·ªè nh·ªØng ƒëi·ªÅu ki·ªán h·∫±ng</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sql"><div tabindex="0" class="prism-code language-sql codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">b</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;=</span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> b</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">OR</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">b</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">6</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">OR</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">b</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">7</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">6</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> b</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">OR</span><span class="token plain"> b</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">6</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></li><li><p>Bi·ªÉu th·ª©c h·∫±ng (constant expression) s·∫Ω ch·ªâ ƒë∆∞·ª£c t√≠nh to√°n 1 l·∫ßn duy nh·∫•t.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sql"><div tabindex="0" class="prism-code language-sql codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> t</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">WHERE</span><span class="token plain"> id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> POW</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> t</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">WHERE</span><span class="token plain"> id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> FLOOR</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> RAND</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">49</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></li><li><p><code>HAVING</code> s·∫Ω ƒë∆∞·ª£c g·ªôp v·ªõi <code>WHERE</code> khi kh√¥ng s·ª≠ d·ª•ng <code>GROUP BY</code> hay nh·ªØng function nh∆∞ <code>COUNT()</code>, <code>MIN()</code>, <code>MAX()</code>, ...</p></li><li><p>ƒê·ªëi v·ªõi <strong>MyISAM</strong> hay <strong>MEMORY</strong> table, k·∫øt qu·∫£ c·ªßa <code>COUNT(*)</code> (kh√¥ng c√≥ ƒëi·ªÅu ki·ªán <code>WHERE</code> s·∫Ω ƒë∆∞·ª£c l·∫•y tr·ª±c ti·∫øp t·ª´ <strong>information_schema</strong>.</p></li></ul><p>=&gt; Ta c√≥ th·ªÉ ng·ª´ng vi·ªác t·ªëi ∆∞u l·∫°i, v√† vi·∫øt nh·ªØng c√¢u l·ªánh SQL d·ªÖ hi·ªÉu, d·ªÖ b·∫£o tr√¨.</p><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="3-range-optimization"></a>3. Range optimization<a class="hash-link" href="#3-range-optimization" title="Direct link to heading">#</a></h1><ul><li><code>range</code> l√† m·ªôt <strong>access method</strong></li><li><code>range</code> s·ª≠ d·ª•ng index ƒë·ªÉ l·∫•y ra nh·ªØng subset c·ªßa k·∫øt qu·∫£ cu·ªëi c√πng.</li><li><code>range</code> support c·∫£ single-part l·∫´n multiple-part index.</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="nh·ªØng-tr∆∞·ªùng-h·ª£p-sau-mysql-s·∫Ω-coi-nh∆∞-l√†-range-condition"></a>Nh·ªØng tr∆∞·ªùng h·ª£p sau, MySQL s·∫Ω coi nh∆∞ l√† <code>range condition</code>:<a class="hash-link" href="#nh·ªØng-tr∆∞·ªùng-h·ª£p-sau-mysql-s·∫Ω-coi-nh∆∞-l√†-range-condition" title="Direct link to heading">#</a></h4><ul><li><p>M·ªánh ƒë·ªÅ <code>WHERE</code> ƒë·ªëi v·ªõi nh·ªØng tr∆∞·ªùng ƒë∆∞·ª£c ƒë√°nh index (s·ª≠ d·ª•ng BTree ho·∫∑c Hash), m√† s·ª≠ d·ª•ng nh·ªØng to√°n t·ª≠ sau: <code>=</code>, <code>&lt;=&gt;</code>, <code>IN()</code>, <code>IS NULL</code>, hay <code>IS NOT NULL</code></p><p>ƒê·ªëi v·ªõi, BTree, ngo√†i nh·ªØng ph√©p to√°n tr√™n, c√≤n support th√™m <code>&gt;</code>, <code>&lt;</code>, <code>&lt;=</code>, <code>&gt;=</code>, <code>BETWEEN</code>, <code>!=</code>, hay <code>&lt;&gt;</code> v·ªõi <strong>constant value</strong>, ho·∫∑c <code>LIKE</code> c≈©ng l√† range condition. Ch√∫ √Ω khi s·ª≠ d·ª•ng <code>LIKE</code>, v·∫ø ph·∫£i ph·∫£i l√† 1 string h·∫±ng, v√† kh√¥ng b·∫Øt ƒë·∫ßu b·ªüi wildcard nh∆∞ <code>%</code> hay <code>_</code>.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sql"><div tabindex="0" class="prism-code language-sql codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> t1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">WHERE</span><span class="token plain"> key_col </span><span class="token operator" style="color:rgb(137, 221, 255)">LIKE</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;ab%&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></li><li><p>K·∫øt h·ª£p nhi·ªÅu range condition s·ª≠ d·ª•ng <code>AND</code> ho·∫∑c <code>OR</code>, ta v·∫´n thu ƒë∆∞·ª£c range condition.</p></li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="constant-value"></a>Constant value<a class="hash-link" href="#constant-value" title="Direct link to heading">#</a></h4><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="l√†-gi√°-tr·ªã-ƒë∆∞·ª£c-t√≠nh-to√°n-tr∆∞·ªõc-th·ªùi-ƒëi·ªÉm-runtime-khi-runtime-gi√°-tr·ªã-c·ªßa-n√≥-s·∫Ω-kh√¥ng-thay-ƒë·ªïi"></a>L√† gi√° tr·ªã ƒë∆∞·ª£c t√≠nh to√°n tr∆∞·ªõc th·ªùi ƒëi·ªÉm runtime, khi runtime, gi√° tr·ªã c·ªßa n√≥ s·∫Ω kh√¥ng thay ƒë·ªïi<a class="hash-link" href="#l√†-gi√°-tr·ªã-ƒë∆∞·ª£c-t√≠nh-to√°n-tr∆∞·ªõc-th·ªùi-ƒëi·ªÉm-runtime-khi-runtime-gi√°-tr·ªã-c·ªßa-n√≥-s·∫Ω-kh√¥ng-thay-ƒë·ªïi" title="Direct link to heading">#</a></h5><ul><li>H·∫±ng s·ªë truy·ªÅn th·∫≥ng v√†o tham s·ªë c·ªßa c√¢u truy v·∫•n</li><li>M·ªôt c·ªôt c·ªßa <code>const</code> hay <code>system</code> table<ul><li><code>const</code> table l√† b·∫£ng ch·ªâ c√≥ t·ªëi ƒëa 1 row (hay 0 ho·∫∑c 1 row).</li><li><code>const</code> table c√≥ th·ªÉ l√† k·∫øt qu·∫£ c·ªßa 1 c√¢u truy v·∫•n ch·ª©a m·ªánh ƒë·ªÅ <code>WHERE</code> ƒë·ªëi v·ªõi 1 field unique, not null, c√≥ d·∫°ng <code>column = constant</code>. Truy v·∫•n n√†y lu√¥n tr·∫£ v·ªÅ 1 k·∫øt qu·∫£ duy nh·∫•t.</li><li>table c√≥ 1 row th√¨ g·ªçi l√† <code>system</code> table</li></ul></li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="btree-hash-index"></a>BTree, Hash index<a class="hash-link" href="#btree-hash-index" title="Direct link to heading">#</a></h4><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="btree"></a>BTree:<a class="hash-link" href="#btree" title="Direct link to heading">#</a></h5><ul><li><p>Self-balancing tree, c·∫•u tr√∫c d·∫°ng c√¢y, c√≥ th·ªÉ t·ª± c√¢n b·∫±ng nh·∫±m gi·ªØ chi·ªÅu cao c·ªßa c√¢y th·∫•p nh·∫•t c√≥ th·ªÉ.</p></li><li><p>Tr√°nh nh·∫ßm v·ªõi Binary Tree (c√¢y nh·ªã ph√¢n)</p></li><li><p>Th·ªùi gian t√¨m ki·∫øm O(logn)</p></li><li><p>Ph√π h·ª£p v·ªõi ƒëa d·∫°ng c√°c ph√©p to√°n: <code>=</code>, <code>&lt;=&gt;</code>, <code>IN()</code>, <code>IS NULL</code>, <code>IS NOT NULL</code>, <code>&gt;</code>, <code>&lt;</code>, <code>&lt;=</code>, <code>&gt;=</code>, <code>BETWEEN</code>, <code>!=</code>, <code>&lt;&gt;</code>, hay th·∫≠m ch√≠ c·∫£ <code>LIKE</code></p></li></ul><p><img src="https://camo.githubusercontent.com/cb15fccfa6fafa1cea762a58c1dd51ad8f32fe2c/68747470733a2f2f63646e2d696d616765732d312e6d656469756d2e636f6d2f6d61782f313630302f312a70453453457a374370727a4664375a77772d617866512e6a706567"></p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="hash"></a>Hash:<a class="hash-link" href="#hash" title="Direct link to heading">#</a></h5><ul><li><p>B·∫£ng bƒÉm, l√† c·∫•u tr√∫c d·ªØ li·ªáu l∆∞u theo key-value</p></li><li><p>T√¨m ki·∫øm theo key r·∫•t nhanh - O(1)</p></li><li><p>Ph√π h·ª£p v·ªõi nh·ªØng ph√©p to√°n: <code>=</code>, <code>&lt;=&gt;</code>, <code>IN()</code>, <code>IS NULL</code>, hay <code>IS NOT NULL</code>.</p></li></ul><p><img src="https://camo.githubusercontent.com/b1df2be12b1c8779b7cf941d88d1cc8e2178753f/68747470733a2f2f696d616765732e7669626c6f2e617369612f30356236313638372d386230342d346536352d613834642d3361353363343035386437642e6a7067"></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="31-single-part-index"></a>3.1. Single-part index<a class="hash-link" href="#31-single-part-index" title="Direct link to heading">#</a></h2><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="single-part-index-l√†-nh·ªØng-index-ƒë∆∞·ª£c-ƒë√°nh-ri√™ng-l·∫ª-cho-1-field"></a>Single-part index l√† nh·ªØng index ƒë∆∞·ª£c ƒë√°nh ri√™ng l·∫ª cho 1 field.<a class="hash-link" href="#single-part-index-l√†-nh·ªØng-index-ƒë∆∞·ª£c-ƒë√°nh-ri√™ng-l·∫ª-cho-1-field" title="Direct link to heading">#</a></h5><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sql"><div tabindex="0" class="prism-code language-sql codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">INDEX</span><span class="token plain"> index_name </span><span class="token keyword" style="font-style:italic">ON</span><span class="token plain"> t1 </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">key_col</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Khi th·ª±c hi·ªán truy v·∫•n v·ªõi nh·ªØng index lo·∫°i n√†y, v·ªõi m·ªói possible key (c√≥ th·ªÉ s·ª≠ d·ª•ng <code>EXPLAIN</code> ƒë·ªÉ check), MySQL s·∫Ω ti·∫øn h√†nh extract range condition. Nh·ªØng ƒëi·ªÅu ki·ªán kh√¥ng th·ªÉ c·∫•u th√†nh range condition s·∫Ω b·ªã lo·∫°i b·ªè, nh·ªØng ƒëi·ªÅu ki·ªán c√≥ th·ªÉ b·ªã overlap s·∫Ω ƒë∆∞·ª£c g·ªôp v·ªõi nhau.</p><p>Sau khi extract, MySQL s·∫Ω √°p d·ª•ng nh·ªØng ƒëi·ªÅu ki·ªán ƒë√≥ ƒë·ªÉ t·∫≠n d·ª•ng ƒë∆∞·ª£c t·ªëi ƒëa index c·ªßa table, sau ƒë√≥ k·∫øt h·ª£p th√™m v·ªõi nh·ªØng ƒëi·ªÅu ki·ªán c√≤n l·∫°i ƒë·ªÉ l·ªçc ti·∫øp.</p><p>MySQL ch·ªâ b·ªè qua index, n·∫øu nh∆∞ n√≥ tin r·∫±ng vi·ªác duy·ªát full table t·ªëi ∆∞u h∆°n, ho·∫∑c d√πng <code>FORCE INDEX</code>.</p><p>VD:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sql"><div tabindex="0" class="prism-code language-sql codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> t1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">WHERE</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">key1 </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;abc&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">key1 </span><span class="token operator" style="color:rgb(137, 221, 255)">LIKE</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;abcde%&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">OR</span><span class="token plain"> key1 </span><span class="token operator" style="color:rgb(137, 221, 255)">LIKE</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;%b&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token operator" style="color:rgb(137, 221, 255)">OR</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">key1 </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;bar&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> nonkey </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">4</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token operator" style="color:rgb(137, 221, 255)">OR</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">key1 </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;uux&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> key1 </span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;z&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">key1 </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;abc&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">key1 </span><span class="token operator" style="color:rgb(137, 221, 255)">LIKE</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;abcde%&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">OR</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">TRUE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">OR</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">key1 </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;bar&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">TRUE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">OR</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">key1 </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;uux&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> key1 </span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;z&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">key1 </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;abc&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">TRUE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">OR</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">key1 </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;bar&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">TRUE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">OR</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token boolean" style="color:rgb(255, 88, 116)">FALSE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> key1 </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;abc&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">OR</span><span class="token plain"> key1 </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;bar&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> key1 </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;bar&#x27;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="32-multiple-part-index"></a>3.2. Multiple-part index<a class="hash-link" href="#32-multiple-part-index" title="Direct link to heading">#</a></h2><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="multiple-part-index-l√†-nh·ªØng-index-ƒë∆∞·ª£c-ƒë√°nh-cho-nhi·ªÅu-tr∆∞·ªùng-c√πng-l√∫c"></a>Multiple-Part Index l√† nh·ªØng index ƒë∆∞·ª£c ƒë√°nh cho nhi·ªÅu tr∆∞·ªùng c√πng l√∫c<a class="hash-link" href="#multiple-part-index-l√†-nh·ªØng-index-ƒë∆∞·ª£c-ƒë√°nh-cho-nhi·ªÅu-tr∆∞·ªùng-c√πng-l√∫c" title="Direct link to heading">#</a></h5><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sql"><div tabindex="0" class="prism-code language-sql codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">INDEX</span><span class="token plain"> index_name </span><span class="token keyword" style="font-style:italic">ON</span><span class="token plain"> t1 </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">key_part1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> key_part2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Range condition s·∫Ω s·ª≠ d·ª•ng <strong>key tuple intervals</strong> ƒë·ªÉ t√¨m ki·∫øm. Key tuple intervals ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a b·ªüi nh·ªØng key tuples, c√≥ th·ª© t·ª±.</p><p><strong>Tuple</strong> l√† 1 c·∫∑p gi√° tr·ªã. VD: (1, 2, 3), (1, &#x27;a&#x27;, 3), ...</p><p>L·∫•y v√≠ d·ª• v·ªÅ 1 multiple-part index <code>key1(key_part1, key_part2, key_part3)</code>, v√† nh·ªØng tuples ·ª©ng v·ªõi key tuple (key_part1, key_part2, key_part3) sau:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly plaintext"><div tabindex="0" class="prism-code language-plaintext codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">key_part1  key_part2  key_part3</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  NULL       1          &#x27;abc&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  NULL       1          &#x27;xyz&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  NULL       2          &#x27;foo&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   1         1          &#x27;abc&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   1         1          &#x27;xyz&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   1         2          &#x27;abc&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   2         1          &#x27;aaa&#x27;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><code>key_part1 = 1</code> define interval sau:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly plaintext"><div tabindex="0" class="prism-code language-plaintext codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(1,-inf,-inf) &lt;= (key_part1,key_part2,key_part3) &lt; (1,+inf,+inf)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Interval tr√™n s·∫Ω ƒë∆∞·ª£c s·ª≠ d·ª•ng b·ªüi <code>range</code> access method.</p><p>B√™n c·∫°nh ƒë√≥, <code>key_part3 = &#x27;abc&#x27;</code> kh√¥ng t·∫°o ra interval n√†o (gi√° tr·ªã li·ªÅn m·∫°ch nhau), v√¨ th·∫ø s·∫Ω kh√¥ng th·ªÉ s·ª≠ d·ª•ng b·ªüi <code>range</code></p><p>Ch√∫ √Ω khi s·ª≠ d·ª•ng:</p><ul><li><p>V·ªõi Hash index, n·∫øu index c√≥ <code>N</code> part, th√¨ condition c·ªßa ta ph·∫£i c√≥ format sau</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sql"><div tabindex="0" class="prism-code language-sql codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">    key_part1 cmp const1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> key_part2 cmp const2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> key_partN cmp constN</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><code>cmp</code> l√† m·ªôt trong nh·ªØng to√°n t·ª≠ <code>=</code>, <code>&lt;=&gt;</code>, ho·∫∑c <code>IS NULL</code></p></li><li><p>V·ªõi BTree index, 1 interval c√≥ th·ªÉ s·ª≠ d·ª•ng cho nh·ªØng ƒëi·ªÅu ki·ªán k·∫øt h·ª£p b·ªüi <code>AND</code>, trong ƒë√≥ m·ªói ƒëi·ªÅu ki·ªán so s√°nh 1 key part v·ªõi 1 h·∫±ng s·ªë, s·ª≠ d·ª•ng <code>=</code>, <code>&lt;=&gt;</code>, <code>IS NULL</code>, <code>&gt;</code>, <code>&lt;</code>, <code>&gt;=</code>, <code>&lt;=</code>, <code>!=</code>, <code>&lt;&gt;</code>.</p><p>Optimizer trong khi t√≠nh to√°n interval, s·∫Ω s·ª≠ d·ª•ng th√™m key part n·∫øu to√°n t·ª≠ l√† <code>=</code>, <code>&lt;=&gt;</code> hay <code>IS NULL</code>. C√≤n n·∫øu l√† <code>&gt;</code>, <code>&lt;</code>, <code>&gt;=</code>, <code>&lt;=</code>, <code>!=</code>, <code>&lt;&gt;</code>, <code>BETWEEN</code> hay <code>LIKE</code> th√¨ s·∫Ω kh√¥ng l·∫•y th√™m key part n·ªØa.</p><p>VD1:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sql"><div tabindex="0" class="prism-code language-sql codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">key_part1 </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;foo&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> key_part2 </span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">10</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> key_part3 </span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">10</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>s·∫Ω s·ª≠ d·ª•ng interval:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sql"><div tabindex="0" class="prism-code language-sql codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;foo&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">10</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">inf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">key_part1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">key_part2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">key_part3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;foo&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain">inf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain">inf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>VD2:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sql"><div tabindex="0" class="prism-code language-sql codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">key_part1 </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> key_part2 </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">OR</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">key_part1 </span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>s·∫Ω s·ª≠ d·ª•ng 2 interval:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sql"><div tabindex="0" class="prism-code language-sql codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">inf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">key_part1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">key_part2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">inf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">key_part1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">key_part2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Trong v√≠ d·ª• n√†y, interval th·ª© nh·∫•t s·ª≠ d·ª•ng 1 key part ·ªü v·∫ø tr√°i, v·∫ø ph·∫£i s·ª≠ d·ª•ng 2 key part.</p><p>Interval th·ª© 2 ch·ªâ s·ª≠ d·ª•ng 1 key part.</p><p>Gi√° tr·ªã <code>key_len</code> khi th·ª±c hi·ªán <code>EXPLAIN</code> s·∫Ω tr·∫£ v·ªÅ ƒë·ªô d√†i t·ªëi ƒëa c·ªßa key prefix ƒë∆∞·ª£c s·ª≠ d·ª•ng.</p></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="index-dive"></a>Index Dive<a class="hash-link" href="#index-dive" title="Direct link to heading">#</a></h3><p>Index dive ƒë∆∞·ª£c th·ª±c hi·ªán trong khi optimizing ƒë·ªÉ t√≠nh to√°n estimate (s·ªë row th·ªèa m√£n 1 condition), ƒë·ªÉ quy·∫øt ƒë·ªãnh xem c√≥ n√™n d√πng index hay kh√¥ng. C√≥ th·ªÉ skip b·∫±ng c√°ch d√πng <code>FORCE INDEX</code></p><p>N·∫øu ƒëi·ªÅu ki·ªán ph·ª©c t·∫°p th√¨ index dive s·∫Ω m·∫•t nhi·ªÅu th·ªùi gian.</p><p>Ngo√†i index dive, MySQL c≈©ng c√≥ th·ªÉ s·ª≠ d·ª•ng index statistics ƒë·ªÉ estimate, tuy nhi√™n ƒë·ªô ch√≠nh x√°c th·∫•p h∆°n, c√≥ th·ªÉ d√πng <code>ANALYZE TABLE</code> ƒë·ªÉ update l·∫°i index statistics, tƒÉng c∆∞·ªùng ƒë·ªô ch√≠nh x√°c.</p><p>Index dive b·ªã skip trong tr∆∞·ªùng h·ª£p th·ªèa m√£n t·∫•t c·∫£ ƒëi·ªÅu ki·ªán sau (ch·ªâ √°p d·ª•ng cho single table query):</p><ul><li><code>FORCE INDEX</code></li><li>Nonunique index, v√† kh√¥ng ph·∫£i <code>FULLTEXT</code> index.</li><li>Kh√¥ng c√≥ subquery</li><li>Kh√¥ng c√≥ <code>DISTINCT</code>, <code>GROUP BY</code>, ho·∫∑c <code>ORDER BY</code>.</li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="equality-range-optimization-of-many-valued-comparisons"></a>Equality Range Optimization of Many-Valued Comparisons<a class="hash-link" href="#equality-range-optimization-of-many-valued-comparisons" title="Direct link to heading">#</a></h5><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sql"><div tabindex="0" class="prism-code language-sql codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">col_name </span><span class="token operator" style="color:rgb(137, 221, 255)">IN</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">val1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> valN</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">col_name </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> val1 </span><span class="token operator" style="color:rgb(137, 221, 255)">OR</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">OR</span><span class="token plain"> col_name </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> valN</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Nh·ªØng bi·ªÉu th·ª©c nh∆∞ tr√™n, v·ªõi <code>col_name</code> ƒë∆∞·ª£c ƒë√°nh index, v√† so s√°nh v·ªõi nhi·ªÅu gi√° tr·ªã, ƒë∆∞·ª£c g·ªçi l√† range comparisions (m·ªói range l√† 1 gi√° tr·ªã). Optimizer s·∫Ω estimate cost c·ªßa m·ªói range nh∆∞ sau:</p><ul><li>N·∫øu index l√† unique, cost = 1</li><li>N·∫øu kh√¥ng unique, s·∫Ω c·∫ßn s·ª≠ d·ª•ng index dive ho·∫∑c index statistics ƒë·ªÉ estimate.</li></ul><p>·ª®ng v·ªõi m·ªói range l√† 2 l·∫ßn dive (1 cho ƒëi·ªÉm b·∫Øt ƒë·∫ßu, 1 cho ƒëi·ªÉm k·∫øt th√∫c) c·ªßa range (interval).</p></div><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog/tags/mysql">mysql</a><a class="margin-horiz--sm" href="/blog/tags/database">database</a><a class="margin-horiz--sm" href="/blog/tags/optimization">optimization</a></div></footer></article><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_GeHD"><a href="/blog/cung-tim-hieu-ve-actiontext-trong-rails-6">C√πng t√¨m hi·ªÉu v·ªÅ ActionText trong Rails 6</a></h2><div class="margin-vert--md"><time datetime="2019-07-20T00:00:00.000Z" class="blogPostDate_fNvV">July 20, 2019 ¬∑ 11 min read</time></div><div class="avatar margin-vert--md"><a href="https://github.com/moonlight8978" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img src="https://avatars.githubusercontent.com/u/26299310?v=4" alt="L√™ Sƒ© B√≠ch"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/moonlight8978" target="_blank" rel="noopener noreferrer">L√™ Sƒ© B√≠ch</a></h4><small class="avatar__subtitle">Ruby on Rails/React Developer</small></div></div></header><div class="markdown"><p>Rails 6 ƒë√£ b∆∞·ªõc v√†o giai ƒëo·∫°n beta v·ªõi phi√™n b·∫£n <a href="https://github.com/rails/rails/releases/tag/v6.0.0.rc1" target="_blank" rel="noopener noreferrer">v6.0.0.rc1</a>. RC l√† vi·∫øt t·∫Øt c·ªßa <strong>R</strong>elease <strong>C</strong>andidate, ƒë√¢y l√† phi√™n b·∫£n m√† c√≥ x√°c su·∫•t tr·ªü th√†nh final release r·∫•t cao. Ta c√≥ th·ªÉ √°p d·ª•ng n√≥ v√†o d·ª± √°n ngay k·ªÉ t·ª´ b√¢y gi·ªù m√† kh√¥ng c·∫ßn lo s·ª£ c√≥ nh·ªØng breaking change.</p><p>N·∫øu b·∫°n s·ª≠ d·ª•ng Docker, m√¨nh khuy√™n n√™n s·ª≠ d·ª•ng ruby 2.6.3, v√¨ tr∆∞·ªõc ƒë√¢y m√¨nh ƒë√£ d√πng th·ª≠ ruby:2.7.0-preview1-alpine3.10 th√¨ kh√° nhi·ªÅu l·ªói khi up server, m√† ch·∫£ bi·∫øt ph·∫£i fix sao :sad:</p><p>·ªû Rails 6, c√≥ kh√° nhi·ªÅu t√≠nh nƒÉng m·ªõi hay ho:</p><ul><li>Action Text</li><li>Parallel Testing</li><li>Action Model custom error message format.</li><li>v√¢n v√¢n m√¢y m√¢y...</li></ul><p>·ªû b√†i n√†y, m√¨nh s·∫Ω ch·ªâ t·∫≠p trung ƒë·ªÅ c·∫≠p t·ªõi Action Text. ƒê√¢y l√† m·ªôt package gi√∫p ta x√¢y d·ª±ng WYSIWYG editor m·ªôt c√°ch nhanh ch√≥ng, h∆°n n·ªØa, vi·ªác upload c≈©ng ƒë∆∞·ª£c integrate v·ªõi Active Storage.</p><p><strong>Ch√∫ √Ω:</strong> B√†i kh√° d√†i v√† embed nhi·ªÅu code :v</p><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="c√°ch-d√πng"></a>C√°ch d√πng<a class="hash-link" href="#c√°ch-d√πng" title="Direct link to heading">#</a></h1><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="c√†i-ƒë·∫∑t-v√†-s·ª≠-d·ª•ng"></a>C√†i ƒë·∫∑t v√† s·ª≠ d·ª•ng<a class="hash-link" href="#c√†i-ƒë·∫∑t-v√†-s·ª≠-d·ª•ng" title="Direct link to heading">#</a></h2><p>V√¨ l√† Rails n√™n c√°ch s·ª≠ d·ª•ng r·∫•t ƒë∆°n gi·∫£n, nh∆∞ng ta s·∫Ω ch·∫£ bi·∫øt n√≥ ch·∫°y c√°i g√¨ ƒë·∫±ng sau c·∫£ =))</p><p>C√†i ƒë·∫∑t Action Text b·∫±ng CLI command sau:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><div tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">rails action_text:install</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Nh·ªõ h√£y ch·∫°y th√™m c·∫£ command install Active Storage n·ªØa.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><div tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">rails active_storage:install</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>ƒê·ªÉ √°p d·ª•ng cho field <code>content</code> c·ªßa model <code>Post</code>, ta s·∫Ω d√πng t·ªõi macro <code>has_rich_text</code></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">class CreatePosts &lt; ActiveRecord::Migration[6.0]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  def change</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    create_table :posts do |t|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      t.string :content</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      t.string :category</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      t.timestamps</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><code>content</code> ·ªü ƒë√¢y m√¨nh d√πng string, nh∆∞ng khuy·∫øn kh√≠ch d√πng text h∆°n.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">class Post &lt; ApplicationRecord</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    has_rich_text :content</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Tr√™n form, ta ch·ªâ vi·ªác d√πng <code>rich_text_area</code></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly erb"><div tabindex="0" class="prism-code language-erb codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;%= form_with(model: @post) do |form| %&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &lt;div class=&quot;field&quot;&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;%= form.label :content %&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;%= form.rich_text_area :content %&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &lt;/div&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;% end %&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Khi permit params, ta c≈©ng l√†m nh∆∞ bao field kh√°c</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">class PostsController &lt; ApplicationController</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  def post_params</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    params.require(:post).permit(:category, :content)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Cu·ªëi c√πng ta hi·ªÉn th·ªã d·ªØ li·ªáu nh∆∞ sau:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly erb"><div tabindex="0" class="prism-code language-erb codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;%= @post.content %&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>C√¢u l·ªánh tr√™n th·ª±c ch·∫•t ƒëang ng·∫ßm g·ªçi t·ªõi <code>@post.content.to_s</code></p><p>ƒê√¢y l√† s·∫£n ph·∫©m c·ªßa ta:</p><p>Form t·∫°o post v·ªõi WYSIWYG editor - S·ª≠ d·ª•ng Trix editor, do Basecamp ph√°t tri·ªÉn, c√¢y nh√† l√° v∆∞·ªùn lu√¥n.</p><p>C√≥ th·ªÉ k√©o th·∫£ file v√†o, file ƒë√≥ s·∫Ω ƒë∆∞·ª£c upload b·∫±ng Active Storage.</p><p><img src="https://images.viblo.asia/77b9bd23-5ba3-426b-b6fc-cac02edb0b42.png"></p><p>Hi·ªÉn th·ªã d·ªØ li·ªáu ·ªü m√†n h√¨nh detail</p><p><img src="https://images.viblo.asia/6b1b8da0-ca7f-468b-9705-444a8cb2d736.png"></p><p>C√°c b·∫°n th·∫•y sao? C√° nh√¢n m√¨nh th·∫•y x·∫•u nh∆∞ c·ªù h√≥ v·∫≠y =)) Tuy nhi√™n ta c√≥ th·ªÉ styling cho n√≥.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="styling"></a>Styling<a class="hash-link" href="#styling" title="Direct link to heading">#</a></h2><p>Rails ƒëang c√≥ s·∫µn m·ªôt v√†i style c∆° b·∫£n cho n√≥ trong file <code>app/assets/stylesheets/actiontext.scss</code>, ta c√≥ th·ªÉ s·ª≠a n√≥ ƒë·ªÉ cho ƒë·∫πp h∆°n.</p><p>V·ªõi ƒë·ªëng tool c·ªßa editor th√¨ c√≥ th·ªÉ d√πng selector <code>.trix-button-row</code></p><p>V·ªõi template attachment (nh∆∞ c√°i <code>monaco.ttf</code> ·ªü tr√™n), ta c≈©ng c√≥ th·ªÉ custom l·∫°i, Rails cung c·∫•p s·∫µn template m·∫∑c ƒë·ªãnh ·ªü file <code>app/views/active_storage/blobs/_blob.html.erb</code></p><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="t√¨m-hi·ªÉu-s·ª±-ma-gi√°o"></a>T√¨m hi·ªÉu s·ª± ma gi√°o<a class="hash-link" href="#t√¨m-hi·ªÉu-s·ª±-ma-gi√°o" title="Direct link to heading">#</a></h1><p>R·ªìi ta ƒë√£ l∆∞·ªõt qua c√°ch s·ª≠ d·ª•ng n√≥, nh∆∞ng m√† c√≥ qu√° nhi·ªÅu magic.</p><p>Li·ªáu b·∫°n c√≥ t·ª± ƒë·∫∑t ra nh·ªØng c√¢u h·ªèi th·∫ø n√†y hay kh√¥ng?</p><ul><li><p>Kh√¥ng bi·∫øt c√°ch l∆∞u tr·ªØ d·ªØ li·ªáu c·ªßa n√≥ nh∆∞ th·∫ø n√†o?</p></li><li><p>L√†m sao m√† c√°i file trong kia integrate ƒë∆∞·ª£c v·ªõi Active Storage?</p></li><li><p>V√¨ sao l·∫°i c√≥ th·ªÉ custom l·∫°i nh·ªØng attachment b·∫±ng template?</p></li><li><p>v√¢n v√¢n m√¢y m√¢y...</p></li></ul><p>Ta s·∫Ω b·∫Øt tay v√†o t√¨m hi·ªÉu n√≥.</p><p>H√£y b·∫Øt ƒë·∫ßu v·ªõi <code>has_rich_text</code></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="macro-has_rich_text"></a>Macro <code>has_rich_text</code><a class="hash-link" href="#macro-has_rich_text" title="Direct link to heading">#</a></h2><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># https://github.com/rails/rails/blob/6a5c8b91998c56e50b5cc934d968947cd319f735/actiontext/lib/action_text/attribute.rb#L26</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">def has_rich_text(name)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  class_eval &lt;&lt;-CODE, __FILE__, __LINE__ + 1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    def #{name}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      rich_text_#{name} || build_rich_text_#{name}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    def #{name}=(body)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      self.#{name}.body = body</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  CODE</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  has_one :&quot;rich_text_#{name}&quot;, -&gt; { where(name: name) },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    class_name: &quot;ActionText::RichText&quot;, as: :record, inverse_of: :record, autosave: true, dependent: :destroy</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  # ... codes</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>D·ªÖ d√†ng th·∫•y r·∫±ng ƒë√¢y l√† 1 macro gi√∫p ƒë·ªãnh nghƒ©a getter, setter, v√† c·∫£ association <code>has_one :rich_text_...</code> v·ªõi <code>ActionText::RichText</code>.</p><p>V·∫≠y th√¨ khi ta g·ªçi <code>@post.content</code>, th·ª±c ch·∫•t l√† ta ƒëang g·ªçi t·ªõi <code>@post.rich_text_content</code>.</p><p>V√† n√≥ c≈©ng ch·ªâ ra 1 ƒëi·ªÅu n·ªØa l√† Rails d√πng 1 b·∫£ng ri√™ng ƒë·ªÉ l∆∞u l·∫°i ƒë·ªëng rich text c·ªßa ta.</p><p>H√£y d√†nh ch√∫t th·ªùi gian nh√¨n v√†o th∆∞ m·ª•c <code>db/migrate</code>, ta s·∫Ω th·∫•y file sau:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># db/migrate/20190718085159_create_action_text_tables.action_text.rb</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># This migration comes from action_text (originally 20180528164100)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">class CreateActionTextTables &lt; ActiveRecord::Migration[6.0]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  def change</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    create_table :action_text_rich_texts do |t|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      t.string     :name, null: false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      t.text       :body, size: :long</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      t.references :record, null: false, polymorphic: true, index: false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      t.timestamps</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      t.index [ :record_type, :record_id, :name ], name: &quot;index_action_text_rich_texts_uniqueness&quot;, unique: true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Qu·∫£ th·∫≠t l√† v·∫≠y, <code>body</code> ch√≠nh l√† n∆°i l∆∞u tr·ªØ ƒë·ªëng text c·ªßa ta, c√≤n <code>name</code>, <code>record_id</code>, v√† <code>record_type</code> l√† nh·ªØng attribute cho polymorphic association, kh√° quen thu·ªôc n·∫øu b·∫°n ƒë√£ d√πng Active storage</p><p>Ta s·∫Ω ƒëi ƒë·∫øn b∆∞·ªõc ti·∫øp theo <code>rich_text_area</code></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="rails-x·ª≠-l√Ω-l∆∞u-tr·ªØ-rich-text-nh∆∞-th·∫ø-n√†o"></a>Rails x·ª≠ l√Ω, l∆∞u tr·ªØ rich text nh∆∞ th·∫ø n√†o?<a class="hash-link" href="#rails-x·ª≠-l√Ω-l∆∞u-tr·ªØ-rich-text-nh∆∞-th·∫ø-n√†o" title="Direct link to heading">#</a></h2><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># https://github.com/rails/rails/blob/cc1a5d5620c4cd952b27f6c1bbd16d8780a34d0e/actiontext/app/helpers/action_text/tag_helper.rb#L20</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">def rich_text_area_tag(name, value = nil, options = {})</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  options = options.symbolize_keys</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  options[:input] ||= &quot;trix_input_#{ActionText::TagHelper.id += 1}&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  options[:class] ||= &quot;trix-content&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  options[:data] ||= {}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  options[:data][:direct_upload_url] = main_app.rails_direct_uploads_url</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  options[:data][:blob_url_template] = main_app.rails_service_blob_url(&quot;:signed_id&quot;, &quot;:filename&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  editor_tag = content_tag(&quot;trix-editor&quot;, &quot;&quot;, options)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  input_tag = hidden_field_tag(name, value, id: options[:input])</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  input_tag + editor_tag</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>C√≥ th·ªÉ th·∫•y ƒë∆°n gi·∫£n n√≥ ch·ªâ init c√°i trix editor cho ta th√¥i.</p><p>Vi·ªác k√©o th·∫£ file, upload ho√†n to√†n ƒë∆∞·ª£c handle b·ªüi trix editor, ta kh√¥ng custom ƒë∆∞·ª£c template sau khi file upload th√†nh c√¥ng.</p><p>Tuy nhi√™n Action Text c√≥ th√™m 1 callback sau khi file ƒë∆∞·ª£c upload th√†nh c√¥ng:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><div tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// https://github.com/rails/rails/blob/cc1a5d5620c4cd952b27f6c1bbd16d8780a34d0e/actiontext/app/javascript/actiontext/attachment_upload.js#L26</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">attachment</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">setAttributes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  sgid</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> attributes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">attachable_sgid</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  url</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">createBlobUrl</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">attributes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">signed_id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> attributes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">filename</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>ƒë√¢y l√† 1 step r·∫•t quan tr·ªçng, nh∆∞ng ta s·∫Ω ch∆∞a c·∫ßn ch√∫ √Ω t·ªõi n√≥ v·ªôi. Attachment c·ªßa ta sau khi upload th√†nh c√¥ng s·∫Ω tr√¥ng nh∆∞ sau:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly html"><div tabindex="0" class="prism-code language-html codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">figure</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">  </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">contenteditable</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">false</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">  </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">data-trix-attachment</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&#x27;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">{</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">contentType</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">:</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">application/zip</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">,</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">filename</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">:</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">monaco.ttf-master.zip</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">,</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">filesize</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">:88996,</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">sgid</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">:</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">BAh7CEkiCGdpZAY6BkVUSSIvZ2lkOi8vYXBwL0FjdGl2ZVN0b3JhZ2U6OkJsb2IvOD9leHBpcmVzX2luBjsAVEkiDHB1cnBvc2UGOwBUSSIPYXR0YWNoYWJsZQY7AFRJIg9leHBpcmVzX2F0BjsAVDA=--79d2aa5a0af367233a5420a4f0ae02657d3910ab</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">,</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">url</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">:</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">http://localhost:60100/rails/active_storage/blobs/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaHBEUT09IiwiZXhwIjpudWxsLCJwdXIiOiJibG9iX2lkIn19--e79bebbfa0f10319d319411c129291d12e752d22/monaco.ttf-master.zip</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">}</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&#x27;</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">  </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">data-trix-content-type</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">application/zip</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">  </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">data-trix-id</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">1108</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">  </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">attachment attachment--file attachment--zip</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)"></span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">figcaption</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">attachment__caption</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">span</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">attachment__name</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">monaco.ttf-master.zip</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">span</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">span</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">attachment__size</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">86.91 KB</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">span</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">figcaption</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">figure</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Ti·∫øp ƒë·∫øn l√† submit d·ªØ li·ªáu, v·∫≠y Rails s·∫Ω g·ª≠i g√¨ l√™n?</p><p>ƒê∆°n gi·∫£n l√† Rails s·∫Ω g·ª≠i t·∫•t c·∫£ nh·ªØng g√¨ b√™n trong <code>&lt;trix-editor&gt;&lt;/trix-editor&gt;</code></p><p>Inspect th·ª≠ params, ta s·∫Ω th·∫•y:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">post_params[:content]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># =&gt; &quot;&lt;div&gt;&lt;a href=\&quot;http://localhost:60100/posts/new\&quot;&gt;http://localhost:60100/posts/new&lt;/a&gt;&lt;/div&gt;&lt;div&gt;&lt;strong&gt;Hello world&lt;br&gt;&lt;/strong&gt;&lt;figure data-trix-attachment=\&quot;{&amp;quot;content&amp;quot;:&amp;quot;&lt;figure class=\\&amp;quot;attachment attachment--file attachment--zip\\&amp;quot;&gt;\\n\\n  &lt;figcaption class=\\&amp;quot;attachment__caption\\&amp;quot;&gt;\\n      &lt;span class=\\&amp;quot;attachment__name\\&amp;quot;&gt;monaco.ttf-master.zip&lt;/span&gt;\\n      &lt;span class=\\&amp;quot;attachment__size\\&amp;quot;&gt;86.9 KB&lt;/span&gt;\\n  &lt;/figcaption&gt;\\n&lt;/figure&gt;\\n&amp;quot;,&amp;quot;contentType&amp;quot;:&amp;quot;application/zip&amp;quot;,&amp;quot;filename&amp;quot;:&amp;quot;monaco.ttf-master.zip&amp;quot;,&amp;quot;filesize&amp;quot;:88996,&amp;quot;sgid&amp;quot;:&amp;quot;BAh7CEkiCGdpZAY6BkVUSSIvZ2lkOi8vYXBwL0FjdGl2ZVN0b3JhZ2U6OkJsb2IvNz9leHBpcmVzX2luBjsAVEkiDHB1cnBvc2UGOwBUSSIPYXR0YWNoYWJsZQY7AFRJIg9leHBpcmVzX2F0BjsAVDA=--97b885c24fd3d87464525f34a7b6ea117e4c72e6&amp;quot;,&amp;quot;url&amp;quot;:&amp;quot;http://localhost:60100/rails/active_storage/blobs/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaHBEQT09IiwiZXhwIjpudWxsLCJwdXIiOiJibG9iX2lkIn19--940badfc5aee704ef3f98085f87f909baf870660/monaco.ttf-master.zip&amp;quot;}\&quot; data-trix-content-type=\&quot;application/zip\&quot; class=\&quot;attachment attachment--content attachment--zip\&quot;&gt;&lt;figure class=\&quot;attachment attachment--file attachment--zip\&quot;&gt;\r\n\r\n  &lt;figcaption class=\&quot;attachment__caption\&quot;&gt;\r\n      &lt;span class=\&quot;attachment__name\&quot;&gt;monaco.ttf-master.zip&lt;/span&gt;\r\n      &lt;span class=\&quot;attachment__size\&quot;&gt;86.9 KB&lt;/span&gt;\r\n  &lt;/figcaption&gt;\r\n&lt;/figure&gt;\r\n&lt;figcaption class=\&quot;attachment__caption\&quot;&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;/div&gt;&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>L√†m ƒë·∫πp n√≥ ch√∫t</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly html"><div tabindex="0" class="prism-code language-html codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">div</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">a</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">href</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">http://localhost:60100/posts/new</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">http://localhost:60100/posts/new</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">a</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">div</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">div</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">strong</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">Hello world</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">br</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">/&gt;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">strong</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">figure</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">    </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">data-trix-attachment</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">...</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">    </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">data-trix-content-type</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">application/zip</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">    </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">attachment attachment--content attachment--zip</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">figure</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">attachment attachment--file attachment--zip</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">figcaption</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">attachment__caption</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">span</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">attachment__name</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">monaco.ttf-master.zip</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">span</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">span</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">attachment__size</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">86.9 KB</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">span</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">figcaption</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">figure</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">figcaption</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">attachment__caption</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">figcaption</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">figure</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">div</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>C√≥ th·ªÉ th·∫•y n√≥ kh√° gi·ªëng v·ªõi content c·ªßa <code>&lt;trix-editor&gt;&lt;/trix-editor&gt;</code> ƒë√∫ng kh√¥ng n√†o?</p><p>Ta s·∫Ω save ƒë·ªëng params n√†y l·∫°i, v√† xem DB ta ch·ª©a g√¨?</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sql"><div tabindex="0" class="prism-code language-sql codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">app_development</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># SELECT body FROM action_text_rich_texts WHERE id = 3;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly html"><div tabindex="0" class="prism-code language-html codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">div</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">a</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">href</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">http://localhost:60100/posts/new</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">http://localhost:60100/posts/new</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">a</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">div</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">div</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">strong</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">Hello world</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">br</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">/&gt;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">strong</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">action-text-attachment</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">    </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">sgid</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">BAh7CEkiCGdpZAY6BkVUSSIvZ2lkOi8vYXBwL0FjdGl2ZVN0b3JhZ2U6OkJsb2IvNz9leHBpcmVzX2luBjsAVEkiDHB1cnBvc2UGOwBUSSIPYXR0YWNoYWJsZQY7AFRJIg9leHBpcmVzX2F0BjsAVDA=--97b885c24fd3d87464525f34a7b6ea117e4c72e6</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">    </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">content-type</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">application/zip</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">    </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">url</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">http://localhost:60100/rails/active_storage/blobs/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaHBEQT09IiwiZXhwIjpudWxsLCJwdXIiOiJibG9iX2lkIn19--940badfc5aee704ef3f98085f87f909baf870660/monaco.ttf-master.zip</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">    </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">filename</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">monaco.ttf-master.zip</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">    </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">filesize</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">88996</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">action-text-attachment</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">div</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>C√°c th·∫ª kh√°c th√¨ v·∫´n v·∫≠y, tuy nhi√™n attachments c·ªßa ta l·∫°i c√≥ m·ªôt ch√∫t kh√°c bi·ªát. ·ªû ƒë√¢y ƒë·ªëng <code>figure</code> ƒë√£ ƒë∆∞·ª£c minify l·∫°i th√†nh <code>action-text-attachment </code> ƒë·ªÉ cho g·ªçn h∆°n.</p><p>H√£y c√πng ƒëi·ªÅu tra xem t·∫°i sao l·∫°i nh∆∞ v·∫≠y? Tr∆∞·ªõc ti√™n ta v√†o xem <code>ActionText::RichText</code> c·ªßa ta ch·ª©a g√¨ ma gi√°o</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># https://github.com/rails/rails/blob/027085a5972a798cfea60f829a9edabbd67a2818/actiontext/app/models/action_text/rich_text.rb#L11</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">class ActionText::RichText &lt; ActiveRecord::Base</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  serialize :body, ActionText::Content</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>V·∫≠y l√† <code>body</code> c·ªßa ta ƒëang ƒë∆∞·ª£c serialize b·ªüi <code>ActionText::Content</code>, m√≤ ƒë·∫øn ƒë√≥ ti·∫øp th√¥i.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># https://github.com/rails/rails/blob/df8ee09ce71338cdf9816225df1bdebc707f3560/actiontext/lib/action_text/content.rb#L15</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">class ActionText::Content</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  class &lt;&lt; self</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    def fragment_by_canonicalizing_content(content)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      fragment = ActionText::Attachment.fragment_by_canonicalizing_attachments(content)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      fragment = ActionText::AttachmentGallery.fragment_by_canonicalizing_attachment_galleries(fragment)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      fragment</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  def initialize(content = nil, options = {})</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    options.with_defaults! canonicalize: true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    if options[:canonicalize]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      @fragment = self.class.fragment_by_canonicalizing_content(content)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    else</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      @fragment = ActionText::Fragment.wrap(content)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Ta s·∫Ω quan t√¢m t·ªõi h√†m <code>initialize</code> tr∆∞·ªõc, khi serialize, m·∫∑c ƒë·ªãnh l√† ta ƒëang kh√¥ng d√πng tham s·ªë, v·∫≠y l√† options s·ª≠ d·ª•ng s·∫Ω l√† <code>canonicalize: true</code>, xem ti·∫øp <code>fragment_by_canonicalizing_content</code> n√†o. C√≥ v·∫ª l·∫°i ph·∫£i m√≤ <code>fragment_by_canonicalizing_attachments</code> ti·∫øp @@</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># https://github.com/rails/rails/blob/df8ee09ce7/actiontext/lib/action_text/attachment.rb#L11</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">class ActionText::Attachment</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  TAG_NAME = &quot;action-text-attachment&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  SELECTOR = TAG_NAME</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  class &lt;&lt; self</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    def fragment_by_canonicalizing_attachments(content)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      fragment_by_minifying_attachments(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        fragment_by_converting_trix_attachments(content)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      )</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><code>fragment_by_minifying_attachments</code>, b·∫°n c√≥ th·∫•y t·ª´ minify kh√¥ng? C√≥ v·∫ª ta ƒëang ƒëi ƒë√∫ng h∆∞·ªõng. H√£y ti·∫øp t·ª•c, nh∆∞ng h√£y b·∫Øt ƒë·∫ßu b·∫±ng <code>fragment_by_converting_trix_attachments</code></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># https://github.com/rails/rails/blob/df8ee09ce71338cdf9816225df1bdebc707f3560/actiontext/lib/action_text/attachments/trix_conversion.rb#L9</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">module ActionText::Attachments::TrixConversion</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  class_methods do</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    def fragment_by_converting_trix_attachments(content)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      Fragment.wrap(content).replace(TrixAttachment::SELECTOR) do |node|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        from_trix_attachment(TrixAttachment.new(node))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>N√¥m na l√† ƒëo·∫°n n√†y s·∫Ω replace to√†n b·ªô <code>ActionText::TrixAttachment::SELECTOR = &quot;[data-trix-attachment]</code> b·∫±ng th·∫ª <code>ActionText::Attachment::SELECTOR = &quot;action-text-attachment&quot;</code>.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">module ActionText::Attachments::Minification</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  class_methods do</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    def fragment_by_minifying_attachments(content)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      Fragment.wrap(content).replace(ActionText::Attachment::SELECTOR) do |node|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        node.tap { |n| n.inner_html = &quot;&quot; }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>H√†m <code>fragment_by_minifying_attachments</code> c·ªßa ch√∫ng ta s·∫Ω remove to√†n b·ªô inner content c·ªßa th·∫ª <code>action-text-attachment</code>.</p><p>Sau m·ªôt h·ªìi l√≤ng v√≤ng, cu·ªëi c√πng ta ƒë√£ bi·∫øt ƒë∆∞·ª£c t·∫°i sao ƒë·ªëng <code>figure</code> r·ªëi r·∫Øm kia tr·ªü th√†nh <code>action-text-attachment</code> g·ªçn g√†ng h∆°n r·∫•t nhi·ªÅu.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="hi·ªÉn-th·ªã-d·ªØ-li·ªáu"></a>Hi·ªÉn th·ªã d·ªØ li·ªáu<a class="hash-link" href="#hi·ªÉn-th·ªã-d·ªØ-li·ªáu" title="Direct link to heading">#</a></h2><p>H√£y v√†o m√†n h√¨nh detail, v√† th·ª≠ inspect element, ta s·∫Ω th·∫•y attachment c·ªßa ta l·∫°i tr·ªü v·ªÅ d·∫°ng ƒë·∫ßy ƒë·ªß:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;%= @post.content =&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>ƒê√¢y l√† nh·ªØng g√¨ ta thu ƒë∆∞·ª£c.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly html"><div tabindex="0" class="prism-code language-html codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">div</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">trix-content</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">div</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">a</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">href</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">http://localhost:60100/posts/new</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">      </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">http://localhost:60100/posts/new</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">a</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">div</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">div</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">strong</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">Hello world</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">br</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">/&gt;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">strong</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">action-text-attachment</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">      </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">sgid</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">BAh7CEkiCGdpZAY6BkVUSSIvZ2lkOi8vYXBwL0FjdGl2ZVN0b3JhZ2U6OkJsb2IvNz9leHBpcmVzX2luBjsAVEkiDHB1cnBvc2UGOwBUSSIPYXR0YWNoYWJsZQY7AFRJIg9leHBpcmVzX2F0BjsAVDA=--97b885c24fd3d87464525f34a7b6ea117e4c72e6</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">      </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">content-type</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">application/zip</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">      </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">url</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">http://localhost:60100/rails/active_storage/blobs/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaHBEQT09IiwiZXhwIjpudWxsLCJwdXIiOiJibG9iX2lkIn19--940badfc5aee704ef3f98085f87f909baf870660/monaco.ttf-master.zip</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">      </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">filename</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">monaco.ttf-master.zip</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">      </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">filesize</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">88996</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">figure</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">attachment attachment--file attachment--zip</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">figcaption</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">attachment__caption</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">span</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">attachment__name</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">monaco.ttf-master.zip</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">span</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">span</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">attachment__size</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">86.9 KB</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">span</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">figcaption</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">figure</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">action-text-attachment</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">div</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">div</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>B·∫°n c√≤n nh·ªõ m√¨nh ghi ·ªü tr√™n, khi ta vi·∫øt <code>@post.content</code>, th·ª±c ch·∫•t ta ƒëang g·ªçi <code>@post.content.to_s</code> ch·ª©?</p><p>Th·ª≠ ƒë√†o s√¢u v√†o ch√∫t:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># https://github.com/rails/rails/blob/df8ee09ce7/actiontext/lib/action_text/content.rb#L90</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">def to_rendered_html_with_layout</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  renderer.render(partial: &quot;action_text/content/layout&quot;, locals: { content: self })</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">def to_s</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  to_rendered_html_with_layout</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly erb"><div tabindex="0" class="prism-code language-erb codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;%# https://github.com/rails/rails/blob/df8ee09ce7/actiontext/app/views/action_text/content/_layout.html.erb %&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;div class=&quot;trix-content&quot;&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &lt;%= render_action_text_content(content) %&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;/div&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># https://github.com/rails/rails/blob/0ec2a907545e47f816993b9fd8cabb552454b1a2/actiontext/app/helpers/action_text/content_helper.rb#L12</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">def render_action_text_content(content)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  sanitize_action_text_content(render_action_text_attachments(content))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">def sanitize_action_text_content(content)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  sanitizer.sanitize(content.to_html, tags: allowed_tags, attributes: allowed_attributes, scrubber: scrubber).html_safe</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">def render_action_text_attachments(content)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  content.render_attachments do |attachment|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    unless attachment.in?(content.gallery_attachments)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      attachment.node.tap do |node|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        node.inner_html = render(attachment, in_gallery: false).chomp</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end.render_attachment_galleries do |attachment_gallery|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    render(layout: attachment_gallery, object: attachment_gallery) do</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      attachment_gallery.attachments.map do |attachment|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        attachment.node.inner_html = render(attachment, in_gallery: true).chomp</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        attachment.to_html</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      end.join(&quot;&quot;).html_safe</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    end.chomp</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>ƒê·∫°i kh√°i l√† Rails s·∫Ω sanitize ƒë·ªëng rich text c·ªßa ta ƒë·ªÉ tr√°nh XSS attack, v√† render template ƒë·ªëi v·ªõi nh·ªØng attachment.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="integrate-v·ªõi-active-storage"></a>Integrate v·ªõi Active Storage<a class="hash-link" href="#integrate-v·ªõi-active-storage" title="Direct link to heading">#</a></h2><p>H√£y quay tr·ªü l·∫°i v·ªõi model <code>ActionText::RichText</code></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># https://github.com/rails/rails/blob/df8ee09ce7/actiontext/app/models/action_text/rich_text.rb#L14</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">class ActionText::RichText &lt; ActiveRecord::Base</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  has_many_attached :embeds</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  before_save do</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    self.embeds = body.attachments.map(&amp;:attachable) if body.present?</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Ta d·ªÖ d√†ng hi·ªÉu 1 c√°ch t·ªïng quan l√† Rails s·∫Ω ti·∫øn h√†nh extract to√†n b·ªô attachment trong body, g√°n v√†o embeds. Sau ƒë√≥ s·∫Ω save ƒë·ªëng association n√†y l·∫°i.</p><p>Th·ª≠ xem Rails s·∫Ω extract attachments ra l√†m sao.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># https://github.com/rails/rails/blob/027085a5972a798cfea60f829a9edabbd67a2818/actiontext/lib/action_text/content.rb#L53</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">def attachables</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  @attachables ||= attachment_nodes.map do |node|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ActionText::Attachable.from_node(node)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># https://github.com/rails/rails/blob/027085a5972a798cfea60f829a9edabbd67a2818/actiontext/lib/action_text/content.rb#L113</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">def attachment_nodes</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  @attachment_nodes ||= fragment.find_all(ActionText::Attachment::SELECTOR)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Rails s·∫Ω t√¨m ki·∫øm t·∫•t c·∫£ th·∫ª <code>action-text-attachment</code>, extract nh·ªØng th√¥ng tin c·∫ßn thi·∫øt ƒë·ªÉ init ƒë∆∞·ª£c <code>ActiveStorage::Blob</code> object.</p><p>Ta c·∫ßn ngh√≠a qua h√†m <code>Attachable.from_node</code> n·ªØa</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># https://github.com/rails/rails/blob/027085a5972a798cfea60f829a9edabbd67a2818/actiontext/lib/action_text/attachable.rb#L10</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">def from_node(node)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  if attachable = attachable_from_sgid(node[&quot;sgid&quot;])</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    attachable</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  elsif attachable = ActionText::Attachables::ContentAttachment.from_node(node)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    attachable</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  elsif attachable = ActionText::Attachables::RemoteImage.from_node(node)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    attachable</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  else</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ActionText::Attachables::MissingAttachable</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Trong tr∆∞·ªùng h·ª£p n√†y, Rails s·∫Ω lu√¥n extract theo strategy l√† <code>sgid</code>, c√°c b·∫°n kh√¥ng c·∫ßn quan t√¢m t·ªõi 3 nh√°nh d∆∞·ªõi l√†m g√¨ cho m·∫•t c√¥ng.</p><p>C√≤n nh·ªõ ph·∫ßn tr√™n m√¨nh ƒë√£ ƒë·ªÅ c·∫≠p t·ªõi <code>sgid</code> ch·ª©?</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//github.com/rails/rails/blob/cc1a5d5620c4cd952b27f6c1bbd16d8780a34d0e/actiontext/app/javascript/actiontext/attachment_upload.js#L26</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">https</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">attachment</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">setAttributes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  sgid</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> attributes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">attachable_sgid</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  url</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">createBlobUrl</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">attributes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">signed_id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> attributes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">filename</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Callback n√†y ƒë∆∞·ª£c g·ªçi sau khi file ƒë∆∞·ª£c upload th√†nh c√¥ng. V·∫≠y <code>sgid</code> l√† c√°i g√¨?</p><p><code>sigd</code> ƒë∆∞·ª£c encrypt t·ª´ <code>id</code> c·ªßa attachment sau khi upload. Khi g·ª≠i l√™n, server s·∫Ω decrypt n√≥ ƒë·ªÉ l·∫•y l·∫°i <code>id</code>, g√°n attachment v√†o record.</p><p>T·∫°i sao l·∫°i c·∫ßn encrypt? C√°c b·∫°n c·ª© t∆∞·ªüng t∆∞·ª£ng, n·∫øu d√πng th·∫≥ng id, do ta upload ·∫£nh tr∆∞·ªõc khi t·∫°o record, n√™n khi g·ª≠i params t·ª´ client l√™n, ch·∫Øc ch·∫Øn s·∫Ω ph·∫£i ƒë∆∞a attachment id v√†o ƒë·ªÉ server l∆∞u ƒë√∫ng association. Client n√≥ g·ª≠i ƒë√∫ng th√¨ kh√¥ng sao, nh∆∞ng n·∫øu n√≥ g·ª≠i id attachment c·ªßa ng∆∞·ªùi kh√°c th√¨ sao? Attachment ƒë√≥ s·∫Ω chuy·ªÉn ch·ªß ngay l·∫≠p t·ª©c :v C√≤n n·∫øu encrypt th√¨ user ƒë·ªë m√† m√≤ ƒë∆∞·ª£c m√£ hash c·ªßa attachment ng∆∞·ªùi kh√°c.</p><p><code>attachable_from_sgid(node[&quot;sgid&quot;])</code> s·∫Ω tr·∫£ v·ªÅ <code>ActiveStorage::Blob</code> object</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># https://github.com/rails/rails/blob/f1b8bb4e1f16e4029ddf05515db0c01942521116/actiontext/lib/action_text/attachable.rb#L22</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">def from_attachable_sgid(sgid, options = {})</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  method = sgid.is_a?(Array) ? :locate_many_signed : :locate_signed</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  record = GlobalID::Locator.public_send(method, sgid, options.merge(for: LOCATOR_NAME))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  record || raise(ActiveRecord::RecordNotFound)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>N·∫øu kh√¥ng tin, b·∫°n h√£y th·ª≠ <code>rails c</code> v√† g·ªçi h√†m:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">GlobalID::Locator.locate_signed(sgid, { for: &quot;attachable&quot; })</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="k·∫øt-lu·∫≠n"></a>K·∫øt lu·∫≠n<a class="hash-link" href="#k·∫øt-lu·∫≠n" title="Direct link to heading">#</a></h1><p><code>Action Text</code> ƒë∆∞·ª£c thi·∫øt k·∫ø kh√° hay, code g·ªçn, t·∫•t c·∫£ method ƒë·ªÅu r·∫•t ng·∫Øn, d·ªÖ hi·ªÉu.</p><p>Do l√† built-in n√™n ta c≈©ng ch·∫£ c·∫ßn c√†i c·∫Øm g√¨ th√™m m·ªát ng∆∞·ªùi. N·∫øu ƒë√£ upgrade l√™n Rails 6, b·∫°n h√£y th·ª≠ tr·∫£i nghi·ªám n√≥ xem.</p><p>C√≤n ƒë·ªëi v·ªõi phi√™n b·∫£n th·∫•p h∆°n, ta c≈©ng c√≥ th·ªÉ √°p d·ª•ng flow c·ªßa Action Text ƒë·ªÉ build m·ªôt package h·ªó tr·ª£ richtext.</p></div><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog/tags/action-text">action-text</a><a class="margin-horiz--sm" href="/blog/tags/ruby-on-rails">ruby-on-rails</a><a class="margin-horiz--sm" href="/blog/tags/web">web</a></div></footer></article><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_GeHD"><a href="/blog/cung-tim-hieu-ve-railway-oriented-programming">C√πng t√¨m hi·ªÉu v·ªÅ Railway Oriented Programming</a></h2><div class="margin-vert--md"><time datetime="2019-03-16T00:00:00.000Z" class="blogPostDate_fNvV">March 16, 2019 ¬∑ 8 min read</time></div><div class="avatar margin-vert--md"><a href="https://github.com/moonlight8978" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img src="https://avatars.githubusercontent.com/u/26299310?v=4" alt="L√™ Sƒ© B√≠ch"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/moonlight8978" target="_blank" rel="noopener noreferrer">L√™ Sƒ© B√≠ch</a></h4><small class="avatar__subtitle">Ruby on Rails/React Developer</small></div></div></header><div class="markdown"><p>Khi m·ªõi b·∫Øt ƒë·∫ßu code, c√≥ th·ªÉ ch√∫ng ta r·∫•t ng·∫°i handle nh·ªØng exception m√† ngay c·∫£ 1 h√†m ƒë∆°n gi·∫£n nh·∫•t c≈©ng c√≥ th·ªÉ tung ra. Tuy nhi√™n, th·ª±c t·∫ø khi x√¢y d·ª±ng h·ªá th·ªëng, ta ph·∫£i ƒë·∫∑c bi·ªát ch√∫ √Ω ƒë·∫øn nh·ªØng exception, kh√¥ng th√¨ ·ª©ng d·ª•ng c·ªßa ta c√≥ th·ªÉ thƒÉng b·∫•t c·ª© l√∫c n√†o :v</p><p>V·∫≠y th√¨ l√†m sao ƒë·ªÉ handle ch√∫ng 1 c√°ch th·∫≠t <em>clean</em>. C√≥ kh√° nhi·ªÅu h∆∞·ªõng ti·∫øp c·∫≠n, tuy nhi√™n ta h√£y c√πng th·ª≠ tr·∫£i nghi·ªám theo h∆∞·ªõng <em>Railway Oriented</em> xem n√≥ c√≥ g√¨ hay.</p><p>B√†i gi·ªõi thi·ªáu g·ªëc ƒë∆∞·ª£c vi·∫øt s·ª≠ d·ª•ng ng√¥n ng·ªØ F#, nh∆∞ng ta ho√†n to√†n c√≥ th·ªÉ √°p d·ª•ng v√†o c√°c ng√¥n ng·ªØ kh√°c nh∆∞ Javascript, Ruby, ...</p><p><em>Railway Oriented Programming</em> ph√π h·ª£p v·ªõi style l·∫≠p tr√¨nh h√†m (Functional Programming - FP)</p><p>T√™n g·ªçi l√† <em>Railway</em> c≈©ng b·ªüi tr√¥ng n√≥ kh√° gi·ªëng v·ªõi ƒë∆∞·ªùng ray t√†u h·ªèa.</p><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="v·∫•n-ƒë·ªÅ"></a>V·∫•n ƒë·ªÅ<a class="hash-link" href="#v·∫•n-ƒë·ªÅ" title="Direct link to heading">#</a></h1><p>H√£y b·∫Øt ƒë·∫ßu v·ªõi 1 usecase r·∫•t c∆° b·∫£n</p><blockquote><p>Ng∆∞·ªùi d√πng mu·ªën c·∫≠p nh·∫≠t profile c·ªßa h·ªç.</p></blockquote><p>Sau khi ng∆∞·ªùi d√πng submit th√¥ng tin ·ªü web, ta hay c√πng ph√¢n t√≠ch nh·ªØng x·ª≠ l√Ω ·ªü ph√≠a server</p><p><img src="https://images.viblo.asia/e37fd6b1-91fc-4340-8938-154196463a70.jpg"></p><p>T√¨nh hu·ªëng ƒë·∫πp nh·∫•t x·∫£y ra l√† t·ª´ b∆∞·ªõc 1-5, ·ª©ng d·ª•ng ta s·∫Ω ch·∫°y tr∆°n tru, kh√¥ng c√≥ b·∫•t c·ª© 1 l·ªói n√†o.</p><p>Nh∆∞ng m√† ...</p><blockquote><p>ƒê·ªùi kh√¥ng nh∆∞ m∆°, t√¨nh kh√¥ng nh∆∞ th∆°.</p></blockquote><p>T·ª´ b∆∞·ªõc 1-4 ƒë·ªÅu c√≥ th·ªÉ c√≥ l·ªói x·∫£y ra, v√† t·∫•t nhi√™n ng∆∞·ªùi d√πng s·∫Ω kh√¥ng h·ªÅ mu·ªën nh√¨n th·∫•y c·∫£nh n√†y</p><p><img src="https://images.viblo.asia/e05c2f5c-ee9e-4f78-958d-bd54ff7b291c.jpg"></p><p>V·∫≠y th√¨ nh·ªØng g√¨ ta c·∫ßn l√†m l√† x·ª≠ l√Ω nh·ªØng l·ªói n√†y, kh√¥ng th√¨ ng∆∞·ªùi d√πng m·ªôt ƒëi kh√¥ng tr·ªü l·∫°i lu√¥n.</p><p><img src="https://images.viblo.asia/d7ea1ee4-2326-408a-be91-e361803f7f0b.jpeg"></p><p>V√† ta s·∫Ω vi·∫øt code cho n√≥:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><div tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">updateUser</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">user</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> request </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">receiveRequest</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword control-flow" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">!</span><span class="token function" style="color:rgb(130, 170, 255)">isValidRequest</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">request</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword control-flow" style="font-style:italic">return</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Request is forbidden&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword control-flow" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">!</span><span class="token function" style="color:rgb(130, 170, 255)">isValidUser</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">request</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword control-flow" style="font-style:italic">return</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;User information is invalid&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword control-flow" style="font-style:italic">try</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">saveToDatabase</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">request</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="font-style:italic">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">error</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword control-flow" style="font-style:italic">return</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;DB error&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword control-flow" style="font-style:italic">try</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">sendEmail</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">request</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="font-style:italic">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">error</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword control-flow" style="font-style:italic">return</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Mailer error&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword control-flow" style="font-style:italic">return</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;OK&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Code tr√™n ƒë∆∞·ª£c vi·∫øt theo style Imperative, v√¨ th·∫ø n√™n ta c√≥ th·ªÉ return b·∫•t c·ª© l√∫c n√†o ta mu·ªën. ƒêi·ªÅu ƒë√≥ l√†m h√†m c·ªßa ta c√≥ th·ªÉ return theo r·∫•t nhi·ªÅu c√°ch (nhi·ªÅu ki·ªÉu response kh√°c nhau).</p><p><img src="https://images.viblo.asia/13ab6aca-df34-41a5-89fe-85e6b8de4523.png"></p><p>Ta s·∫Ω design l·∫°i flow theo style FP.</p><p><img src="https://images.viblo.asia/e20339fb-142c-46a8-8d29-965f6ebcf63f.png"></p><p>H√†m c·ªßa ta gi·ªù ƒë√¢y:</p><ul><li><p>Ch·ªâ c√≥ 2 ki·ªÉu tr·∫£ v·ªÅ: <code>Success</code> ho·∫∑c <code>Failure</code>.</p><ul><li><p>Success:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// @flow</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">type </span><span class="token maybe-class-name">Success</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> data</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> object </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></li><li><p>Failure:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// @flow</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">type </span><span class="token maybe-class-name">Failure</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> error</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> string </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></li></ul></li><li><p>Use case ƒë∆∞·ª£c x√¢y d·ª±ng t·ª´ 1 series c√°c h√†m con t∆∞∆°ng ·ª©ng v·ªõi m·ªói step.</p></li></ul><p>Ta s·∫Ω √°p d·ª•ng <em>Railway Oriented Programming</em> ƒë·ªÉ gi·∫£i quy·∫øt v·∫•n ƒë·ªÅ n√†y.</p><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="railway-oriented-programming"></a>Railway Oriented Programming<a class="hash-link" href="#railway-oriented-programming" title="Direct link to heading">#</a></h1><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="monad"></a>Monad<a class="hash-link" href="#monad" title="Direct link to heading">#</a></h4><p>Trong l·∫≠p tr√¨nh h√†m, c√≥ m·ªôt c√°ch ƒë·ªÉ handle l·ªói l√† d√πng <em>monad</em>.</p><p>Monad th∆∞·ªùng ƒëi k√®m v·ªõi Applicative v√† Functor n·ªØa, b·ªçn n√†y kh√° l√† xo·∫Øn n√£o n√™n m√¨nh s·∫Ω kh√¥ng ƒë·ªÅ c·∫≠p ·ªü ƒë√¢y.</p><p>Ta s·∫Ω ch·ªâ quan t√¢m t·ªõi: <em>Either</em> monad.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// @flow</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">type </span><span class="token maybe-class-name">Either</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token constant" style="color:rgb(130, 170, 255)">A</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">B</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">A</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">B</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">type </span><span class="token maybe-class-name">FunctionReturnMonad</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token constant" style="color:rgb(130, 170, 255)">A</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">B</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token maybe-class-name">Either</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token constant" style="color:rgb(130, 170, 255)">A</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">B</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Hi·ªÉu m·ªôt c√°ch n√¥m na s·∫Ω l√†: h√†m c·ªßa ta s·∫Ω lu√¥n tr·∫£ v·ªÅ A ho·∫∑c B, nh∆∞ng kh√¥ng bao gi·ªù tr·∫£ v·ªÅ c·∫£ 2.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="switch"></a>Switch<a class="hash-link" href="#switch" title="Direct link to heading">#</a></h4><p>H√£y b·∫Øt ƒë·∫ßu v·ªõi 1 function c√≥ th·ªÉ g√¢y ra l·ªói:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">validateNameNotBlank</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">user</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword control-flow" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">user</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">name</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">===</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword control-flow" style="font-style:italic">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> error</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Name is blank&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword control-flow" style="font-style:italic">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> data</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> user </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><img src="https://images.viblo.asia/4214182b-82ca-4ff1-9f86-7161b063632d.jpg"></p><p>ƒê√¢y ch√≠nh l√† 1 switch, n√≥ r·∫Ω nh√°nh lu·ªìng x·ª≠ l√Ω c·ªßa ta th√†nh <code>Success</code> v√† <code>Failure</code>.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="k·∫øt-n·ªëi-nhi·ªÅu-switch"></a>K·∫øt n·ªëi nhi·ªÅu switch<a class="hash-link" href="#k·∫øt-n·ªëi-nhi·ªÅu-switch" title="Direct link to heading">#</a></h4><p><img src="https://images.viblo.asia/b6cf8618-c07c-4502-86a3-90b1b6ab3530.png"></p><p>ƒê√¢y l√† <em>ƒë∆∞·ªùng ray</em> ho√†n ch·ªânh m√† ta c·∫ßn x√¢y d·ª±ng t·ª´ nh·ªØng switch ri√™ng l·∫ª tr√™n.</p><p>C√≥ th·ªÉ nh·∫≠n th·∫•y m·ªôt v√†i ƒëi·ªÉm quan tr·ªçng ·ªü railway n√†y:</p><ul><li><p>Khi m·ªôt step b·ªã l·ªói, n√≥ s·∫Ω kh√¥ng return function ngay l·∫≠p t·ª©c, m√† s·∫Ω ti·∫øp t·ª•c ch·∫°y v√†o c√°c function ti·∫øp theo cho t·ªõi khi k·∫øt th√∫c flow.</p><p>Tuy nhi√™n k·∫øt qu·∫£ cu·ªëi c√πng nh·∫≠n ƒë∆∞·ª£c ch·ªâ l√† l·ªói ƒë·∫ßu ti√™n ph√°t sinh.</p></li><li><p>Nh·ªØng h√†m c·ªßa t·ª´ng step ƒë·ªÅu ph·∫£i x·ª≠ l√Ω c·∫£ tr∆∞·ªùng h·ª£p c√≥ d·ªØ li·ªáu v√† tr∆∞·ªùng h·ª£p h√†m tr∆∞·ªõc tr·∫£ v·ªÅ l·ªói</p></li></ul><p>B√¢y gi·ªù v·∫•n ƒë·ªÅ l√† l√†m th·∫ø n√†o ƒë·ªÉ n·ªëi nh·ªØng switch l·∫°i v·ªõi nhau?</p><p>C√¢u tr·∫£ l·ªùi l√† <code>compose</code>. Tuy nhi√™n ta kh√¥ng th·ªÉ compose theo c√°ch th√¥ng th∆∞·ªùng ƒë∆∞·ª£c.</p><p>V√≠ d·ª• nh∆∞:</p><p>N·∫øu ƒë·∫ßu v√†o v√† ƒë·∫ßu ra c·ªßa ta c√πng interface</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:rgb(130, 170, 255)">mul2</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">num</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> num </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:rgb(130, 170, 255)">add1</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">num</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> num </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">mul2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token function" style="color:rgb(130, 170, 255)">add1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// 4</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Tr·ªü l·∫°i h√†m <code>validateBlank</code> ·ªü tr√™n, n·∫øu ta c√≥ nhi·ªÅu h√†m <code>validate</code> kh√°c t∆∞∆°ng t·ª±</p><p><img src="https://images.viblo.asia/02d95ea0-c572-481b-bb2b-d2801667e9a0.png"></p><p>Ta c√≥ th·ªÉ th·∫•y ƒë·∫ßu v√†o ch·ªâ c√≥ 1, m√† l·∫°i c√≥ nh·ªØng 2 ƒë·∫ßu ra.</p><p>ƒê·ªÉ c√≥ th·ªÉ compose, ta s·∫Ω ph·∫£i bi·∫øn ch√∫ng th√†nh nh·ªØng function c√≥ th·ªÉ handle c·∫£ tr∆∞·ªùng h·ª£p <code>Success</code> l·∫´n <code>Failure</code>.</p><p>C√≥ th·ªÉ s·ª≠ d·ª•ng HOC</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:rgb(130, 170, 255)">transformToTwoTrackInput</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">func</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token parameter"> data</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token parameter"> error </span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword control-flow" style="font-style:italic">return</span><span class="token plain"> data </span><span class="token operator" style="color:rgb(137, 221, 255)">?</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">func</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> error </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> twoTrackValidateNameNotBlank </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">transformToTwoTrackInput</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">validateNameNotBlank</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> twoTrackValidateName50 </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">transformToTwoTrackInput</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">validateName50</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> twoTrackValidateEmailNotBlank </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">transformToTwoTrackInput</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  validateEmailNotBlank</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> user </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> email</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> name</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">twoTrackValidateEmailNotBlank</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">twoTrackValidateName50</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token function" style="color:rgb(130, 170, 255)">twoTrackValidateNameNotBlank</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> data</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> user </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// { error: &#x27;name is blank&#x27; }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Nh∆∞ v·∫≠y l√† ta ƒë√£ k·∫øt n·ªëi ƒë∆∞·ª£c nh·ªØng m·∫£nh gh√©p tr√™n v·ªõi nhau.</p><p><img src="https://images.viblo.asia/59045ab0-2465-4163-8c25-1b7529749196.png"></p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="m·ªôt-v√†i-ki·ªÉu-function-th∆∞·ªùng-g·∫∑p"></a>M·ªôt v√†i ki·ªÉu function th∆∞·ªùng g·∫∑p<a class="hash-link" href="#m·ªôt-v√†i-ki·ªÉu-function-th∆∞·ªùng-g·∫∑p" title="Direct link to heading">#</a></h4><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="single-track-function"></a>Single track function<a class="hash-link" href="#single-track-function" title="Direct link to heading">#</a></h5><p>N·∫øu m·ªôt function kh√¥ng g√¢y ra l·ªói (ch·ªâ c√≥ 1 ƒë·∫ßu v√†o v√† 1 ƒë·∫ßu ra) th√¨ n√≥ s·∫Ω kh√¥ng th·ªÉ n√†o compose ƒë∆∞·ª£c v√†o railway c·ªßa ch√∫ng ta.</p><p>Khi ƒë√≥ ta ph·∫£i wrap n√≥ b·ªüi 2-track function, gi·ªëng v·ªõi HOC ·ªü tr√™n.</p><p><img src="https://images.viblo.asia/754c4226-95b0-4b98-81dc-e64ed7842ee9.jpg"></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">trimEmail</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">user</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword control-flow" style="font-style:italic">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token spread operator" style="color:rgb(137, 221, 255)">...</span><span class="token plain">user</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    email</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> user</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">email</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">trim</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:rgb(130, 170, 255)">transformSingleTrackToTwoTrackInput</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token parameter">func</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token parameter"> data</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token parameter"> error </span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword control-flow" style="font-style:italic">return</span><span class="token plain"> data </span><span class="token operator" style="color:rgb(137, 221, 255)">?</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">func</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> error </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> user </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> email</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;  sample@email.com&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">transformSingleTrackToTwoTrackInput</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">trimEmail</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> data</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> user </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="dead-end-function"></a>Dead-end function<a class="hash-link" href="#dead-end-function" title="Direct link to heading">#</a></h5><p>Dead-end function l√† nh·ªØng h√†m void, kh√¥ng c√≥ gi√° tr·ªã tr·∫£ v·ªÅ</p><p><img src="https://images.viblo.asia/55f5aa49-c5c8-498f-a175-edd967b3d5c2.jpg"></p><p>M√†u t√≠m ch√≠nh l√† n∆°i ta s·∫Ω ƒë·∫∑t <em>dead-end function</em> v√†o</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:rgb(130, 170, 255)">transformDeadEndFunction</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">func</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token parameter"> data</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token parameter"> error </span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword control-flow" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token function" style="color:rgb(130, 170, 255)">func</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword control-flow" style="font-style:italic">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> data </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="font-style:italic">else</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword control-flow" style="font-style:italic">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> error </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="function-throw-exception"></a>Function throw Exception<a class="hash-link" href="#function-throw-exception" title="Direct link to heading">#</a></h5><p>Ta c√≥ th·ªÉ ƒë·∫∑t try-catch ƒë·ªÉ tr·∫£ v·ªÅ Failure</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:rgb(130, 170, 255)">transformExceptionFunction</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">func</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token parameter"> data</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token parameter"> error </span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword control-flow" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword control-flow" style="font-style:italic">try</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token function" style="color:rgb(130, 170, 255)">func</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="font-style:italic">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">error</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword control-flow" style="font-style:italic">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> error</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> error</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">message</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">||</span><span class="token plain"> error </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword control-flow" style="font-style:italic">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> data </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="font-style:italic">else</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword control-flow" style="font-style:italic">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> error </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><em>Note</em>: Convert t·∫•t c·∫£ Exception th√†nh <code>Failure</code></p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="k·∫øt-qu·∫£"></a>K·∫øt qu·∫£<a class="hash-link" href="#k·∫øt-qu·∫£" title="Direct link to heading">#</a></h4><p>Ta kh√¥ng th·ªÉ tr·∫£ v·ªÅ d·ªØ li·ªáu ki·ªÉu two-track cho client ƒë∆∞·ª£c, v√¨ v·∫≠y ta s·∫Ω c√≥ th√™m 1 b∆∞·ªõc cu·ªëi ƒë·ªÉ tr·∫£ v·ªÅ th√¥ng tin cho client.</p><p><img src="https://images.viblo.asia/08650333-ae3a-4fa8-b960-09c7b11fbd79.jpg"></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">returnMessage</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token parameter"> data</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token parameter"> error </span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword control-flow" style="font-style:italic">return</span><span class="token plain"> data </span><span class="token operator" style="color:rgb(137, 221, 255)">?</span><span class="token plain"> </span><span class="token known-class-name class-name" style="color:rgb(255, 203, 107)">JSON</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">stringify</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> error</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">toString</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="rop-trong-m·ªôt-s·ªë-ng√¥n-ng·ªØ-kh√°c"></a>ROP trong m·ªôt s·ªë ng√¥n ng·ªØ kh√°c<a class="hash-link" href="#rop-trong-m·ªôt-s·ªë-ng√¥n-ng·ªØ-kh√°c" title="Direct link to heading">#</a></h1><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="ruby-framework-rails"></a>Ruby (framework Rails)<a class="hash-link" href="#ruby-framework-rails" title="Direct link to heading">#</a></h4><p>N·∫øu c√°c b·∫°n s·ª≠ d·ª•ng Rails, h√£y th·ª≠ tr·∫£i nghi·ªám qua gem <code>trailblazer</code>. Logic c·ªßa ·ª©ng d·ª•ng gi·ªù s·∫Ω t·∫≠p trung ch·ªß y·∫øu trong c√°c <code>Operation</code> thay v√¨ controller nh∆∞ x∆∞a n·ªØa, m√† nh·ªØng operation n√†y ƒë∆∞·ª£c vi·∫øt theo style ROP.</p><p><img src="https://images.viblo.asia/f425b9c2-0d14-460b-8540-f289e8859972.gif"></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">class Song::Create &lt; Trailblazer::Operation</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  step    Model(Song, :new) # init model</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  step    :assign_current_user!</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  step    Contract::Build(constant: SongForm) # create form object</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  step    Contract::Validate() # validate form object</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  failure :log_error!</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  step    Contract::Persist() # save song to db</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  def log_error!(options)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    logger.debug &quot;Errors occurred while creating song.&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  def assign_current_user!(options)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    options[&quot;model&quot;].created_by = options[&quot;current_user&quot;]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Flow c·ªßa Operation kh√¥ng ho√†n to√†n gi·ªëng v·ªõi ROP nh∆∞ ta ƒë√£ th·∫•y ·ªü tr√™n, m·ªôt khi b·∫°n ƒë√£ v√†o nh√°nh Failure, n√≥ s·∫Ω trigger to√†n b·ªô nh·ªØng step handle error ph√≠a sau.</p><p>Kh√¥ng li√™n quan l·∫Øm nh∆∞ng trong <code>trailblazer</code> ecosystem c√≥ kh√° nhi·ªÅu gem th√∫ v·ªã nh∆∞: <code>reform</code> (form object pattern), v√† <code>cells</code> (view components).</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="javascript"></a>Javascript<a class="hash-link" href="#javascript" title="Direct link to heading">#</a></h4><p>N·∫øu ta ƒë·ªÉ √Ω, <code>Promise</code> c·ªßa Javascript c≈©ng kh√° gi·ªëng v·ªõi ROP.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> user </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> username</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;sample&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> email</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;sample&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:rgb(130, 170, 255)">validatePresenceOfUsername</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword control-flow" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">!</span><span class="token operator" style="color:rgb(137, 221, 255)">!</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">username</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword control-flow" style="font-style:italic">return</span><span class="token plain"> user</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword control-flow" style="font-style:italic">throw</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Username is blank&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:rgb(130, 170, 255)">validateFormatOfEmail</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword control-flow" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">email</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;&amp;</span><span class="token plain"> data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">email</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">match</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token regex regex-delimiter">/</span><span class="token regex regex-source language-regex">@</span><span class="token regex regex-delimiter">/</span><span class="token regex regex-flags">g</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword control-flow" style="font-style:italic">return</span><span class="token plain"> user</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword control-flow" style="font-style:italic">throw</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Email is in invalid format&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:rgb(130, 170, 255)">logError</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">error</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token console class-name" style="color:rgb(255, 203, 107)">console</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">error</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">error</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token known-class-name class-name" style="color:rgb(255, 203, 107)">Promise</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">resolve</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">user</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">then</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">validatePresenceOfUsername</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">then</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">validateFormatOfEmail</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token keyword control-flow" style="font-style:italic">catch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">logError</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// =&gt; &#x27;Email is in invalid format</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="tham-kh·∫£o"></a>Tham kh·∫£o<a class="hash-link" href="#tham-kh·∫£o" title="Direct link to heading">#</a></h1><p><a href="https://fsharpforfunandprofit.com/rop/" target="_blank" rel="noopener noreferrer">https://fsharpforfunandprofit.com/rop/</a></p><p><a href="https://fsharpforfunandprofit.com/posts/function-composition/" target="_blank" rel="noopener noreferrer">https://fsharpforfunandprofit.com/posts/function-composition/</a></p><p><a href="https://dorp.io/posts/railway-oriented-programming/" target="_blank" rel="noopener noreferrer">https://dorp.io/posts/railway-oriented-programming/</a></p><p><a href="https://github.com/trailblazer/trailblazer" target="_blank" rel="noopener noreferrer">https://github.com/trailblazer/trailblazer</a></p><p><a href="http://trailblazer.to/gems/operation/2.0/api.html" target="_blank" rel="noopener noreferrer">http://trailblazer.to/gems/operation/2.0/api.html</a></p></div><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog/tags/ruby">ruby</a><a class="margin-horiz--sm" href="/blog/tags/javascript">javascript</a><a class="margin-horiz--sm" href="/blog/tags/functional-programing">functional-programing</a><a class="margin-horiz--sm" href="/blog/tags/railway-oriented-programming">railway-oriented-programming</a></div></footer></article><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_GeHD"><a href="/blog/mot-vai-mindset-khi-lam-viec-voi-react">M·ªôt v√†i mindset khi l√†m vi·ªác v·ªõi React</a></h2><div class="margin-vert--md"><time datetime="2019-02-16T00:00:00.000Z" class="blogPostDate_fNvV">February 16, 2019 ¬∑ 11 min read</time></div><div class="avatar margin-vert--md"><a href="https://github.com/moonlight8978" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img src="https://avatars.githubusercontent.com/u/26299310?v=4" alt="L√™ Sƒ© B√≠ch"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/moonlight8978" target="_blank" rel="noopener noreferrer">L√™ Sƒ© B√≠ch</a></h4><small class="avatar__subtitle">Ruby on Rails/React Developer</small></div></div></header><div class="markdown"><p>Ng√†y nay, c√¥ng ngh·ªá ng√†y c√†ng ph√°t tri·ªÉn, v√† th·∫ø gi·ªõi Web c≈©ng v·∫≠y. ƒêa s·ªë web hi·ªán ƒë·∫°i ƒë·ªÅu ƒë√£ n√≥i l·ªùi t·∫°m bi·ªát v·ªõi nh·ªØng d√≤ng Ruby, PHP, hay Java ƒë∆∞·ª£c nh√∫ng trong HTML/JS. Ph·∫ßn giao di·ªán ng∆∞·ªùi d√πng ƒë∆∞·ª£c ch√≠nh browser ph√≠a client x·ª≠ l√Ω, thay v√¨ server √¥m h·∫øt nh∆∞ x∆∞a. C√°c th∆∞ vi·ªán/framework nh∆∞ React, Angular, Vue, ... ƒë·ªÅu ƒë√£ tr·ªü n√™n qu√° quen thu·ªôc.</p><p>N·∫øu b·∫°n c√≥ √Ω ƒë·ªãnh h·ªçc hay ƒë√£ chuy·ªÉn sang React th√¨ mong b√†i vi·∫øt c√≥ th·ªÉ gi√∫p c√°c b·∫°n c√≥ nh·ªØng mindset t·ªët h∆°n khi l√†m vi·ªác v·ªõi n√≥.</p><p>ƒê√¢y ƒë·ªÅu l√† nh·ªØng th·ª© m√¨nh cho r·∫±ng c·∫ßn quan t√¢m sau 1 th·ªùi gian l√†m vi·ªác v·ªõi React.</p><p>B√†i vi·∫øt n√†y kh√¥ng n√≥i v·ªÅ vi·ªác h∆∞·ªõng d·∫´n code React.</p><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="component"></a>Component<a class="hash-link" href="#component" title="Direct link to heading">#</a></h1><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="react-is-all-about-components"></a>React is all about components<a class="hash-link" href="#react-is-all-about-components" title="Direct link to heading">#</a></h3><p>React ƒë∆∞·ª£c design theo h∆∞·ªõng Component, m·ªói ph·∫ßn t·ª≠ nh·ªè nh·∫•t nh∆∞ th·∫ª <code>&lt;span&gt;</code>, hay <code>&lt;button&gt;</code> ƒë·ªÅu c√≥ th·ªÉ wrap th√†nh m·ªôt component ƒë·ªÉ t√°i s·ª≠ d·ª•ng 1 c√°ch t·ªëi ƒëa.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly jsx"><div tabindex="0" class="prism-code language-jsx codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// path/to/button.jsx</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">export</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">Button</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token parameter"> children</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token parameter"> type</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token parameter"> onClick </span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">button</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">type</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">button</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">className</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:rgb(199, 146, 234)">=</span><span class="token tag script language-javascript punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token tag script language-javascript template-string template-punctuation string" style="color:rgb(195, 232, 141)">`</span><span class="token tag script language-javascript template-string string" style="color:rgb(195, 232, 141)">btn btn-</span><span class="token tag script language-javascript template-string interpolation interpolation-punctuation punctuation" style="color:rgb(199, 146, 234)">${</span><span class="token tag script language-javascript template-string interpolation" style="color:rgb(255, 85, 114)">type</span><span class="token tag script language-javascript template-string interpolation interpolation-punctuation punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token tag script language-javascript template-string template-punctuation string" style="color:rgb(195, 232, 141)">`</span><span class="token tag script language-javascript punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">onClick</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:rgb(199, 146, 234)">=</span><span class="token tag script language-javascript punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token tag script language-javascript" style="color:rgb(255, 85, 114)">onClick</span><span class="token tag script language-javascript punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">children</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">button</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>V√† ·ªü ƒë√¢u c·∫ßn component n√†y, ta s·∫Ω import n√≥ v√†o ƒë·ªÉ s·ª≠ d·ª•ng.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly jsx"><div tabindex="0" class="prism-code language-jsx codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> Button </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;./path/to/button&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">Screen</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag class-name" style="color:rgb(255, 203, 107)">Button</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">type</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">primary</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">onClick</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:rgb(199, 146, 234)">=</span><span class="token tag script language-javascript punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token tag script language-javascript punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token tag script language-javascript punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token tag script language-javascript" style="color:rgb(255, 85, 114)"> </span><span class="token tag script language-javascript operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token tag script language-javascript" style="color:rgb(255, 85, 114)"> console</span><span class="token tag script language-javascript punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token tag script language-javascript function" style="color:rgb(130, 170, 255)">log</span><span class="token tag script language-javascript punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token tag script language-javascript string" style="color:rgb(195, 232, 141)">&quot;Clicked&quot;</span><span class="token tag script language-javascript punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token tag script language-javascript punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      Click me</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag class-name" style="color:rgb(255, 203, 107)">Button</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>V·ªõi nh·ªØng ng√¥n ng·ªØ server side truy·ªÅn th·ªëng, ta s·∫Ω vi·∫øt nh∆∞ sau (slim ruby):</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly slim"><div tabindex="0" class="prism-code language-slim codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">/ path/to/a.slim</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">button.btn.btn-primary</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | Button A</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly slim"><div tabindex="0" class="prism-code language-slim codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">/ path/to/b.slim</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">button.btn.btn-primary</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | Button B</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>C√≥ th·ªÉ th·∫•y l√† code c·ªßa ta tr√¥ng s√°ng s·ªßa h∆°n r·∫•t nhi·ªÅu.</p><p>Tr√™n th·ª±c t·∫ø, ta c≈©ng n√™n vi·∫øt nh·ªØng component nh·ªè nh·∫•t c√≥ th·ªÉ nh∆∞ v·∫≠y, n√≥ s·∫Ω gi√∫p giao di·ªán app ta ƒë·ªìng b·ªô, v√† debug c≈©ng tr·ªü n√™n d·ªÖ h∆°n.</p><p>Hay th·ª≠ v·ªõi m·ªôt component ph·ª©c t·∫°p h∆°n h∆°n x√≠u:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly jsx"><div tabindex="0" class="prism-code language-jsx codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">List</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token parameter"> items</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token parameter"> renderItem</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token parameter"> emptyText </span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">items</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">length </span><span class="token operator" style="color:rgb(137, 221, 255)">===</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">div</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">span</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">emptyText</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">span</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">div</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">div</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">items</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">map</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">item</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">renderItem</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">item</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">div</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="c·∫•u-tr√∫c-th∆∞-m·ª•c"></a>C·∫•u tr√∫c th∆∞ m·ª•c<a class="hash-link" href="#c·∫•u-tr√∫c-th∆∞-m·ª•c" title="Direct link to heading">#</a></h3><p>ƒê·ªëi v·ªõi nh·ªØng d·ª± √°n l·ªõn, c√≥ m·ªôt c·∫•u tr√∫c th∆∞ m·ª•c r√µ r√†ng s·∫Ω khi·∫øn vi·ªác code tr·ªü n√™n d·ªÖ ch·ªãu h∆°n nhi·ªÅu.</p><p>L·∫°i quay l·∫°i c√°c ng√¥n ng·ªØ server side MVC c≈© - Rails. ƒê√¢y l√† m·ªôt c·∫•u tr√∫c kh√≥ m√† c√≥ th·ªÉ thay ƒë·ªïi trong t·∫•t c·∫£ c√°c d·ª± √°n:</p><p><img src="https://images.viblo.asia/70c519f5-7322-4384-a76f-caae42495028.png"></p><p>D√π v·ªõi s·ª± h·ªó tr·ª£ c·ªßa c√°c Editor/IDE hi·ªán ƒë·∫°i trong vi·ªác t√¨m ki·∫øm, m·ªü file, th√¨ c≈©ng kh√° m·∫•t th·ªùi gian ƒë·ªÉ c√≥ th·ªÉ t√¨m ƒë∆∞·ª£c nh·ªØng file li√™n quan.</p><p>V·ªõi React th√¨ flexible h∆°n, b·∫°n c√≥ th·ªÉ t·ªï ch·ª©c theo ki·ªÉu tr√™n (VD cho 1 project d√πng Redux)</p><p><img src="https://images.viblo.asia/a6cd4317-a0e0-4990-bdbe-5eea297d9ced.png"></p><p>Nh∆∞ng v·ªõi m√¨nh th√¨ m√¨nh th√≠ch c√°ch t·ªï ch·ª©c theo component/m√†n h√¨nh h∆°n.</p><p><img src="https://images.viblo.asia/f70e763d-8744-497a-9a0c-6abcfc380195.png"></p><p>M√¨nh h·ªçc ƒë∆∞·ª£c c·∫•u tr√∫c tr√™n t·ª´ m·ªôt d·ª± √°n trong list awesome react native - <a href="https://github.com/gitpoint/git-point" target="_blank" rel="noopener noreferrer">Gitpoint</a>, d√π n√≥ ƒë∆∞·ª£c vi·∫øt b·∫±ng React Native nh∆∞ng b·∫£n ch·∫•t v·∫´n l√† React n√™n kh√¥ng c√≥ v·∫•n ƒë·ªÅ g√¨ h·∫øt.</p><p>Tuy nhi√™n c·∫•u tr√∫c n√†y g·∫∑p 1 nh∆∞·ª£c ƒëi·ªÉm ·ªü ch·ªó n·∫øu 2 m√†n h√¨nh m√† share nhau chung 1 state (redux) th√¨ s·∫Ω g√¢y b·ªëi r·ªëi, ho·∫∑c l√† l·∫∑p code. V·ªõi m√¨nh, m√¨nh ch·ªçn gi·∫£i ph√°p t·∫°o 1 th∆∞ m·ª•c shared, r·ªìi c≈©ng t·ªï ch·ª©c file gi·ªëng c·∫•u tr√∫c c·ªßa th∆∞ m·ª•c <code>screens</code>. C√≤n kh√¥ng th√¨ ch·∫•p nh·∫≠n vi·ªác code b·ªã l·∫∑p 1 ch√∫t.</p><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="functional-programming-fp"></a>Functional Programming (FP)<a class="hash-link" href="#functional-programming-fp" title="Direct link to heading">#</a></h1><p>N·∫øu nh∆∞ Ruby, Java l√† c√°c ng√¥n ng·ªØ l·∫≠p tr√¨nh h∆∞·ªõng ƒë·ªëi t∆∞·ª£ng (OOP) th√¨ Javascript l·∫°i mang phong c√°ch l·∫≠p tr√¨nh h√†m, m·∫∑c d√π v·∫´n c√≥ class, object n·∫øu b·∫°n mu·ªën d√πng (Prototype)</p><p>V·ªõi OOP, ta th∆∞·ªùng xuy√™n thay ƒë·ªïi tr·∫°ng th√°i (c√°c bi·∫øn instance) c·ªßa object, nh∆∞ng FP l·∫°i kh√¥ng th√≠ch ƒëi·ªÅu n√†y, m√† th∆∞·ªùng h∆∞·ªõng t·ªõi t√≠nh b·∫•t bi·∫øn (Immutability) v√† pure function. Ta h√£y c≈©ng t√¨m hi·ªÉu th√™m v·ªÅ ch√∫ng</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="pure-functions"></a>Pure Functions<a class="hash-link" href="#pure-functions" title="Direct link to heading">#</a></h3><p>L·∫•y v√≠ d·ª• v·ªõi vi·ªác c·ªông 2 s·ªë t·ª± nhi√™n</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> z </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">10</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:rgb(130, 170, 255)">add</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">x</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token parameter"> y</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> x </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> y</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">add</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// 3</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">add</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// 4</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>H√†m <code>add</code> nh·∫≠n 2 tham s·ªë <code>x</code> v√† <code>y</code>, n√≥ ch·ªâ s·ª≠ d·ª•ng 2 tham s·ªë ƒë·∫ßu v√†o n√†y ƒë·ªÉ th·ª±c hi·ªán ph√©p t√≠nh, m√† kh√¥ng s·ª≠ d·ª•ng/l√†m thay ƒë·ªïi c√°c bi·∫øn ngo√†i ph·∫°m vi h√†m.</p><p>H∆°n n·ªØa n√≥ lu√¥n tr·∫£ v·ªÅ c√πng 1 gi√° tr·ªã n·∫øu nh∆∞ tham s·ªë ƒë·∫ßu v√†o kh√¥ng thay ƒë·ªïi.</p><p>C√≤n xem h√†m d∆∞·ªõi ƒë√¢y</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> bonus </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:rgb(130, 170, 255)">add</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">x</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token parameter"> y</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> x </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> y </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> bonus</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">add</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// 3</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">add</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// 3</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>D√π lu√¥n tr·∫£ v·ªÅ m·ªôt gi√° tr·ªã v·ªõi c√πng tham s·ªë, tuy nhi√™n h√†m l·∫°i ph·ª• thu·ªôc v√†o bi·∫øn <code>bonus</code> (external variable) n√™n ƒë√¢y ƒë∆∞·ª£c xem l√† 1 impure function.</p><p>Ngo√†i ra impure function c≈©ng g√¢y ra c√°c side effects nh∆∞ c√°c h√†m sau:</p><ul><li>G·ªçi HTTP request</li><li>Ghi d·ªØ li·ªáu</li><li><code>Math.random()</code>, <code>new Date()</code></li><li>....</li></ul><p>Gi√° tr·ªã tr·∫£ v·ªÅ c·ªßa ch√∫ng kh√¥ng ph·∫£i l√∫c n√†o c≈©ng gi·ªëng nhau, ƒëi·ªÅu ƒë√≥ khi·∫øn k·∫øt qu·∫£ c·ªßa h√†m kh√≥ m√† l∆∞·ªùng tr∆∞·ªõc ƒë∆∞·ª£c, khi test ta th∆∞·ªùng ph·∫£i mock 1 gi√° tr·ªã c·ªë ƒë·ªãnh.</p><p>Pure function s·∫Ω gi√∫p app ch√∫ng ta √≠t l·ªói h∆°n, ngo√†i ra c≈©ng d·ªÖ d√†ng test h∆°n.</p><p>Trong React, n√≥i ƒë·∫øn pure function ta th∆∞·ªùng nghƒ© ƒë·∫øn stateless component - Functional Component, n√≥ s·∫Ω ch·ªâ s·ª≠ d·ª•ng props ƒë·ªÉ t√≠nh to√°n v√† render d·ª±a tr√™n nh·ªØng props ƒë√≥. Tuy nhi√™n nh·ªØng update g·∫ßn ƒë√¢y ƒë√£ th√™m <a href="https://reactjs.org/docs/hooks-intro.html" target="_blank" rel="noopener noreferrer">Hook</a>, n√≥ l√†m cho Functional Component c≈©ng c√≥ th·ªÉ c√≥ state. C√° nh√¢n m√¨nh kh√¥ng th√≠ch c√°i Hook n√†y l·∫Øm.</p><p>Nh∆∞ng app c·ªßa ta kh√¥ng ch·ªâ to√†n pure function ƒë∆∞·ª£c, s·∫Ω ph·∫£i c√≥ nh·ªØng h√†m g·ªçi API, thay ƒë·ªïi state, l·∫•y state ƒë·ªÉ t√≠nh to√°n, l∆∞u d·ªØ li·ªáu v√†o localStorage, ... nh∆∞ng h√£y c·ªë g·∫Øng gi·∫£m thi·ªÉu s·ªë l∆∞·ª£ng side effects xu·ªëng th·∫•p nh·∫•t c√≥ th·ªÉ.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="immutability"></a>Immutability<a class="hash-link" href="#immutability" title="Direct link to heading">#</a></h3><p>M·ªôt ƒëi·ªÅu quan tr·ªçng n·ªØa l√† t√≠nh b·∫•t bi·∫øn.</p><p>Functional programming n√≥i chung v√† React n√≥i ri√™ng, ta th∆∞·ªùng tr√°nh vi·ªác s·ª≠a tr·ª±c ti·∫øp 1 bi·∫øn n√†o ƒë√≥, hay state. Thay v√†o ƒë√≥, ta s·∫Ω t·∫°o 1 bi·∫øn m·ªõi.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> person </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  age</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">12</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">person</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">name</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Name&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">let</span><span class="token plain"> array </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">array</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">push</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">4</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>N·∫øu trong d·ª± √°n c·ªßa b·∫°n c√≥ nh·ªØng d√≤ng code nh∆∞ tr√™n, th√¨ code b·∫°n ƒë√£ m·∫•t t√≠nh b·∫•t bi·∫øn.
Thay v√¨ tr·ª±c ti·∫øp ch·ªânh s·ª≠a 1 bi·∫øn nh∆∞ v·∫≠y. Ta n√™n t·∫°o 1 bi·∫øn m·ªõi v·ªõi nh·ªØng gi√° tr·ªã c≈©, sau ƒë√≥ th√™m gi√° tr·ªã m·ªõi v√†o.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> updatedPerson </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  age</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> person</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">age</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  name</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Name&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// hay</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> updatedPerson </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token spread operator" style="color:rgb(137, 221, 255)">...</span><span class="token plain">person</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  name</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Name&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>D·ªÖ d√†ng nh·∫≠n th·∫•y <code>updatedPerson.age</code> v·∫´n tham chi·∫øu ƒë·∫øn gi√° tr·ªã c≈© c·ªßa <code>person.name</code>, tuy nhi√™n ta s·ª≠ d·ª•ng bi·∫øn <code>updatedPerson</code> n√†y th·∫ø n√†o ƒëi n·ªØa, th√¨ c≈©ng s·∫Ω kh√¥ng ·∫£nh h∆∞·ªüng ƒë·∫øn gi√° tr·ªã c·ªßa <code>person</code></p><p>Nh∆∞ng t·∫°i sao l·∫°i ph·∫£i l√†m v·∫≠y? Th·ª≠ x√©t 1 v√≤ng l·∫∑p ƒë∆°n gi·∫£n nh∆∞:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">let</span><span class="token plain"> s </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">let</span><span class="token plain"> index </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword control-flow" style="font-style:italic">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">index </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> index </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">length</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> index</span><span class="token operator" style="color:rgb(137, 221, 255)">++</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  s </span><span class="token operator" style="color:rgb(137, 221, 255)">+=</span><span class="token plain"> data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">index</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Gi·∫£ s·ª≠ ƒëang trong qu√° tr√¨nh l·∫∑p, thi <code>data[n]</code> b·ªã thay ƒë·ªïi, ch·∫≥ng ph·∫£i <code>s += data[index]</code> s·∫Ω sai lu√¥n hay sao.</p><p>C√≤n trong React, ta c√≥ <code>React.PureComponent</code> n√≥ s·∫Ω shallow compare props v√† state ƒë·ªÉ quy·∫øt ƒë·ªãnh xem c√≥ update component hay kh√¥ng.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly jsx"><div tabindex="0" class="prism-code language-jsx codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">export</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">SampleComponent</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">extends</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">React</span><span class="token class-name punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token class-name" style="color:rgb(255, 203, 107)">PureComponent</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  state </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    filter</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      name</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;A name&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      age</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">21</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//  shouldComponentUpdate(nextProps, nextState) {</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//      return shallowCompare(this, nextProps, nextState)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//    }</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function-variable function" style="color:rgb(130, 170, 255)">handleClick</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">state</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">filter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">name </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;New name&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">render</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">div</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">h3</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token keyword" style="font-style:italic">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">state</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">filter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">h3</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">button</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">onClick</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:rgb(199, 146, 234)">=</span><span class="token tag script language-javascript punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token tag script language-javascript keyword" style="color:rgb(255, 85, 114);font-style:italic">this</span><span class="token tag script language-javascript punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token tag script language-javascript" style="color:rgb(255, 85, 114)">handleClick</span><span class="token tag script language-javascript punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">Click me</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">button</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">div</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><code>React.PureComponent</code> ƒë√£ ƒë·ªãnh nghƒ©a s·∫µn cho ta ph∆∞∆°ng th·ª©c <code>shouldComponentUpdate</code> nh∆∞ ph·∫ßn m√¨nh comment.</p><p>H√†m <code>shallowCompare</code> ch·ªâ ƒë∆°n thu·∫ßn l·∫∑p t·∫•t c·∫£ c√°c key c√≥ trong props v√† state, so s√°nh v·ªõi state/props c≈©.</p><p>N√≥ s·∫Ω th·ª±c hi·ªán vi·ªác so s√°nh <code>currentState.filter === nextState.filter</code> (so s√°nh b·∫±ng tham chi·∫øu).</p><p>Vi·ªác n√†y c√≥ l·ª£i h∆°n r·∫•t nhi·ªÅu so v·ªõi vi·ªác deep compare t·∫•t c·∫£ c√°c gi√° tr·ªã trong filter (c·∫£ v·ªÅ th·ªùi gian l·∫´n ƒë·ªô ph·ª©c t·∫°p).</p><p>Tuy nhi√™n, khi ch√∫ng ta tr·ª±c ti·∫øp ch·ªânh s·ª≠a <code>this.state.filter.name = &#x27;New name&#x27;</code>, s·∫Ω khi·∫øn filter kh√¥ng h·ªÅ thay ƒë·ªïi v·ªÅ tham chi·∫øu. Khi ƒë√≥:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">currentState</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">filter</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">===</span><span class="token plain"> nextState</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">filter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// true</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">currentState</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">filter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">name</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">===</span><span class="token plain"> nextState</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">filter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// false</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>v√† <code>SampleComponent</code> c·ªßa ta c≈©ng s·∫Ω kh√¥ng re-render, cho d√π b·∫°n c√≥ click ƒë·∫øn sang nƒÉm.</p><p><img src="https://images.viblo.asia/ecee315c-f2a5-4eb6-a290-af2c100a8724.png"></p><p>Thay v√†o ƒë√≥ ta s·∫Ω l√†m nh∆∞ sau</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token function-variable function" style="color:rgb(130, 170, 255)">handleClick</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">setState</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> filter</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><span class="token spread operator" style="color:rgb(137, 221, 255)">...</span><span class="token keyword" style="font-style:italic">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">state</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">filter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> name</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;New name&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Ta copy to√†n b·ªô tham chi·∫øu c√°c attribute c·ªßa <code>state.filter</code> c≈© sang 1 object m·ªõi, v√† sau ƒë√≥ thay ƒë·ªïi bi·∫øn <code>name</code> c·ªßa object m·ªõi n√†y, ta kh√¥ng h·ªÅ l√†m thay ƒë·ªïi <code>state.filter</code> c≈©.</p><p>Khi ƒë√≥ <code>currentState.filter === nextState.filter</code> s·∫Ω tr·∫£ v·ªÅ <code>false</code>. <code>SampleComponent</code> c·ªßa ta ƒë∆∞·ª£c re-render l·∫°i. V√† n·∫øu c√≥ action n√†o kh√¥ng l√†m thay ƒë·ªïi <code>state</code>, component c·ªßa ta c≈©ng s·∫Ω kh√¥ng re-render. V·∫≠y l√† c·∫£ React v√† ta ƒë·ªÅu happy - <em>m·ªôt ng∆∞·ªùi kh·ªèe, 2 ng∆∞·ªùi vui :v</em></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="higher-order-functions-hof"></a>Higher-Order Functions (HOF)<a class="hash-link" href="#higher-order-functions-hof" title="Direct link to heading">#</a></h3><blockquote><p>HOF nh·∫≠n tham s·ªë l√† h√†m, ho·∫∑c tr·∫£ v·ªÅ m·ªôt h√†m kh√°c, ho·∫∑c l√† c·∫£ 2.</p></blockquote><p>VD 1 h√†m nh·∫≠n tham s·ªë h√†m:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> name </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;React&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> phoneNumber </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;0969696969&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:rgb(130, 170, 255)">numberValidator</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">str</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> str</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">match</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token regex regex-delimiter">/</span><span class="token regex regex-source language-regex">\d+</span><span class="token regex regex-delimiter">/</span><span class="token regex regex-flags">g</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:rgb(130, 170, 255)">validate</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">value</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token parameter"> validator</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">!</span><span class="token operator" style="color:rgb(137, 221, 255)">!</span><span class="token function" style="color:rgb(130, 170, 255)">validator</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">validate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> numberValidator</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// false</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">validate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">phoneNumber</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> numberValidator</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// false</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Hay 1 h√†m tr·∫£ v·ªÅ 1 h√†m:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">makeAdder</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">constantValue</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword control-flow" style="font-style:italic">return</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">adder</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword control-flow" style="font-style:italic">return</span><span class="token plain"> constantValue </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>ta g·ªçi h√†m n√†y nh∆∞ sau: <code>makeAdder(10)(20)</code></p><p>Tho·∫°t nh√¨n c√≥ v·∫ª s·ª£, nh∆∞ng n·∫øu vi·∫øt minh b·∫°ch ra</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> add10 </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">makeAdder</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">10</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">add10</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">20</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// 30</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>M·ªçi th·ª© tr·ªü n√™n r√µ r√†ng h∆°n nhi·ªÅu, <code>makerAdder(10)</code> tr·∫£ v·ªÅ m·ªôt h√†m, sau ƒë√≥ ta g·ªçi h√†m n√†y v·ªõi tham s·ªë l√† 20</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> add10 </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">makeAdder</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">10</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// add10 = function adder(value) {</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//   return 10 + value</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// }</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">add10</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">20</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Trong React, ta c≈©ng th∆∞·ªùng xuy√™n √°p d·ª•ng k·ªπ thu·∫≠t n√†y, tuy nhi√™n ngo√†i HOF, th√¨ ta c√≤n c√≥ Higher-Order Component (HOC), nh·∫±m ch·ªâ nh·ªØng h√†m nh·∫≠n v√†o tham s·ªë l√† 1 Component v√† tr·∫£ v·ªÅ 1 Component kh√°c.</p><p>VD:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly jsx"><div tabindex="0" class="prism-code language-jsx codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">protectRoute</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">Component</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token parameter"> requiredRole</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">ProtectedRoute</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">props</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> currentRole </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> localStorage</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">getItem</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;role&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">currentRole </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> requiredRole</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag class-name" style="color:rgb(255, 203, 107)">Redirect</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">to</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">/sign_in</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">/&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag class-name" style="color:rgb(255, 203, 107)">Component</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag spread punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token tag spread punctuation" style="color:rgb(199, 146, 234)">...</span><span class="token tag spread attr-value" style="color:rgb(255, 85, 114)">props</span><span class="token tag spread punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">/&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="declarative-programming"></a>Declarative Programming<a class="hash-link" href="#declarative-programming" title="Direct link to heading">#</a></h3><p>Ta c√≥ 2 thi√™n h∆∞·ªõng l·∫≠p tr√¨nh ƒë·ªëi l·∫≠p nhau, ƒë√≥ l√†:</p><ul><li>Imperative Programming: m√¥ t·∫£ control flow c·ªßa vi·ªác c·∫ßn l√†m</li><li>Declarative Programming: ch·ªâ vi·∫øt ra nh·ªØng g√¨ c·∫ßn l√†m m√† kh√¥ng m√¥ t·∫£ r√µ control flow c·ªßa t·ª´ng b∆∞·ªõc.</li></ul><p>VD ti√™u bi·ªÉu ƒë√≥ l√† 1 v√≤ng l·∫∑p c∆° b·∫£n:</p><p>Style Imperative:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> arr </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> newArr </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword control-flow" style="font-style:italic">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">let</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> arr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">length</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">+=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  newArr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">push</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">arr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token console class-name" style="color:rgb(255, 203, 107)">console</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">log</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">newArr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// [2, 3]</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>V·ªõi style n√†y, b·∫°n n√™u l·∫ßn l∆∞·ª£t t·ª´ng b∆∞·ªõc code b·∫°n th·ª±c hi·ªán nh∆∞ th·∫ø n√†o, ta ph·∫£i ƒëi s√¢u v√†o implementation h∆°n.</p><p>Trong khi ƒë√≥ v·ªõi Declarative:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> arr </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> newArr </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> arr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">map</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">element</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> element </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// [2, 3]</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Ta s·∫Ω ch·ªâ n√≥i r·∫±ng ta c·∫ßn 1 m·∫£ng m·ªõi t·ª´ arr, m√† m·ªói ph·∫ßn t·ª≠ c·ªßa n√≥ tƒÉng l√™n 1. Code c·ªßa ta v·ª´a d·ªÖ hi·ªÉu v√† v·ª´a ƒë·∫πp h∆°n.</p><p>M·ªôt s·ªë ng√¥n ng·ªØ ti√™u bi·ªÉu:</p><ul><li>Imperative: C/C++, Java, ...</li><li>Declarative: SQL, HTML, ...</li><li>T·∫°p ph·∫ø l√π: Javascript =)), ...</li></ul><p>·ªû tr√™n l√† nh·ªØng g√¨ m√¨nh search ƒë∆∞·ª£c tr√™n google khi b·∫Øt ƒë·∫ßu t√¨m hi·ªÉu v·ªÅ Declarative Programming. Tuy nhi√™n, v·∫´n kh√° l√† kh√≥ hi·ªÉu, v√† kh√≥ ph√¢n bi·ªát gi·ªØa 2 th·∫±ng Imperative v√† Declarative</p><p>Tuy nhi√™n khi ƒë·ªçc ƒë∆∞·ª£c comment <a href="https://stackoverflow.com/questions/1784664/what-is-the-difference-between-declarative-and-imperative-programming#comment29365241_1784702" target="_blank" rel="noopener noreferrer">n√†y</a>, m·ªçi th·ª© ƒë√£ tr·ªü n√™n s√°ng s·ªßa h∆°n nhi·ªÅu. M√¨nh coi n√≥ l√† 1 l·ªõp abstract, m√† khi g·ªçi h√†m ƒë√≥, ta ch·ªâ c·∫ßn quan t√¢m ƒë·∫øn <em>what to do</em> m√† kh√¥ng ph·∫£i nghƒ© xem <em>how to do</em>.</p><p>H√£y s·ª≠ d·ª•ng c√°c h√†m c√≥ s·∫µn c·ªßa javascript nh∆∞: <code>.map</code>, <code>.reduce</code>, <code>.filter</code>, ... v√† b·∫°n s·∫Ω nh·∫≠n th·∫•y ƒë∆∞·ª£c v·∫ª ƒë·∫πp c·ªßa Declarative Programming.</p><p>Quay tr·ªü l·∫°i v·ªõi React, v·∫≠y th√¨ t√≠nh Declarative c·ªßa n√≥ ·ªü ƒë√¢u?</p><p>Ch√≠nh b·∫£n th√¢n c√°c component React ƒë√£ r·∫•t &#x27;declarative&#x27; r·ªìi.</p><p>H√£y ƒë·ªçc ph·∫ßn description c·ªßa React tr√™n <a href="https://github.com/facebook/react" target="_blank" rel="noopener noreferrer">Github</a></p><blockquote><p>A declarative, efficient, and flexible JavaScript library for building user interfaces.</p></blockquote><p>Th·ª≠ so s√°nh 2 ƒëo·∫°n m√£ sau:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// jQuery</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">$</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;.like&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">click</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> $btn </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">$</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword control-flow" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">$btn</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">hasClass</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;liked&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    $btn</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">removeClass</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;liked&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="font-style:italic">else</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    $btn</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">addClass</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;liked&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly jsx"><div tabindex="0" class="prism-code language-jsx codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// React</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">LikeButton</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">extends</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">React</span><span class="token class-name punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token class-name" style="color:rgb(255, 203, 107)">Component</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// ...codes</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">render</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">state</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">liked</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag class-name" style="color:rgb(255, 203, 107)">HighlightButton</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">Like</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag class-name" style="color:rgb(255, 203, 107)">HighlightButton</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag class-name" style="color:rgb(255, 203, 107)">Button</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">Like</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag class-name" style="color:rgb(255, 203, 107)">Button</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>V·ªõi jQuery, ta ph·∫£i m√¥ t·∫£ ch√≠nh x√°c code ta c·∫ßn l√†m g√¨.</p><p>Trong khi ƒë√≥ v·ªõi React: <em>Ti·ªÉu nh·ªã, like r·ªìi th√¨ cho c√°i <code>HightlightButton</code> ra ƒë√¢y, kh√¥ng th√¨ <code>Button</code> th∆∞·ªùng th√¥i.</em></p><p>Ta s·∫Ω quan t√¢m ƒë·∫øn vi·ªác component c·∫ßn hi·ªÉn th·ªã c√°i g√¨ t∆∞∆°ng ·ª©ng v·ªõi m·ªói (props/state) c·ªßa n√≥.</p><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="link-tham-kh·∫£o"></a>Link tham kh·∫£o<a class="hash-link" href="#link-tham-kh·∫£o" title="Direct link to heading">#</a></h1><p><a href="https://github.com/facebook/react" target="_blank" rel="noopener noreferrer">https://github.com/facebook/react</a></p><p><a href="https://github.com/jondot/awesome-react-native" target="_blank" rel="noopener noreferrer">https://github.com/jondot/awesome-react-native</a></p><p><a href="https://github.com/gitpoint/git-point" target="_blank" rel="noopener noreferrer">https://github.com/gitpoint/git-point</a></p><p><a href="https://medium.freecodecamp.org/all-the-fundamental-react-js-concepts-jammed-into-this-single-medium-article-c83f9b53eac2?gi=7fb0830efbd4" target="_blank" rel="noopener noreferrer">https://medium.freecodecamp.org/all-the-fundamental-react-js-concepts-jammed-into-this-single-medium-article-c83f9b53eac2?gi=7fb0830efbd4</a></p><p><a href="https://medium.com/@cscalfani/so-you-want-to-be-a-functional-programmer-part-1-1f15e387e536" target="_blank" rel="noopener noreferrer">https://medium.com/@cscalfani/so-you-want-to-be-a-functional-programmer-part-1-1f15e387e536</a></p><p><a href="https://www.miles.no/blogg/tema/teknisk/why-care-about-functional-programming-part-1-immutability" target="_blank" rel="noopener noreferrer">https://www.miles.no/blogg/tema/teknisk/why-care-about-functional-programming-part-1-immutability</a></p><p><a href="https://blog.logrocket.com/immutability-in-react-ebe55253a1cc" target="_blank" rel="noopener noreferrer">https://blog.logrocket.com/immutability-in-react-ebe55253a1cc</a></p><p><a href="https://stackoverflow.com/questions/1784664/what-is-the-difference-between-declarative-and-imperative-programming#comment29365241_1784702" target="_blank" rel="noopener noreferrer">https://stackoverflow.com/questions/1784664/what-is-the-difference-between-declarative-and-imperative-programming#comment29365241_1784702</a></p></div><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog/tags/reactjs">reactjs</a><a class="margin-horiz--sm" href="/blog/tags/web">web</a><a class="margin-horiz--sm" href="/blog/tags/javascript">javascript</a></div></footer></article><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_GeHD"><a href="/blog/cung-tim-hieu-ve-nguyen-tu-cua-the-gioi-front-end-phan-2-density-independent-pixel">C√πng t√¨m hi·ªÉu v·ªÅ nguy√™n t·ª≠ c·ªßa th·∫ø gi·ªõi FrontEnd (Ph·∫ßn 2 - Density-independent Pixel)</a></h2><div class="margin-vert--md"><time datetime="2018-11-25T00:00:00.000Z" class="blogPostDate_fNvV">November 25, 2018 ¬∑ 9 min read</time></div><div class="avatar margin-vert--md"><a href="https://github.com/moonlight8978" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img src="https://avatars.githubusercontent.com/u/26299310?v=4" alt="L√™ Sƒ© B√≠ch"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/moonlight8978" target="_blank" rel="noopener noreferrer">L√™ Sƒ© B√≠ch</a></h4><small class="avatar__subtitle">Ruby on Rails/React Developer</small></div></div></header><div class="markdown"><p><a href="https://viblo.asia/p/cung-tim-hieu-ve-nguyen-tu-cua-the-gioi-front-end-phan-1-pixel-4P856PoOZY3" target="_blank" rel="noopener noreferrer">·ªû k√¨ tr∆∞·ªõc</a>, ta ƒë√£ c√πng nhau t√¨m hi·ªÉu v·ªÅ Pixel c·ªßa CSS, ƒë√≥ l√† 1 ƒë∆°n v·ªã ƒë·ªôc l·∫≠p, kh√¥ng b·ªã ph·ª• thu·ªôc v√†o ƒë·ªô ph√¢n gi·∫£i hay c√°c th√¥ng s·ªë kh√°c c·ªßa m√†n h√¨nh. ƒê·ªëi v·ªõi m·ªôt lo·∫°i m√†n h√¨nh (x√©t theo kho·∫£ng c√°ch t·ª´ m·∫Øt t·ªõi m√†n h√¨nh), n√≥ lu√¥n l√† 1 h·∫±ng s·ªë kh√¥ng ƒë·ªïi. ƒêi·ªÅu ƒë√≥ ƒë√£ gi√∫p cho l·∫≠p tr√¨nh vi√™n Web d·ªÖ th·ªü h∆°n r·∫•t nhi·ªÅu.</p><p>·ªû Android c≈©ng c√≥ m·ªôt ƒë∆°n v·ªã gi·ªëng nh∆∞ v·∫≠y, Google ƒë·∫∑t t√™n cho n√≥ l√† DP (hay DIP - Density Independent Pixel). Ngo√†i ra ƒë∆°n v·ªã n√†y c√≤n d√πng trong React Native <a href="https://facebook.github.io/react-native/docs/height-and-width.html#fixed-dimensions" target="_blank" rel="noopener noreferrer">[link]</a></p><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="2-m·ªôt-s·ªë-kh√°i-ni·ªám-c·∫ßn-nh·∫Øc-l·∫°i"></a>2. M·ªôt s·ªë kh√°i ni·ªám c·∫ßn nh·∫Øc l·∫°i<a class="hash-link" href="#2-m·ªôt-s·ªë-kh√°i-ni·ªám-c·∫ßn-nh·∫Øc-l·∫°i" title="Direct link to heading">#</a></h1><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="pixel-thi·∫øt-b·ªã"></a>Pixel thi·∫øt b·ªã:<a class="hash-link" href="#pixel-thi·∫øt-b·ªã" title="Direct link to heading">#</a></h4><p>L√† 1 ƒëi·ªÉm ·∫£nh, n√≥ ph·ª• thu·ªôc v√†o k√≠ch th∆∞·ªõc m√†n h√¨nh, v√† ƒë·ªô ph√¢n gi·∫£i m√†n h√¨nh. Th√¥ng th∆∞·ªùng, 1px thi·∫øt b·ªã tr√™n c√°c m√†n h√¨nh ƒë·ªÅu c√≥ gi√° tr·ªã kh√°c nhau.</p><p>Pixel n√†y l√† pixel v·∫≠t l√Ω c·ªßa thi·∫øt b·ªã kh√°c ho√†n to√†n so v·ªõi ƒë∆°n v·ªã px m√† ta hay s·ª≠ d·ª•ng trong CSS.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="ƒë·ªô-ph√¢n-gi·∫£i-thi·∫øt-b·ªã---resolution"></a>ƒê·ªô ph√¢n gi·∫£i thi·∫øt b·ªã - Resolution:<a class="hash-link" href="#ƒë·ªô-ph√¢n-gi·∫£i-thi·∫øt-b·ªã---resolution" title="Direct link to heading">#</a></h4><p>C√°c b·∫°n th∆∞·ªùng th·∫•y m√†n h√¨nh c√≥ ƒë·ªô ph√¢n gi·∫£i 4k, HD, FullHD, k√®m theo n√≥ l√† 2 con s·ªë c√≥ d·∫°ng P1xP2 ph·∫£i kh√¥ng n√†o?</p><p>Nh·ªØng con s·ªë n√†y th·ªÉ hi·ªán s·ªë pixel c√≥ tr√™n m√†n h√¨nh, P1 l√† s·ªë pixel ph√¢n b·ªë theo chi·ªÅu d√†i, c√≤n P2 l√† theo chi·ªÅu r·ªông.</p><p><img src="https://images.viblo.asia/d4b0da95-f9d9-44ff-92e9-71931821321a.jpg"></p><p>(<em>·∫£nh ch·ªâ mang t√≠nh ch·∫•t minh h·ªça, m√¨nh k ph·∫£i seeder ƒë√¢u nh√° =))</em>)</p><p>TV tr√™n c√≥ chi·ªÅu d√†i 52.4 inch, c√≥ 3840px theo chi·ªÅu ngang. 1px s·∫Ω c√≥ gi√° tr·ªã</p><p><code>1px = 52.4 / 3840 = 0.01365 (inch)</code></p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="dpi-ppi"></a>DPI, PPI:<a class="hash-link" href="#dpi-ppi" title="Direct link to heading">#</a></h4><p>DPI - <strong>Dots Per Inch</strong>. PPI - <strong>Points Per Inch</strong></p><p>Ch√∫ng ƒë·ªÅu l√† s·ªë pixel/ƒëi·ªÉm ·∫£nh c√≥ tr√™n 1 inch ƒë·ªô d√†i v·∫≠t l√Ω c·ªßa thi·∫øt b·ªã, bi·ªÉu th·ªã m·∫≠t ƒë·ªô pixel tr√™n m√†n h√¨nh.</p><p>DPI th·∫•p, 1px c√≥ k√≠ch th∆∞·ªõc l·ªõn, h√¨nh ·∫£nh c√≥ th·ªÉ s·∫Ω b·ªã rƒÉng c∆∞a, kh√¥ng s·∫Øc n√©t b·∫±ng DPI cao</p><p><img src="https://images.viblo.asia/1e74f9f2-8d4e-407c-9023-9f4d248598cf.jpg"></p><p>L·∫•y l·∫°i VD m√†n h√¨nh TV tr√™n:</p><p><code>DPI = 3840 / 52.4 = 73.28 (pixels/inch)</code></p><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="3-density-independent-pixels"></a>3. Density Independent Pixels<a class="hash-link" href="#3-density-independent-pixels" title="Direct link to heading">#</a></h1><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="31-ƒë·∫∑t-v·∫•n-ƒë·ªÅ"></a>3.1 ƒê·∫∑t v·∫•n ƒë·ªÅ<a class="hash-link" href="#31-ƒë·∫∑t-v·∫•n-ƒë·ªÅ" title="Direct link to heading">#</a></h3><p>C√°c ƒëi·ªán tho·∫°i Android c√≥ nhi·ªÅu lo·∫°i k√≠ch th∆∞·ªõc (phone, tablet, TV, ...), h∆°n n·ªØa ch√∫ng l·∫°i c√≤n c√≥ ƒë·ªô ph√¢n gi·∫£i kh√°c nhau, d·∫´n ƒë·∫øn k√≠ch th∆∞·ªõc pixel lu√¥n thay ƒë·ªïi, g√¢y kh√≥ khƒÉn cho nh√† ph√°t tri·ªÉn khi d·ª±ng giao di·ªán.</p><p>L·∫•y v√≠ d·ª• ƒë∆°n gi·∫£n nh·∫•t v·ªÅ 2 ƒëi·ªán tho·∫°i c√≥ c√πng k√≠ch th∆∞·ªõc ƒë∆∞·ªùng ch√©o 5inch, nh∆∞ng 1 chi·∫øc FullHD 1080x1920, 1 chi·∫øc 4K 2160 x 3840.</p><p>N·∫øu b·∫°n l√† dev, b·∫°n s·∫Ω mu·ªën 1 button trong app c·ªßa m√¨nh hi·ªÉn th·ªã tr√™n 2 ƒëi·ªán tho·∫°i n√†y gi·ªëng nhau ph·∫£i kh√¥ng n√†o?</p><p>Th·∫ø nh∆∞ng n·∫øu l√†m vi·ªác v·ªõi px thi·∫øt b·ªã, ta s·∫Ω g·∫∑p 1 ch√∫t r·∫Øc r·ªëi v√¨ v·ªõi c√πng 1 k√≠ch th∆∞·ªõc, ƒëi·ªán tho·∫°i 4K lu√¥n c·∫ßn g·∫•p ƒë√¥i s·ªë px so v·ªõi FullHD.</p><p><img src="https://images.viblo.asia/4b56fc09-40ee-4f95-b7fc-8409b2961e99.jpg"></p><p>2 c√°i ƒë√£ m·ªát, tr√™n th·ª±c t·∫ø, ta c√≥ ty t·ª∑ lo·∫°i m√†n h√¨nh, v·∫≠y th√¨ style sao cho xu·ªÉ, ch∆∞a k·ªÉ c√≤n ƒë·∫øn t·ªëi ∆∞u c√°c file ·∫£nh cho app.</p><p>Ch√≠nh v√¨ v·∫≠y, <code>dp</code> ra ƒë·ªùi.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="32-dp"></a>3.2. DP<a class="hash-link" href="#32-dp" title="Direct link to heading">#</a></h3><p>Google ƒë·ªãnh nghƒ©a n√≥ nh∆∞ sau:</p><blockquote><p>One dp is a virtual pixel unit that&#x27;s roughly equal to one pixel on a medium-density screen (160dpi; the &quot;baseline&quot; density). Android translates this value to the appropriate number of real pixels for each other density.</p></blockquote><p>N·∫øu b·∫°n ƒë√£ ƒë·ªçc b√†i tr∆∞·ªõc c·ªßa m√¨nh v·ªÅ CSS pixel, th√¨ c√≥ th·ªÉ th·∫•y n√≥ kh√° quen thu·ªôc ph·∫£i kh√¥ng n√†o, ƒë√¢y c≈©ng l√† 1 <em>virtual unit</em>.</p><p><strong>1dp t∆∞∆°ng ƒë∆∞∆°ng 1 px tr√™n m√†n h√¨nh 160dpi</strong>. C√≥ nghƒ©a l√† <code>1dp = 1 / 160 = 0.00625 (inch) = 1px (160dpi)</code></p><p>ƒê·ªÉ quy ƒë·ªïi <code>dp</code> sang <code>px</code> tr√™n c√°c lo·∫°i m√†n h√¨nh kh√°c, ta nh√¢n dp v·ªõi 1 s·ªë, g·ªçi l√† scale factor (t·ªâ l·ªá DPI c·ªßa m√†n h√¨nh so v·ªõi chu·∫©n 160dpi).</p><p>V√≠ d·ª• m√°y 320dpi. <code>1dp = 1 * 320 / 160 = 2px</code></p><p>Android s·∫Ω t·ª± ƒë·ªông convert sang pixel thi·∫øt b·ªã cho ta, n√™n ta ch·ªâ c·∫ßn d√πng <code>dp</code> l√† tr√™n m·ªçi thi·∫øt b·ªã, ph·∫ßn t·ª≠ c·ªßa ta s·∫Ω ƒë·ªÅu c√≥ k√≠ch th∆∞·ªõc b·∫±ng nhau (ngo·∫°i l·ªá s·∫Ω ƒë·ªÅ c·∫≠p sau).</p><p>Khi ta d·ª±ng UI, n√™n t·∫≠n d·ª•ng t·ªëi ƒëa <code>dp</code>, tr√°nh s·ª≠ d·ª•ng <code>px</code>.</p><p>B√™n c·∫°nh ƒë√≥, Google c≈©ng khuy√™n ta kh√¥ng n√™n s·ª≠ d·ª•ng <code>dp</code> cho text, m√† h√£y d√πng <code>sp</code>. ƒê√¢y c≈©ng l√† m·ªôt lo·∫°i density-independent, nh∆∞ng n√≥ c√≥ th·ªÉ b·ªã ·∫£nh h∆∞·ªüng b·ªüi t√πy ch·ªçn c·ªßa ng∆∞·ªùi d√πng. Ng∆∞·ªùi d√πng ch·ªçn c·ª° ch·ªØ to, th√¨ 1sp c≈©ng l·ªõn l√™n theo. V√¨ v·∫≠y, c≈©ng tr√°nh d√πng <code>sp</code> khi thi·∫øt k·∫ø layout.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="33-density-bucket"></a>3.3 Density Bucket<a class="hash-link" href="#33-density-bucket" title="Direct link to heading">#</a></h3><p><code>dp</code> ra ƒë·ªùi, nh∆∞ng c≈©ng ch∆∞a gi·∫£i quy·∫øt ƒë∆∞·ª£c h·∫øt c√°c v·∫•n ƒë·ªÅ. ƒê√≥ ch√≠nh l√† v·ªÅ resource h√¨nh ·∫£nh. Style cho ·∫£nh th√¨ c√≥ th·ªÉ s·ª≠ d·ª•ng dp ƒë∆∞·ª£c (·∫£nh s·∫Ω b·ªã k√©o to, ho·∫∑c co l·∫°i cho ƒë·ªß size c·∫ßn thi·∫øt), nh∆∞ng resource th√¨ ƒë√¢u c√≥ th·ªÉ to nh·ªè t√πy √Ω ƒë∆∞·ª£c, th√¥ng s·ªë c·ªßa n√≥ lu√¥n l√† c·ªë ƒë·ªãnh.</p><p>L·∫•y v√≠ d·ª• v·ªÅ 1 h√¨nh ·∫£nh 500x500px (resolution), v·ªõi 2 m√†n h√¨nh c√≥ k√≠ch th∆∞·ªõc b·∫±ng nhau, nh∆∞ng kh√°c ƒë·ªô ph√¢n gi·∫£i (kh√°c DPI), 1 chi·∫øc l√† 360x640, 1 chi·∫øc l√† 720x1280.</p><p>H√¨nh ·∫£nh tr√™n n·∫øu hi·ªÉn th·ªã tr√™n m√†n h√¨nh 360x640 th√¨ ch·∫≥ng ph·∫£i s·∫Ω d∆∞ th·ª´a sao? V√¨ chi·ªÅu r·ªông m√†n h√¨nh ch·ªâ c√≥ 360px. C√≤n tr√™n m√†n h√¨nh 720x1280, th√¨ n√≥ ch·∫£ ƒë√°ng l√† bao. V√¨ v·∫≠y ta c·∫ßn s·ª≠ d·ª•ng h√¨nh ·∫£nh c√≥ ƒë·ªô ph√¢n gi·∫£i th·∫•p h∆°n cho m√†n h√¨nh 360x640.</p><p>Nh∆∞ng kh√¥ng l·∫Ω c·ª© m·ªói ƒë·ªô ph√¢n gi·∫£i l·∫°i t·∫°o 1 h√¨nh ·∫£nh t∆∞∆°ng ·ª©ng? V·∫≠y th√¨ app size c·ªßa ta s·∫Ω b√πng n·ªï lu√¥n.</p><p>V√¨ l·∫Ω ƒë√≥ m√† ra ƒë·ªùi <code>density bucket</code>.</p><p>ƒê·ªÉ cho ƒë∆°n gi·∫£n, c√°c lo·∫°i m√†n h√¨nh c√≥ DPI g·∫ßn b·∫±ng nhau s·∫Ω ƒë∆∞·ª£c l√†m tr√≤n r·ªìi gom v√†o 1 nh√≥m. V√≠ d·ª• nh∆∞ m√°y 293dpi, Android s·∫Ω coi nh∆∞ m√°y ƒë√≥ l√† 320dpi, khi ƒë√≥ 1dp = 2px. C√≤n nhi·ªÅu lo·∫°i kh√°c n·ªØa, nh∆∞ng m√¨nh ch·ªâ n√™u ra 4 bucket ƒë√°ng ch√∫ √Ω, best practice l√† support c·∫£ 4 bucket n√†y.</p><table><thead><tr><th>Bucket name</th><th>Density bucket</th><th>DPI</th><th>Scale Factor</th></tr></thead><tbody><tr><td>Medium</td><td>mdpi</td><td>160</td><td>1.00</td></tr><tr><td>High</td><td>hdpi</td><td>240</td><td>1.50</td></tr><tr><td>Extra High</td><td>xhdpi</td><td>320</td><td>2.00</td></tr><tr><td>Extra Extra High</td><td>xxhdpi</td><td>480</td><td>3.00</td></tr></tbody></table><p>Nh·ªØng g√¨ b·∫°n c·∫ßn l√†m l√† n√©m h·∫øt h√¨nh ·∫£nh c·ªßa c√°c bucket v√†o th∆∞ m·ª•c t∆∞∆°ng ·ª©ng. Android s·∫Ω t·ª± detect v√† ch·ªçn h√¨nh ·∫£nh t·ªëi ∆∞u nh·∫•t cho b·∫°n (l·∫•y t·ª´ DPI cao nh·∫•t v·ªÅ).</p><p><img src="https://images.viblo.asia/653192f1-8c27-469d-a007-1ac22681ea23.png"></p><p><img src="https://images.viblo.asia/d606e411-f5cc-4151-b13e-4b2dfd626097.png"></p><p>C≈©ng v√¨ vi·ªác l√†m tr√≤n DPI n√†y, m√† 1dp c·ªßa ta tr√™n c√°c thi·∫øt b·ªã c√≥ th·ªÉ kh√¥ng b·∫±ng nhau, nh∆∞ng <strong>lu√¥n x·∫•p x·ªâ 1/160 = 0.00625 inch</strong></p><table><thead><tr><th>Density</th><th>Bucket</th><th>Scale factor</th><th>Physical Size (inch)</th></tr></thead><tbody><tr><td>293dpi</td><td>xhdpi - 320dpi</td><td>2</td><td>1 * 2 / 293 = 0.00686</td></tr><tr><td>320dpi</td><td>xhdpi</td><td>2</td><td>1 * 2 / 320 = 0.00625</td></tr><tr><td>330 dpi</td><td>xhdpi</td><td>2</td><td>1 * 2 / 330 = 0.00606</td></tr></tbody></table><p>ƒêi·ªÅu n√†y c≈©ng ƒëem ƒë·∫øn cho ta 1 l·ª£i √≠ch, ƒë√≥ l√† v·ªõi c√°c s·ªë m√°y density kh√°c nhau, nh∆∞ng c√πng ƒë·ªô ph√¢n gi·∫£i, k√≠ch th∆∞·ªõc b·ªÅ ngang c·ªßa ta t√≠nh b·∫±ng dp ƒë·ªÅu b·∫±ng nhau. L·∫•y v√≠ d·ª• 3 m√°y 720x1280, 1 m√°y 293 dpi, 1 m√°y 320 dpi, 1 m√°y 330 dpi.</p><table><thead><tr><th>Density</th><th>Width (without Density Bucket)</th><th>Width (with density bucket)</th></tr></thead><tbody><tr><td>293dpi</td><td>720 / (293 / 160) = 393dp</td><td>360dp</td></tr><tr><td>320dpi</td><td>720 / (320 / 160) = 360dp</td><td>360dp</td></tr><tr><td>330dpi</td><td>720 / (330 / 160) = 349dp</td><td>360dp</td></tr></tbody></table><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="4-v√≠-d·ª•"></a>4. V√≠ d·ª•<a class="hash-link" href="#4-v√≠-d·ª•" title="Direct link to heading">#</a></h1><p>Sau khi nh·ªìi 1 ƒë·ªëng l√Ω thuy·∫øt v√†o ƒë·∫ßu, ta h√£y th·ª≠ l√†m 1 b√†i t·∫≠p nho nh·ªè, ƒë·ªÉ √°p d·ª•ng ch√∫ng. H√£y th·ª≠ t·ª± t√≠nh to√°n th√¥ng s·ªë cho ƒëi·ªán tho·∫°i c·ªßa m√¨nh xem.</p><p>ƒêi·ªán tho·∫°i m√¨nh 5inch, ƒë·ªô ph√¢n gi·∫£i 720x1280.</p><p>Ta d·ªÖ d√†ng t√≠nh to√°n ƒë∆∞·ª£c chi·ªÅu d√†i v√† chi·ªÅu r·ªông c·ªßa m√°y, d·ª±a v√†o ƒë·ªãnh l√Ω Pytago:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly tx"><div tabindex="0" class="prism-code language-tx codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">5**2 = (1280 * x)**2 + (720 * x)**2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">width = 720 * x = 2.4513 (inch)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">height = 1280 * x = 4.3579 (inch)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>T·ª´ ƒë√≥ ta c√≥ th·ªÉ t√≠nh t·∫•t c·∫£ c√°c th√¥ng s·ªë kh√°c:</p><table><thead><tr><th>Th√¥ng s·ªë</th><th>Gi√° tr·ªã</th></tr></thead><tbody><tr><td>Device density</td><td>720 / 2.4513 = 294 dpi</td></tr><tr><td>Density bucket</td><td>xhdpi - 320dpi</td></tr><tr><td>Scale factor</td><td>320 / 160 = 2.00</td></tr><tr><td>Width</td><td>720 / 2 = 360dp</td></tr><tr><td>Height</td><td>1280 / 2 = 640dp</td></tr><tr><td>DIP</td><td>1dp = 2px = 0.0068 (inch)</td></tr></tbody></table><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="5-k·∫øt-lu·∫≠n"></a>5. K·∫øt lu·∫≠n<a class="hash-link" href="#5-k·∫øt-lu·∫≠n" title="Direct link to heading">#</a></h1><p>S·ª± ra ƒë·ªùi c·ªßa <code>dp</code> v√† <code>density bucket</code> qu·∫£ th·ª±c ƒë√£ gi√∫p ta tr√°nh ƒë∆∞·ª£c kh√¥ng √≠t r·∫Øc r·ªëi trong khi ph√°t tri·ªÉn ·ª©ng d·ª•ng Android, t·ªëi ∆∞u h√¨nh ·∫£nh cho app. B√†i vi·∫øt kh√¥ng tr√°nh kh·ªèi sai s√≥t, n·∫øu c√≥ s·∫°n, h√£y c·ª© g√≥p √Ω, m√¨nh s·∫Ω ti·∫øp thu v√† ch·ªânh s·ª≠a cho ph√π h·ª£p.</p><p>ƒê√¢y c√≥ l·∫Ω l√† b√†i cu·ªëi c·ªßa m√¨nh trong series v·ªÅ nh·ªØng th·ª© b√© nh·ªè m√† √≠t ai ƒë·ªÉ √Ω trong khi thi·∫øt k·∫ø giao di·ªán Web, mobile. C√°m ∆°n m·ªçi ng∆∞·ªùi ƒë√£ ƒë·ªçc b√†i! - n·∫øu c√°c b·∫°n ƒë·ªçc ƒë·∫øn t·∫≠n d√≤ng n√†y =))</p><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="6-link-tham-kh·∫£o"></a>6. Link tham kh·∫£o<a class="hash-link" href="#6-link-tham-kh·∫£o" title="Direct link to heading">#</a></h1><ol><li><a href="https://developer.android.com/training/multiscreen/screendensities" target="_blank" rel="noopener noreferrer">https://developer.android.com/training/multiscreen/screendensities</a></li><li><a href="https://www.highgroundgaming.com/tas/gaming-mouse-guide/low-vs-high-dpi-example/" target="_blank" rel="noopener noreferrer">https://www.highgroundgaming.com/tas/gaming-mouse-guide/low-vs-high-dpi-example/</a></li><li><a href="https://facebook.github.io/react-native/docs/height-and-width.html#fixed-dimensions" target="_blank" rel="noopener noreferrer">https://facebook.github.io/react-native/docs/height-and-width.html#fixed-dimensions</a></li><li><a href="https://www.avconcepts.com/2015/09/24/4k-ultra-hd-vs-hd-projection/" target="_blank" rel="noopener noreferrer">https://www.avconcepts.com/2015/09/24/4k-ultra-hd-vs-hd-projection/</a></li><li><a href="https://www.captechconsulting.com/blogs/understanding-density-independence-in-android" target="_blank" rel="noopener noreferrer">https://www.captechconsulting.com/blogs/understanding-density-independence-in-android</a></li><li><a href="https://medium.com/@sashaserg/a-mysterious-density-independent-pixel-a-quick-introduction-to-android-design-111d68be7cf5" target="_blank" rel="noopener noreferrer">https://medium.com/@sashaserg/a-mysterious-density-independent-pixel-a-quick-introduction-to-android-design-111d68be7cf5</a></li></ol></div><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog/tags/frontend">frontend</a><a class="margin-horiz--sm" href="/blog/tags/android">android</a></div></footer></article><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_GeHD"><a href="/blog/cung-tim-hieu-ve-nguyen-tu-cua-the-gioi-front-end-phan-1-pixel">C√πng t√¨m hi·ªÉu v·ªÅ nguy√™n t·ª≠ c·ªßa th·∫ø gi·ªõi FrontEnd (Ph·∫ßn 1 - Pixel)</a></h2><div class="margin-vert--md"><time datetime="2018-10-27T00:00:00.000Z" class="blogPostDate_fNvV">October 27, 2018 ¬∑ 7 min read</time></div><div class="avatar margin-vert--md"><a href="https://github.com/moonlight8978" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img src="https://avatars.githubusercontent.com/u/26299310?v=4" alt="L√™ Sƒ© B√≠ch"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/moonlight8978" target="_blank" rel="noopener noreferrer">L√™ Sƒ© B√≠ch</a></h4><small class="avatar__subtitle">Ruby on Rails/React Developer</small></div></div></header><div class="markdown"><p><img src="https://images.viblo.asia/356f907a-e15f-4de7-a14c-e60c6553537b.png"></p><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="1-m·ªü-ƒë·∫ßu"></a>1. M·ªü ƒë·∫ßu<a class="hash-link" href="#1-m·ªü-ƒë·∫ßu" title="Direct link to heading">#</a></h1><p>N·∫øu l√† m·ªôt nh√† ph√°t tri·ªÉn ·ª©ng d·ª•ng Web hay Android, th√¨ ch·∫Øc h·∫≥n b·∫°n ƒë√£ d√πng c√°c ƒë∆°n v·ªã ƒë·ªô d√†i nh∆∞ <code>px</code>, <code>dp</code> ƒë·ªÉ t·∫°o style cho c√°c ph·∫ßn t·ª≠ tr√™n giao di·ªán.</p><p>C√≥ l·∫Ω nhi·ªÅu ng∆∞·ªùi s·∫Ω nghƒ© r·∫±ng: M√†n h√¨nh m√¨nh FullHD, ƒë·ªô ph√¢n gi·∫£i 1920x1080, th√¨ c·ª© 1920px m√† v√£ v√†o css th√¥i, nghƒ© ng·ª£i l√†m g√¨ nhi·ªÅu. Nh∆∞ng li·ªáu c√≥ th·∫≠t l√† nh∆∞ v·∫≠y kh√¥ng? Ch√∫ng ta h√£y c√πng t√¨m hi·ªÉu</p><p>TL;DR</p><blockquote><p>1px = 1/96 inch</p><p>1dp = 1/160 inch</p></blockquote><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="2-pixel---nguy√™n-t·ª≠-c·ªßa-th·∫ø-gi·ªõi-web"></a>2. Pixel - nguy√™n t·ª≠ c·ªßa th·∫ø gi·ªõi Web<a class="hash-link" href="#2-pixel---nguy√™n-t·ª≠-c·ªßa-th·∫ø-gi·ªõi-web" title="Direct link to heading">#</a></h1><p><strong>L∆∞u √Ω:</strong>
Tr∆∞·ªõc ti√™n, ta c·∫ßn ph·∫£i l√†m r√µ 1 ƒëi·ªÅu: 1px c·ªßa CSS kh√°c v·ªõi 1px c·ªßa thi·∫øt b·ªã (ƒë·ªô ph√¢n gi·∫£i). 1px CSS c√≥ th·ªÉ t∆∞∆°ng ·ª©ng v·ªõi 1 ho·∫∑c nhi·ªÅu px c·ªßa thi·∫øt b·ªã.</p><p>C√≥ r·∫•t nhi·ªÅu lo·∫°i m√†n h√¨nh, ƒë·ªô ph√¢n gi·∫£i, k√≠ch th∆∞·ªõc kh√°c nhau. N√≥ l√†m kh√≥ l·∫≠p tr√¨nh vi√™n trong vi·ªác d·ª±ng giao di·ªán, ƒë∆∞·ª£c m√†n h√¨nh n√†y th√¨ l·∫°i h·ªèng m√†n h√¨nh kia. V√¨ v·∫≠y w3 ƒë√£ quy ∆∞·ªõc 1 ƒë∆°n v·ªã chu·∫©n, d√πng cho m·ªçi thi·∫øt b·ªã: <strong>px</strong>.</p><p>ƒê·ªãnh nghƒ©a tr√™n <a href="https://www.w3.org/TR/css-values-4/#px" target="_blank" rel="noopener noreferrer">w3</a></p><blockquote><p>1px = 1/96th of 1in</p></blockquote><p>Tuy nhi√™n, khi nh√¨n xu·ªëng d∆∞·ªõi m·ªôt ch√∫t, ta c√≥ th·ªÉ th·∫•y th√™m</p><blockquote><p>For a CSS device, these dimensions are anchored either:</p><p>‚Äã i. by relating the physical units to their physical measurements, or</p><p>‚Äã ii. by relating the pixel unit to the reference pixel.</p></blockquote><p>Nh√¨n s∆° qua th√¨ kh√° l√† kh√≥ hi·ªÉu, nh∆∞ng ta c√≥ th·ªÉ h√¨nh dung ƒë∆∞·ª£c 1 ƒëi·ªÅu, pixel c√≥ th·ªÉ ƒë∆∞·ª£c t√≠nh to√°n theo 2 c√°ch.</p><h6><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="21-by-relating-the-physical-units-to-their-physical-measurements"></a>2.1 By relating the physical units to their physical measurements<a class="hash-link" href="#21-by-relating-the-physical-units-to-their-physical-measurements" title="Direct link to heading">#</a></h6><p>√ù ƒë·∫ßu l√† d√†nh cho c√°c thi·∫øt b·ªã ƒë√≤i h·ªèi ƒë·ªô ch√≠nh x√°c cao v·ªÅ ƒë·ªô d√†i, v√≠ d·ª• nh∆∞ m√°y in. Ta ph·∫£i s·ª≠ d·ª•ng c√°c ƒë∆°n v·ªã <code>inch</code>, <code>cm</code>, ... ƒë√∫ng nh∆∞ ƒë·ªô d√†i th·ª±c t·∫ø c·ªßa ch√∫ng. Khi ƒë√≥, <code>1px</code> s·∫Ω t∆∞∆°ng ƒë∆∞∆°ng <strong>0.267mm</strong> (25.6/96). Ta s·∫Ω kh√¥ng ƒë·ªÅ c·∫≠p ƒë·∫øn nh·ªØng lo·∫°i thi·∫øt b·ªã n√†y trong b√†i.</p><h6><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="22-by-relating-the-pixel-unit-to-the-reference-pixel"></a>2.2 By relating the pixel unit to the reference pixel<a class="hash-link" href="#22-by-relating-the-pixel-unit-to-the-reference-pixel" title="Direct link to heading">#</a></h6><p>ƒê·ªëi v·ªõi c√°c thi·∫øt b·ªã tr√¨nh chi·∫øu (b·∫•t k·ªÉ ƒë·ªô ph√¢n gi·∫£i, m√†n h√¨nh Retina hay th·ª© g√¨ th·∫ßn th√°nh kh√°c), c√°c thi·∫øt b·ªã m√† c√≥ kho·∫£ng c√°ch nh√¨n b·∫•t th∆∞·ªùng, <strong>px</strong> s·∫Ω l√† ƒë∆°n v·ªã ƒë·ªÉ t√≠nh ra <code>inch</code>, <code>cm</code>, ...</p><p>V√† w3 khuy√™n r·∫±ng, n√™n s·ª≠ d·ª•ng <strong>reference pixel</strong> ƒë·ªÉ t√≠nh ra t·ªâ l·ªá quy ƒë·ªïi 1px CSS n√†y v·ªõi s·ªë pixel thi·∫øt b·ªã (m√†n h√¨nh 4096‚Äâ√ó‚Äâ2160 c√≥ th·ªÉ s·∫Ω kh√¥ng c√≤n l√† 4096px trong CSS n·ªØa). Hay n√≥i c√°ch kh√°c l√† t√≠nh xem 1px CSS b·∫±ng bao nhi√™u.</p><p>L·∫°i m·ªôt ƒë∆°n v·ªã h·∫°i n√£o n·ªØa, v√† w3 ƒë·ªãnh nghƒ©a n√≥ nh∆∞ sau:</p><blockquote><p>The reference pixel is the visual angle of one pixel on a device with a pixel density of 96dpi and a distance from the reader of an arm‚Äôs length. For a nominal arm‚Äôs length of 28 inches, the visual angle is therefore about 0.0213 degrees. For reading at arm‚Äôs length, 1px thus corresponds to about 0.26 mm (1/96 inch).</p></blockquote><p>Nh∆∞ v·∫≠y, <code>reference pixel</code> l√† m·ªôt <strong>visual angle</strong> c·ªßa <strong>1px</strong> tr√™n m√†n h√¨nh <strong>96dpi</strong>. Kho·∫£ng c√°ch nh√¨n l√† 1 s·∫£i tay (kho·∫£ng 28in ƒë·ªëi v·ªõi ng∆∞·ªùi b√¨nh th∆∞·ªùng) - ƒë√¢y l√† kho·∫£ng c√°ch ng·ªìi PC th√¥ng th∆∞·ªùng.</p><p>T·ª´ kh√°i ni·ªám n√†y l·∫°i ƒë·∫ª ra kh√°i ni·ªám kh√°c :v Ta h√£y b·∫Øt ƒë·∫ßu v·ªõi DPI</p><p><strong>DPI</strong> (Dots Per Inch): t∆∞∆°ng ƒë∆∞∆°ng v·ªõi PPI (Pixels Per Inch), n√≥ cho ta bi·∫øt 1inch m√†n h√¨nh thi·∫øt b·ªã c√≥ bao nhi√™u pixel thi·∫øt b·ªã. 96dpi nghƒ©a l√† 1inch c√≥ 96 pixel. Nh∆∞ v·∫≠y 1px c·ªßa m√†n h√¨nh 96dpi s·∫Ω l√† 2.56 / 96 ~ <strong>0.26mm</strong></p><p>DPI c√†ng l·ªõn, m√†n h√¨nh hi·ªÉn th·ªã c√†ng chi ti·∫øt. DPI ƒë∆∞·ª£c t√≠nh d·ª±a tr√™n k√≠ch th∆∞·ªõc thi·∫øt b·ªã v√† ƒë·ªô ph√¢n gi·∫£i c·ªßa thi·∫øt b·ªã.</p><p>VD m√†n h√¨nh c√¥ng ty m√¨nh d√πng l√† Dell P2319H, 23in (58,42cm), ƒë·ªô ph√¢n gi·∫£i 1920x1080</p><p><img src="https://images.viblo.asia/c5529984-c033-4c36-abb1-9dd73be39f03.jpg"></p><p>√Åp d·ª•ng Pytago: ta c√≥</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(1920x)^2 + (1080x)^2 = 58.42^2 (cm^2)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>T√≠nh nhanh, ta ƒë∆∞·ª£c x = 0.0265cm. Nh∆∞ v·∫≠y, m√°y m√¨nh c√≥ chi·ªÅu r·ªông l√† 1920x = 19.89in, v√† DPI = 1920 / 19.89 = 96.53</p><p><strong>Visual angle</strong> l√† g√≥c v ƒë∆∞·ª£c bi·ªÉu th·ªã d∆∞·ªõi h√¨nh sau:</p><p><img src="https://images.viblo.asia/835cce17-7a60-43d8-adc0-ead0a1d00de8.jpg"></p><p>√Åp d·ª•ng v√†o, b·∫•m m√°y t√≠nh:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">v = 2 x arctan((2.56/96) / (2x28x2.56)) =&gt; 0.0213 (ƒë·ªô)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>V·ªõi reference pixel l√† <strong>0.0213 ƒë·ªô</strong>, kho·∫£ng c√°ch nh√¨n <strong>28in</strong>, 1px CSS lu√¥n c√≥ gi√° tr·ªã l√† <strong>0.26mm</strong>. V√¨ v·∫≠y gi·ªØa 2 m√†n h√¨nh PC c√πng k√≠ch th∆∞·ªõc, nh∆∞ng c√≥ ƒë·ªô ph√¢n gi·∫£i kh√°c nhau (v√≠ d·ª• 1 c√°i FullHD, 1 c√°i 4K), 1 element c√≥ width 10px s·∫Ω lu√¥n c√≥ k√≠ch th∆∞·ªõc v·∫≠t l√Ω b·∫±ng nhau (2.6mm).</p><p><img src="https://images.viblo.asia/4f52ddec-b90b-42f3-9556-b3cf12e6f4d8.png"></p><p>V·ªõi m√†n h√¨nh FullHD, 1px CSS s·∫Ω ·ª©ng v·ªõi 1px c·ªßa thi·∫øt b·ªã, c√≤n v·ªõi m√†n Retina cƒÉng ƒë√©t, 1px CSS ·ª©ng v·ªõi 2px thi·∫øt b·ªã, nh∆∞ng k√≠ch th∆∞·ªõc th·∫≠t c·ªßa ch√∫ng ƒë·ªÅu l√† 0.26mm.</p><p>Kho·∫£ng c√°ch t·ªõi m√†n h√¨nh c√†ng cao, ƒë·ªô l·ªõn c·ªßa 1px c√†ng tƒÉng l√™n. ·ªû kho·∫£ng c√°ch 3.5m, 1px c√≥ gi√° tr·ªã l√™n t·ªõi 1.3mm, v√† 1in l√∫c n√†y kho·∫£ng 124.8mm (g·∫•p g·∫ßn 5 l·∫ßn gi√° tr·ªã th·ª±c).</p><p><img src="https://images.viblo.asia/a666ffa1-d5ba-4e25-9f16-4231d6f0a08a.png"></p><p>Loanh quanh m·ªôt h·ªìi, ta v·∫´n ch∆∞a gi·∫£i th√≠ch ƒë∆∞·ª£c v·∫•n ƒë·ªÅ ban ƒë·∫ßu: Ta c√≥ th·ªÉ coi 1px tr√™n m√†n h√¨nh PC l√† 1px CSS hay kh√¥ng?</p><p>C√¢u tr·∫£ l·ªùi l√† c√≥. B·ªüi v√¨ m√†n h√¨nh PC, laptop hi·ªán nay ƒëa s·ªë ƒë·ªÅu c√≥ ƒë·ªô ph√¢n gi·∫£i kho·∫£ng 96dpi, n√™n 1px thi·∫øt b·ªã v·ª´a ƒë√∫ng v·ªõi 1px CSS.</p><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="3-pixel-tr√™n-tr√¨nh-duy·ªát-mobile"></a>3. Pixel tr√™n tr√¨nh duy·ªát Mobile<a class="hash-link" href="#3-pixel-tr√™n-tr√¨nh-duy·ªát-mobile" title="Direct link to heading">#</a></h1><p>Li·ªáu c√°c b·∫°n c√≥ bao gi·ªù th·∫Øc m·∫Øc: M√†n h√¨nh ƒëi·ªán tho·∫°i to√†n HD 720x1280, FullHD 1080x1920, ... m√† sao khi responsive l·∫°i ph·∫£i s·ª≠ d·ª•ng media query &lt; 576px?</p><p>Ch·∫Øc h·∫≥n c√°c b·∫°n ƒë√£ t·ª± c√≥ c√¢u tr·∫£ l·ªùi cho m√¨nh. V√¨ khi s·ª≠ d·ª•ng <strong>reference pixel</strong>, 1px tr√™n ƒëi·ªán tho·∫°i s·∫Ω kh√¥ng c√≤n l√† 1px c·ªßa CSS n·ªØa.</p><p>Do DPI ƒëi·ªán tho·∫°i cao chƒÉng? V√≠ d·ª• ƒëi·ªán tho·∫°i m√¨nh c√≥ DPI l√† 294, ƒë·ªô ph√¢n gi·∫£i 720x1280, v·∫≠y th√¨ 1px CSS (0.26mm) = 3px thi·∫øt b·ªã (0.087mm). V·∫≠y th√¨ l√† 240x427?</p><p>Kh√¥ng, m·ªôt ph·∫ßn ƒë√∫ng l√† do DPI, v√† 1 l√Ω do n·ªØa l√† v√¨ ta c·∫ßm ƒëi·ªán tho·∫°i g·∫ßn h∆°n nhi·ªÅu so v·ªõi kho·∫£ng c√°ch ng·ªìi tr∆∞·ªõc m√†n h√¨nh PC, Laptop (kho·∫£ng 18in)</p><p><img src="https://images.viblo.asia/ff59e444-6b0f-430e-85b2-b4afa3494ec9.jpg"></p><p>√Åp d·ª•ng ƒë·ªãnh l√Ω Talet trong tam gi√°c, ta t√≠nh ƒë∆∞·ª£c 1px CSS gi·ªù ch·ªâ c√≤n:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">18 * 0.26 / 28 = 0.167mm</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>L·∫°i l·∫•y ƒëi·ªán tho·∫°i 5in, ƒë·ªô ph√¢n gi·∫£i 720x1280 c·ªßa m√¨nh, 1px = 0.087mm</p><p>D·ªÖ th·∫•y 1px CSS = 2px thi·∫øt b·ªã. V√¨ th·∫ø m√†n h√¨nh r·ªông 720px c·ªßa ta gi·ªù ch·ªâ c√≤n 360px trong m·∫Øt CSS. T·ªâ l·ªá 2:1 n√†y, g·ªçi l√† <code>devicePixelRatio</code></p><p>Con s·ªë n√†y s·∫Ω ƒë∆∞·ª£c nh√† s·∫£n xu·∫•t t√≠nh to√°n v√† cung c·∫•p khi s·∫£n xu·∫•t 1 thi·∫øt b·ªã n√†o ƒë√≥. V·ªõi Javascript, ta c√≥ th·ªÉ d√πng h√†m sau ƒë·ªÉ l·∫•y ƒë∆∞·ª£c <code>devicePixelRatio</code>:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token dom variable" style="color:rgb(191, 199, 213)">window</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">devicePixelRatio</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="4-k·∫øt-lu·∫≠n"></a>4. K·∫øt lu·∫≠n<a class="hash-link" href="#4-k·∫øt-lu·∫≠n" title="Direct link to heading">#</a></h1><p>Th·∫ø gi·ªõi Frontend kh√° h·∫°i n√£o v·ªõi c√°c lo·∫°i m√†n h√¨nh kh√°c nhau, n√™n ng∆∞·ªùi ta ƒë√£ ph·∫£i quy ∆∞·ªõc 1 ƒë∆°n v·ªã chu·∫©n d√πng cho m·ªçi thi·∫øt b·ªã trong c√πng 1 kho·∫£ng c√°ch nh√¨n. ƒêi·ªÅu n√†y ƒë√£ gi√∫p anh em dev ch√∫ng ta d·ªÖ th·ªü h∆°n nhi·ªÅu.</p><p>Hy v·ªçng b√†i vi·∫øt n√†y gi√∫p m·ªçi ng∆∞·ªùi hi·ªÉu th√™m v·ªÅ ƒë∆°n v·ªã px m√† m√¨nh v·∫´n s·ª≠ d·ª•ng th∆∞·ªùng ng√†y.</p><p>ƒê·ªãnh vi·∫øt th√™m c·∫£ v·ªÅ <code>dp</code> trong Android m√† c·∫£m th·∫•y b√†i d√†i qu√° r·ªìi, c√≥ l·∫Ω m√¨nh s·∫Ω ƒë·ªÉ k·ª≥ t·ªõi, mong c√°c b·∫°n ·ªßng h·ªô.</p><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="5-tham-kh·∫£o"></a>5. Tham kh·∫£o<a class="hash-link" href="#5-tham-kh·∫£o" title="Direct link to heading">#</a></h1><ul><li><p><a href="https://www.w3.org/TR/css-values-4/#px" target="_blank" rel="noopener noreferrer">w3</a></p></li><li><p><a href="https://www.html5rocks.com/en/mobile/high-dpi/" target="_blank" rel="noopener noreferrer">html5rocks</a></p></li><li><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/devicePixelRatio" target="_blank" rel="noopener noreferrer">Mozilla Docs</a></p></li><li><p>H√¨nh ·∫£nh th√¨ l·∫•y t√πm lum qu√° m√† qu√™n l∆∞u ngu·ªìn T.T</p></li></ul></div><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog/tags/frontend">frontend</a><a class="margin-horiz--sm" href="/blog/tags/css">css</a><a class="margin-horiz--sm" href="/blog/tags/html">html</a></div></footer></article><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_GeHD"><a href="/blog/tdd-bdd-noi-de-hon-lam">TDD/BDD - N√≥i d·ªÖ h∆°n l√†m</a></h2><div class="margin-vert--md"><time datetime="2018-09-22T00:00:00.000Z" class="blogPostDate_fNvV">September 22, 2018 ¬∑ 7 min read</time></div><div class="avatar margin-vert--md"><a href="https://github.com/moonlight8978" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img src="https://avatars.githubusercontent.com/u/26299310?v=4" alt="L√™ Sƒ© B√≠ch"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/moonlight8978" target="_blank" rel="noopener noreferrer">L√™ Sƒ© B√≠ch</a></h4><small class="avatar__subtitle">Ruby on Rails/React Developer</small></div></div></header><div class="markdown"><p>M·ªôt v√†i l∆∞u √Ω tr∆∞·ªõc khi b·∫Øt ƒë·∫ßu.</p><ul><li>Code demo trong b√†i s·∫Ω s·ª≠ d·ª•ng rspec, capybara, factory_bot (Ruby/Rails), h∆∞·ªõng t·ªõi ƒë·ªëi t∆∞·ª£ng Web developer.</li><li>B√†i vi·∫øt kh√¥ng tr√°nh kh·ªèi thi·∫øu s√≥t, n·∫øu c√≥ ch·ªó n√†o kh√¥ng ƒë√∫ng, m·ªçi ng∆∞·ªùi c·ª© quƒÉng g·∫°ch ·ªü d∆∞·ªõi comment :v</li></ul><p>√îng cha ta c√≥ c√¢u &quot;D·ª•c t·ªëc b·∫•t ƒë·∫°t&quot;. Tr∆∞·ªõc khi ƒëi v√†o chi ti·∫øt, ta h√£y c√πng ƒëi·ªÉm qua m·ªôt v√†i kh√°i ni·ªám tr∆∞·ªõc.</p><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="1-test-l√†-g√¨"></a>1. Test l√† g√¨?<a class="hash-link" href="#1-test-l√†-g√¨" title="Direct link to heading">#</a></h1><p>N·∫øu b·∫°n l√† m·ªôt developer, ch·∫Øc h·∫≥n s·∫Ω kh√¥ng l·∫° l·∫´m g√¨ kh√°i ni·ªám &quot;testing&quot;.</p><p>V√≠ d·ª• khi b·∫°n l·∫≠p tr√¨nh ch·ª©c nƒÉng ƒëƒÉng nh·∫≠p c·ªßa 1 trang web. Sau m·ªôt h·ªìi h√¨ h·ª•c code, ch·∫Øc h·∫≥n b·∫°n s·∫Ω v√†o trang ƒë√≥, ti·∫øn h√†nh ƒëƒÉng nh·∫≠p, r·ªìi ch·ªù xem code m√¨nh c√≥ ch·∫°y ƒë√∫ng hay kh√¥ng :v</p><p>Tuy nhi√™n gi·ªù ƒë√¢y, ƒëa s·ªë ƒë·ªÅu s·ª≠ d·ª•ng c√°c automated test script ƒë·ªÉ t·ª± ƒë·ªông h√≥a qu√° tr√¨nh test. H∆°n th·∫ø, n√≥ c√≤n gi√∫p nh·ªØng ng∆∞·ªùi maintainer sau n√†y c√≥ th·ªÉ hi·ªÉu <del>c√°i ƒë·ªëng h·ªï l·ªën</del> code b·∫°n ƒë·ªÉ l·∫°i ch·∫°y nh∆∞ th·∫ø n√†o.</p><p>Test kh√°c v·ªõi Debug.</p><p>C√°c lo·∫°i test n√™n ch√∫ √Ω:</p><ul><li>Unit test: test ri√™ng l·∫ª t·ª´ng class/function, vi·∫øt kh√° d·ªÖ.</li><li>Integration test, Feature test: ·ªü ƒë√¢y b·∫Øt ƒë·∫ßu c√≥ s·ª± k·∫øt h·ª£p gi·ªØa nhi·ªÅu module v·ªõi nhau ƒë·ªÉ m√¥ t·∫£ 1 (hay nhi·ªÅu) ch·ª©c nƒÉng c·ªßa ·ª©ng d·ª•ng.</li></ul><p>M√†u s·∫Øc ƒë·∫∑c tr∆∞ng:</p><ul><li>ƒê·ªè: xin chia bu·ªìn test c·ªßa b·∫°n ƒë√£ t·∫°ch =))</li><li>Xanh: ch√∫c m·ª´ng, test ƒë√£ pass, code c·ªßa b·∫°n &quot;c√≥ th·ªÉ&quot; ƒë√£ ch·∫°y ƒë√∫ng.</li></ul><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="2-tdd---test-driven-development"></a>2. TDD - Test Driven Development<a class="hash-link" href="#2-tdd---test-driven-development" title="Direct link to heading">#</a></h1><p>D·ªãch ra th√¨ s·∫Ω l√† <strong>Ph√°t tri·ªÉn v·ªõi tr·ªçng t√¢m l√† ki·ªÉm th·ª≠ (test)</strong>, hay n√¥m na l√† test tr∆∞·ªõc code sau.</p><p><img src="https://images.viblo.asia/bd25076f-2ddb-4b27-888e-d58ab8e8c286.png" alt="TDD"></p><ul><li><p>Tr∆∞·ªõc ti√™n ta vi·∫øt c√°c test script v√† ch·∫°y ch√∫ng, t·∫•t nhi√™n l√† s·∫Ω fail v√¨ l√†m g√¨ c√≥ code =))</p><p>VD ta mu·ªën vi·∫øt 1 h√†m t√≠nh s·ªë Fibonacci:</p><p><img src="https://wikimedia.org/api/rest_v1/media/math/render/svg/6693d2c78bc8132bb9b65be861148ca574a738ef" alt="Fibonacci"></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># spec/fibonacci_spec.rb</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">describe &quot;#fibonacci_of&quot; do</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  context &quot;one&quot; do</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    it &quot;returns 1&quot; do</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      expect(fibonacci_of(1)).to eq 1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  context &quot;two&quot; do</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    it &quot;returns 1&quot; do</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      expect(fibonacci_of(2)).to eq 1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  context &quot;greater than two&quot; do</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    it &quot;returns sum of two elements before&quot; do</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      expect(fibonacci_of(4)).to eq 3</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></li><li><p>R·ªìi ta m·ªõi b·∫Øt tay v√†o code, ch·∫°y test, n·∫øu fail th√¨ l·∫°i h√¨ h·ª•c s·ª≠a, h·ªèng ƒë√¢u v√° ƒë√≥. L√∫c n√†y b·∫°n ch∆∞a c·∫ßn b·∫≠n t√¢m v·ªÅ vi·ªác code m√¨nh c√≥ d·ªÖ hi·ªÉu/ƒë·∫πp kh√¥ng.</p><p>V√† sau 1 h·ªìi th√¨ cu·ªëi c√πng test ta c≈©ng pass :v</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># fibonacci.rb</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">def fibonacci_of(n)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  case n</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  when 1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  when 2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  else</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    fibonacci_of(n - 1) + fibonacci_of(n - 2)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></li><li><p>Ta s·∫Ω nh√¨n l·∫°i ƒë·ªëng h·ªï l·ªën m√† ta v·ª´a vi·∫øt ra, t·ªâa t√≥t l·∫°i cho ƒë·∫πp m·∫Øt, t√°ch service c√°c th·ª©. V√† nh·ªõ r·∫±ng ƒë·ª´ng l√†m cho test ƒë·ªè l√≤m.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># fibonacci.rb</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">def fibonacci_of(n)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  return 1 if [1, 2].include?(n)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  fibonacci_of(n - 1) + fibonacci_of(n - 2)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></li></ul><p><strong>L∆∞u √Ω:</strong> Kh√¥ng ph·∫£i c·ª© test pass l√† app c·ªßa ta ƒë√£ ch·∫°y ƒë√∫ng, vi·ªác n√†y c√≤n bao g·ªìm nhi·ªÅu y·∫øu t·ªë kh√°c nh∆∞</p><ul><li>Ta c√≥ hi·ªÉu ƒë√∫ng y√™u c·∫ßu c·ªßa kh√°ch h√†ng kh√¥ng</li><li>Test c·ªßa ta ƒë√£ bao g·ªìm h·∫øt c√°c tr∆∞·ªùng h·ª£p c√≥ th·ªÉ ch∆∞a</li></ul><p>C√≥ th·ªÉ d·ªÖ d√†ng nh·∫≠n th·∫•y, h√†m <code>#fibonacci_of</code> ·ªü tr√™n s·∫Ω ch·∫øt ngay l·∫≠p t·ª©c n·∫øu g·∫∑p tham s·ªë <code>&lt;= 0</code>.</p><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="3-bdd---behavior-driven-development"></a>3. BDD - Behavior Driven Development<a class="hash-link" href="#3-bdd---behavior-driven-development" title="Direct link to heading">#</a></h1><p><img src="http://blog.andolasoft.com/wp-content/uploads/2015/05/TDD-vs-BDD.jpg" alt="BDD"></p><p>K·∫ø th·ª´a ng∆∞·ªùi ti·ªÅn nhi·ªám TDD v·ªõi ph∆∞∆°ng ch√¢m &quot;Test tr∆∞·ªõc code sau&quot;, BDD ch·ªâ kh√°c ch√∫t l√† ta s·∫Ω t·∫≠p trung v√†o h√†nh vi ng∆∞·ªùi d√πng (feature).</p><p>Theo ƒë√≥, ta s·∫Ω vi·∫øt c√°c feature test tr∆∞·ªõc (m√¥ t·∫£ m·ªôt t√≠nh nƒÉng c·ªßa ·ª©ng d·ª•ng, ho·∫∑c usecase/userstory). V·ªõi m·ªói feature test ƒë√≥, ta c√≥ th·ªÉ s·∫Ω ph·∫£i tri·ªÉn khai th√™m 1 v√†i unit test/integration test cho c√°c class/function c·∫ßn thi·∫øt trong feature test.</p><p>V√≠ d·ª•: Ta mu·ªën x√¢y d·ª±ng t√≠nh nƒÉng t·∫°o album cho ·ª©ng d·ª•ng qu·∫£n l√Ω album nh·∫°c.</p><p>Tr∆∞·ªõc h·∫øt h√£y h√¨nh dung t√≠nh nƒÉng n√†y trong ƒë·∫ßu:</p><blockquote><p>Admin t·ª´ trang index albums (/albums), b·∫•m n√∫t &quot;Add album&quot;, 1 form s·∫Ω hi·ªán ra ƒë·ªÉ nh·∫≠p th√¥ng tin album (bao g·ªìm title v√† artist name).</p><p>N·∫øu anh admin n√†y nh·∫≠p ƒë√∫ng, h√£y redirect sang trang index v√† hi·ªÉn th·ªã album m·ªõi n√†y, c√≤n kh√¥ng th√¨ h√£y hi·ªán l·ªói ƒë·ªÉ anh admin c√≤n bi·∫øt ƒë∆∞·ªùng m√† l·∫ßn.</p></blockquote><p>Feature test c·ªßa ta s·∫Ω nh∆∞ sau:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># spec/features/create_album_spec.rb</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">RSpec.feature &quot;album creating process&quot;, type: :feature do</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  context &quot;all fields are filled correctly&quot; do</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    it &quot;create a new album&quot; do</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      visit &#x27;/albums&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      click_link &#x27;Add album&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      within &#x27;form#album_form&#x27; do</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        fill_in &#x27;Title&#x27;, with: &#x27;Chay ngay di&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        fill_in &#x27;Artist name&#x27;, with: &quot;Sep&#x27;ss&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      click_button &#x27;Create&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      expect(page).to have_content(&#x27;Chay ngay di&#x27;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  context &quot;title is blank&quot; do</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    it &quot;show errors&quot; do</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      visit &#x27;/albums&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      click_link &#x27;Add album&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      within &#x27;form#album_form&#x27; do</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        fill_in &#x27;Artist name&#x27;, with: &quot;Sep&#x27;ss&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      click_button &#x27;Create&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      expect(page).to have_content(&quot;Title can&#x27;t be blank&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>N·∫øu l√†m theo ƒë√∫ng flow c·ªßa Rails, ta s·∫Ω ph·∫£i vi·∫øt unit test cho:</p><ul><li>Controller: index, create - test xem logic b√™n trong ƒë√£ ƒë√∫ng ch∆∞a, status code ra sao.</li><li>View: new, index - test xem tr∆∞·ªùng h·ª£p c√≥ l·ªói th√¨ form hi·ªÉn th·ªã sao, hay tr∆∞·ªùng h·ª£p kh√¥ng c√≥ album th√¨ view index c√≥ th√¥ng b√°o cho ng∆∞·ªùi d√πng bi·∫øt hay kh√¥ng.</li><li>Model: album - test xem validate c√≥ ho·∫°t ƒë·ªông hay kh√¥ng.</li></ul><p>Chi ti·∫øt th√¨ m√¨nh xin l∆∞·ª£c b·ªõt v√¨ d√†i qu√°, b·∫°n c√≥ th·ªÉ tham kh·∫£o th√™m ·ªü <a href="http://hanamirb.org/guides/1.2/getting-started/" target="_blank" rel="noopener noreferrer">ƒë√¢y</a>.</p><p>N·∫øu b·∫°n bƒÉn khoƒÉn n√™n test c√°i g√¨ trong Rails, c√≥ th·ªÉ tham kh·∫£o b√†i <a href="https://m.patrikonrails.com/how-i-test-my-rails-applications-cf150e347a6b" target="_blank" rel="noopener noreferrer">n√†y</a>.</p><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="3-c√°c-nguy√™n-t·∫Øc-khi-vi·∫øt-test-tdd"></a>3. C√°c nguy√™n t·∫Øc khi vi·∫øt test (TDD)<a class="hash-link" href="#3-c√°c-nguy√™n-t·∫Øc-khi-vi·∫øt-test-tdd" title="Direct link to heading">#</a></h1><ol><li><p>Ch·ªâ vi·∫øt code khi n√≥ c·∫ßn thi·∫øt ƒë·ªÉ test c·ªßa b·∫°n pass.</p><p>VD b·∫°n vi·∫øt m·ªôt h√†m l·∫•y v·ªÅ email c·ªßa ng∆∞·ªùi d√πng theo <code>id</code>.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">def get_user_mail_by_id(id)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  user = User.find(id)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  user.mail</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>·ªû ƒë√¢y b·∫Øt bu·ªôc ph·∫£i truy v·∫•n CSDL ƒë·ªÉ t√¨m ra user. Kh√¥ng d√πng <code>find</code> th√¨ l·∫•y th√¥ng tin user th·∫ø n√†o :v</p></li><li><p>Ch·ªâ vi·∫øt n√™n unit test trong ph·∫°m vi v·ª´a ƒë·ªß.</p></li></ol><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="4-∆∞u-ƒëi·ªÉm"></a>4. ∆Øu ƒëi·ªÉm<a class="hash-link" href="#4-∆∞u-ƒëi·ªÉm" title="Direct link to heading">#</a></h1><ul><li><p>Nh·ªØng ng∆∞·ªùi n√£o to tr√™n th·∫ø gi·ªõi ƒë√£ ch·ª©ng minh ƒë∆∞·ª£c TDD gi√∫p thay ƒë·ªïi mindset c·ªßa b·∫°n, v√† b·∫°n s·∫Ω tr·ªü th√†nh nh·ªØng l·∫≠p tr√¨nh vi√™n t·ªët h∆°n.</p><p>N√≥ ƒë√≤i h·ªèi b·∫°n ph·∫£i thu t·∫≠p trung h∆°n v√†o nh·ªØng chi ti·∫øt nh·ªè ƒë·ªÉ test c·ªßa m√¨nh pass, h∆°n l√† suy nghƒ© v·∫©n v∆° v·ªÅ c·∫£ c√°i app to ƒë√πng.</p></li><li><p>Ngo√†i ki·ªÉm th·ª≠, test c≈©ng l√† docs cho maintainer sau n√†y, n√≥ cung c·∫•p chi ti·∫øt v·ªÅ c√°c ƒë·∫∑c t·∫£ k·ªπ thu·∫≠t (specification) c·ªßa app.</p></li><li><p>√çt bug h∆°n, d·ªÖ b·∫£o tr√¨, ph√°t hi·ªán l·ªói s·ªõm.</p></li><li><p>Cho b·∫°n bi·∫øt code m√† b·∫°n v·ª´a vi·∫øt xong n√≥ l√†m h·ªèng c·∫£ app kh√¥ng =))</p></li></ul><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="5-k·∫øt-lu·∫≠n"></a>5. K·∫øt lu·∫≠n<a class="hash-link" href="#5-k·∫øt-lu·∫≠n" title="Direct link to heading">#</a></h1><ul><li><p>TDD/BDD th·ª±c s·ª± r·∫•t t·ªët, n·∫øu b·∫°n mu·ªën tr·ªü th√†nh m·ªôt l·∫≠p tr√¨nh vi√™n t·ªët h∆°n, h√£y c·ªë g·∫Øng tryhard :v</p></li><li><p>Th∆∞·ªùng m·ªçi ng∆∞·ªùi hay c√≥ xu h∆∞·ªõng code xong m·ªõi vi·∫øt test, v√† m√¨nh c≈©ng l√† m·ªôt trong s·ªë ƒë√≥ =)). Tuy v·∫≠y, h√£y c·ªë g·∫Øng vi·∫øt test case c·ªßa m√¨nh th·∫≠t minh b·∫°ch, d·ªÖ hi·ªÉu, v√¨ ch√≠nh b·∫£n th√¢n ta v√† c√°c maintainer sau n√†y.</p></li></ul><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="6-tham-kh·∫£o"></a>6. Tham kh·∫£o<a class="hash-link" href="#6-tham-kh·∫£o" title="Direct link to heading">#</a></h1><ul><li><p><a href="https://medium.com/pacroy/test-driven-development-tdd-resource-site-tdd-pacroy-com-a02e02396f32" target="_blank" rel="noopener noreferrer">Test-Driven Development (TDD) Resource Site</a></p></li><li><p><a href="http://blog.andolasoft.com/2014/06/rails-things-you-must-know-about-tdd-and-bdd.html" target="_blank" rel="noopener noreferrer">Rails: Things you must know about TDD and BDD</a></p></li><li><p><a href="https://www.madetech.com/blog/9-benefits-of-test-driven-development" target="_blank" rel="noopener noreferrer">9 Benefits of Test Driven Development</a></p></li><li><p><a href="https://apiumhub.com/tech-blog-barcelona/advantages-of-test-driven-development/" target="_blank" rel="noopener noreferrer">20 ADVANTAGES OF TEST DRIVEN DEVELOPMENT</a></p></li><li><p><a href="http://hanamirb.org/guides/1.2/getting-started/" target="_blank" rel="noopener noreferrer">Hanami Official Guide</a></p></li><li><p><a href="https://m.patrikonrails.com/how-i-test-my-rails-applications-cf150e347a6b" target="_blank" rel="noopener noreferrer">How I test Rails applications</a></p></li></ul></div><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog/tags/tdd">tdd</a><a class="margin-horiz--sm" href="/blog/tags/bdd">bdd</a><a class="margin-horiz--sm" href="/blog/tags/testing">testing</a><a class="margin-horiz--sm" href="/blog/tags/ruby-on-rails">ruby-on-rails</a></div></footer></article><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></main></div></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Self notes</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/moonlight8978/moonlight8978.github.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li><li class="footer__item"><a href="https://stackoverflow.com/users/8068639/moonlight8978" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright ¬© 2021 moonlight8978. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.2e9fde40.js"></script>
<script src="/assets/js/main.f5ae6226.js"></script>
</body>
</html>