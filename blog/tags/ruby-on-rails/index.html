<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.0">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="moonlight8978's Blog Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="moonlight8978's Blog Blog Atom Feed"><title data-react-helmet="true">Posts tagged &quot;ruby-on-rails&quot; | moonlight8978&#x27;s Blog</title><meta data-react-helmet="true" property="og:title" content="Posts tagged &quot;ruby-on-rails&quot; | moonlight8978&#x27;s Blog"><meta data-react-helmet="true" name="description" content="Blog | Tagged &quot;ruby-on-rails&quot;"><meta data-react-helmet="true" property="og:description" content="Blog | Tagged &quot;ruby-on-rails&quot;"><meta data-react-helmet="true" property="og:url" content="https://moonlight8978.github.io/blog/tags/ruby-on-rails"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="blog_tags_posts"><link data-react-helmet="true" rel="shortcut icon" href="https://avatars.githubusercontent.com/u/26299310?v=4"><link data-react-helmet="true" rel="canonical" href="https://moonlight8978.github.io/blog/tags/ruby-on-rails"><link data-react-helmet="true" rel="alternate" href="https://moonlight8978.github.io/blog/tags/ruby-on-rails" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://moonlight8978.github.io/blog/tags/ruby-on-rails" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.5f3c8191.css">
<link rel="preload" href="/assets/js/runtime~main.f8558fbc.js" as="script">
<link rel="preload" href="/assets/js/main.a94954d9.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="https://avatars.githubusercontent.com/u/26299310?v=4" alt="moonlight8978" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="https://avatars.githubusercontent.com/u/26299310?v=4" alt="moonlight8978" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">My Site</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/docs/intro">Programming notes</a><a class="navbar__item navbar__link" href="/books/intro">Book notes</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle displayOnlyInLargeViewport_GrZ2 react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT">üåú</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">üåû</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="https://avatars.githubusercontent.com/u/26299310?v=4" alt="moonlight8978" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="https://avatars.githubusercontent.com/u/26299310?v=4" alt="moonlight8978" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">My Site</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/blog">Blog</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/intro">Programming notes</a></li><li class="menu__list-item"><a class="menu__link" href="/books/intro">Book notes</a></li><li class="menu__list-item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper blog-wrapper blog-tags-post-page"><div class="container margin-vert--lg"><div class="row"><div class="col col--3"><div class="sidebar_2ahu thin-scrollbar"><h3 class="sidebarItemTitle_2hhb">All posts</h3><ul class="sidebarItemList_2xAf"><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/cung-tim-hieu-ve-puma-ruby-on-rails">C√πng t√¨m hi·ªÉu v·ªÅ Puma (Ruby on Rails)</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/cuoi-react-native-xem-appium-phan-1-cung-tim-hieu-cach-hoat-dong-cua-appium">C∆∞·ª°i React Native xem Appium (Ph·∫ßn 1 - C√πng t√¨m hi·ªÉu c√°ch ho·∫°t ƒë·ªông c·ªßa Appium)</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/gioi-thieu-ve-kubernetes">Gi·ªõi thi·ªáu v·ªÅ Kubernetes</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/toi-uu-menh-de-where-mysql">T·ªëi ∆∞u m·ªánh ƒë·ªÅ WHERE (MySQL)</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/cung-tim-hieu-ve-actiontext-trong-rails-6">C√πng t√¨m hi·ªÉu v·ªÅ ActionText trong Rails 6</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/cung-tim-hieu-ve-railway-oriented-programming">C√πng t√¨m hi·ªÉu v·ªÅ Railway Oriented Programming</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/mot-vai-mindset-khi-lam-viec-voi-react">M·ªôt v√†i mindset khi l√†m vi·ªác v·ªõi React</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/cung-tim-hieu-ve-nguyen-tu-cua-the-gioi-front-end-phan-2-density-independent-pixel">C√πng t√¨m hi·ªÉu v·ªÅ nguy√™n t·ª≠ c·ªßa th·∫ø gi·ªõi FrontEnd (Ph·∫ßn 2 - Density-independent Pixel)</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/cung-tim-hieu-ve-nguyen-tu-cua-the-gioi-front-end-phan-1-pixel">C√πng t√¨m hi·ªÉu v·ªÅ nguy√™n t·ª≠ c·ªßa th·∫ø gi·ªõi FrontEnd (Ph·∫ßn 1 - Pixel)</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/tdd-bdd-noi-de-hon-lam">TDD/BDD - N√≥i d·ªÖ h∆°n l√†m</a></li></ul></div></div><main class="col col--7"><h1>3 posts tagged with &quot;ruby-on-rails&quot;</h1><a href="/blog/tags">View All Tags</a><div class="margin-vert--xl"><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_GeHD"><a href="/blog/cung-tim-hieu-ve-puma-ruby-on-rails">C√πng t√¨m hi·ªÉu v·ªÅ Puma (Ruby on Rails)</a></h2><div class="margin-vert--md"><time datetime="2021-05-31T00:00:00.000Z" class="blogPostDate_fNvV">May 31, 2021 ¬∑ 11 min read</time></div><div class="avatar margin-vert--md"><a href="https://github.com/moonlight8978" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img src="https://avatars.githubusercontent.com/u/26299310?v=4" alt="L√™ Sƒ© B√≠ch"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/moonlight8978" target="_blank" rel="noopener noreferrer">L√™ Sƒ© B√≠ch</a></h4><small class="avatar__subtitle">Ruby on Rails/React Developer</small></div></div></header><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="1-m·ªü-ƒë·∫ßu"></a>1. M·ªü ƒë·∫ßu<a class="hash-link" href="#1-m·ªü-ƒë·∫ßu" title="Direct link to heading">#</a></h2><p>Ch·∫Øc h·∫≥n Puma kh√¥ng ph·∫£i m·ªôt c√°i t√™n xa l·∫° ƒë·ªëi v·ªõi m·ªói Rails developer, m·ªôt ph·∫ßn c≈©ng v√¨ ƒë√¢y l√† appserver m·∫∑c ƒë·ªãnh khi t·∫°o m·ªõi m·ªôt project Rails.</p><p>H√£y c√πng nh√¨n qua nh·ªØng config c∆° b·∫£n khi ch·∫°y 1 ·ª©ng d·ª•ng Rails v·ªõi Puma server. <a href="https://github.com/rails/rails/blob/0f5700ac3589081126fbfde1e4037dc1d4166cce/railties/lib/rails/generators/rails/app/templates/config/puma.rb.tt" target="_blank" rel="noopener noreferrer">link</a></p><div class="codeBlockContainer_K1bP"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_eoMF">config/puma.rb</div><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar codeBlockWithTitle_2JqI"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">max_threads_count = ENV.fetch(&quot;RAILS_MAX_THREADS&quot;) { 5 }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">min_threads_count = ENV.fetch(&quot;RAILS_MIN_THREADS&quot;) { max_threads_count }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">threads min_threads_count, max_threads_count</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">worker_timeout 3600 if ENV.fetch(&quot;RAILS_ENV&quot;, &quot;development&quot;) == &quot;development&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">port ENV.fetch(&quot;PORT&quot;) { 3000 }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">environment ENV.fetch(&quot;RAILS_ENV&quot;) { &quot;development&quot; }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">pidfile ENV.fetch(&quot;PIDFILE&quot;) { &quot;tmp/pids/server.pid&quot; }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">workers ENV.fetch(&quot;WEB_CONCURRENCY&quot;) { 2 }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">preload_app!</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">plugin :tmp_restart</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>ƒê·ªëi v·ªõi nh·ªØng ng∆∞·ªùi m·ªõi b·∫Øt ƒë·∫ßu, khi deploy puma, c√≥ l·∫Ω s·∫Ω t·ª´ ch·ªëi hi·ªÉu ƒë·ªëng config tr√™n v√† set m·ªôt s·ªë bi·∫øn m√¥i tr∆∞·ªùng nh∆∞ sau:</p><ul><li><code>WEB_CONCURRENCY</code>: b·∫±ng v·ªõi s·ªë l∆∞·ª£ng vcore/process c·ªßa m√°y</li><li><code>RAILS_MAX_THREADS</code>: ·ªù th√¨ nhi·ªÅu RAM th√¨ set 16, 32 cho o√°ch, kh√¥ng th√¨ th√¥i d√πng m·∫∑c ƒë·ªãnh 5 v√† m·∫∑c do d√≤ng ƒë·ªùi x√¥ ƒë·∫©y :v</li></ul><p>H√£y c√πng t√¨m hi·ªÉu th√™m v·ªÅ Puma ƒë·ªÉ g√≥p ph·∫ßn l√†m ch·ªß t·ª´ng d√≤ng code trong app c·ªßa ch√∫ng ta.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="2-multi-processing-v√†-multi-threading"></a>2. Multi-processing v√† Multi-threading<a class="hash-link" href="#2-multi-processing-v√†-multi-threading" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="21-puma-d√πng-lo·∫°i-n√†o"></a>2.1. Puma d√πng lo·∫°i n√†o?<a class="hash-link" href="#21-puma-d√πng-lo·∫°i-n√†o" title="Direct link to heading">#</a></h3><ul><li>Khi ch·∫°y 1 Rails app m·ªõi t·∫°o, h√£y ƒë·ªÉ √Ω l√∫c boot server, b·∫°n s·∫Ω th·∫•y:</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly log"><div tabindex="0" class="prism-code language-log codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Puma starting in single mode...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">* Puma version: 5.3.1 (ruby 3.0.1-p64) (&quot;Sweetnighter&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">*  Min threads: 5</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">*  Max threads: 5</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">*  Environment: development</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">*          PID: 1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">* Listening on http://0.0.0.0:3000</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Use Ctrl-C to stop</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>ƒê√¢y l√† d·∫•u hi·ªáu cho ta th·∫•y, Rails ƒëang ch·∫°y ·ªü ch·∫ø ƒë·ªô single process (1 process), v√† multi-thread (c·ª• th·ªÉ l√† 5 thread)</p><ul><li>C√≤n khi config deploy, c√≥ th·ªÉ b·∫°n s·∫Ω ƒë∆∞·ª£c 1 ng∆∞·ªùi c√≥ kinh nghi·ªám h∆°n b·∫£o r·∫±ng <em>&quot;B·ªè comment c√°i d√≤ng <code>workers ENV.fetch(&quot;WEB_CONCURRENCY&quot;) { 2 }</code> ƒëi em √™i&quot;</em></li></ul><p>V√† ƒë√¢y l√† k·∫øt qu·∫£ khi ta l√†m nh∆∞ v·∫≠y</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly log"><div tabindex="0" class="prism-code language-log codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">[1] Puma starting in cluster mode...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[1] * Puma version: 5.3.1 (ruby 3.0.1-p64) (&quot;Sweetnighter&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[1] *  Min threads: 5</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[1] *  Max threads: 5</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[1] *  Environment: development</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[1] *   Master PID: 1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[1] *      Workers: 2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[1] *     Restarts: (ÔøΩÔøΩÔøΩ) hot (ÔøΩÔøΩÔøΩ) phased</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[1] * Preloading application</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[1] * Listening on htp://0.0.0.0:3000</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[1] Use Ctrl-C to stop</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[1] - Worker 0 (PID: 16) booted in 0.02s, phase: 0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[1] - Worker 1 (PID: 17) booted in 0.05s, phase: 0</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Puma ƒëang ch·∫°y ƒë·ªìng th·ªùi multi-process (2 process) v√† multi-thread (5 thread)</p><blockquote><p>Multi-process, multi-thread l√† c√°i c·ªßa n·ª£ g√¨ v·∫≠y?</p></blockquote><p>Ch√∫ng ta s·∫Ω t√¨m hi·ªÉu v·ªÅ n√≥ ngay sau ƒë√¢y. Tuy nhi√™n ch√∫ng ta s·∫Ω focus v√†o cluster mode c·ªßa Puma nh√©.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="22-multi-threading"></a>2.2. Multi-threading<a class="hash-link" href="#22-multi-threading" title="Direct link to heading">#</a></h3><p>Tr∆∞·ªõc ti√™n ta h√£y nh·ªõ l·∫°i ƒë·ªãnh nghƒ©a v·ªÅ <code>process</code> - ti·∫øn tr√¨nh, m·ªói khi ta ch·∫°y 1 command n√†o ƒë√≥ (v√≠ d·ª• nh∆∞ <code>ruby xxx.rb</code> hay b·∫≠t chrome ch·∫≥ng h·∫°n), OS s·∫Ω t·∫°o 1 process ƒë·ªÉ x·ª≠ l√Ω command c·ªßa ta.</p><p>M·ªói <em>process</em> c√≥ th·ªÉ t·∫°o ra nhi·ªÅu <em>thread</em> ƒë·ªÉ x·ª≠ l√Ω task (v√≠ d·ª• m·ªói tab chrome ƒë∆∞·ª£c handle b·ªüi 1 thread). C√°c thread ƒë∆∞·ª£c t·∫°o b·ªüi 1 process s·∫Ω share nhau 1 v√πng nh·ªõ (memory), trong shared memory n√†y, m·ªói thread s·∫Ω c√≥ stack, register (google ƒë·ªÉ bi·∫øt th√™m ƒë·ªëng n√†y l√† g√¨ =)) ) ri√™ng c·ªßa m√¨nh. Tuy nhi√™n, vi·ªác chung ƒë·ª•ng memory nh∆∞ tr√™n s·∫Ω d·∫´n ƒë·∫øn 1 v·∫•n ƒë·ªÅ l√† nhi·ªÅu thread c√πng ch·ªçc t·ªõi 1 resource n√†o ƒë√≥, d·∫´n t·ªõi conflict v·ªÅ data, hay c√≤n ƒë∆∞·ª£c bi·∫øt ƒë·∫øn v·ªõi c√°i t√™n nguy hi·ªÉm h∆°n l√† <strong>race condition</strong>. Code c·ªßa ta s·∫Ω c·∫ßn <em>thread-safe</em> (c√°c b·∫°n c√≥ th·ªÉ google th√™m :v)</p><p>ƒê·ªëi v·ªõi ·ª©ng d·ª•ng Ruby th√¨ khi ch·∫°y ·ªü m√¥i tr∆∞·ªùng MRI... √Ä ƒë·∫•y l·∫°i nh·∫Øc t·ªõi MRI, ch·∫Øc nhi·ªÅu ng∆∞·ªùi s·∫Ω th·∫Øc m·∫Øc li·ªáu ƒë√≥ l√† g√¨. ƒê√¢y l√† t√™n c·ªßa 1 Ruby Runtime. Ruby 1 chu·∫©n spec, implement ki·ªÉu g√¨ c≈©ng ƒë∆∞·ª£c, mi·ªÖn l√† ƒë√°p ·ª©ng ƒë∆∞·ª£c spec ƒë√≥ th√¨ ƒë·ªÅu l√† Ruby. C√≥ th·ªÉ k·ªÉ ƒë·∫øn c√°c Runtime ph·ªï bi·∫øn sau</p><ul><li><p>MRI - aka CRuby: Matz‚Äôs Ruby Interpreter (Matz - hay Matsumoto Yukihiro) l√† ng∆∞·ªùi t·∫°o ra runtime n√†y, ƒë∆∞·ª£c vi·∫øt b·∫±ng C, n√™n c√≤n g·ªçi l√† CRuby</p><p>ƒêa s·ªë l√† d√πng MRI</p></li><li><p>JRuby: Ruby implement b·∫±ng Java</p></li><li><p>Rubinius</p></li><li><p>mruby</p></li><li><p>...</p></li></ul><p>MRI c√≥ 1 c∆° ch·∫ø l√† <strong>Global Interpreter Lock</strong> (GIL), khi ch·∫°y multi-thread, n√≥ ch·ªâ cho ph√©p 1 thread ch·∫°y source code Ruby t·∫°i 1 th·ªùi ƒëi·ªÉm, n√™n l√† ta c√≥ nhi·ªÅu thread ƒëi chƒÉng n·ªØa th√¨ c≈©ng ch·ªâ c√≥ 1 thread ƒë∆∞·ª£c ch·∫°y m√† th√¥i.</p><p>Tuy nhi√™n v·ªõi c√°c thao t√°c IO nh∆∞ ƒë·ªçc DB, request external resource, ƒë·ªçc ghi file, ... th√¨ GIL kh√¥ng block. Puma ƒë√£ t·∫≠n d·ª•ng ƒëi·ªÅu n√†y, khi 1 thread ƒëang x·ª≠ l√Ω IO, n√≥ s·∫Ω quay tr·ªü l·∫°i x·ª≠ l√Ω ·ªü process, nh·∫≠n th√™m c√°c request kh√°c ƒë·ªÉ x·ª≠ l√Ω.</p><p>Ch√≠nh v√¨ v·∫≠y, ngay c·∫£ khi ch·ªâ ch·∫°y ·ªü single mode, Puma v·∫´n c√≥ th·ªÉ handle ƒë∆∞·ª£c concurrent request. Tuy nhi√™n v·ªõi c√°c request c·∫ßn th·ªùi gian d√†i ƒë·ªÉ x·ª≠ l√Ω, do ch·ªâ c√≥ 1 thread ƒë∆∞·ª£c ch·∫°y, n√™n request sau s·∫Ω ph·∫£i ch·ªù request tr∆∞·ªõc x·ª≠ l√Ω xong, d·∫´n ƒë·∫øn Puma b·ªã th·ªçt trong tr∆∞·ªùng h·ª£p n√†y.</p><p>Ta c√≥ th·ªÉ ki·ªÉm tra v·ªÅ tr·∫°ng th√°i c√°c thread c·ªßa Puma b·∫±ng ƒëo·∫°n code sau:</p><div class="codeBlockContainer_K1bP"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_eoMF">app/controllers/homes_controller.rb</div><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar codeBlockWithTitle_2JqI"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">class HomesController &lt; ApplicationController</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  def show</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Thread.list.select { |t| t.name&amp;.match?(/puma threadpool \d+/) }.each do |t|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      Rails.logger.info(&quot;Thread #{t.name}: #{t.status}, alive: #{t.alive?}, current: #{t == Thread.current}&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    head :ok</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>V√¨ sao l·∫°i l√† <code>/puma threadpool \d+/</code>? C√°c b·∫°n c√≥ th·ªÉ xem t·∫°i <a href="https://github.com/puma/puma/blob/3e80f7c704e5585da4faa32edf0fa7a0abed3689/lib/puma/thread_pool.rb#L104" target="_blank" rel="noopener noreferrer">ƒë√¢y</a>.</p><div class="codeBlockContainer_K1bP"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_eoMF">config/routes.rb</div><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar codeBlockWithTitle_2JqI"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Rails.application.routes.draw do</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  resource :home</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_eoMF">config/puma.rb</div><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar codeBlockWithTitle_2JqI"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">max_threads_count = ENV.fetch(&#x27;RAILS_MAX_THREADS&#x27;, 5)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">min_threads_count = ENV.fetch(&#x27;RAILS_MIN_THREADS&#x27;) { max_threads_count }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">threads min_threads_count, max_threads_count</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">worker_timeout 3600 if ENV.fetch(&#x27;RAILS_ENV&#x27;, &#x27;development&#x27;) == &#x27;development&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">port ENV.fetch(&#x27;PORT&#x27;, 3000)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">environment ENV.fetch(&#x27;RAILS_ENV&#x27;, &#x27;development&#x27;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">pidfile ENV.fetch(&#x27;PIDFILE&#x27;, &#x27;tmp/pids/server.pid&#x27;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">plugin :tmp_restart</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly curl"><div tabindex="0" class="prism-code language-curl codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">curl http://localhost:3000/home</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">tail -n 50 log/development.log</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>V√† ƒë√¢y l√† output:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly log"><div tabindex="0" class="prism-code language-log codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Thread puma threadpool 001: sleep, alive: true, current: false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Thread puma threadpool 002: sleep, alive: true, current: false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Thread puma threadpool 003: sleep, alive: true, current: false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Thread puma threadpool 004: sleep, alive: true, current: false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Thread puma threadpool 005: run, alive: true, current: true</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>ƒê√≥ ch√≠nh l√† 5 thread c·ªßa ch√∫ng ta, nh∆∞ v√≠ d·ª• l√† thread 5 ƒëang ti·∫øn h√†nh x·ª≠ l√Ω request, c√≤n nh·ªØng thread kh√°c n·∫øu r·∫£nh n√≥ s·∫Ω ·ªü tr·∫°ng th√°i <code>sleep</code>. ·ªû ƒë√¢y c√≥ 1 ƒëi·ªÉm ƒë√°ng ch√∫ √Ω l√† sau khi k·∫øt th√∫c request, thread kh√¥ng b·ªã kill m√† ch·ªâ v·ªÅ tr·∫°ng th√°i <code>sleep</code>, do v·∫≠y n·∫øu ta tu·ª≥ ti·ªán modify bi·∫øn global, n√≥ s·∫Ω ·∫£nh h∆∞·ªüng t·ªõi request ti·∫øp theo m√† thread ƒë√≥ handle.</p><p>V√≠ d·ª•:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">before_action :set_locale</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">def set_locale</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  I18n.locale = params[:locale] || I18n.default_locale</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Kh√¥ng c·∫ßn bi·∫øt code c√°i g√¨, nh∆∞ng modify 1 bi·∫øn global t·∫°i runtime nh∆∞ tr√™n l√† ƒë√£ th·∫•y nguy hi·ªÉm r·ªìi. V√† ta h√£y ti·∫øn h√†nh test xem</p><div class="codeBlockContainer_K1bP"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_eoMF">app/controllers/homes_controller.rb</div><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar codeBlockWithTitle_2JqI"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">class HomesController &lt; ApplicationController</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  def show</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Thread.current.tap { |t| Rails.logger.info(&quot;Current thread #{t.name}: #{t.status}, alive: #{t.alive?}&quot;) }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Rails.logger.info(&quot;Before: #{I18n.locale}&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    I18n.locale = params[:locale]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Rails.logger.info(&quot;After: #{I18n.locale}&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    head :ok</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>r·ªìi sau ƒë√≥ spam kho·∫£ng ch·ª•c c√°i request</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><div tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">curl</span><span class="token plain"> http://localhost:3000/home?locale</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">vi</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>v√† ta s·∫Ω th·∫•y k·∫øt qu·∫£ nh∆∞ sau</p><div class="codeBlockContainer_K1bP"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_eoMF">log/development.log</div><div class="codeBlockContent_hGly log"><div tabindex="0" class="prism-code language-log codeBlock_23N8 thin-scrollbar codeBlockWithTitle_2JqI"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Current thread puma threadpool 003: run, alive: true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Before: en</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">After: vi</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Current thread puma threadpool 003: run, alive: true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Before: vi</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">After: vi</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>C√≥ th·ªÉ d·ªÖ d√†ng nh·∫≠n ra r·∫±ng vi·ªác set <code>I18n.locale = &quot;vi&quot;</code> ·ªü request tr∆∞·ªõc ƒë√£ b·ªã leak sang request sau. N·∫øu ·ªü t·∫•t c·∫£ c√°c request, tr∆∞·ªõc khi x·ª≠ l√Ω ta ƒë·ªÅu set <code>I18n.locale</code> th√¨ vi·ªác leak tr√™n s·∫Ω √≠t ·∫£nh h∆∞·ªüng h∆°n.</p><p>Tuy nhi√™n h√£y th·ª≠ t∆∞·ªüng t∆∞·ª£ng khi app c·ªßa b·∫°n c√≥ ch·ª©a c·∫£ code admin v√† api, b√™n admin c√≥ th·ªÉ ƒë·ªïi ng√¥n ng·ªØ, c√≤n api th√¨ kh√¥ng, th√¨ k·∫øt qu·∫£ s·∫Ω ra sao. Khi admin ƒë·ªïi ng√¥n ng·ªØ, t√¨nh c·ªù, 1 user v√¥ ph√∫c n√†o ƒë√≥ request t·ªõi tr√∫ng c√°i thread v·ª´a handle vi·ªác admin ƒë·ªïi ng√¥n ng·ªØ, v√† API s·∫Ω tr·∫£ v·ªÅ locale c·ªßa √¥ng admin kia :v</p><p>Ch√≠nh v√¨ v·∫≠y, ·ªü docs c·ªßa Rails c≈©ng c√≥ recommend ch√∫ng ta x·ª≠ l√Ω chuy·ªÉn locale b·∫±ng <code>I18n.with_locale</code>, c√°c b·∫°n c√≥ th·ªÉ xem t·∫°i <a href="https://guides.rubyonrails.org/i18n.html#managing-the-locale-across-requests" target="_blank" rel="noopener noreferrer">ƒë√¢y</a></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">around_action :switch_locale</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">def switch_locale(&amp;action)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  locale = params[:locale] || I18n.default_locale</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  I18n.with_locale(locale, &amp;action)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>T√∫m v√°y l·∫°i l√† multi-threading h·ªó tr·ª£ concurrent r·∫•t t·ªët, tuy nhi√™n c≈©ng ·∫©n ch·ª©a 1 v√†i v·∫•n ƒë·ªÅ. N√™n s·∫Ω c·∫ßn ch√∫ √Ω h∆°n khi code.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="23-multi-processing"></a>2.3. Multi-processing<a class="hash-link" href="#23-multi-processing" title="Direct link to heading">#</a></h3><p>M√°y t√≠nh hi·ªán nay ƒëa s·ªë ƒë·ªÅu c√≥ kh√° nhi·ªÅu core, v√† ƒë·ªÅu h·ªó tr·ª£ ƒëa nhi·ªám ƒë·ªÉ t·ªëi ∆∞u ho√° vi·ªác x·ª≠ l√Ω song song. V·∫≠y v·ªõi webserver th√¨ sao? C√≥ c·∫ßn ch·ª©, multi-processing gi√∫p ta c√≥ th·ªÉ x·ª≠ l√Ω th√™m nhi·ªÅu request ƒë·ªìng th·ªùi h∆°n n·ªØa. Tr·ª´ khi server c·ªßa ta qu√° y·∫øu, ch·ª© kh√¥ng th√¨ t·ªôi g√¨, nh√† ch·∫£ c√≥ g√¨ ngo√†i core m√† l·∫°i ch·∫°y ƒë∆°n nh√¢n th√¨ ph√≠ c·ªßa gi·ªùi qu√° :v</p><p>M·∫∑c ƒë·ªãnh Puma s·∫Ω ch·∫°y ·ªü single mode, khi ƒë√≥ ch·ªâ c√≥ 1 process, process n√†y s·∫Ω ƒë·∫£m nh·∫≠n h·∫øt t·ª´ vi·ªác l∆∞u code c·ªßa app, ti·∫øp nh·∫≠n request, ... sau ƒë√≥ s·∫Ω ƒë·∫©y request sang cho c√°c thread x·ª≠ l√Ω nh∆∞ ƒë√£ m√¥ t·∫£ ·ªü tr√™n.</p><p>C√≤n ƒë·ªëi v·ªõi cluster mode, tr∆∞·ªõc h·∫øt Puma s·∫Ω t·∫°o ra m·ªôt master process. T·ª´ process n√†y, d·ª±a v√†o gi√° tr·ªã c·ªßa config d∆∞·ªõi, Puma s·∫Ω <em>fork</em> ƒë·ªÉ t·∫°o ra s·ªë process t∆∞∆°ng ·ª©ng, hay c√≤n g·ªçi l√† <em>worker</em>.</p><div class="codeBlockContainer_K1bP"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_eoMF">config/puma.rb</div><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar codeBlockWithTitle_2JqI"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">workers ENV.fetch(&quot;WEB_CONCURRENCY&quot;) { 2 }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>L·∫°i n√≥i v·ªÅ fork, ƒë√¢y l√† qu√° tr√¨nh m√† 1 process t·∫°o ra 1 process m·ªõi, g·ªçi l√† <em>child process</em>. M·ªói child process ƒë·ªÅu c√≥ process id (PID) ri√™ng bi·ªát, v√† m·ªôt m√¥i tr∆∞·ªùng ri√™ng t√°ch bi·ªát ho√†n to√†n v·ªõi parent process (source code, memory, stack, ...). Kh√¥ng nh∆∞ thread v·∫´n share code v·ªõi process, nh∆∞ng c√≥ stack, register ri√™ng. Do v·∫≠y, c√≥ th·ªÉ n√≥i forking an to√†n v√† b·∫£o m·∫≠t h∆°n so v·ªõi multi-thread.</p><p>Quay tr·ªü l·∫°i v·ªõi Puma, ·ªü cluster mode, master process ch·ªâ ƒë·∫£m nh·∫≠n vi·ªác ti·∫øp nh·∫≠n request, sau ƒë√≥ s·∫Ω b·∫Øn sang c√°c worker ƒë·ªÉ ch√∫ng t·ª± x·ª≠ v·ªõi c√°c thread m√† ch√∫ng spawn. C√°c worker c·ªßa Puma ƒë·ªÅu c√≥ 1 b·∫£n copy source code app ri√™ng, n√™n khi ch·∫°y nhi·ªÅu worker, h√£y ch·∫Øc ch·∫Øn l√† server c·ªßa b·∫°n c√≥ ƒë·ªß RAM :v</p><p>·ªû Ruby, c√≥ th·ªÉ ki·ªÉm tra xem app c·ªßa ta ƒëang ch·∫°y ·ªü process n√†o b·∫±ng c√°ch s·ª≠ d·ª•ng</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Process.pid  # Current child process</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Process.ppid # Parent process</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>H√£y th·ª≠ ·ªü app Rails c·ªßa ta xem</p><div class="codeBlockContainer_K1bP"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_eoMF">app/controllers/homes_controller.rb</div><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar codeBlockWithTitle_2JqI"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">class HomesController &lt; ApplicationController</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  def show</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Rails.logger.info(&quot;Current: #{Process.pid}. Parent: #{Process.ppid}&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    head :ok</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_eoMF">config/puma.rb</div><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar codeBlockWithTitle_2JqI"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">workers 2</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_eoMF">log/development.log</div><div class="codeBlockContent_hGly log"><div tabindex="0" class="prism-code language-log codeBlock_23N8 thin-scrollbar codeBlockWithTitle_2JqI"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Processing by HomesController#show as */*</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Current: 128. Parent: 1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Processing by HomesController#show as */*</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Current: 129. Parent: 1</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><div tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">ps</span><span class="token plain"> aux</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># root         1  0.5  7.1 236000 145864 pts/0   Ssl+ 03:28   0:04 puma 5.3.1 (tcp://0.0.0.0:3000) [app]</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># root         7  0.0  0.1   3544  3192 pts/1    Ss   03:29   0:00 zsh</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># root       128  0.0  6.9 288680 142008 pts/0   Sl+  03:29   0:00 puma: cluster worker 0: 1 [app]</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># root       129  0.0  6.9 288720 142116 pts/0   Sl+  03:29   0:00 puma: cluster worker 1: 1 [app]</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># root       219  0.0  0.0   1640   856 pts/1    R+   03:40   0:00 ps aux</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="3-k·∫øt-lu·∫≠n"></a>3. K·∫øt lu·∫≠n<a class="hash-link" href="#3-k·∫øt-lu·∫≠n" title="Direct link to heading">#</a></h2><p>C·∫£ multi-threading v√† multi-processing ƒë·ªÅu quan tr·ªçng, ch√∫ng g√≥p ph·∫ßn gi√∫p app ta x·ª≠ l√Ω ƒëc concurrent request. Hy v·ªçng b√†i vi·∫øt c√≥ th·ªÉ gi√∫p √≠ch cho c√°c b·∫°n √≠t nhi·ªÅu.</p><p>Ngo√†i ra, v·ªÅ v·∫•n ƒë·ªÅ set s·ªë worker v√† thread ·ªü ph·∫ßn ƒë·∫ßu ƒë√£ n√≥i, t·ªët nh·∫•t ch·∫Øc v·∫´n l√†:</p><ul><li><code>WEB_CONCURRENCY</code> = vcore, ngo√†i ra c√≤n ph·ª• thu·ªôc v√†o RAM n·ªØa</li><li><code>RAILS_MAX_THREADS</code> kh√¥ng c√≥ con s·ªë c·ª• th·ªÉ, ph·ª• thu·ªôc v√†o RAM v√† CPU, nhi·ªÅu RAM, CPU kho·∫ª th√¨ set ƒë∆∞·ª£c c√†ng nhi·ªÅu, nh∆∞ng c≈©ng kh√° l√† h√™n xui, ph·∫£i ti·∫øn h√†nh test r·ªìi m·ªõi cƒÉn ch·ªânh con s·ªë ph√π h·ª£p ƒë∆∞·ª£c =))</li></ul><p>N·∫øu c√≥ sai s√≥t g√¨ c√°c b·∫°n c·ª© g·∫°ch ƒë√° tho·∫£i m√°i √† :v chi ti·∫øt c√≥ th·ªÉ tham kh·∫£o ·ªü <a href="https://devcenter.heroku.com/articles/deploying-rails-applications-with-the-puma-web-server#workers" target="_blank" rel="noopener noreferrer">ƒë√¢y</a></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="4-tham-kh·∫£o"></a>4. Tham kh·∫£o<a class="hash-link" href="#4-tham-kh·∫£o" title="Direct link to heading">#</a></h2><ul><li><a href="https://www.speedshop.co/2015/07/29/scaling-ruby-apps-to-1000-rpm.html" target="_blank" rel="noopener noreferrer">https://www.speedshop.co/2015/07/29/scaling-ruby-apps-to-1000-rpm.html</a></li><li><a href="https://devcenter.heroku.com/articles/concurrency-and-database-connections" target="_blank" rel="noopener noreferrer">https://devcenter.heroku.com/articles/concurrency-and-database-connections</a></li><li><a href="https://devcenter.heroku.com/articles/deploying-rails-applications-with-the-puma-web-server" target="_blank" rel="noopener noreferrer">https://devcenter.heroku.com/articles/deploying-rails-applications-with-the-puma-web-server</a></li><li><a href="http://www.geekride.com/fork-forking-vs-threading-thread-linux-kernel/" target="_blank" rel="noopener noreferrer">http://www.geekride.com/fork-forking-vs-threading-thread-linux-kernel/</a></li><li><a href="https://www.studytonight.com/operating-system/multithreading" target="_blank" rel="noopener noreferrer">https://www.studytonight.com/operating-system/multithreading</a></li><li><a href="https://www.tutorialspoint.com/how-to-create-a-process-in-linux#:~:text=A%20new%20process%20can%20be,newly%20is%20called%20child%20process" target="_blank" rel="noopener noreferrer">https://www.tutorialspoint.com/how-to-create-a-process-in-linux#:~:text=A%20new%20process%20can%20be,newly%20is%20called%20child%20process</a>.</li></ul></div><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog/tags/puma">puma</a><a class="margin-horiz--sm" href="/blog/tags/ruby-on-rails">ruby-on-rails</a><a class="margin-horiz--sm" href="/blog/tags/multi-threading">multi-threading</a><a class="margin-horiz--sm" href="/blog/tags/multi-processing">multi-processing</a></div><div class="col text--right"><a aria-label="Read more about C√πng t√¨m hi·ªÉu v·ªÅ Puma (Ruby on Rails)" href="/blog/cung-tim-hieu-ve-puma-ruby-on-rails"><strong>Read More</strong></a></div></footer></article><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_GeHD"><a href="/blog/cung-tim-hieu-ve-actiontext-trong-rails-6">C√πng t√¨m hi·ªÉu v·ªÅ ActionText trong Rails 6</a></h2><div class="margin-vert--md"><time datetime="2019-07-20T00:00:00.000Z" class="blogPostDate_fNvV">July 20, 2019 ¬∑ 11 min read</time></div><div class="avatar margin-vert--md"><a href="https://github.com/moonlight8978" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img src="https://avatars.githubusercontent.com/u/26299310?v=4" alt="L√™ Sƒ© B√≠ch"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/moonlight8978" target="_blank" rel="noopener noreferrer">L√™ Sƒ© B√≠ch</a></h4><small class="avatar__subtitle">Ruby on Rails/React Developer</small></div></div></header><div class="markdown"><p>Rails 6 ƒë√£ b∆∞·ªõc v√†o giai ƒëo·∫°n beta v·ªõi phi√™n b·∫£n <a href="https://github.com/rails/rails/releases/tag/v6.0.0.rc1" target="_blank" rel="noopener noreferrer">v6.0.0.rc1</a>. RC l√† vi·∫øt t·∫Øt c·ªßa <strong>R</strong>elease <strong>C</strong>andidate, ƒë√¢y l√† phi√™n b·∫£n m√† c√≥ x√°c su·∫•t tr·ªü th√†nh final release r·∫•t cao. Ta c√≥ th·ªÉ √°p d·ª•ng n√≥ v√†o d·ª± √°n ngay k·ªÉ t·ª´ b√¢y gi·ªù m√† kh√¥ng c·∫ßn lo s·ª£ c√≥ nh·ªØng breaking change.</p><p>N·∫øu b·∫°n s·ª≠ d·ª•ng Docker, m√¨nh khuy√™n n√™n s·ª≠ d·ª•ng ruby 2.6.3, v√¨ tr∆∞·ªõc ƒë√¢y m√¨nh ƒë√£ d√πng th·ª≠ ruby:2.7.0-preview1-alpine3.10 th√¨ kh√° nhi·ªÅu l·ªói khi up server, m√† ch·∫£ bi·∫øt ph·∫£i fix sao :sad:</p><p>·ªû Rails 6, c√≥ kh√° nhi·ªÅu t√≠nh nƒÉng m·ªõi hay ho:</p><ul><li>Action Text</li><li>Parallel Testing</li><li>Action Model custom error message format.</li><li>v√¢n v√¢n m√¢y m√¢y...</li></ul><p>·ªû b√†i n√†y, m√¨nh s·∫Ω ch·ªâ t·∫≠p trung ƒë·ªÅ c·∫≠p t·ªõi Action Text. ƒê√¢y l√† m·ªôt package gi√∫p ta x√¢y d·ª±ng WYSIWYG editor m·ªôt c√°ch nhanh ch√≥ng, h∆°n n·ªØa, vi·ªác upload c≈©ng ƒë∆∞·ª£c integrate v·ªõi Active Storage.</p><p><strong>Ch√∫ √Ω:</strong> B√†i kh√° d√†i v√† embed nhi·ªÅu code :v</p><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="c√°ch-d√πng"></a>C√°ch d√πng<a class="hash-link" href="#c√°ch-d√πng" title="Direct link to heading">#</a></h1><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="c√†i-ƒë·∫∑t-v√†-s·ª≠-d·ª•ng"></a>C√†i ƒë·∫∑t v√† s·ª≠ d·ª•ng<a class="hash-link" href="#c√†i-ƒë·∫∑t-v√†-s·ª≠-d·ª•ng" title="Direct link to heading">#</a></h2><p>V√¨ l√† Rails n√™n c√°ch s·ª≠ d·ª•ng r·∫•t ƒë∆°n gi·∫£n, nh∆∞ng ta s·∫Ω ch·∫£ bi·∫øt n√≥ ch·∫°y c√°i g√¨ ƒë·∫±ng sau c·∫£ =))</p><p>C√†i ƒë·∫∑t Action Text b·∫±ng CLI command sau:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><div tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">rails action_text:install</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Nh·ªõ h√£y ch·∫°y th√™m c·∫£ command install Active Storage n·ªØa.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><div tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">rails active_storage:install</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>ƒê·ªÉ √°p d·ª•ng cho field <code>content</code> c·ªßa model <code>Post</code>, ta s·∫Ω d√πng t·ªõi macro <code>has_rich_text</code></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">class CreatePosts &lt; ActiveRecord::Migration[6.0]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  def change</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    create_table :posts do |t|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      t.string :content</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      t.string :category</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      t.timestamps</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><code>content</code> ·ªü ƒë√¢y m√¨nh d√πng string, nh∆∞ng khuy·∫øn kh√≠ch d√πng text h∆°n.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">class Post &lt; ApplicationRecord</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    has_rich_text :content</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Tr√™n form, ta ch·ªâ vi·ªác d√πng <code>rich_text_area</code></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly erb"><div tabindex="0" class="prism-code language-erb codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;%= form_with(model: @post) do |form| %&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &lt;div class=&quot;field&quot;&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;%= form.label :content %&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;%= form.rich_text_area :content %&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &lt;/div&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;% end %&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Khi permit params, ta c≈©ng l√†m nh∆∞ bao field kh√°c</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">class PostsController &lt; ApplicationController</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  def post_params</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    params.require(:post).permit(:category, :content)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Cu·ªëi c√πng ta hi·ªÉn th·ªã d·ªØ li·ªáu nh∆∞ sau:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly erb"><div tabindex="0" class="prism-code language-erb codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;%= @post.content %&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>C√¢u l·ªánh tr√™n th·ª±c ch·∫•t ƒëang ng·∫ßm g·ªçi t·ªõi <code>@post.content.to_s</code></p><p>ƒê√¢y l√† s·∫£n ph·∫©m c·ªßa ta:</p><p>Form t·∫°o post v·ªõi WYSIWYG editor - S·ª≠ d·ª•ng Trix editor, do Basecamp ph√°t tri·ªÉn, c√¢y nh√† l√° v∆∞·ªùn lu√¥n.</p><p>C√≥ th·ªÉ k√©o th·∫£ file v√†o, file ƒë√≥ s·∫Ω ƒë∆∞·ª£c upload b·∫±ng Active Storage.</p><p><img src="https://images.viblo.asia/77b9bd23-5ba3-426b-b6fc-cac02edb0b42.png"></p><p>Hi·ªÉn th·ªã d·ªØ li·ªáu ·ªü m√†n h√¨nh detail</p><p><img src="https://images.viblo.asia/6b1b8da0-ca7f-468b-9705-444a8cb2d736.png"></p><p>C√°c b·∫°n th·∫•y sao? C√° nh√¢n m√¨nh th·∫•y x·∫•u nh∆∞ c·ªù h√≥ v·∫≠y =)) Tuy nhi√™n ta c√≥ th·ªÉ styling cho n√≥.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="styling"></a>Styling<a class="hash-link" href="#styling" title="Direct link to heading">#</a></h2><p>Rails ƒëang c√≥ s·∫µn m·ªôt v√†i style c∆° b·∫£n cho n√≥ trong file <code>app/assets/stylesheets/actiontext.scss</code>, ta c√≥ th·ªÉ s·ª≠a n√≥ ƒë·ªÉ cho ƒë·∫πp h∆°n.</p><p>V·ªõi ƒë·ªëng tool c·ªßa editor th√¨ c√≥ th·ªÉ d√πng selector <code>.trix-button-row</code></p><p>V·ªõi template attachment (nh∆∞ c√°i <code>monaco.ttf</code> ·ªü tr√™n), ta c≈©ng c√≥ th·ªÉ custom l·∫°i, Rails cung c·∫•p s·∫µn template m·∫∑c ƒë·ªãnh ·ªü file <code>app/views/active_storage/blobs/_blob.html.erb</code></p><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="t√¨m-hi·ªÉu-s·ª±-ma-gi√°o"></a>T√¨m hi·ªÉu s·ª± ma gi√°o<a class="hash-link" href="#t√¨m-hi·ªÉu-s·ª±-ma-gi√°o" title="Direct link to heading">#</a></h1><p>R·ªìi ta ƒë√£ l∆∞·ªõt qua c√°ch s·ª≠ d·ª•ng n√≥, nh∆∞ng m√† c√≥ qu√° nhi·ªÅu magic.</p><p>Li·ªáu b·∫°n c√≥ t·ª± ƒë·∫∑t ra nh·ªØng c√¢u h·ªèi th·∫ø n√†y hay kh√¥ng?</p><ul><li><p>Kh√¥ng bi·∫øt c√°ch l∆∞u tr·ªØ d·ªØ li·ªáu c·ªßa n√≥ nh∆∞ th·∫ø n√†o?</p></li><li><p>L√†m sao m√† c√°i file trong kia integrate ƒë∆∞·ª£c v·ªõi Active Storage?</p></li><li><p>V√¨ sao l·∫°i c√≥ th·ªÉ custom l·∫°i nh·ªØng attachment b·∫±ng template?</p></li><li><p>v√¢n v√¢n m√¢y m√¢y...</p></li></ul><p>Ta s·∫Ω b·∫Øt tay v√†o t√¨m hi·ªÉu n√≥.</p><p>H√£y b·∫Øt ƒë·∫ßu v·ªõi <code>has_rich_text</code></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="macro-has_rich_text"></a>Macro <code>has_rich_text</code><a class="hash-link" href="#macro-has_rich_text" title="Direct link to heading">#</a></h2><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># https://github.com/rails/rails/blob/6a5c8b91998c56e50b5cc934d968947cd319f735/actiontext/lib/action_text/attribute.rb#L26</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">def has_rich_text(name)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  class_eval &lt;&lt;-CODE, __FILE__, __LINE__ + 1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    def #{name}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      rich_text_#{name} || build_rich_text_#{name}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    def #{name}=(body)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      self.#{name}.body = body</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  CODE</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  has_one :&quot;rich_text_#{name}&quot;, -&gt; { where(name: name) },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    class_name: &quot;ActionText::RichText&quot;, as: :record, inverse_of: :record, autosave: true, dependent: :destroy</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  # ... codes</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>D·ªÖ d√†ng th·∫•y r·∫±ng ƒë√¢y l√† 1 macro gi√∫p ƒë·ªãnh nghƒ©a getter, setter, v√† c·∫£ association <code>has_one :rich_text_...</code> v·ªõi <code>ActionText::RichText</code>.</p><p>V·∫≠y th√¨ khi ta g·ªçi <code>@post.content</code>, th·ª±c ch·∫•t l√† ta ƒëang g·ªçi t·ªõi <code>@post.rich_text_content</code>.</p><p>V√† n√≥ c≈©ng ch·ªâ ra 1 ƒëi·ªÅu n·ªØa l√† Rails d√πng 1 b·∫£ng ri√™ng ƒë·ªÉ l∆∞u l·∫°i ƒë·ªëng rich text c·ªßa ta.</p><p>H√£y d√†nh ch√∫t th·ªùi gian nh√¨n v√†o th∆∞ m·ª•c <code>db/migrate</code>, ta s·∫Ω th·∫•y file sau:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># db/migrate/20190718085159_create_action_text_tables.action_text.rb</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># This migration comes from action_text (originally 20180528164100)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">class CreateActionTextTables &lt; ActiveRecord::Migration[6.0]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  def change</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    create_table :action_text_rich_texts do |t|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      t.string     :name, null: false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      t.text       :body, size: :long</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      t.references :record, null: false, polymorphic: true, index: false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      t.timestamps</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      t.index [ :record_type, :record_id, :name ], name: &quot;index_action_text_rich_texts_uniqueness&quot;, unique: true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Qu·∫£ th·∫≠t l√† v·∫≠y, <code>body</code> ch√≠nh l√† n∆°i l∆∞u tr·ªØ ƒë·ªëng text c·ªßa ta, c√≤n <code>name</code>, <code>record_id</code>, v√† <code>record_type</code> l√† nh·ªØng attribute cho polymorphic association, kh√° quen thu·ªôc n·∫øu b·∫°n ƒë√£ d√πng Active storage</p><p>Ta s·∫Ω ƒëi ƒë·∫øn b∆∞·ªõc ti·∫øp theo <code>rich_text_area</code></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="rails-x·ª≠-l√Ω-l∆∞u-tr·ªØ-rich-text-nh∆∞-th·∫ø-n√†o"></a>Rails x·ª≠ l√Ω, l∆∞u tr·ªØ rich text nh∆∞ th·∫ø n√†o?<a class="hash-link" href="#rails-x·ª≠-l√Ω-l∆∞u-tr·ªØ-rich-text-nh∆∞-th·∫ø-n√†o" title="Direct link to heading">#</a></h2><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># https://github.com/rails/rails/blob/cc1a5d5620c4cd952b27f6c1bbd16d8780a34d0e/actiontext/app/helpers/action_text/tag_helper.rb#L20</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">def rich_text_area_tag(name, value = nil, options = {})</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  options = options.symbolize_keys</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  options[:input] ||= &quot;trix_input_#{ActionText::TagHelper.id += 1}&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  options[:class] ||= &quot;trix-content&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  options[:data] ||= {}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  options[:data][:direct_upload_url] = main_app.rails_direct_uploads_url</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  options[:data][:blob_url_template] = main_app.rails_service_blob_url(&quot;:signed_id&quot;, &quot;:filename&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  editor_tag = content_tag(&quot;trix-editor&quot;, &quot;&quot;, options)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  input_tag = hidden_field_tag(name, value, id: options[:input])</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  input_tag + editor_tag</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>C√≥ th·ªÉ th·∫•y ƒë∆°n gi·∫£n n√≥ ch·ªâ init c√°i trix editor cho ta th√¥i.</p><p>Vi·ªác k√©o th·∫£ file, upload ho√†n to√†n ƒë∆∞·ª£c handle b·ªüi trix editor, ta kh√¥ng custom ƒë∆∞·ª£c template sau khi file upload th√†nh c√¥ng.</p><p>Tuy nhi√™n Action Text c√≥ th√™m 1 callback sau khi file ƒë∆∞·ª£c upload th√†nh c√¥ng:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><div tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// https://github.com/rails/rails/blob/cc1a5d5620c4cd952b27f6c1bbd16d8780a34d0e/actiontext/app/javascript/actiontext/attachment_upload.js#L26</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">attachment</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">setAttributes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  sgid</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> attributes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">attachable_sgid</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  url</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">createBlobUrl</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">attributes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">signed_id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> attributes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">filename</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>ƒë√¢y l√† 1 step r·∫•t quan tr·ªçng, nh∆∞ng ta s·∫Ω ch∆∞a c·∫ßn ch√∫ √Ω t·ªõi n√≥ v·ªôi. Attachment c·ªßa ta sau khi upload th√†nh c√¥ng s·∫Ω tr√¥ng nh∆∞ sau:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly html"><div tabindex="0" class="prism-code language-html codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">figure</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">  </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">contenteditable</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">false</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">  </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">data-trix-attachment</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&#x27;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">{</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">contentType</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">:</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">application/zip</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">,</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">filename</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">:</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">monaco.ttf-master.zip</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">,</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">filesize</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">:88996,</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">sgid</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">:</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">BAh7CEkiCGdpZAY6BkVUSSIvZ2lkOi8vYXBwL0FjdGl2ZVN0b3JhZ2U6OkJsb2IvOD9leHBpcmVzX2luBjsAVEkiDHB1cnBvc2UGOwBUSSIPYXR0YWNoYWJsZQY7AFRJIg9leHBpcmVzX2F0BjsAVDA=--79d2aa5a0af367233a5420a4f0ae02657d3910ab</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">,</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">url</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">:</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">http://localhost:60100/rails/active_storage/blobs/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaHBEUT09IiwiZXhwIjpudWxsLCJwdXIiOiJibG9iX2lkIn19--e79bebbfa0f10319d319411c129291d12e752d22/monaco.ttf-master.zip</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">}</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&#x27;</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">  </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">data-trix-content-type</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">application/zip</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">  </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">data-trix-id</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">1108</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">  </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">attachment attachment--file attachment--zip</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)"></span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">figcaption</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">attachment__caption</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">span</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">attachment__name</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">monaco.ttf-master.zip</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">span</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">span</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">attachment__size</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">86.91 KB</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">span</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">figcaption</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">figure</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Ti·∫øp ƒë·∫øn l√† submit d·ªØ li·ªáu, v·∫≠y Rails s·∫Ω g·ª≠i g√¨ l√™n?</p><p>ƒê∆°n gi·∫£n l√† Rails s·∫Ω g·ª≠i t·∫•t c·∫£ nh·ªØng g√¨ b√™n trong <code>&lt;trix-editor&gt;&lt;/trix-editor&gt;</code></p><p>Inspect th·ª≠ params, ta s·∫Ω th·∫•y:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">post_params[:content]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># =&gt; &quot;&lt;div&gt;&lt;a href=\&quot;http://localhost:60100/posts/new\&quot;&gt;http://localhost:60100/posts/new&lt;/a&gt;&lt;/div&gt;&lt;div&gt;&lt;strong&gt;Hello world&lt;br&gt;&lt;/strong&gt;&lt;figure data-trix-attachment=\&quot;{&amp;quot;content&amp;quot;:&amp;quot;&lt;figure class=\\&amp;quot;attachment attachment--file attachment--zip\\&amp;quot;&gt;\\n\\n  &lt;figcaption class=\\&amp;quot;attachment__caption\\&amp;quot;&gt;\\n      &lt;span class=\\&amp;quot;attachment__name\\&amp;quot;&gt;monaco.ttf-master.zip&lt;/span&gt;\\n      &lt;span class=\\&amp;quot;attachment__size\\&amp;quot;&gt;86.9 KB&lt;/span&gt;\\n  &lt;/figcaption&gt;\\n&lt;/figure&gt;\\n&amp;quot;,&amp;quot;contentType&amp;quot;:&amp;quot;application/zip&amp;quot;,&amp;quot;filename&amp;quot;:&amp;quot;monaco.ttf-master.zip&amp;quot;,&amp;quot;filesize&amp;quot;:88996,&amp;quot;sgid&amp;quot;:&amp;quot;BAh7CEkiCGdpZAY6BkVUSSIvZ2lkOi8vYXBwL0FjdGl2ZVN0b3JhZ2U6OkJsb2IvNz9leHBpcmVzX2luBjsAVEkiDHB1cnBvc2UGOwBUSSIPYXR0YWNoYWJsZQY7AFRJIg9leHBpcmVzX2F0BjsAVDA=--97b885c24fd3d87464525f34a7b6ea117e4c72e6&amp;quot;,&amp;quot;url&amp;quot;:&amp;quot;http://localhost:60100/rails/active_storage/blobs/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaHBEQT09IiwiZXhwIjpudWxsLCJwdXIiOiJibG9iX2lkIn19--940badfc5aee704ef3f98085f87f909baf870660/monaco.ttf-master.zip&amp;quot;}\&quot; data-trix-content-type=\&quot;application/zip\&quot; class=\&quot;attachment attachment--content attachment--zip\&quot;&gt;&lt;figure class=\&quot;attachment attachment--file attachment--zip\&quot;&gt;\r\n\r\n  &lt;figcaption class=\&quot;attachment__caption\&quot;&gt;\r\n      &lt;span class=\&quot;attachment__name\&quot;&gt;monaco.ttf-master.zip&lt;/span&gt;\r\n      &lt;span class=\&quot;attachment__size\&quot;&gt;86.9 KB&lt;/span&gt;\r\n  &lt;/figcaption&gt;\r\n&lt;/figure&gt;\r\n&lt;figcaption class=\&quot;attachment__caption\&quot;&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;/div&gt;&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>L√†m ƒë·∫πp n√≥ ch√∫t</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly html"><div tabindex="0" class="prism-code language-html codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">div</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">a</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">href</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">http://localhost:60100/posts/new</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">http://localhost:60100/posts/new</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">a</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">div</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">div</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">strong</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">Hello world</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">br</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">/&gt;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">strong</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">figure</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">    </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">data-trix-attachment</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">...</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">    </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">data-trix-content-type</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">application/zip</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">    </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">attachment attachment--content attachment--zip</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">figure</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">attachment attachment--file attachment--zip</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">figcaption</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">attachment__caption</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">span</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">attachment__name</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">monaco.ttf-master.zip</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">span</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">span</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">attachment__size</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">86.9 KB</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">span</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">figcaption</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">figure</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">figcaption</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">attachment__caption</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">figcaption</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">figure</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">div</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>C√≥ th·ªÉ th·∫•y n√≥ kh√° gi·ªëng v·ªõi content c·ªßa <code>&lt;trix-editor&gt;&lt;/trix-editor&gt;</code> ƒë√∫ng kh√¥ng n√†o?</p><p>Ta s·∫Ω save ƒë·ªëng params n√†y l·∫°i, v√† xem DB ta ch·ª©a g√¨?</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sql"><div tabindex="0" class="prism-code language-sql codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">app_development</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># SELECT body FROM action_text_rich_texts WHERE id = 3;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly html"><div tabindex="0" class="prism-code language-html codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">div</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">a</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">href</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">http://localhost:60100/posts/new</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">http://localhost:60100/posts/new</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">a</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">div</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">div</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">strong</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">Hello world</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">br</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">/&gt;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">strong</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">action-text-attachment</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">    </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">sgid</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">BAh7CEkiCGdpZAY6BkVUSSIvZ2lkOi8vYXBwL0FjdGl2ZVN0b3JhZ2U6OkJsb2IvNz9leHBpcmVzX2luBjsAVEkiDHB1cnBvc2UGOwBUSSIPYXR0YWNoYWJsZQY7AFRJIg9leHBpcmVzX2F0BjsAVDA=--97b885c24fd3d87464525f34a7b6ea117e4c72e6</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">    </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">content-type</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">application/zip</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">    </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">url</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">http://localhost:60100/rails/active_storage/blobs/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaHBEQT09IiwiZXhwIjpudWxsLCJwdXIiOiJibG9iX2lkIn19--940badfc5aee704ef3f98085f87f909baf870660/monaco.ttf-master.zip</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">    </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">filename</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">monaco.ttf-master.zip</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">    </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">filesize</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">88996</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">action-text-attachment</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">div</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>C√°c th·∫ª kh√°c th√¨ v·∫´n v·∫≠y, tuy nhi√™n attachments c·ªßa ta l·∫°i c√≥ m·ªôt ch√∫t kh√°c bi·ªát. ·ªû ƒë√¢y ƒë·ªëng <code>figure</code> ƒë√£ ƒë∆∞·ª£c minify l·∫°i th√†nh <code>action-text-attachment </code> ƒë·ªÉ cho g·ªçn h∆°n.</p><p>H√£y c√πng ƒëi·ªÅu tra xem t·∫°i sao l·∫°i nh∆∞ v·∫≠y? Tr∆∞·ªõc ti√™n ta v√†o xem <code>ActionText::RichText</code> c·ªßa ta ch·ª©a g√¨ ma gi√°o</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># https://github.com/rails/rails/blob/027085a5972a798cfea60f829a9edabbd67a2818/actiontext/app/models/action_text/rich_text.rb#L11</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">class ActionText::RichText &lt; ActiveRecord::Base</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  serialize :body, ActionText::Content</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>V·∫≠y l√† <code>body</code> c·ªßa ta ƒëang ƒë∆∞·ª£c serialize b·ªüi <code>ActionText::Content</code>, m√≤ ƒë·∫øn ƒë√≥ ti·∫øp th√¥i.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># https://github.com/rails/rails/blob/df8ee09ce71338cdf9816225df1bdebc707f3560/actiontext/lib/action_text/content.rb#L15</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">class ActionText::Content</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  class &lt;&lt; self</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    def fragment_by_canonicalizing_content(content)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      fragment = ActionText::Attachment.fragment_by_canonicalizing_attachments(content)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      fragment = ActionText::AttachmentGallery.fragment_by_canonicalizing_attachment_galleries(fragment)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      fragment</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  def initialize(content = nil, options = {})</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    options.with_defaults! canonicalize: true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    if options[:canonicalize]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      @fragment = self.class.fragment_by_canonicalizing_content(content)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    else</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      @fragment = ActionText::Fragment.wrap(content)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Ta s·∫Ω quan t√¢m t·ªõi h√†m <code>initialize</code> tr∆∞·ªõc, khi serialize, m·∫∑c ƒë·ªãnh l√† ta ƒëang kh√¥ng d√πng tham s·ªë, v·∫≠y l√† options s·ª≠ d·ª•ng s·∫Ω l√† <code>canonicalize: true</code>, xem ti·∫øp <code>fragment_by_canonicalizing_content</code> n√†o. C√≥ v·∫ª l·∫°i ph·∫£i m√≤ <code>fragment_by_canonicalizing_attachments</code> ti·∫øp @@</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># https://github.com/rails/rails/blob/df8ee09ce7/actiontext/lib/action_text/attachment.rb#L11</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">class ActionText::Attachment</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  TAG_NAME = &quot;action-text-attachment&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  SELECTOR = TAG_NAME</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  class &lt;&lt; self</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    def fragment_by_canonicalizing_attachments(content)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      fragment_by_minifying_attachments(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        fragment_by_converting_trix_attachments(content)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      )</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><code>fragment_by_minifying_attachments</code>, b·∫°n c√≥ th·∫•y t·ª´ minify kh√¥ng? C√≥ v·∫ª ta ƒëang ƒëi ƒë√∫ng h∆∞·ªõng. H√£y ti·∫øp t·ª•c, nh∆∞ng h√£y b·∫Øt ƒë·∫ßu b·∫±ng <code>fragment_by_converting_trix_attachments</code></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># https://github.com/rails/rails/blob/df8ee09ce71338cdf9816225df1bdebc707f3560/actiontext/lib/action_text/attachments/trix_conversion.rb#L9</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">module ActionText::Attachments::TrixConversion</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  class_methods do</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    def fragment_by_converting_trix_attachments(content)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      Fragment.wrap(content).replace(TrixAttachment::SELECTOR) do |node|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        from_trix_attachment(TrixAttachment.new(node))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>N√¥m na l√† ƒëo·∫°n n√†y s·∫Ω replace to√†n b·ªô <code>ActionText::TrixAttachment::SELECTOR = &quot;[data-trix-attachment]</code> b·∫±ng th·∫ª <code>ActionText::Attachment::SELECTOR = &quot;action-text-attachment&quot;</code>.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">module ActionText::Attachments::Minification</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  class_methods do</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    def fragment_by_minifying_attachments(content)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      Fragment.wrap(content).replace(ActionText::Attachment::SELECTOR) do |node|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        node.tap { |n| n.inner_html = &quot;&quot; }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>H√†m <code>fragment_by_minifying_attachments</code> c·ªßa ch√∫ng ta s·∫Ω remove to√†n b·ªô inner content c·ªßa th·∫ª <code>action-text-attachment</code>.</p><p>Sau m·ªôt h·ªìi l√≤ng v√≤ng, cu·ªëi c√πng ta ƒë√£ bi·∫øt ƒë∆∞·ª£c t·∫°i sao ƒë·ªëng <code>figure</code> r·ªëi r·∫Øm kia tr·ªü th√†nh <code>action-text-attachment</code> g·ªçn g√†ng h∆°n r·∫•t nhi·ªÅu.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="hi·ªÉn-th·ªã-d·ªØ-li·ªáu"></a>Hi·ªÉn th·ªã d·ªØ li·ªáu<a class="hash-link" href="#hi·ªÉn-th·ªã-d·ªØ-li·ªáu" title="Direct link to heading">#</a></h2><p>H√£y v√†o m√†n h√¨nh detail, v√† th·ª≠ inspect element, ta s·∫Ω th·∫•y attachment c·ªßa ta l·∫°i tr·ªü v·ªÅ d·∫°ng ƒë·∫ßy ƒë·ªß:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;%= @post.content =&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>ƒê√¢y l√† nh·ªØng g√¨ ta thu ƒë∆∞·ª£c.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly html"><div tabindex="0" class="prism-code language-html codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">div</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">trix-content</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">div</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">a</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">href</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">http://localhost:60100/posts/new</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">      </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">http://localhost:60100/posts/new</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">a</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">div</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">div</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">strong</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">Hello world</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">br</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">/&gt;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">strong</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">action-text-attachment</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">      </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">sgid</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">BAh7CEkiCGdpZAY6BkVUSSIvZ2lkOi8vYXBwL0FjdGl2ZVN0b3JhZ2U6OkJsb2IvNz9leHBpcmVzX2luBjsAVEkiDHB1cnBvc2UGOwBUSSIPYXR0YWNoYWJsZQY7AFRJIg9leHBpcmVzX2F0BjsAVDA=--97b885c24fd3d87464525f34a7b6ea117e4c72e6</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">      </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">content-type</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">application/zip</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">      </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">url</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">http://localhost:60100/rails/active_storage/blobs/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaHBEQT09IiwiZXhwIjpudWxsLCJwdXIiOiJibG9iX2lkIn19--940badfc5aee704ef3f98085f87f909baf870660/monaco.ttf-master.zip</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">      </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">filename</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">monaco.ttf-master.zip</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">      </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">filesize</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">88996</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">figure</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">attachment attachment--file attachment--zip</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">figcaption</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">attachment__caption</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">span</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">attachment__name</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">monaco.ttf-master.zip</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">span</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">span</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">attachment__size</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">86.9 KB</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">span</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">figcaption</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">figure</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">action-text-attachment</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">div</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">div</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>B·∫°n c√≤n nh·ªõ m√¨nh ghi ·ªü tr√™n, khi ta vi·∫øt <code>@post.content</code>, th·ª±c ch·∫•t ta ƒëang g·ªçi <code>@post.content.to_s</code> ch·ª©?</p><p>Th·ª≠ ƒë√†o s√¢u v√†o ch√∫t:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># https://github.com/rails/rails/blob/df8ee09ce7/actiontext/lib/action_text/content.rb#L90</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">def to_rendered_html_with_layout</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  renderer.render(partial: &quot;action_text/content/layout&quot;, locals: { content: self })</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">def to_s</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  to_rendered_html_with_layout</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly erb"><div tabindex="0" class="prism-code language-erb codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;%# https://github.com/rails/rails/blob/df8ee09ce7/actiontext/app/views/action_text/content/_layout.html.erb %&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;div class=&quot;trix-content&quot;&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &lt;%= render_action_text_content(content) %&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;/div&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># https://github.com/rails/rails/blob/0ec2a907545e47f816993b9fd8cabb552454b1a2/actiontext/app/helpers/action_text/content_helper.rb#L12</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">def render_action_text_content(content)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  sanitize_action_text_content(render_action_text_attachments(content))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">def sanitize_action_text_content(content)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  sanitizer.sanitize(content.to_html, tags: allowed_tags, attributes: allowed_attributes, scrubber: scrubber).html_safe</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">def render_action_text_attachments(content)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  content.render_attachments do |attachment|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    unless attachment.in?(content.gallery_attachments)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      attachment.node.tap do |node|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        node.inner_html = render(attachment, in_gallery: false).chomp</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end.render_attachment_galleries do |attachment_gallery|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    render(layout: attachment_gallery, object: attachment_gallery) do</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      attachment_gallery.attachments.map do |attachment|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        attachment.node.inner_html = render(attachment, in_gallery: true).chomp</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        attachment.to_html</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      end.join(&quot;&quot;).html_safe</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    end.chomp</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>ƒê·∫°i kh√°i l√† Rails s·∫Ω sanitize ƒë·ªëng rich text c·ªßa ta ƒë·ªÉ tr√°nh XSS attack, v√† render template ƒë·ªëi v·ªõi nh·ªØng attachment.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="integrate-v·ªõi-active-storage"></a>Integrate v·ªõi Active Storage<a class="hash-link" href="#integrate-v·ªõi-active-storage" title="Direct link to heading">#</a></h2><p>H√£y quay tr·ªü l·∫°i v·ªõi model <code>ActionText::RichText</code></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># https://github.com/rails/rails/blob/df8ee09ce7/actiontext/app/models/action_text/rich_text.rb#L14</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">class ActionText::RichText &lt; ActiveRecord::Base</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  has_many_attached :embeds</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  before_save do</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    self.embeds = body.attachments.map(&amp;:attachable) if body.present?</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Ta d·ªÖ d√†ng hi·ªÉu 1 c√°ch t·ªïng quan l√† Rails s·∫Ω ti·∫øn h√†nh extract to√†n b·ªô attachment trong body, g√°n v√†o embeds. Sau ƒë√≥ s·∫Ω save ƒë·ªëng association n√†y l·∫°i.</p><p>Th·ª≠ xem Rails s·∫Ω extract attachments ra l√†m sao.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># https://github.com/rails/rails/blob/027085a5972a798cfea60f829a9edabbd67a2818/actiontext/lib/action_text/content.rb#L53</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">def attachables</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  @attachables ||= attachment_nodes.map do |node|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ActionText::Attachable.from_node(node)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># https://github.com/rails/rails/blob/027085a5972a798cfea60f829a9edabbd67a2818/actiontext/lib/action_text/content.rb#L113</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">def attachment_nodes</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  @attachment_nodes ||= fragment.find_all(ActionText::Attachment::SELECTOR)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Rails s·∫Ω t√¨m ki·∫øm t·∫•t c·∫£ th·∫ª <code>action-text-attachment</code>, extract nh·ªØng th√¥ng tin c·∫ßn thi·∫øt ƒë·ªÉ init ƒë∆∞·ª£c <code>ActiveStorage::Blob</code> object.</p><p>Ta c·∫ßn ngh√≠a qua h√†m <code>Attachable.from_node</code> n·ªØa</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># https://github.com/rails/rails/blob/027085a5972a798cfea60f829a9edabbd67a2818/actiontext/lib/action_text/attachable.rb#L10</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">def from_node(node)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  if attachable = attachable_from_sgid(node[&quot;sgid&quot;])</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    attachable</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  elsif attachable = ActionText::Attachables::ContentAttachment.from_node(node)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    attachable</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  elsif attachable = ActionText::Attachables::RemoteImage.from_node(node)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    attachable</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  else</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ActionText::Attachables::MissingAttachable</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Trong tr∆∞·ªùng h·ª£p n√†y, Rails s·∫Ω lu√¥n extract theo strategy l√† <code>sgid</code>, c√°c b·∫°n kh√¥ng c·∫ßn quan t√¢m t·ªõi 3 nh√°nh d∆∞·ªõi l√†m g√¨ cho m·∫•t c√¥ng.</p><p>C√≤n nh·ªõ ph·∫ßn tr√™n m√¨nh ƒë√£ ƒë·ªÅ c·∫≠p t·ªõi <code>sgid</code> ch·ª©?</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//github.com/rails/rails/blob/cc1a5d5620c4cd952b27f6c1bbd16d8780a34d0e/actiontext/app/javascript/actiontext/attachment_upload.js#L26</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">https</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">attachment</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">setAttributes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  sgid</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> attributes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">attachable_sgid</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  url</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">createBlobUrl</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">attributes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">signed_id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> attributes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">filename</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Callback n√†y ƒë∆∞·ª£c g·ªçi sau khi file ƒë∆∞·ª£c upload th√†nh c√¥ng. V·∫≠y <code>sgid</code> l√† c√°i g√¨?</p><p><code>sigd</code> ƒë∆∞·ª£c encrypt t·ª´ <code>id</code> c·ªßa attachment sau khi upload. Khi g·ª≠i l√™n, server s·∫Ω decrypt n√≥ ƒë·ªÉ l·∫•y l·∫°i <code>id</code>, g√°n attachment v√†o record.</p><p>T·∫°i sao l·∫°i c·∫ßn encrypt? C√°c b·∫°n c·ª© t∆∞·ªüng t∆∞·ª£ng, n·∫øu d√πng th·∫≥ng id, do ta upload ·∫£nh tr∆∞·ªõc khi t·∫°o record, n√™n khi g·ª≠i params t·ª´ client l√™n, ch·∫Øc ch·∫Øn s·∫Ω ph·∫£i ƒë∆∞a attachment id v√†o ƒë·ªÉ server l∆∞u ƒë√∫ng association. Client n√≥ g·ª≠i ƒë√∫ng th√¨ kh√¥ng sao, nh∆∞ng n·∫øu n√≥ g·ª≠i id attachment c·ªßa ng∆∞·ªùi kh√°c th√¨ sao? Attachment ƒë√≥ s·∫Ω chuy·ªÉn ch·ªß ngay l·∫≠p t·ª©c :v C√≤n n·∫øu encrypt th√¨ user ƒë·ªë m√† m√≤ ƒë∆∞·ª£c m√£ hash c·ªßa attachment ng∆∞·ªùi kh√°c.</p><p><code>attachable_from_sgid(node[&quot;sgid&quot;])</code> s·∫Ω tr·∫£ v·ªÅ <code>ActiveStorage::Blob</code> object</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># https://github.com/rails/rails/blob/f1b8bb4e1f16e4029ddf05515db0c01942521116/actiontext/lib/action_text/attachable.rb#L22</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">def from_attachable_sgid(sgid, options = {})</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  method = sgid.is_a?(Array) ? :locate_many_signed : :locate_signed</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  record = GlobalID::Locator.public_send(method, sgid, options.merge(for: LOCATOR_NAME))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  record || raise(ActiveRecord::RecordNotFound)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>N·∫øu kh√¥ng tin, b·∫°n h√£y th·ª≠ <code>rails c</code> v√† g·ªçi h√†m:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">GlobalID::Locator.locate_signed(sgid, { for: &quot;attachable&quot; })</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="k·∫øt-lu·∫≠n"></a>K·∫øt lu·∫≠n<a class="hash-link" href="#k·∫øt-lu·∫≠n" title="Direct link to heading">#</a></h1><p><code>Action Text</code> ƒë∆∞·ª£c thi·∫øt k·∫ø kh√° hay, code g·ªçn, t·∫•t c·∫£ method ƒë·ªÅu r·∫•t ng·∫Øn, d·ªÖ hi·ªÉu.</p><p>Do l√† built-in n√™n ta c≈©ng ch·∫£ c·∫ßn c√†i c·∫Øm g√¨ th√™m m·ªát ng∆∞·ªùi. N·∫øu ƒë√£ upgrade l√™n Rails 6, b·∫°n h√£y th·ª≠ tr·∫£i nghi·ªám n√≥ xem.</p><p>C√≤n ƒë·ªëi v·ªõi phi√™n b·∫£n th·∫•p h∆°n, ta c≈©ng c√≥ th·ªÉ √°p d·ª•ng flow c·ªßa Action Text ƒë·ªÉ build m·ªôt package h·ªó tr·ª£ richtext.</p></div><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog/tags/action-text">action-text</a><a class="margin-horiz--sm" href="/blog/tags/ruby-on-rails">ruby-on-rails</a><a class="margin-horiz--sm" href="/blog/tags/web">web</a></div><div class="col text--right"><a aria-label="Read more about C√πng t√¨m hi·ªÉu v·ªÅ ActionText trong Rails 6" href="/blog/cung-tim-hieu-ve-actiontext-trong-rails-6"><strong>Read More</strong></a></div></footer></article><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_GeHD"><a href="/blog/tdd-bdd-noi-de-hon-lam">TDD/BDD - N√≥i d·ªÖ h∆°n l√†m</a></h2><div class="margin-vert--md"><time datetime="2018-09-22T00:00:00.000Z" class="blogPostDate_fNvV">September 22, 2018 ¬∑ 7 min read</time></div><div class="avatar margin-vert--md"><a href="https://github.com/moonlight8978" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img src="https://avatars.githubusercontent.com/u/26299310?v=4" alt="L√™ Sƒ© B√≠ch"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/moonlight8978" target="_blank" rel="noopener noreferrer">L√™ Sƒ© B√≠ch</a></h4><small class="avatar__subtitle">Ruby on Rails/React Developer</small></div></div></header><div class="markdown"><p>M·ªôt v√†i l∆∞u √Ω tr∆∞·ªõc khi b·∫Øt ƒë·∫ßu.</p><ul><li>Code demo trong b√†i s·∫Ω s·ª≠ d·ª•ng rspec, capybara, factory_bot (Ruby/Rails), h∆∞·ªõng t·ªõi ƒë·ªëi t∆∞·ª£ng Web developer.</li><li>B√†i vi·∫øt kh√¥ng tr√°nh kh·ªèi thi·∫øu s√≥t, n·∫øu c√≥ ch·ªó n√†o kh√¥ng ƒë√∫ng, m·ªçi ng∆∞·ªùi c·ª© quƒÉng g·∫°ch ·ªü d∆∞·ªõi comment :v</li></ul><p>√îng cha ta c√≥ c√¢u &quot;D·ª•c t·ªëc b·∫•t ƒë·∫°t&quot;. Tr∆∞·ªõc khi ƒëi v√†o chi ti·∫øt, ta h√£y c√πng ƒëi·ªÉm qua m·ªôt v√†i kh√°i ni·ªám tr∆∞·ªõc.</p><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="1-test-l√†-g√¨"></a>1. Test l√† g√¨?<a class="hash-link" href="#1-test-l√†-g√¨" title="Direct link to heading">#</a></h1><p>N·∫øu b·∫°n l√† m·ªôt developer, ch·∫Øc h·∫≥n s·∫Ω kh√¥ng l·∫° l·∫´m g√¨ kh√°i ni·ªám &quot;testing&quot;.</p><p>V√≠ d·ª• khi b·∫°n l·∫≠p tr√¨nh ch·ª©c nƒÉng ƒëƒÉng nh·∫≠p c·ªßa 1 trang web. Sau m·ªôt h·ªìi h√¨ h·ª•c code, ch·∫Øc h·∫≥n b·∫°n s·∫Ω v√†o trang ƒë√≥, ti·∫øn h√†nh ƒëƒÉng nh·∫≠p, r·ªìi ch·ªù xem code m√¨nh c√≥ ch·∫°y ƒë√∫ng hay kh√¥ng :v</p><p>Tuy nhi√™n gi·ªù ƒë√¢y, ƒëa s·ªë ƒë·ªÅu s·ª≠ d·ª•ng c√°c automated test script ƒë·ªÉ t·ª± ƒë·ªông h√≥a qu√° tr√¨nh test. H∆°n th·∫ø, n√≥ c√≤n gi√∫p nh·ªØng ng∆∞·ªùi maintainer sau n√†y c√≥ th·ªÉ hi·ªÉu <del>c√°i ƒë·ªëng h·ªï l·ªën</del> code b·∫°n ƒë·ªÉ l·∫°i ch·∫°y nh∆∞ th·∫ø n√†o.</p><p>Test kh√°c v·ªõi Debug.</p><p>C√°c lo·∫°i test n√™n ch√∫ √Ω:</p><ul><li>Unit test: test ri√™ng l·∫ª t·ª´ng class/function, vi·∫øt kh√° d·ªÖ.</li><li>Integration test, Feature test: ·ªü ƒë√¢y b·∫Øt ƒë·∫ßu c√≥ s·ª± k·∫øt h·ª£p gi·ªØa nhi·ªÅu module v·ªõi nhau ƒë·ªÉ m√¥ t·∫£ 1 (hay nhi·ªÅu) ch·ª©c nƒÉng c·ªßa ·ª©ng d·ª•ng.</li></ul><p>M√†u s·∫Øc ƒë·∫∑c tr∆∞ng:</p><ul><li>ƒê·ªè: xin chia bu·ªìn test c·ªßa b·∫°n ƒë√£ t·∫°ch =))</li><li>Xanh: ch√∫c m·ª´ng, test ƒë√£ pass, code c·ªßa b·∫°n &quot;c√≥ th·ªÉ&quot; ƒë√£ ch·∫°y ƒë√∫ng.</li></ul><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="2-tdd---test-driven-development"></a>2. TDD - Test Driven Development<a class="hash-link" href="#2-tdd---test-driven-development" title="Direct link to heading">#</a></h1><p>D·ªãch ra th√¨ s·∫Ω l√† <strong>Ph√°t tri·ªÉn v·ªõi tr·ªçng t√¢m l√† ki·ªÉm th·ª≠ (test)</strong>, hay n√¥m na l√† test tr∆∞·ªõc code sau.</p><p><img src="https://images.viblo.asia/bd25076f-2ddb-4b27-888e-d58ab8e8c286.png" alt="TDD"></p><ul><li><p>Tr∆∞·ªõc ti√™n ta vi·∫øt c√°c test script v√† ch·∫°y ch√∫ng, t·∫•t nhi√™n l√† s·∫Ω fail v√¨ l√†m g√¨ c√≥ code =))</p><p>VD ta mu·ªën vi·∫øt 1 h√†m t√≠nh s·ªë Fibonacci:</p><p><img src="https://wikimedia.org/api/rest_v1/media/math/render/svg/6693d2c78bc8132bb9b65be861148ca574a738ef" alt="Fibonacci"></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># spec/fibonacci_spec.rb</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">describe &quot;#fibonacci_of&quot; do</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  context &quot;one&quot; do</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    it &quot;returns 1&quot; do</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      expect(fibonacci_of(1)).to eq 1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  context &quot;two&quot; do</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    it &quot;returns 1&quot; do</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      expect(fibonacci_of(2)).to eq 1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  context &quot;greater than two&quot; do</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    it &quot;returns sum of two elements before&quot; do</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      expect(fibonacci_of(4)).to eq 3</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></li><li><p>R·ªìi ta m·ªõi b·∫Øt tay v√†o code, ch·∫°y test, n·∫øu fail th√¨ l·∫°i h√¨ h·ª•c s·ª≠a, h·ªèng ƒë√¢u v√° ƒë√≥. L√∫c n√†y b·∫°n ch∆∞a c·∫ßn b·∫≠n t√¢m v·ªÅ vi·ªác code m√¨nh c√≥ d·ªÖ hi·ªÉu/ƒë·∫πp kh√¥ng.</p><p>V√† sau 1 h·ªìi th√¨ cu·ªëi c√πng test ta c≈©ng pass :v</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># fibonacci.rb</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">def fibonacci_of(n)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  case n</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  when 1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  when 2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  else</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    fibonacci_of(n - 1) + fibonacci_of(n - 2)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></li><li><p>Ta s·∫Ω nh√¨n l·∫°i ƒë·ªëng h·ªï l·ªën m√† ta v·ª´a vi·∫øt ra, t·ªâa t√≥t l·∫°i cho ƒë·∫πp m·∫Øt, t√°ch service c√°c th·ª©. V√† nh·ªõ r·∫±ng ƒë·ª´ng l√†m cho test ƒë·ªè l√≤m.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># fibonacci.rb</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">def fibonacci_of(n)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  return 1 if [1, 2].include?(n)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  fibonacci_of(n - 1) + fibonacci_of(n - 2)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></li></ul><p><strong>L∆∞u √Ω:</strong> Kh√¥ng ph·∫£i c·ª© test pass l√† app c·ªßa ta ƒë√£ ch·∫°y ƒë√∫ng, vi·ªác n√†y c√≤n bao g·ªìm nhi·ªÅu y·∫øu t·ªë kh√°c nh∆∞</p><ul><li>Ta c√≥ hi·ªÉu ƒë√∫ng y√™u c·∫ßu c·ªßa kh√°ch h√†ng kh√¥ng</li><li>Test c·ªßa ta ƒë√£ bao g·ªìm h·∫øt c√°c tr∆∞·ªùng h·ª£p c√≥ th·ªÉ ch∆∞a</li></ul><p>C√≥ th·ªÉ d·ªÖ d√†ng nh·∫≠n th·∫•y, h√†m <code>#fibonacci_of</code> ·ªü tr√™n s·∫Ω ch·∫øt ngay l·∫≠p t·ª©c n·∫øu g·∫∑p tham s·ªë <code>&lt;= 0</code>.</p><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="3-bdd---behavior-driven-development"></a>3. BDD - Behavior Driven Development<a class="hash-link" href="#3-bdd---behavior-driven-development" title="Direct link to heading">#</a></h1><p><img src="http://blog.andolasoft.com/wp-content/uploads/2015/05/TDD-vs-BDD.jpg" alt="BDD"></p><p>K·∫ø th·ª´a ng∆∞·ªùi ti·ªÅn nhi·ªám TDD v·ªõi ph∆∞∆°ng ch√¢m &quot;Test tr∆∞·ªõc code sau&quot;, BDD ch·ªâ kh√°c ch√∫t l√† ta s·∫Ω t·∫≠p trung v√†o h√†nh vi ng∆∞·ªùi d√πng (feature).</p><p>Theo ƒë√≥, ta s·∫Ω vi·∫øt c√°c feature test tr∆∞·ªõc (m√¥ t·∫£ m·ªôt t√≠nh nƒÉng c·ªßa ·ª©ng d·ª•ng, ho·∫∑c usecase/userstory). V·ªõi m·ªói feature test ƒë√≥, ta c√≥ th·ªÉ s·∫Ω ph·∫£i tri·ªÉn khai th√™m 1 v√†i unit test/integration test cho c√°c class/function c·∫ßn thi·∫øt trong feature test.</p><p>V√≠ d·ª•: Ta mu·ªën x√¢y d·ª±ng t√≠nh nƒÉng t·∫°o album cho ·ª©ng d·ª•ng qu·∫£n l√Ω album nh·∫°c.</p><p>Tr∆∞·ªõc h·∫øt h√£y h√¨nh dung t√≠nh nƒÉng n√†y trong ƒë·∫ßu:</p><blockquote><p>Admin t·ª´ trang index albums (/albums), b·∫•m n√∫t &quot;Add album&quot;, 1 form s·∫Ω hi·ªán ra ƒë·ªÉ nh·∫≠p th√¥ng tin album (bao g·ªìm title v√† artist name).</p><p>N·∫øu anh admin n√†y nh·∫≠p ƒë√∫ng, h√£y redirect sang trang index v√† hi·ªÉn th·ªã album m·ªõi n√†y, c√≤n kh√¥ng th√¨ h√£y hi·ªán l·ªói ƒë·ªÉ anh admin c√≤n bi·∫øt ƒë∆∞·ªùng m√† l·∫ßn.</p></blockquote><p>Feature test c·ªßa ta s·∫Ω nh∆∞ sau:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># spec/features/create_album_spec.rb</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">RSpec.feature &quot;album creating process&quot;, type: :feature do</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  context &quot;all fields are filled correctly&quot; do</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    it &quot;create a new album&quot; do</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      visit &#x27;/albums&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      click_link &#x27;Add album&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      within &#x27;form#album_form&#x27; do</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        fill_in &#x27;Title&#x27;, with: &#x27;Chay ngay di&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        fill_in &#x27;Artist name&#x27;, with: &quot;Sep&#x27;ss&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      click_button &#x27;Create&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      expect(page).to have_content(&#x27;Chay ngay di&#x27;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  context &quot;title is blank&quot; do</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    it &quot;show errors&quot; do</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      visit &#x27;/albums&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      click_link &#x27;Add album&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      within &#x27;form#album_form&#x27; do</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        fill_in &#x27;Artist name&#x27;, with: &quot;Sep&#x27;ss&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      click_button &#x27;Create&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      expect(page).to have_content(&quot;Title can&#x27;t be blank&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>N·∫øu l√†m theo ƒë√∫ng flow c·ªßa Rails, ta s·∫Ω ph·∫£i vi·∫øt unit test cho:</p><ul><li>Controller: index, create - test xem logic b√™n trong ƒë√£ ƒë√∫ng ch∆∞a, status code ra sao.</li><li>View: new, index - test xem tr∆∞·ªùng h·ª£p c√≥ l·ªói th√¨ form hi·ªÉn th·ªã sao, hay tr∆∞·ªùng h·ª£p kh√¥ng c√≥ album th√¨ view index c√≥ th√¥ng b√°o cho ng∆∞·ªùi d√πng bi·∫øt hay kh√¥ng.</li><li>Model: album - test xem validate c√≥ ho·∫°t ƒë·ªông hay kh√¥ng.</li></ul><p>Chi ti·∫øt th√¨ m√¨nh xin l∆∞·ª£c b·ªõt v√¨ d√†i qu√°, b·∫°n c√≥ th·ªÉ tham kh·∫£o th√™m ·ªü <a href="http://hanamirb.org/guides/1.2/getting-started/" target="_blank" rel="noopener noreferrer">ƒë√¢y</a>.</p><p>N·∫øu b·∫°n bƒÉn khoƒÉn n√™n test c√°i g√¨ trong Rails, c√≥ th·ªÉ tham kh·∫£o b√†i <a href="https://m.patrikonrails.com/how-i-test-my-rails-applications-cf150e347a6b" target="_blank" rel="noopener noreferrer">n√†y</a>.</p><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="3-c√°c-nguy√™n-t·∫Øc-khi-vi·∫øt-test-tdd"></a>3. C√°c nguy√™n t·∫Øc khi vi·∫øt test (TDD)<a class="hash-link" href="#3-c√°c-nguy√™n-t·∫Øc-khi-vi·∫øt-test-tdd" title="Direct link to heading">#</a></h1><ol><li><p>Ch·ªâ vi·∫øt code khi n√≥ c·∫ßn thi·∫øt ƒë·ªÉ test c·ªßa b·∫°n pass.</p><p>VD b·∫°n vi·∫øt m·ªôt h√†m l·∫•y v·ªÅ email c·ªßa ng∆∞·ªùi d√πng theo <code>id</code>.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">def get_user_mail_by_id(id)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  user = User.find(id)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  user.mail</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>·ªû ƒë√¢y b·∫Øt bu·ªôc ph·∫£i truy v·∫•n CSDL ƒë·ªÉ t√¨m ra user. Kh√¥ng d√πng <code>find</code> th√¨ l·∫•y th√¥ng tin user th·∫ø n√†o :v</p></li><li><p>Ch·ªâ vi·∫øt n√™n unit test trong ph·∫°m vi v·ª´a ƒë·ªß.</p></li></ol><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="4-∆∞u-ƒëi·ªÉm"></a>4. ∆Øu ƒëi·ªÉm<a class="hash-link" href="#4-∆∞u-ƒëi·ªÉm" title="Direct link to heading">#</a></h1><ul><li><p>Nh·ªØng ng∆∞·ªùi n√£o to tr√™n th·∫ø gi·ªõi ƒë√£ ch·ª©ng minh ƒë∆∞·ª£c TDD gi√∫p thay ƒë·ªïi mindset c·ªßa b·∫°n, v√† b·∫°n s·∫Ω tr·ªü th√†nh nh·ªØng l·∫≠p tr√¨nh vi√™n t·ªët h∆°n.</p><p>N√≥ ƒë√≤i h·ªèi b·∫°n ph·∫£i thu t·∫≠p trung h∆°n v√†o nh·ªØng chi ti·∫øt nh·ªè ƒë·ªÉ test c·ªßa m√¨nh pass, h∆°n l√† suy nghƒ© v·∫©n v∆° v·ªÅ c·∫£ c√°i app to ƒë√πng.</p></li><li><p>Ngo√†i ki·ªÉm th·ª≠, test c≈©ng l√† docs cho maintainer sau n√†y, n√≥ cung c·∫•p chi ti·∫øt v·ªÅ c√°c ƒë·∫∑c t·∫£ k·ªπ thu·∫≠t (specification) c·ªßa app.</p></li><li><p>√çt bug h∆°n, d·ªÖ b·∫£o tr√¨, ph√°t hi·ªán l·ªói s·ªõm.</p></li><li><p>Cho b·∫°n bi·∫øt code m√† b·∫°n v·ª´a vi·∫øt xong n√≥ l√†m h·ªèng c·∫£ app kh√¥ng =))</p></li></ul><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="5-k·∫øt-lu·∫≠n"></a>5. K·∫øt lu·∫≠n<a class="hash-link" href="#5-k·∫øt-lu·∫≠n" title="Direct link to heading">#</a></h1><ul><li><p>TDD/BDD th·ª±c s·ª± r·∫•t t·ªët, n·∫øu b·∫°n mu·ªën tr·ªü th√†nh m·ªôt l·∫≠p tr√¨nh vi√™n t·ªët h∆°n, h√£y c·ªë g·∫Øng tryhard :v</p></li><li><p>Th∆∞·ªùng m·ªçi ng∆∞·ªùi hay c√≥ xu h∆∞·ªõng code xong m·ªõi vi·∫øt test, v√† m√¨nh c≈©ng l√† m·ªôt trong s·ªë ƒë√≥ =)). Tuy v·∫≠y, h√£y c·ªë g·∫Øng vi·∫øt test case c·ªßa m√¨nh th·∫≠t minh b·∫°ch, d·ªÖ hi·ªÉu, v√¨ ch√≠nh b·∫£n th√¢n ta v√† c√°c maintainer sau n√†y.</p></li></ul><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="6-tham-kh·∫£o"></a>6. Tham kh·∫£o<a class="hash-link" href="#6-tham-kh·∫£o" title="Direct link to heading">#</a></h1><ul><li><p><a href="https://medium.com/pacroy/test-driven-development-tdd-resource-site-tdd-pacroy-com-a02e02396f32" target="_blank" rel="noopener noreferrer">Test-Driven Development (TDD) Resource Site</a></p></li><li><p><a href="http://blog.andolasoft.com/2014/06/rails-things-you-must-know-about-tdd-and-bdd.html" target="_blank" rel="noopener noreferrer">Rails: Things you must know about TDD and BDD</a></p></li><li><p><a href="https://www.madetech.com/blog/9-benefits-of-test-driven-development" target="_blank" rel="noopener noreferrer">9 Benefits of Test Driven Development</a></p></li><li><p><a href="https://apiumhub.com/tech-blog-barcelona/advantages-of-test-driven-development/" target="_blank" rel="noopener noreferrer">20 ADVANTAGES OF TEST DRIVEN DEVELOPMENT</a></p></li><li><p><a href="http://hanamirb.org/guides/1.2/getting-started/" target="_blank" rel="noopener noreferrer">Hanami Official Guide</a></p></li><li><p><a href="https://m.patrikonrails.com/how-i-test-my-rails-applications-cf150e347a6b" target="_blank" rel="noopener noreferrer">How I test Rails applications</a></p></li></ul></div><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog/tags/tdd">tdd</a><a class="margin-horiz--sm" href="/blog/tags/bdd">bdd</a><a class="margin-horiz--sm" href="/blog/tags/testing">testing</a><a class="margin-horiz--sm" href="/blog/tags/ruby-on-rails">ruby-on-rails</a></div><div class="col text--right"><a aria-label="Read more about TDD/BDD - N√≥i d·ªÖ h∆°n l√†m" href="/blog/tdd-bdd-noi-de-hon-lam"><strong>Read More</strong></a></div></footer></article></div></main></div></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Self notes</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/moonlight8978/moonlight8978.github.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li><li class="footer__item"><a href="https://stackoverflow.com/users/8068639/moonlight8978" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright ¬© 2021 moonlight8978. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.f8558fbc.js"></script>
<script src="/assets/js/main.a94954d9.js"></script>
</body>
</html>