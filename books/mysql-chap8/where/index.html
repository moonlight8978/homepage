<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.0">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="moonlight8978's Blog Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="moonlight8978's Blog Blog Atom Feed"><title data-react-helmet="true">Tối ưu SELECT | moonlight8978&#x27;s Blog</title><meta data-react-helmet="true" property="og:url" content="https://moonlight8978.github.io/books/mysql-chap8/where"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-books-current"><meta data-react-helmet="true" property="og:title" content="Tối ưu SELECT | moonlight8978&#x27;s Blog"><meta data-react-helmet="true" name="description" content="Tổng quan"><meta data-react-helmet="true" property="og:description" content="Tổng quan"><link data-react-helmet="true" rel="shortcut icon" href="https://avatars.githubusercontent.com/u/26299310?v=4"><link data-react-helmet="true" rel="canonical" href="https://moonlight8978.github.io/books/mysql-chap8/where"><link data-react-helmet="true" rel="alternate" href="https://moonlight8978.github.io/books/mysql-chap8/where" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://moonlight8978.github.io/books/mysql-chap8/where" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.5f3c8191.css">
<link rel="preload" href="/assets/js/runtime~main.9bf10215.js" as="script">
<link rel="preload" href="/assets/js/main.a4c2403e.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="https://avatars.githubusercontent.com/u/26299310?v=4" alt="moonlight8978" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="https://avatars.githubusercontent.com/u/26299310?v=4" alt="moonlight8978" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">_MoonLight_</strong></a><a class="navbar__item navbar__link" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/docs/intro">Programming notes</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/books/intro">Book notes</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle displayOnlyInLargeViewport_GrZ2 react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">🌞</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="https://avatars.githubusercontent.com/u/26299310?v=4" alt="moonlight8978" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="https://avatars.githubusercontent.com/u/26299310?v=4" alt="moonlight8978" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">_MoonLight_</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/blog">Blog</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/intro">Programming notes</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/books/intro">Book notes</a></li><li class="menu__list-item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><div class="docSidebarContainer_3Kbt" role="complementary"><div class="sidebar_15mo"><div class="menu menu--responsive thin-scrollbar menu_Bmed"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/books/intro">Intro</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">AWS Certified Developer - Associated</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/books/aws-developer-associated/intro">Intro</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/books/aws-developer-associated/api-gateway">AWS API Gateway</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/books/aws-developer-associated/auto-scaling-group">Auto Scaling Group</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/books/aws-developer-associated/ci-cd">CI/CD</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/books/aws-developer-associated/cloud-formation">AWS CloudFormation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/books/aws-developer-associated/cloud-front">AWS CloudFront</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/books/aws-developer-associated/cloud-trail">AWS Cloud Trail</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/books/aws-developer-associated/code-star">AWS CodeStar</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/books/aws-developer-associated/cognito">AWS Cognito</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/books/aws-developer-associated/dynamo-db">DynamoDB</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/books/aws-developer-associated/ec2">AWS Elastic Compute Cloud (EC2)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/books/aws-developer-associated/ecs">Elastic Container Service</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/books/aws-developer-associated/elasti-cache">AWS Elasti Cache</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/books/aws-developer-associated/elastic-beanstalk">Elastic Beanstalk notes</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/books/aws-developer-associated/elb">Elastic Load Balancer</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/books/aws-developer-associated/event-bridge">AWS EventBridge</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/books/aws-developer-associated/iam">IAM</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/books/aws-developer-associated/kinesis">AWS Kinesis</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/books/aws-developer-associated/kms">AWS KMS</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/books/aws-developer-associated/lambda">Lambda</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/books/aws-developer-associated/parameter-store">AWS SSM Parameter Store</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/books/aws-developer-associated/rds">RDS</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/books/aws-developer-associated/route53">AWS Route 53</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/books/aws-developer-associated/s3">AWS Simple Storage Service</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/books/aws-developer-associated/sam">AWS Serverless Application Model</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/books/aws-developer-associated/secrets-manager">AWS Secrets Manager</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/books/aws-developer-associated/security-group">AWS Security Group</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/books/aws-developer-associated/ses">AWS Simple Email Service</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/books/aws-developer-associated/sns">AWS Simple Notification Service</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/books/aws-developer-associated/sqs">Amazon SQS</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/books/aws-developer-associated/step-functions">AWS Step Functions</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/books/aws-developer-associated/vpc">AWS Virtual Private Cloud</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/books/aws-developer-associated/x-ray">AWS X-Ray</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Database</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/books/database/high-performance-mysql">High Performance MySQL</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Javascript</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/books/javascript/ecma">ECMA</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">MySQL Docs - Optimization (Chapter 8)</a><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/books/mysql-chap8/where">Tối ưu SELECT</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/books/mysql-chap8/subquery">Optimize Subquery với Semijoin transformation</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">World Wide Web</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/books/www/oauth2-in-action">OAuth2 in Action</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3ufF"><div class="container padding-vert--lg docItemWrapper_3FMP"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><header><h1 class="docTitle_3a4h">Tối ưu SELECT</h1></header><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="tổng-quan"></a>Tổng quan<a class="hash-link" href="#tổng-quan" title="Direct link to heading">#</a></h2><p>Có 2 hướng tối ưu chính:</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="1-tối-ưu-tầng-db"></a>1. Tối ưu tầng DB<a class="hash-link" href="#1-tối-ưu-tầng-db" title="Direct link to heading">#</a></h3><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="cấu-trúc-db"></a>Cấu trúc DB:<a class="hash-link" href="#cấu-trúc-db" title="Direct link to heading">#</a></h5><ul><li>Đọc nhiều =&gt; ít table, nhiều column</li><li>Ghi nhiều =&gt; nhiều table, ít column</li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="index-đã-ổn-chưa"></a>Index đã ổn chưa?<a class="hash-link" href="#index-đã-ổn-chưa" title="Direct link to heading">#</a></h5><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="engine-cho-table"></a>Engine cho table<a class="hash-link" href="#engine-cho-table" title="Direct link to heading">#</a></h5><ul><li>MyISAM: Table-locking, phù hợp với table đọc nhiều, ghi ít</li><li>InnoDB: Row-locking, đáp ứng được việc ghi nhiều.</li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="caching"></a>Caching<a class="hash-link" href="#caching" title="Direct link to heading">#</a></h5><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="2-tối-ưu-phần-cứng"></a>2. Tối ưu phần cứng<a class="hash-link" href="#2-tối-ưu-phần-cứng" title="Direct link to heading">#</a></h3><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="disk-seek"></a>Disk seek:<a class="hash-link" href="#disk-seek" title="Direct link to heading">#</a></h5><ul><li><p>Thời gian HDD quay khi tìm dữ liệu, SDD không cần quay để tìm dữ liệu.</p></li><li><p>Phân tán dữ liệu để tìm trên nhiều ổ đĩa cùng lúc.</p></li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="disk-rw"></a>Disk R/W:<a class="hash-link" href="#disk-rw" title="Direct link to heading">#</a></h5><ul><li><p>Khi tìm được dữ liệu thì sẽ cần đọc dữ liệu vào RAM.</p></li><li><p>Phân tán để đọc/ghi nhiều trên nhiều ổ đĩa cùng lúc.</p></li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="cpu-cycle"></a>CPU cycle<a class="hash-link" href="#cpu-cycle" title="Direct link to heading">#</a></h5><ul><li>Khi đã load được vào RAM rồi, thì sẽ tới CPU xử lý những dữ liệu đó.</li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="memory-bandwidth"></a>Memory bandwidth:<a class="hash-link" href="#memory-bandwidth" title="Direct link to heading">#</a></h5><ul><li>Khi CPU cần nhiều dữ liệu, nhưng cache lại không đủ, sẽ cần đến memory bandwith.</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="tối-ưu-tầng-db---tối-ưu-select"></a>Tối ưu tầng DB - Tối ưu SELECT<a class="hash-link" href="#tối-ưu-tầng-db---tối-ưu-select" title="Direct link to heading">#</a></h2><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="1-where-clause-optimization"></a>1. WHERE clause optimization<a class="hash-link" href="#1-where-clause-optimization" title="Direct link to heading">#</a></h2><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="ngoài-select-thì-còn-áp-dụng-được-cho-cả-update-delete-vv"></a>Ngoài SELECT thì còn áp dụng được cho cả UPDATE, DELETE, v.v.<a class="hash-link" href="#ngoài-select-thì-còn-áp-dụng-được-cho-cả-update-delete-vv" title="Direct link to heading">#</a></h5><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="mysql-sẽ-tự-động-tối-ưu-những-trường-hợp-sau"></a>MySQL sẽ tự động tối ưu những trường hợp sau:<a class="hash-link" href="#mysql-sẽ-tự-động-tối-ưu-những-trường-hợp-sau" title="Direct link to heading">#</a></h5><ul><li><p>Loại bỏ những dấu ngoặc thừa</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sql"><div tabindex="0" class="prism-code language-sql codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> b</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> c </span><span class="token operator" style="color:rgb(137, 221, 255)">OR</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> b</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">c </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> d</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> b </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> c</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">OR</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> b </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> c </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> d</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></li><li><p>Thay thế biến bởi hằng số</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sql"><div tabindex="0" class="prism-code language-sql codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">b </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> b</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">c</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> a</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> b</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> b</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">c </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> a</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">5</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></li><li><p>Loại bỏ những điều kiện hằng</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sql"><div tabindex="0" class="prism-code language-sql codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">b</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;=</span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> b</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">OR</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">b</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">6</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">OR</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">b</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">7</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">6</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> b</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">OR</span><span class="token plain"> b</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">6</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></li><li><p>Biểu thức hằng (constant expression) sẽ chỉ được tính toán 1 lần duy nhất.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sql"><div tabindex="0" class="prism-code language-sql codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> t</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">WHERE</span><span class="token plain"> id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> POW</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> t</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">WHERE</span><span class="token plain"> id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> FLOOR</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> RAND</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">49</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></li><li><p><code>HAVING</code> sẽ được gộp với <code>WHERE</code> khi không sử dụng <code>GROUP BY</code> hay những function như <code>COUNT()</code>, <code>MIN()</code>, <code>MAX()</code>, ...</p></li><li><p>Đối với <strong>MyISAM</strong> hay <strong>MEMORY</strong> table, kết quả của <code>COUNT(*)</code> (không có điều kiện <code>WHERE</code> sẽ được lấy trực tiếp từ <strong>information_schema</strong>.</p></li></ul><p>=&gt; Ta có thể ngừng việc tối ưu lại, và viết những câu lệnh SQL dễ hiểu, dễ bảo trì.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="2-range-optimization"></a>2. Range optimization<a class="hash-link" href="#2-range-optimization" title="Direct link to heading">#</a></h2><ul><li><code>range</code> là một <strong>access method</strong></li><li><code>range</code> sử dụng index để lấy ra những subset của kết quả cuối cùng.</li><li><code>range</code> support cả single-part lẫn multiple-part index.</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="những-trường-hợp-sau-mysql-sẽ-coi-như-là-range-condition"></a>Những trường hợp sau, MySQL sẽ coi như là <code>range condition</code>:<a class="hash-link" href="#những-trường-hợp-sau-mysql-sẽ-coi-như-là-range-condition" title="Direct link to heading">#</a></h4><ul><li><p>Mệnh đề <code>WHERE</code> đối với những trường được đánh index (sử dụng BTree hoặc Hash), mà sử dụng những toán tử sau: <code>=</code>, <code>&lt;=&gt;</code>, <code>IN()</code>, <code>IS NULL</code>, hay <code>IS NOT NULL</code></p><p>Đối với, BTree, ngoài những phép toán trên, còn support thêm <code>&gt;</code>, <code>&lt;</code>, <code>&lt;=</code>, <code>&gt;=</code>, <code>BETWEEN</code>, <code>!=</code>, hay <code>&lt;&gt;</code> với <strong>constant value</strong>, hoặc <code>LIKE</code> cũng là range condition. Chú ý khi sử dụng <code>LIKE</code>, vế phải phải là 1 string hằng, và không bắt đầu bởi wildcard như <code>%</code> hay <code>_</code>.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sql"><div tabindex="0" class="prism-code language-sql codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> t1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">WHERE</span><span class="token plain"> key_col </span><span class="token operator" style="color:rgb(137, 221, 255)">LIKE</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;ab%&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></li><li><p>Kết hợp nhiều range condition sử dụng <code>AND</code> hoặc <code>OR</code>, ta vẫn thu được range condition.</p></li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="constant-value"></a>Constant value<a class="hash-link" href="#constant-value" title="Direct link to heading">#</a></h4><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="là-giá-trị-được-tính-toán-trước-thời-điểm-runtime-khi-runtime-giá-trị-của-nó-sẽ-không-thay-đổi"></a>Là giá trị được tính toán trước thời điểm runtime, khi runtime, giá trị của nó sẽ không thay đổi<a class="hash-link" href="#là-giá-trị-được-tính-toán-trước-thời-điểm-runtime-khi-runtime-giá-trị-của-nó-sẽ-không-thay-đổi" title="Direct link to heading">#</a></h5><ul><li>Hằng số truyền thẳng vào tham số của câu truy vấn</li><li>Một cột của <code>const</code> hay <code>system</code> table<ul><li><code>const</code> table là bảng chỉ có tối đa 1 row (hay 0 hoặc 1 row).</li><li><code>const</code> table có thể là kết quả của 1 câu truy vấn chứa mệnh đề <code>WHERE</code> đối với 1 field unique, not null, có dạng <code>column = constant</code>. Truy vấn này luôn trả về 1 kết quả duy nhất.</li><li>table có 1 row thì gọi là <code>system</code> table</li></ul></li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="btree-hash-index"></a>BTree, Hash index<a class="hash-link" href="#btree-hash-index" title="Direct link to heading">#</a></h4><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="btree"></a>BTree:<a class="hash-link" href="#btree" title="Direct link to heading">#</a></h5><ul><li><p>Self-balancing tree, cấu trúc dạng cây, có thể tự cân bằng nhằm giữ chiều cao của cây thấp nhất có thể.</p></li><li><p>Tránh nhầm với Binary Tree (cây nhị phân)</p></li><li><p>Thời gian tìm kiếm O(logn)</p></li><li><p>Phù hợp với đa dạng các phép toán: <code>=</code>, <code>&lt;=&gt;</code>, <code>IN()</code>, <code>IS NULL</code>, <code>IS NOT NULL</code>, <code>&gt;</code>, <code>&lt;</code>, <code>&lt;=</code>, <code>&gt;=</code>, <code>BETWEEN</code>, <code>!=</code>, <code>&lt;&gt;</code>, hay thậm chí cả <code>LIKE</code></p></li></ul><p><img src="https://camo.githubusercontent.com/cb15fccfa6fafa1cea762a58c1dd51ad8f32fe2c/68747470733a2f2f63646e2d696d616765732d312e6d656469756d2e636f6d2f6d61782f313630302f312a70453453457a374370727a4664375a77772d617866512e6a706567"></p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="hash"></a>Hash:<a class="hash-link" href="#hash" title="Direct link to heading">#</a></h5><ul><li><p>Bảng băm, là cấu trúc dữ liệu lưu theo key-value</p></li><li><p>Tìm kiếm theo key rất nhanh - O(1)</p></li><li><p>Phù hợp với những phép toán: <code>=</code>, <code>&lt;=&gt;</code>, <code>IN()</code>, <code>IS NULL</code>, hay <code>IS NOT NULL</code>.</p></li></ul><p><img src="https://camo.githubusercontent.com/b1df2be12b1c8779b7cf941d88d1cc8e2178753f/68747470733a2f2f696d616765732e7669626c6f2e617369612f30356236313638372d386230342d346536352d613834642d3361353363343035386437642e6a7067"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="21-single-part-index"></a>2.1. Single-part index<a class="hash-link" href="#21-single-part-index" title="Direct link to heading">#</a></h3><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="single-part-index-là-những-index-được-đánh-riêng-lẻ-cho-1-field"></a>Single-part index là những index được đánh riêng lẻ cho 1 field.<a class="hash-link" href="#single-part-index-là-những-index-được-đánh-riêng-lẻ-cho-1-field" title="Direct link to heading">#</a></h5><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sql"><div tabindex="0" class="prism-code language-sql codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">INDEX</span><span class="token plain"> index_name </span><span class="token keyword" style="font-style:italic">ON</span><span class="token plain"> t1 </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">key_col</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Khi thực hiện truy vấn với những index loại này, với mỗi possible key (có thể sử dụng <code>EXPLAIN</code> để check), MySQL sẽ tiến hành extract range condition. Những điều kiện không thể cấu thành range condition sẽ bị loại bỏ, những điều kiện có thể bị overlap sẽ được gộp với nhau.</p><p>Sau khi extract, MySQL sẽ áp dụng những điều kiện đó để tận dụng được tối đa index của table, sau đó kết hợp thêm với những điều kiện còn lại để lọc tiếp.</p><p>MySQL chỉ bỏ qua index, nếu như nó tin rằng việc duyệt full table tối ưu hơn, hoặc dùng <code>FORCE INDEX</code>.</p><p>VD:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sql"><div tabindex="0" class="prism-code language-sql codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> t1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">WHERE</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">key1 </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;abc&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">key1 </span><span class="token operator" style="color:rgb(137, 221, 255)">LIKE</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;abcde%&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">OR</span><span class="token plain"> key1 </span><span class="token operator" style="color:rgb(137, 221, 255)">LIKE</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;%b&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token operator" style="color:rgb(137, 221, 255)">OR</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">key1 </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;bar&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> nonkey </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">4</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token operator" style="color:rgb(137, 221, 255)">OR</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">key1 </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;uux&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> key1 </span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;z&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">key1 </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;abc&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">key1 </span><span class="token operator" style="color:rgb(137, 221, 255)">LIKE</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;abcde%&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">OR</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">TRUE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">OR</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">key1 </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;bar&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">TRUE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">OR</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">key1 </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;uux&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> key1 </span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;z&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">key1 </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;abc&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">TRUE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">OR</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">key1 </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;bar&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">TRUE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">OR</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token boolean" style="color:rgb(255, 88, 116)">FALSE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> key1 </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;abc&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">OR</span><span class="token plain"> key1 </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;bar&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> key1 </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;bar&#x27;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="22-multiple-part-index"></a>2.2. Multiple-part index<a class="hash-link" href="#22-multiple-part-index" title="Direct link to heading">#</a></h3><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="multiple-part-index-là-những-index-được-đánh-cho-nhiều-trường-cùng-lúc"></a>Multiple-Part Index là những index được đánh cho nhiều trường cùng lúc<a class="hash-link" href="#multiple-part-index-là-những-index-được-đánh-cho-nhiều-trường-cùng-lúc" title="Direct link to heading">#</a></h5><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sql"><div tabindex="0" class="prism-code language-sql codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">INDEX</span><span class="token plain"> index_name </span><span class="token keyword" style="font-style:italic">ON</span><span class="token plain"> t1 </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">key_part1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> key_part2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Range condition sẽ sử dụng <strong>key tuple intervals</strong> để tìm kiếm. Key tuple intervals được định nghĩa bởi những key tuples, có thứ tự.</p><p><strong>Tuple</strong> là 1 cặp giá trị. VD: (1, 2, 3), (1, &#x27;a&#x27;, 3), ...</p><p>Lấy ví dụ về 1 multiple-part index <code>key1(key_part1, key_part2, key_part3)</code>, và những tuples ứng với key tuple (key_part1, key_part2, key_part3) sau:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly txt"><div tabindex="0" class="prism-code language-txt codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">key_part1  key_part2  key_part3</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  NULL       1          &#x27;abc&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  NULL       1          &#x27;xyz&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  NULL       2          &#x27;foo&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   1         1          &#x27;abc&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   1         1          &#x27;xyz&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   1         2          &#x27;abc&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   2         1          &#x27;aaa&#x27;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><code>key_part1 = 1</code> define interval sau:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly txt"><div tabindex="0" class="prism-code language-txt codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(1,-inf,-inf) &lt;= (key_part1,key_part2,key_part3) &lt; (1,+inf,+inf)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Interval trên sẽ được sử dụng bởi <code>range</code> access method.</p><p>Bên cạnh đó, <code>key_part3 = &#x27;abc&#x27;</code> không tạo ra interval nào (giá trị liền mạch nhau), vì thế sẽ không thể sử dụng bởi <code>range</code></p><p>Chú ý khi sử dụng:</p><ul><li><p>Với Hash index, nếu index có <code>N</code> part, thì condition của ta phải có format sau</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sql"><div tabindex="0" class="prism-code language-sql codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">    key_part1 cmp const1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> key_part2 cmp const2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> key_partN cmp constN</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><code>cmp</code> là một trong những toán tử <code>=</code>, <code>&lt;=&gt;</code>, hoặc <code>IS NULL</code></p></li><li><p>Với BTree index, 1 interval có thể sử dụng cho những điều kiện kết hợp bởi <code>AND</code>, trong đó mỗi điều kiện so sánh 1 key part với 1 hằng số, sử dụng <code>=</code>, <code>&lt;=&gt;</code>, <code>IS NULL</code>, <code>&gt;</code>, <code>&lt;</code>, <code>&gt;=</code>, <code>&lt;=</code>, <code>!=</code>, <code>&lt;&gt;</code>.</p><p>Optimizer trong khi tính toán interval, sẽ sử dụng thêm key part nếu toán tử là <code>=</code>, <code>&lt;=&gt;</code> hay <code>IS NULL</code>. Còn nếu là <code>&gt;</code>, <code>&lt;</code>, <code>&gt;=</code>, <code>&lt;=</code>, <code>!=</code>, <code>&lt;&gt;</code>, <code>BETWEEN</code> hay <code>LIKE</code> thì sẽ không lấy thêm key part nữa.</p><p>VD1:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sql"><div tabindex="0" class="prism-code language-sql codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">key_part1 </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;foo&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> key_part2 </span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">10</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> key_part3 </span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">10</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>sẽ sử dụng interval:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sql"><div tabindex="0" class="prism-code language-sql codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;foo&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">10</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">inf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">key_part1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">key_part2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">key_part3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;foo&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain">inf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain">inf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>VD2:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sql"><div tabindex="0" class="prism-code language-sql codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">key_part1 </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> key_part2 </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">OR</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">key_part1 </span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>sẽ sử dụng 2 interval:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sql"><div tabindex="0" class="prism-code language-sql codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">inf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">key_part1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">key_part2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">inf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">key_part1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">key_part2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Trong ví dụ này, interval thứ nhất sử dụng 1 key part ở vế trái, vế phải sử dụng 2 key part.</p><p>Interval thứ 2 chỉ sử dụng 1 key part.</p><p>Giá trị <code>key_len</code> khi thực hiện <code>EXPLAIN</code> sẽ trả về độ dài tối đa của key prefix được sử dụng.</p></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="index-dive"></a>Index Dive<a class="hash-link" href="#index-dive" title="Direct link to heading">#</a></h3><p>Index dive được thực hiện trong khi optimizing để tính toán estimate (số row thỏa mãn 1 condition), để quyết định xem có nên dùng index hay không. Có thể skip bằng cách dùng <code>FORCE INDEX</code></p><p>Nếu điều kiện phức tạp thì index dive sẽ mất nhiều thời gian.</p><p>Ngoài index dive, MySQL cũng có thể sử dụng index statistics để estimate, tuy nhiên độ chính xác thấp hơn, có thể dùng <code>ANALYZE TABLE</code> để update lại index statistics, tăng cường độ chính xác.</p><p>Index dive bị skip trong trường hợp thỏa mãn tất cả điều kiện sau (chỉ áp dụng cho single table query):</p><ul><li><code>FORCE INDEX</code></li><li>Nonunique index, và không phải <code>FULLTEXT</code> index.</li><li>Không có subquery</li><li>Không có <code>DISTINCT</code>, <code>GROUP BY</code>, hoặc <code>ORDER BY</code>.</li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="equality-range-optimization-of-many-valued-comparisons"></a>Equality Range Optimization of Many-Valued Comparisons<a class="hash-link" href="#equality-range-optimization-of-many-valued-comparisons" title="Direct link to heading">#</a></h5><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sql"><div tabindex="0" class="prism-code language-sql codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">col_name </span><span class="token operator" style="color:rgb(137, 221, 255)">IN</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">val1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> valN</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">col_name </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> val1 </span><span class="token operator" style="color:rgb(137, 221, 255)">OR</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">OR</span><span class="token plain"> col_name </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> valN</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Những biểu thức như trên, với <code>col_name</code> được đánh index, và so sánh với nhiều giá trị, được gọi là range comparisions (mỗi range là 1 giá trị). Optimizer sẽ estimate cost của mỗi range như sau:</p><ul><li>Nếu index là unique, cost = 1</li><li>Nếu không unique, sẽ cần sử dụng index dive hoặc index statistics để estimate.</li></ul><p>Ứng với mỗi range là 2 lần dive (1 cho điểm bắt đầu, 1 cho điểm kết thúc) của range (interval).</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/moonlight8978/moonlight8978.github.io/edit/v2/books/books/mysql-chap8/1-where.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col text--right"><em><small>Last updated on <time datetime="2021-06-07T07:55:41.000Z" class="lastUpdatedDate_1WI_">6/7/2021</time></small></em></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/books/javascript/ecma"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« ECMA</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/books/mysql-chap8/subquery"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Optimize Subquery với Semijoin transformation »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#tổng-quan" class="table-of-contents__link">Tổng quan</a><ul><li><a href="#1-tối-ưu-tầng-db" class="table-of-contents__link">1. Tối ưu tầng DB</a></li><li><a href="#2-tối-ưu-phần-cứng" class="table-of-contents__link">2. Tối ưu phần cứng</a></li></ul></li><li><a href="#tối-ưu-tầng-db---tối-ưu-select" class="table-of-contents__link">Tối ưu tầng DB - Tối ưu SELECT</a></li><li><a href="#1-where-clause-optimization" class="table-of-contents__link">1. WHERE clause optimization</a></li><li><a href="#2-range-optimization" class="table-of-contents__link">2. Range optimization</a><ul><li><a href="#21-single-part-index" class="table-of-contents__link">2.1. Single-part index</a></li><li><a href="#22-multiple-part-index" class="table-of-contents__link">2.2. Multiple-part index</a></li><li><a href="#index-dive" class="table-of-contents__link">Index Dive</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Self notes</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/moonlight8978/moonlight8978.github.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li><li class="footer__item"><a href="https://stackoverflow.com/users/8068639/moonlight8978" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2021 moonlight8978. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.9bf10215.js"></script>
<script src="/assets/js/main.a4c2403e.js"></script>
</body>
</html>